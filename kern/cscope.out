cscope 15 $HOME/src/kern               0000519587
	@/home/trinity/src/kern/Makefile

1 #
#T›Àvñ 
makefûe
 
the
 
OS
/161 
kî√l
 
åì
.

3 #
#NŸe: 
a˘uÆ
 
kî√ls
 
¨e
 
nŸ
 
compûed
 
hîe
; 
they
áª compûed 
ö


5 #compûe/
FOO
 
whîe
 FOO 
is
 
a
 
kî√l
 
c⁄figuøti⁄
 
«me
.

6 #
#Wê
d⁄
'táctually doánything from hereÉxcept install includes.

10 
	gTOP
=..

11 .
ö˛ude
 "$(TOP)/mk/os161.config.mk"

13 
INCLUDES
=\

14 
ö˛ude
/
kîn
 include/kern \

15 
¨ch
/
$
(
MACHINE
)/
ö˛ude
/
kîn
 include/kern/$(MACHINE)

17 .
ö˛ude
 "$(TOP)/mk/os161.includes.mk"

	@/home/trinity/src/kern/arch/mips/include/current.h

30 #i‚de‡
_MIPS_CURRENT_H_


31 
	#_MIPS_CURRENT_H_


	)

62 #ifde‡
__GNUC__


63 
thªad
 *
cuπhªad
 
__asm
("$23");

67 #unde‡
__NEED_CURTHREAD


68 
	#__NEED_CURCPU


	)

71 
	#INIT_CURCPU
(
˝u
, 
thªad
Ë(
cuπhªad
 = (thªad), 
cur˝u
 = (˝u))

	)

	@/home/trinity/src/kern/arch/mips/include/elf.h

30 #i‚de‡
_MIPS_ELF_H_


31 
	#_MIPS_ELF_H_


	)

39 
	#EM_MACHINE
 
EM_MIPS


	)

42 
	#R_MIPS_NONE
 0

	)

43 
	#R_MIPS_16
 1

	)

44 
	#R_MIPS_32
 2

	)

45 
	#R_MIPS_REL32
 3

	)

46 
	#R_MIPS_26
 4

	)

47 
	#R_MIPS_HI16
 5

	)

48 
	#R_MIPS_LO16
 6

	)

49 
	#R_MIPS_GPREL16
 7

	)

50 
	#R_MIPS_LITERAL
 8

	)

51 
	#R_MIPS_GOT16
 9

	)

52 
	#R_MIPS_PC16
 10

	)

53 
	#R_MIPS_CALL16
 11

	)

54 
	#R_MIPS_GPREL32
 12

	)

	@/home/trinity/src/kern/arch/mips/include/kern/endian.h

30 #i‚de‡
_KERN_MIPS_ENDIAN_H_


31 
	#_KERN_MIPS_ENDIAN_H_


	)

42 
	#_BYTE_ORDER
 
_BIG_ENDIAN


	)

	@/home/trinity/src/kern/arch/mips/include/kern/regdefs.h

36 #i‚de‡
_KERN_MIPS_REGDEFS_H_


37 
	#_KERN_MIPS_REGDEFS_H_


	)

40 
	#z0
 
$0


	)

41 
	#AT
 
$1


	)

42 
	#v0
 
$2


	)

43 
	#v1
 
$3


	)

44 
	#a0
 
$4


	)

45 
	#a1
 
$5


	)

46 
	#a2
 
$6


	)

47 
	#a3
 
$7


	)

48 
	#t0
 
$8


	)

49 
	#t1
 
$9


	)

50 
	#t2
 
$10


	)

51 
	#t3
 
$11


	)

52 
	#t4
 
$12


	)

53 
	#t5
 
$13


	)

54 
	#t6
 
$14


	)

55 
	#t7
 
$15


	)

56 
	#s0
 
$16


	)

57 
	#s1
 
$17


	)

58 
	#s2
 
$18


	)

59 
	#s3
 
$19


	)

60 
	#s4
 
$20


	)

61 
	#s5
 
$21


	)

62 
	#s6
 
$22


	)

63 
	#s7
 
$23


	)

64 
	#t8
 
$24


	)

65 
	#t9
 
$25


	)

66 
	#k0
 
$26


	)

67 
	#k1
 
$27


	)

68 
	#gp
 
$28


	)

69 
	#•
 
$29


	)

70 
	#s8
 
$30


	)

71 
	#ø
 
$31


	)

	@/home/trinity/src/kern/arch/mips/include/kern/setjmp.h

30 #i‚de‡
_MIPS_SETJMP_H_


31 
	#_MIPS_SETJMP_H_


	)

41 
	#__JB_REGS
 11

	)

44 
uöt32_t
 
	tjmp_buf
[
__JB_REGS
];

	@/home/trinity/src/kern/arch/mips/include/kern/signal.h

31 #i‚de‡
_KERN_MIPS_SIGNAL_H_


32 
	#_KERN_MIPS_SIGNAL_H_


	)

41 
	ssigc⁄ãxt
 {

	@/home/trinity/src/kern/arch/mips/include/kern/types.h

30 #i‚de‡
_KERN_MIPS_TYPES_H_


31 
	#_KERN_MIPS_TYPES_H_


	)

43 
	t__i8
;

44 
	t__i16
;

45 
	t__i32
;

46 
	t__i64
;

48 
	t__u8
;

49 
	t__u16
;

50 
	t__u32
;

51 
	t__u64
;

54 
	t__öçå_t
;

55 
	t__uöçå_t
;

65 
	t__size_t
;

66 
	t__ssize_t
;

67 
	t__±rdiff_t
;

69 
	t__size_t
;

70 
	t__ssize_t
;

71 
	t__±rdiff_t
;

75 
	#__CHAR_BIT
 8

	)

	@/home/trinity/src/kern/arch/mips/include/membar.h

30 #i‚de‡
_MIPS_MEMBAR_H_


31 
	#_MIPS_MEMBAR_H_


	)

43 
MEMBAR_INLINE


45 
	$memb¨_™y_™y
()

47 
__asm
 volatile(

55 
	}
}

57 
MEMBAR_INLINE
 
	$memb¨_lﬂd_lﬂd
(Ë{ 
	`memb¨_™y_™y
(); 
	}
}

58 
MEMBAR_INLINE
 
	$memb¨_°‹e_°‹e
(Ë{ 
	`memb¨_™y_™y
(); 
	}
}

59 
MEMBAR_INLINE
 
	$memb¨_°‹e_™y
(Ë{ 
	`memb¨_™y_™y
(); 
	}
}

60 
MEMBAR_INLINE
 
	$memb¨_™y_°‹e
(Ë{ 
	`memb¨_™y_™y
(); 
	}
}

	@/home/trinity/src/kern/arch/mips/include/specialreg.h

30 #i‚de‡
_MIPS_SPECIALREG_H_


31 
	#_MIPS_SPECIALREG_H_


	)

37 
	#c0_ödex
 
$0


	)

38 
	#c0_øndom
 
$1


	)

39 
	#c0_íåylo
 
$2


	)

42 
	#c0_c⁄ãxt
 
$4


	)

45 
	#c0_vaddr
 
$8


	)

46 
	#c0_cou¡
 
$9


	)

47 
	#c0_íåyhi
 
$10


	)

48 
	#c0_com∑ª
 
$11


	)

49 
	#c0_°©us
 
$12


	)

50 
	#c0_ˇu£
 
$13


	)

51 
	#c0_ïc
 
$14


	)

52 
	#c0_¥id
 
$15


	)

61 
	#CST_IEc
 0x00000001

	)

62 
	#CST_KUc
 0x00000002

	)

63 
	#CST_IEp
 0x00000004

	)

64 
	#CST_KUp
 0x00000008

	)

65 
	#CST_IEo
 0x00000010

	)

66 
	#CST_KUo
 0x00000020

	)

67 
	#CST_MODEMASK
 0x0000003‡

	)

68 
	#CST_IRQMASK
 0x0000ff00

	)

69 
	#CST_BEV
 0x00400000

	)

74 
	#CCA_UTLB
 0x00000001

	)

75 
	#CCA_CODE
 0x0000003¯

	)

76 
	#CCA_IRQS
 0x0000ff00

	)

77 
	#CCA_COPN
 0x30000000

	)

78 
	#CCA_JD
 0x80000000

	)

80 
	#CCA_CODESHIFT
 2

	)

85 
	#CIN_P
 0x80000000

	)

86 
	#CIN_INDEX
 0x00003f00

	)

88 
	#CIN_INDEXSHIFT
 8

	)

105 
	#CTX_VSHIFT
 0x001ffff¯

	)

106 
	#CTX_PTBASE
 0xf„00000

	)

108 
	#CTX_PTBASESHIFT
 21

	)

113 
	#EXADDR_UTLB
 0x80000000

	)

114 
	#EXADDR_GENERAL
 0x80000080

	)

	@/home/trinity/src/kern/arch/mips/include/spinlock.h

30 #i‚de‡
_MIPS_SPINLOCK_H_


31 
	#_MIPS_SPINLOCK_H_


	)

33 
	~<cdefs.h
>

37 
	t•ölock_d©a_t
;

40 
	#SPINLOCK_DATA_INITIALIZER
 0

	)

43 
SPINLOCK_INLINE


44 
•ölock_d©a_£t
(vﬁ©ûê
•ölock_d©a_t
 *
sd
, 
vÆ
);

45 
SPINLOCK_INLINE


46 
•ölock_d©a_t
 
•ölock_d©a_gë
(vﬁ©ûê•ölock_d©a_à*
sd
);

47 
SPINLOCK_INLINE


48 
•ölock_d©a_t
 
•ölock_d©a_ã°™d£t
(vﬁ©ûê•ölock_d©a_à*
sd
);

57 
SPINLOCK_INLINE


59 
	$•ölock_d©a_£t
(vﬁ©ûê
•ölock_d©a_t
 *
sd
, 
vÆ
)

61 *
sd
 = 
vÆ
;

62 
	}
}

68 
SPINLOCK_INLINE


69 
•ölock_d©a_t


70 
	$•ölock_d©a_gë
(vﬁ©ûê
•ölock_d©a_t
 *
sd
)

72  *
sd
;

73 
	}
}

88 
SPINLOCK_INLINE


89 
•ölock_d©a_t


90 
	$•ölock_d©a_ã°™d£t
(vﬁ©ûê
•ölock_d©a_t
 *
sd
)

92 
•ölock_d©a_t
 
x
;

93 
•ölock_d©a_t
 
y
;

106 
y
 = 1;

107 
__asm
 volatile(

114 : "=&r" (
x
), "+r" (
y
Ë: "r" (
sd
));

115 i‡(
y
 == 0) {

118  
x
;

119 
	}
}

	@/home/trinity/src/kern/arch/mips/include/thread.h

30 #i‚de‡
_MIPS_THREAD_H_


31 
	#_MIPS_THREAD_H_


	)

38 
	~<£tjmp.h
>

40 (*
	tbadÁu…func_t
)();

42 
	sthªad_machdï
 {

43 
badÁu…func_t
 
tm_badÁu…func
;

44 
jmp_buf
 
tm_c›yjmp
;

	@/home/trinity/src/kern/arch/mips/include/tlb.h

30 #i‚de‡
_MIPS_TLB_H_


31 
	#_MIPS_TLB_H_


	)

58 
éb_øndom
(
uöt32_t
 
íåyhi
, uöt32_à
íåylo
);

59 
éb_wrôe
(
uöt32_t
 
íåyhi
, uöt32_à
íåylo
, uöt32_à
ödex
);

60 
éb_ªad
(
uöt32_t
 *
íåyhi
, uöt32_à*
íåylo
, uöt32_à
ödex
);

61 
éb_¥obe
(
uöt32_t
 
íåyhi
, uöt32_à
íåylo
);

80 
	#TLBHI_VPAGE
 0xfffff000

	)

84 
	#TLBLO_PPAGE
 0xfffff000

	)

85 
	#TLBLO_NOCACHE
 0x00000800

	)

86 
	#TLBLO_DIRTY
 0x00000400

	)

87 
	#TLBLO_VALID
 0x00000200

	)

95 
	#TLBHI_INVALID
(
íåyno
Ë((0x80000+”¡ryno))<<12)

	)

96 
	#TLBLO_INVALID
(Ë(0)

	)

102 
	#NUM_TLB
 64

	)

	@/home/trinity/src/kern/arch/mips/include/trapframe.h

30 #i‚de‡
_MIPS_TRAPFRAME_H_


31 
	#_MIPS_TRAPFRAME_H_


	)

40 
	så≠‰ame
 {

41 
uöt32_t
 
	mtf_vaddr
;

42 
uöt32_t
 
	mtf_°©us
;

43 
uöt32_t
 
	mtf_ˇu£
;

44 
uöt32_t
 
	mtf_lo
;

45 
uöt32_t
 
	mtf_hi
;

46 
uöt32_t
 
	mtf_ø
;

47 
uöt32_t
 
	mtf_©
;

48 
uöt32_t
 
	mtf_v0
;

49 
uöt32_t
 
	mtf_v1
;

50 
uöt32_t
 
	mtf_a0
;

51 
uöt32_t
 
	mtf_a1
;

52 
uöt32_t
 
	mtf_a2
;

53 
uöt32_t
 
	mtf_a3
;

54 
uöt32_t
 
	mtf_t0
;

55 
uöt32_t
 
	mtf_t1
;

56 
uöt32_t
 
	mtf_t2
;

57 
uöt32_t
 
	mtf_t3
;

58 
uöt32_t
 
	mtf_t4
;

59 
uöt32_t
 
	mtf_t5
;

60 
uöt32_t
 
	mtf_t6
;

61 
uöt32_t
 
	mtf_t7
;

62 
uöt32_t
 
	mtf_s0
;

63 
uöt32_t
 
	mtf_s1
;

64 
uöt32_t
 
	mtf_s2
;

65 
uöt32_t
 
	mtf_s3
;

66 
uöt32_t
 
	mtf_s4
;

67 
uöt32_t
 
	mtf_s5
;

68 
uöt32_t
 
	mtf_s6
;

69 
uöt32_t
 
	mtf_s7
;

70 
uöt32_t
 
	mtf_t8
;

71 
uöt32_t
 
	mtf_t9
;

72 
uöt32_t
 
	mtf_gp
;

73 
uöt32_t
 
	mtf_•
;

74 
uöt32_t
 
	mtf_s8
;

75 
uöt32_t
 
	mtf_ïc
;

81 
	#EX_IRQ
 0

	)

82 
	#EX_MOD
 1

	)

83 
	#EX_TLBL
 2

	)

84 
	#EX_TLBS
 3

	)

85 
	#EX_ADEL
 4

	)

86 
	#EX_ADES
 5

	)

87 
	#EX_IBE
 6

	)

88 
	#EX_DBE
 7

	)

89 
	#EX_SYS
 8

	)

90 
	#EX_BP
 9

	)

91 
	#EX_RI
 10

	)

92 
	#EX_CPU
 11

	)

93 
	#EX_OVF
 12

	)

99 
__DEAD
 
mùs_u£rmode
(
å≠‰ame
 *
tf
);

104 
vaddr_t
 
˝u°acks
[];

105 
vaddr_t
 
˝uthªads
[];

	@/home/trinity/src/kern/arch/mips/include/types.h

30 #i‚de‡
_MIPS_TYPES_H_


31 
	#_MIPS_TYPES_H_


	)

43 
__u32
 
	t∑ddr_t
;

44 
__u32
 
	tvaddr_t
;

	@/home/trinity/src/kern/arch/mips/include/vm.h

30 #i‚de‡
_MIPS_VM_H_


31 
	#_MIPS_VM_H_


	)

38 
	#PAGE_SIZE
 4096

	)

39 
	#PAGE_FRAME
 0xfffff000

	)

51 
	#MIPS_KUSEG
 0x00000000

	)

52 
	#MIPS_KSEG0
 0x80000000

	)

53 
	#MIPS_KSEG1
 0xa0000000

	)

54 
	#MIPS_KSEG2
 0xc0000000

	)

68 
	#PADDR_TO_KVADDR
(
∑ddr
Ë(’addr)+
MIPS_KSEG0
)

	)

74 
	#USERSPACETOP
 
MIPS_KSEG0


	)

84 
	#USERSTACK
 
USERSPACETOP


	)

108 
øm_boŸ°øp
();

109 
∑ddr_t
 
øm_°ólmem
(
≈ages
);

110 
∑ddr_t
 
øm_gësize
();

111 
∑ddr_t
 
øm_gëfú°‰ì
();

119 
	sébshoŸdown
 {

123 
	mts_∂a˚hﬁdî
;

126 
	#TLBSHOOTDOWN_MAX
 16

	)

	@/home/trinity/src/kern/arch/mips/locore/cache-mips161.S

30 
	~<kîn/mùs/ªgdefs.h
>

40 .
	gãxt


41 .
£t
 
	gn‹e‹dî


43 .
globl
 
	gmùs_Êushiˇche


44 .
ty≥
 
	gmùs_Êushiˇche
,@
	gfun˘i⁄


45 .
ít
 
mùs_Êushiˇche


46 
	gmùs_Êushiˇche
:

47 
j
 
ø


48 
n›


49 .
íd
 
mùs_Êushiˇche


	@/home/trinity/src/kern/arch/mips/locore/exception-mips1.S

30 
	~<kîn/mùs/ªgdefs.h
>

31 
	~<mùs/•ecüÃeg.h
>

45 .
£t
 
	gnﬂt


46 .
£t
 
	gn‹e‹dî


64 .
	gãxt


65 .
globl
 
	gmùs_uéb_h™dÀr


66 .
ty≥
 
	gmùs_uéb_h™dÀr
,@
	gfun˘i⁄


67 .
ít
 
mùs_uéb_h™dÀr


68 
	gmùs_uéb_h™dÀr
:

69 
j
 
comm⁄_ex˚±i⁄


70 
n›


71 .
globl
 
mùs_uéb_íd


72 
mùs_uéb_íd
:

73 .
íd
 
mùs_uéb_h™dÀr


82 .
ãxt


83 .
globl
 
mùs_gíîÆ_h™dÀr


84 .
ty≥
 
mùs_gíîÆ_h™dÀr
,@
	gfun˘i⁄


85 .
ít
 
mùs_gíîÆ_h™dÀr


86 
	gmùs_gíîÆ_h™dÀr
:

87 
j
 
comm⁄_ex˚±i⁄


88 
n›


89 .
globl
 
mùs_gíîÆ_íd


90 
mùs_gíîÆ_íd
:

91 .
íd
 
mùs_gíîÆ_h™dÀr


94 
n›


101 .
ãxt


102 .
ty≥
 
comm⁄_ex˚±i⁄
,@
	gfun˘i⁄


103 .
ít
 
	gcomm⁄_ex˚±i⁄


104 .
	gcfi_°¨çroc


105 .
cfi_sig«l_‰ame


106 
	gcomm⁄_ex˚±i⁄
:

107 
mfc0
 
k0
, 
c0_°©us


108 
™di
 
	gk0
, k0, 
CST_KUp


109 
beq
 
	gk0
, 
	g$0
, 1f

110 
n›


113 
mfc0
 
	gk1
, 
c0_c⁄ãxt


114 
§l
 
	gk1
, k1, 
CTX_PTBASESHIFT


115 
¶l
 
	gk1
, k1, 2

116 
lui
 
	gk0
, %
	$hi
(
˝u°acks
)

117 
addu
 
k0
, k0, 
k1


118 
move
 
k1
, 
•


119 
b
 2f

120 
lw
 
•
, %
	$lo
(
˝u°acks
)(
k0
)

123 
move
 
k1
, 
•


139 
addi
 
•
, sp, -160

140 .
cfi_def_cÁ
 
•
, 0

166 
sw
 
s8
, 148(
•
)

167 .
cfi_off£t
 
s8
, 148

168 
sw
 
k1
, 144(
•
)

169 .
cfi_off£t
 
•
, 144

170 
sw
 
gp
, 140(
•
)

171 
n›


172 .
cfi_off£t
 
gp
, 140

174 .
cfi_ªtu∫_cﬁumn
 
k1


175 
mfc0
 
k1
, 
c0_ïc


176 
sw
 
k1
, 152(
•
)

177 .
cfi_off£t
 
k1
, 152

179 
sw
 
t9
, 136(
•
)

180 .
cfi_off£t
 
t9
, 136

181 
sw
 
t8
, 132(
•
)

182 .
cfi_off£t
 
t8
, 132

183 
sw
 
s7
, 128(
•
)

184 .
cfi_off£t
 
s7
, 128

185 
sw
 
s6
, 124(
•
)

186 .
cfi_off£t
 
s6
, 124

187 
sw
 
s5
, 120(
•
)

188 .
cfi_off£t
 
s5
, 120

189 
sw
 
s4
, 116(
•
)

190 .
cfi_off£t
 
s4
, 116

191 
sw
 
s3
, 112(
•
)

192 .
cfi_off£t
 
s3
, 112

193 
sw
 
s2
, 108(
•
)

194 .
cfi_off£t
 
s2
, 108

195 
sw
 
s1
, 104(
•
)

196 .
cfi_off£t
 
s1
, 104

197 
sw
 
s0
, 100(
•
)

198 .
cfi_off£t
 
s0
, 100

199 
sw
 
t7
, 96(
•
)

200 .
cfi_off£t
 
t7
, 96

201 
sw
 
t6
, 92(
•
)

202 .
cfi_off£t
 
t6
, 92

203 
sw
 
t5
, 88(
•
)

204 .
cfi_off£t
 
t5
, 88

205 
sw
 
t4
, 84(
•
)

206 .
cfi_off£t
 
t4
, 84

207 
sw
 
t3
, 80(
•
)

208 .
cfi_off£t
 
t3
, 80

209 
sw
 
t2
, 76(
•
)

210 .
cfi_off£t
 
t2
, 76

211 
sw
 
t1
, 72(
•
)

212 .
cfi_off£t
 
t1
, 72

213 
sw
 
t0
, 68(
•
)

214 .
cfi_off£t
 
t0
, 68

215 
sw
 
a3
, 64(
•
)

216 .
cfi_off£t
 
a3
, 64

217 
sw
 
a2
, 60(
•
)

218 .
cfi_off£t
 
a2
, 60

219 
sw
 
a1
, 56(
•
)

220 .
cfi_off£t
 
a1
, 56

221 
sw
 
a0
, 52(
•
)

222 .
cfi_off£t
 
a0
, 52

223 
sw
 
v1
, 48(
•
)

224 .
cfi_off£t
 
v1
, 48

225 
sw
 
v0
, 44(
•
)

226 .
cfi_off£t
 
v0
, 44

227 
sw
 
AT
, 40(
•
)

228 .
cfi_off£t
 
AT
, 40

230 
sw
 
ø
, 36(
•
)

231 .
cfi_off£t
 
ø
, 36

236 
mfhi
 
t0


237 
mÊo
 
t1


238 
sw
 
t0
, 32(
•
)

239 
sw
 
t1
, 28(
•
)

245 
mfc0
 
t2
, 
c0_°©us


246 
sw
 
t2
, 20(
•
)

247 
mfc0
 
t3
, 
c0_vaddr


248 
sw
 
t3
, 16(
•
)

249 
mfc0
 
t4
, 
c0_ˇu£


250 
sw
 
t4
, 24(
•
)

255 
™di
 
k0
, 
t2
, 
CST_KUp


256 
beq
 
k0
, 
$0
, 3f

257 
n›


259 
mfc0
 
k1
, 
c0_c⁄ãxt


260 
§l
 
k1
, k1, 
CTX_PTBASESHIFT


261 
¶l
 
k1
, k1, 2

262 
lui
 
k0
, %
	$hi
(
˝uthªads
)

263 
addu
 
k0
, k0, 
k1


264 
lw
 
s7
, %
	$lo
(
˝uthªads
)(
k0
)

270 
œ
 
gp
, 
_gp


276 
addiu
 
a0
, 
•
, 16

277 
jÆ
 
mùs_å≠


278 
n›


284 
ex˚±i⁄_ªtu∫
:

287 
lw
 
t0
, 20(
•
)

288 
n›


289 
mtc0
 
t0
, 
c0_°©us


293 
lw
 
t1
, 28(
•
)

294 
lw
 
t0
, 32(
•
)

295 
méo
 
t1


296 
mthi
 
t0


299 
lw
 
ø
, 36(
•
)

301 
lw
 
AT
, 40(
•
)

302 
lw
 
v0
, 44(
•
)

303 
lw
 
v1
, 48(
•
)

304 
lw
 
a0
, 52(
•
)

305 
lw
 
a1
, 56(
•
)

306 
lw
 
a2
, 60(
•
)

307 
lw
 
a3
, 64(
•
)

308 
lw
 
t0
, 68(
•
)

309 
lw
 
t1
, 72(
•
)

310 
lw
 
t2
, 76(
•
)

311 
lw
 
t3
, 80(
•
)

312 
lw
 
t4
, 84(
•
)

313 
lw
 
t5
, 88(
•
)

314 
lw
 
t6
, 92(
•
)

315 
lw
 
t7
, 96(
•
)

316 
lw
 
s0
, 100(
•
)

317 
lw
 
s1
, 104(
•
)

318 
lw
 
s2
, 108(
•
)

319 
lw
 
s3
, 112(
•
)

320 
lw
 
s4
, 116(
•
)

321 
lw
 
s5
, 120(
•
)

322 
lw
 
s6
, 124(
•
)

323 
lw
 
s7
, 128(
•
)

324 
lw
 
t8
, 132(
•
)

325 
lw
 
t9
, 136(
•
)

326 
lw
 
gp
, 140(
•
)

328 
lw
 
s8
, 148(
•
)

329 
lw
 
k1
, 152(
•
)

331 
lw
 
•
, 144(sp)

334 
jr
 
k1


335 
r„


336 .
cfi_íd¥oc


337 .
íd
 
comm⁄_ex˚±i⁄


347 .
ãxt


348 .
globl
 
asm_u£rmode


349 .
ty≥
 
asm_u£rmode
,@
fun˘i⁄


350 .
ít
 
asm_u£rmode


351 
asm_u£rmode
:

364 
j
 
ex˚±i⁄_ªtu∫


365 
addiu
 
•
, 
a0
, -16

366 .
íd
 
asm_u£rmode


	@/home/trinity/src/kern/arch/mips/locore/trap.c

30 
	~<ty≥s.h
>

31 
	~<sig«l.h
>

32 
	~<lib.h
>

33 
	~<mùs/•ecüÃeg.h
>

34 
	~<mùs/å≠‰ame.h
>

35 
	~<˝u.h
>

36 
	~<•l.h
>

37 
	~<thªad.h
>

38 
	~<cuºít.h
>

39 
	~<vm.h
>

40 
	~<maöbus.h
>

41 
	~<sysˇŒ.h
>

45 
__DEAD
 
asm_u£rmode
(
å≠‰ame
 *
tf
);

48 
mùs_å≠
(
å≠‰ame
 *
tf
);

52 
	#NTRAPCODES
 13

	)

53 c⁄° *c⁄° 
	gå≠codíames
[
NTRAPCODES
] = {

74 
	$kûl_cuπhªad
(
vaddr_t
 
ïc
, 
code
, vaddr_à
vaddr
)

76 
sig
 = 0;

78 
	`KASSERT
(
code
 < 
NTRAPCODES
);

79 
code
) {

80 
EX_IRQ
:

81 
EX_IBE
:

82 
EX_DBE
:

83 
EX_SYS
:

85 
	`KASSERT
(0);

86 
sig
 = 
SIGABRT
;

88 
EX_MOD
:

89 
EX_TLBL
:

90 
EX_TLBS
:

91 
sig
 = 
SIGSEGV
;

93 
EX_ADEL
:

94 
EX_ADES
:

95 
sig
 = 
SIGBUS
;

97 
EX_BP
:

98 
sig
 = 
SIGTRAP
;

100 
EX_RI
:

101 
sig
 = 
SIGILL
;

103 
EX_CPU
:

104 
sig
 = 
SIGSEGV
;

106 
EX_OVF
:

107 
sig
 = 
SIGFPE
;

115 
	`k¥ötf
("Fatal user modeÅrap %u sig %d (%s,Épc 0x%x, vaddr 0x%x)\n",

116 
code
, 
sig
, 
å≠codíames
[code], 
ïc
, 
vaddr
);

117 
	`∑nic
("I don't know howÅo handleÅhis\n");

118 
	}
}

126 
	$mùs_å≠
(
å≠‰ame
 *
tf
)

128 
uöt32_t
 
code
;

130 
boﬁ
 
iskîn
;

131 
•l
;

134 
	`KASSERT
((
å≠‰ame
)==(35*4));

139 
code
 = (
tf
->
tf_ˇu£
 & 
CCA_CODE
Ë>> 
CCA_CODESHIFT
;

141 
iskîn
 = (
tf
->
tf_°©us
 & 
CST_KUp
) == 0;

143 
	`KASSERT
(
code
 < 
NTRAPCODES
);

146 i‡(
cuπhªad
 !
NULL
 && cuπhªad->
t_°ack
 != NULL) {

147 
	`KASSERT
((
vaddr_t
)
tf
 > (vaddr_t)
cuπhªad
->
t_°ack
);

148 
	`KASSERT
((
vaddr_t
)
tf
 < (vaddr_t)(
cuπhªad
->
t_°ack


149 + 
STACK_SIZE
));

153 i‡(
code
 =
EX_IRQ
) {

154 
ﬁd_ö
;

155 
boﬁ
 
dﬂdju°
;

157 
ﬁd_ö
 = 
cuπhªad
->
t_ö_öãºu±
;

158 
cuπhªad
->
t_ö_öãºu±
 = 1;

177 i‡(
cuπhªad
->
t_cur•l
 == 0) {

178 
	`KASSERT
(
cuπhªad
->
t_cur•l
 == 0);

179 
	`KASSERT
(
cuπhªad
->
t_ùlhigh_cou¡
 == 0);

180 
cuπhªad
->
t_cur•l
 = 
IPL_HIGH
;

181 
cuπhªad
->
t_ùlhigh_cou¡
++;

182 
dﬂdju°
 = 
åue
;

185 
dﬂdju°
 = 
Ál£
;

188 
	`maöbus_öãºu±
(
tf
);

190 i‡(
dﬂdju°
) {

191 
	`KASSERT
(
cuπhªad
->
t_cur•l
 =
IPL_HIGH
);

192 
	`KASSERT
(
cuπhªad
->
t_ùlhigh_cou¡
 == 1);

193 
cuπhªad
->
t_ùlhigh_cou¡
--;

194 
cuπhªad
->
t_cur•l
 = 0;

197 
cuπhªad
->
t_ö_öãºu±
 = 
ﬁd_ö
;

198 
d⁄e2
;

212 
•l
 = 
	`•lhigh
();

213 
	`•lx
(
•l
);

216 i‡(
code
 =
EX_SYS
) {

218 
	`KASSERT
(
cuπhªad
->
t_cur•l
 == 0);

219 
	`KASSERT
(
cuπhªad
->
t_ùlhigh_cou¡
 == 0);

221 
	`DEBUG
(
DB_SYSCALL
, "syscall: #%d,árgs %x %x %x %x\n",

222 
tf
->
tf_v0
,Åf->
tf_a0
,Åf->
tf_a1
,Åf->
tf_a2
,Åf->
tf_a3
);

224 
	`sysˇŒ
(
tf
);

225 
d⁄e
;

233 
code
) {

234 
EX_MOD
:

235 i‡(
	`vm_Áu…
(
VM_FAULT_READONLY
, 
tf
->
tf_vaddr
)==0) {

236 
d⁄e
;

239 
EX_TLBL
:

240 i‡(
	`vm_Áu…
(
VM_FAULT_READ
, 
tf
->
tf_vaddr
)==0) {

241 
d⁄e
;

244 
EX_TLBS
:

245 i‡(
	`vm_Áu…
(
VM_FAULT_WRITE
, 
tf
->
tf_vaddr
)==0) {

246 
d⁄e
;

249 
EX_IBE
:

250 
EX_DBE
:

260 
	`∑nic
("Bu†îr‹Éx˚±i⁄, PC=0x%x\n", 
tf
->
tf_ïc
);

270 i‡(!
iskîn
) {

275 
	`kûl_cuπhªad
(
tf
->
tf_ïc
, 
code
,Åf->
tf_vaddr
);

276 
d⁄e
;

300 i‡(
cuπhªad
 !
NULL
 &&

301 
cuπhªad
->
t_machdï
.
tm_badÁu…func
 !
NULL
) {

302 
tf
->
tf_ïc
 = (
vaddr_t
Ë
cuπhªad
->
t_machdï
.
tm_badÁu…func
;

303 
d⁄e
;

310 
	`k¥ötf
("∑nic: F©ÆÉx˚±i⁄ %u (%sËö kî√»mode\n", 
code
,

311 
å≠codíames
[
code
]);

312 
	`k¥ötf
("panic: EPC 0x%x,Éxception vaddr 0x%x\n",

313 
tf
->
tf_ïc
,Åf->
tf_vaddr
);

315 
	`∑nic
("I can't handleÅhis... IÅhink I'll just dieÇow...\n");

317 
d⁄e
:

322 
	`˝u_úqoff
();

323 
d⁄e2
:

331 i‡(
cuπhªad
->
t_°ack
 =
NULL
) {

335 
˝uthªads
[
cur˝u
->
c_numbî
] = (
vaddr_t
)
cuπhªad
;

336 
˝u°acks
[
cur˝u
->
c_numbî
] = (
vaddr_t
)
cuπhªad
->
t_°ack
 + 
STACK_SIZE
;

347 
	`KASSERT
(
	`SAME_STACK
(
˝u°acks
[
cur˝u
->
c_numbî
]-1, (
vaddr_t
)
tf
));

348 
	}
}

368 
	$mùs_u£rmode
(
å≠‰ame
 *
tf
)

377 
	`•l0
();

378 
	`˝u_úqoff
();

380 
˝uthªads
[
cur˝u
->
c_numbî
] = (
vaddr_t
)
cuπhªad
;

381 
˝u°acks
[
cur˝u
->
c_numbî
] = (
vaddr_t
)
cuπhªad
->
t_°ack
 + 
STACK_SIZE
;

398 
	`KASSERT
(
	`SAME_STACK
(
˝u°acks
[
cur˝u
->
c_numbî
]-1, (
vaddr_t
)
tf
));

403 
	`asm_u£rmode
(
tf
);

404 
	}
}

423 
	$íãr_√w_¥o˚ss
(
¨gc
, 
u£Ωå_t
 
¨gv
, u£Ωå_à
ív
,

424 
vaddr_t
 
°ack
, vaddr_à
íåy
)

426 
å≠‰ame
 
tf
;

428 
	`bzîo
(&
tf
, (tf));

430 
tf
.
tf_°©us
 = 
CST_IRQMASK
 | 
CST_IEp
 | 
CST_KUp
;

431 
tf
.
tf_ïc
 = 
íåy
;

432 
tf
.
tf_a0
 = 
¨gc
;

433 
tf
.
tf_a1
 = (
vaddr_t
)
¨gv
;

434 
tf
.
tf_a2
 = (
vaddr_t
)
ív
;

435 
tf
.
tf_•
 = 
°ack
;

437 
	`mùs_u£rmode
(&
tf
);

438 
	}
}

	@/home/trinity/src/kern/arch/mips/syscall/syscall.c

30 
	~<ty≥s.h
>

31 
	~<kîn/î∫o.h
>

32 
	~<kîn/sysˇŒ.h
>

33 
	~<lib.h
>

34 
	~<mùs/å≠‰ame.h
>

35 
	~<thªad.h
>

36 
	~<cuºít.h
>

37 
	~<sysˇŒ.h
>

79 
	$sysˇŒ
(
å≠‰ame
 *
tf
)

81 
ˇŒno
;

82 
öt32_t
 
ªtvÆ
;

83 
îr
;

85 
	`KASSERT
(
cuπhªad
 !
NULL
);

86 
	`KASSERT
(
cuπhªad
->
t_cur•l
 == 0);

87 
	`KASSERT
(
cuπhªad
->
t_ùlhigh_cou¡
 == 0);

89 
ˇŒno
 = 
tf
->
tf_v0
;

100 
ªtvÆ
 = 0;

102 
ˇŒno
) {

103 
SYS_ªboŸ
:

104 
îr
 = 
	`sys_ªboŸ
(
tf
->
tf_a0
);

107 
SYS___time
:

108 
îr
 = 
	`sys___time
((
u£Ωå_t
)
tf
->
tf_a0
,

109 (
u£Ωå_t
)
tf
->
tf_a1
);

115 
	`k¥ötf
("Unknow¿sysˇŒ %d\n", 
ˇŒno
);

116 
îr
 = 
ENOSYS
;

121 i‡(
îr
) {

127 
tf
->
tf_v0
 = 
îr
;

128 
tf
->
tf_a3
 = 1;

132 
tf
->
tf_v0
 = 
ªtvÆ
;

133 
tf
->
tf_a3
 = 0;

141 
tf
->
tf_ïc
 += 4;

144 
	`KASSERT
(
cuπhªad
->
t_cur•l
 == 0);

146 
	`KASSERT
(
cuπhªad
->
t_ùlhigh_cou¡
 == 0);

147 
	}
}

158 
	$íãr_f‹ked_¥o˚ss
(
å≠‰ame
 *
tf
)

160 ()
tf
;

161 
	}
}

	@/home/trinity/src/kern/arch/mips/thread/cpu.c

34 
	~<ty≥s.h
>

35 
	~<lib.h
>

36 
	~<mùs/•ecüÃeg.h
>

37 
	~<mùs/å≠‰ame.h
>

38 
	~<∂©f‹m/max˝us.h
>

39 
	~<˝u.h
>

40 
	~<thªad.h
>

67 
vaddr_t
 
	g˝u°acks
[
MAXCPUS
];

68 
vaddr_t
 
	g˝uthªads
[
MAXCPUS
];

76 
	$˝u_machdï_öô
(
˝u
 *
c
)

78 
vaddr_t
 
°ackpoöãr
;

80 
	`KASSERT
(
c
->
c_numbî
 < 
MAXCPUS
);

82 i‡(
c
->
c_cuπhªad
->
t_°ack
 =
NULL
) {

92 
°ackpoöãr
 = (
vaddr_t
Ë
c
->
c_cuπhªad
->
t_°ack
;

94 
°ackpoöãr
 +
STACK_SIZE
;

96 
˝u°acks
[
c
->
c_numbî
] = 
°ackpoöãr
;

97 
˝uthªads
[
c
->
c_numbî
] = (
vaddr_t
)c->
c_cuπhªad
;

99 
	}
}

110 
	#SYS161_PRID_ORIG
 0x000003ff

	)

111 
	#SYS161_PRID_2X
 0x000000a1

	)

113 
ölöe


114 
uöt32_t


115 
	$˝u_gë¥id
()

117 
uöt32_t
 
¥id
;

119 
__asm
 vﬁ©ûe("mfc0 %0,$15" : "Ù" (
¥id
));

120  
¥id
;

121 
	}
}

123 
ölöe


124 
uöt32_t


125 
	$˝u_gë„©uªs
()

127 
uöt32_t
 
„©uªs
;

129 
__asm
 volatile(".setÖush;"

133 : "Ù" (
„©uªs
));

134  
„©uªs
;

135 
	}
}

137 
ölöe


138 
uöt32_t


139 
	$˝u_gëi„©uªs
()

141 
uöt32_t
 
„©uªs
;

143 
__asm
 volatile(".setÖush;"

147 : "Ù" (
„©uªs
));

148  
„©uªs
;

149 
	}
}

152 
	$˝u_idítify
(*
buf
, 
size_t
 
max
)

154 
uöt32_t
 
¥id
;

155 
uöt32_t
 
„©uªs
;

157 
¥id
 = 
	`˝u_gë¥id
();

158 
¥id
) {

159 
SYS161_PRID_ORIG
:

160 
	`¢¥ötf
(
buf
, 
max
, "MIPS/161 (System/161 1.xándÖre-2.x)");

162 
SYS161_PRID_2X
:

163 
„©uªs
 = 
	`˝u_gë„©uªs
();

164 
	`¢¥ötf
(
buf
, 
max
, "MIPS/161 (System/161 2.x) features 0x%x",

165 
„©uªs
);

166 
„©uªs
 = 
	`˝u_gëi„©uªs
();

167 i‡(
„©uªs
 != 0) {

168 
	`k¥ötf
("WARNING: unknown CPU incompatible features "

169 "0x%x\n", 
„©uªs
);

173 
	`¢¥ötf
(
buf
, 
max
, "32-bit MIPS (unknownÅype, CPU ID 0x%x)",

174 
¥id
);

177 
	}
}

203 
	#GET_STATUS
(
x
Ë
__asm
 vﬁ©ûe("mfc0 %0,$12" : "Ù" (x))

	)

204 
	#SET_STATUS
(
x
Ë
__asm
 vﬁ©ûe("mtc0 %0,$12" :: "r" (x))

	)

210 
	$˝u_úq⁄
()

212 
uöt32_t
 
x
;

214 
	`GET_STATUS
(
x
);

215 
x
 |
CST_IEc
;

216 
	`SET_STATUS
(
x
);

217 
	}
}

223 
	$˝u_úqoff
()

225 
uöt32_t
 
x
;

227 
	`GET_STATUS
(
x
);

228 
x
 &~(
uöt32_t
)
CST_IEc
;

229 
	`SET_STATUS
(
x
);

230 
	}
}

237 
	$˝u_úq⁄off
()

239 
uöt32_t
 
x
, 
x⁄
, 
xoff
;

241 
	`GET_STATUS
(
x
);

242 
x⁄
 = 
x
 | 
CST_IEc
;

243 
xoff
 = 
x
 & ~(
uöt32_t
)
CST_IEc
;

244 
	`SET_STATUS
(
x⁄
);

245 
__asm
 volatile("nop;Çop;Çop;Çop");

246 
	`SET_STATUS
(
xoff
);

247 
	}
}

265 
ölöe


267 
	$waô
()

280 
__asm
 volatile(

287 
	}
}

293 
	$˝u_idÀ
()

295 
	`waô
();

296 
	`˝u_úq⁄off
();

297 
	}
}

303 
	$˝u_hÆt
()

305 
	`˝u_úqoff
();

307 
	`waô
();

309 
	}
}

	@/home/trinity/src/kern/arch/mips/thread/switch.S

34 
	~<kîn/mùs/ªgdefs.h
>

36 .
	gãxt


37 .
£t
 
	gn‹e‹dî


39 .
globl
 
	gswôch‰ame_swôch


40 .
ty≥
 
	gswôch‰ame_swôch
,@
	gfun˘i⁄


41 .
ít
 
swôch‰ame_swôch


42 
	gswôch‰ame_swôch
:

62 
addi
 
•
, 
	g•
, -40

65 
sw
 
	gø
, 36(
	g•
)

66 
sw
 
	ggp
, 32(
	g•
)

67 
sw
 
	gs8
, 28(
	g•
)

68 
sw
 
	gs6
, 24(
	g•
)

69 
sw
 
	gs5
, 20(
	g•
)

70 
sw
 
	gs4
, 16(
	g•
)

71 
sw
 
	gs3
, 12(
	g•
)

72 
sw
 
	gs2
, 8(
	g•
)

73 
sw
 
	gs1
, 4(
	g•
)

74 
sw
 
	gs0
, 0(
	g•
)

77 
sw
 
	g•
, 0(
	ga0
)

80 
lw
 
	g•
, 0(
	ga1
)

81 
n›


84 
lw
 
	gs0
, 0(
	g•
)

85 
lw
 
	gs1
, 4(
	g•
)

86 
lw
 
	gs2
, 8(
	g•
)

87 
lw
 
	gs3
, 12(
	g•
)

88 
lw
 
	gs4
, 16(
	g•
)

89 
lw
 
	gs5
, 20(
	g•
)

90 
lw
 
	gs6
, 24(
	g•
)

91 
lw
 
	gs8
, 28(
	g•
)

92 
lw
 
	ggp
, 32(
	g•
)

93 
lw
 
	gø
, 36(
	g•
)

94 
n›


97 
j
 
ø


98 
addi
 
	g•
, sp, 40

99 .
íd
 
	gswôch‰ame_swôch


	@/home/trinity/src/kern/arch/mips/thread/switchframe.c

30 
	~<ty≥s.h
>

31 
	~<lib.h
>

32 
	~<thªad.h
>

33 
	~<thªad¥iv©e.h
>

35 
	~"swôch‰ame.h
"

38 
mùs_thªad°¨t
( );

55 
	$swôch‰ame_öô
(
thªad
 *thread,

56 (*
íåypoöt
)(*
d©a1
, 
d©a2
),

57 *
d©a1
, 
d©a2
)

59 
vaddr_t
 
°ackt›
;

60 
swôch‰ame
 *
sf
;

67 
°ackt›
 = ((
vaddr_t
)
thªad
->
t_°ack
Ë+ 
STACK_SIZE
;

68 
sf
 = ((
swôch‰ame
 *Ë
°ackt›
) - 1;

71 
	`bzîo
(
sf
, (*sf));

91 
sf
->
sf_s0
 = (
uöt32_t
)
íåypoöt
;

92 
sf
->
sf_s1
 = (
uöt32_t
)
d©a1
;

93 
sf
->
sf_s2
 = (
uöt32_t
)
d©a2
;

94 
sf
->
sf_ø
 = (
uöt32_t
)
mùs_thªad°¨t
;

97 
thªad
->
t_c⁄ãxt
 = 
sf
;

98 
	}
}

	@/home/trinity/src/kern/arch/mips/thread/switchframe.h

30 #i‚de‡
_MIPS_SWITCHFRAME_H_


31 
	#_MIPS_SWITCHFRAME_H_


	)

39 
	sswôch‰ame
 {

40 
uöt32_t
 
	msf_s0
;

41 
uöt32_t
 
	msf_s1
;

42 
uöt32_t
 
	msf_s2
;

43 
uöt32_t
 
	msf_s3
;

44 
uöt32_t
 
	msf_s4
;

45 
uöt32_t
 
	msf_s5
;

46 
uöt32_t
 
	msf_s6
;

47 
uöt32_t
 
	msf_s8
;

48 
uöt32_t
 
	msf_gp
;

49 
uöt32_t
 
	msf_ø
;

	@/home/trinity/src/kern/arch/mips/thread/thread_machdep.c

34 
	~<ty≥s.h
>

35 
	~<lib.h
>

36 
	~<thªad.h
>

37 
	~<thªad¥iv©e.h
>

40 
	$thªad_machdï_öô
(
thªad_machdï
 *
tm
)

42 
tm
->
tm_badÁu…func
 = 
NULL
;

43 
	}
}

46 
	$thªad_machdï_˛ónup
(
thªad_machdï
 *
tm
)

48 
	`KASSERT
(
tm
->
tm_badÁu…func
 =
NULL
);

49 
	}
}

	@/home/trinity/src/kern/arch/mips/thread/threadstart.S

34 
	~<kîn/mùs/ªgdefs.h
>

36 .
	gãxt


37 .
£t
 
	gn‹e‹dî


39 .
globl
 
	gmùs_thªad°¨t


40 .
ty≥
 
	gmùs_thªad°¨t
,@
	gfun˘i⁄


41 .
ít
 
mùs_thªad°¨t


42 
	gmùs_thªad°¨t
:

59 
addiu
 
•
, 
	g•
, -16

61 
move
 
	gø
, 
$0


63 
move
 
	ga0
, 
s0


64 
move
 
	ga1
, 
s1


65 
j
 
thªad_°¨tup


66 
move
 
	ga2
, 
	gs2


68 .
íd
 
	gmùs_thªad°¨t


	@/home/trinity/src/kern/arch/mips/vm/dumbvm.c

30 
	~<ty≥s.h
>

31 
	~<kîn/î∫o.h
>

32 
	~<lib.h
>

33 
	~<•l.h
>

34 
	~<˝u.h
>

35 
	~<•ölock.h
>

36 
	~<¥oc.h
>

37 
	~<cuºít.h
>

38 
	~<mùs/éb.h
>

39 
	~<addr•a˚.h
>

40 
	~<vm.h
>

60 
	#DUMBVM_STACKPAGES
 18

	)

65 
•ölock
 
	g°ólmem_lock
 = 
SPINLOCK_INITIALIZER
;

68 
	$vm_boŸ°øp
()

71 
	}
}

82 
	$dumbvm_ˇn_¶ìp
()

84 i‡(
	`CURCPU_EXISTS
()) {

86 
	`KASSERT
(
cur˝u
->
c_•ölocks
 == 0);

89 
	`KASSERT
(
cuπhªad
->
t_ö_öãºu±
 == 0);

91 
	}
}

94 
∑ddr_t


95 
	$gëµages
(
≈ages
)

97 
∑ddr_t
 
addr
;

99 
	`•ölock_acquúe
(&
°ólmem_lock
);

101 
addr
 = 
	`øm_°ólmem
(
≈ages
);

103 
	`•ölock_ªÀa£
(&
°ólmem_lock
);

104  
addr
;

105 
	}
}

108 
vaddr_t


109 
	$Æloc_k∑ges
(
≈ages
)

111 
∑ddr_t
 
∑
;

113 
	`dumbvm_ˇn_¶ìp
();

114 
∑
 = 
	`gëµages
(
≈ages
);

115 i‡(
∑
==0) {

118  
	`PADDR_TO_KVADDR
(
∑
);

119 
	}
}

122 
	$‰ì_k∑ges
(
vaddr_t
 
addr
)

126 ()
addr
;

127 
	}
}

131 
	$c‹em≠_u£d_byãs
() {

136 
	}
}

139 
	$vm_ébshoŸdown
(c⁄° 
ébshoŸdown
 *
ts
)

141 ()
ts
;

142 
	`∑nic
("dumbvmÅriedÅo doÅlb shootdown?!\n");

143 
	}
}

146 
	$vm_Áu…
(
Áu…ty≥
, 
vaddr_t
 
Áu…addªss
)

148 
vaddr_t
 
vba£1
, 
vt›1
, 
vba£2
, 
vt›2
, 
°ackba£
, 
°ackt›
;

149 
∑ddr_t
 
∑ddr
;

150 
i
;

151 
uöt32_t
 
ehi
, 
ño
;

152 
addr•a˚
 *
as
;

153 
•l
;

155 
Áu…addªss
 &
PAGE_FRAME
;

157 
	`DEBUG
(
DB_VM
, "dumbvm: fau…: 0x%x\n", 
Áu…addªss
);

159 
Áu…ty≥
) {

160 
VM_FAULT_READONLY
:

162 
	`∑nic
("dumbvm: got VM_FAULT_READONLY\n");

163 
VM_FAULT_READ
:

164 
VM_FAULT_WRITE
:

167  
EINVAL
;

170 i‡(
cuΩroc
 =
NULL
) {

176  
EFAULT
;

179 
as
 = 
	`¥oc_gëas
();

180 i‡(
as
 =
NULL
) {

185  
EFAULT
;

189 
	`KASSERT
(
as
->
as_vba£1
 != 0);

190 
	`KASSERT
(
as
->
as_pba£1
 != 0);

191 
	`KASSERT
(
as
->
as_≈ages1
 != 0);

192 
	`KASSERT
(
as
->
as_vba£2
 != 0);

193 
	`KASSERT
(
as
->
as_pba£2
 != 0);

194 
	`KASSERT
(
as
->
as_≈ages2
 != 0);

195 
	`KASSERT
(
as
->
as_°ackpba£
 != 0);

196 
	`KASSERT
((
as
->
as_vba£1
 & 
PAGE_FRAME
) ==ás->as_vbase1);

197 
	`KASSERT
((
as
->
as_pba£1
 & 
PAGE_FRAME
) ==ás->as_pbase1);

198 
	`KASSERT
((
as
->
as_vba£2
 & 
PAGE_FRAME
) ==ás->as_vbase2);

199 
	`KASSERT
((
as
->
as_pba£2
 & 
PAGE_FRAME
) ==ás->as_pbase2);

200 
	`KASSERT
((
as
->
as_°ackpba£
 & 
PAGE_FRAME
) ==ás->as_stackpbase);

202 
vba£1
 = 
as
->
as_vba£1
;

203 
vt›1
 = 
vba£1
 + 
as
->
as_≈ages1
 * 
PAGE_SIZE
;

204 
vba£2
 = 
as
->
as_vba£2
;

205 
vt›2
 = 
vba£2
 + 
as
->
as_≈ages2
 * 
PAGE_SIZE
;

206 
°ackba£
 = 
USERSTACK
 - 
DUMBVM_STACKPAGES
 * 
PAGE_SIZE
;

207 
°ackt›
 = 
USERSTACK
;

209 i‡(
Áu…addªss
 >
vba£1
 && fau…addªs†< 
vt›1
) {

210 
∑ddr
 = (
Áu…addªss
 - 
vba£1
Ë+ 
as
->
as_pba£1
;

212 i‡(
Áu…addªss
 >
vba£2
 && fau…addªs†< 
vt›2
) {

213 
∑ddr
 = (
Áu…addªss
 - 
vba£2
Ë+ 
as
->
as_pba£2
;

215 i‡(
Áu…addªss
 >
°ackba£
 && fau…addªs†< 
°ackt›
) {

216 
∑ddr
 = (
Áu…addªss
 - 
°ackba£
Ë+ 
as
->
as_°ackpba£
;

219  
EFAULT
;

223 
	`KASSERT
((
∑ddr
 & 
PAGE_FRAME
) ==Öaddr);

226 
•l
 = 
	`•lhigh
();

228 
i
=0; i<
NUM_TLB
; i++) {

229 
	`éb_ªad
(&
ehi
, &
ño
, 
i
);

230 i‡(
ño
 & 
TLBLO_VALID
) {

233 
ehi
 = 
Áu…addªss
;

234 
ño
 = 
∑ddr
 | 
TLBLO_DIRTY
 | 
TLBLO_VALID
;

235 
	`DEBUG
(
DB_VM
, "dumbvm: 0x%x -> 0x%x\n", 
Áu…addªss
, 
∑ddr
);

236 
	`éb_wrôe
(
ehi
, 
ño
, 
i
);

237 
	`•lx
(
•l
);

241 
	`k¥ötf
("dumbvm: Ran out of TLBÉntries - cannot handleÖage fault\n");

242 
	`•lx
(
•l
);

243  
EFAULT
;

244 
	}
}

246 
addr•a˚
 *

247 
	$as_¸óã
()

249 
addr•a˚
 *
as
 = 
	`kmÆloc
((addrspace));

250 i‡(
as
==
NULL
) {

251  
NULL
;

254 
as
->
as_vba£1
 = 0;

255 
as
->
as_pba£1
 = 0;

256 
as
->
as_≈ages1
 = 0;

257 
as
->
as_vba£2
 = 0;

258 
as
->
as_pba£2
 = 0;

259 
as
->
as_≈ages2
 = 0;

260 
as
->
as_°ackpba£
 = 0;

262  
as
;

263 
	}
}

266 
	$as_de°roy
(
addr•a˚
 *
as
)

268 
	`dumbvm_ˇn_¶ìp
();

269 
	`k‰ì
(
as
);

270 
	}
}

273 
	$as_a˘iv©e
()

275 
i
, 
•l
;

276 
addr•a˚
 *
as
;

278 
as
 = 
	`¥oc_gëas
();

279 i‡(
as
 =
NULL
) {

284 
•l
 = 
	`•lhigh
();

286 
i
=0; i<
NUM_TLB
; i++) {

287 
	`éb_wrôe
(
	`TLBHI_INVALID
(
i
), 
	`TLBLO_INVALID
(), i);

290 
	`•lx
(
•l
);

291 
	}
}

294 
	$as_dó˘iv©e
()

297 
	}
}

300 
	$as_deföe_ªgi⁄
(
addr•a˚
 *
as
, 
vaddr_t
 
vaddr
, 
size_t
 
sz
,

301 
ªadabÀ
, 
wrôóbÀ
, 
execuèbÀ
)

303 
size_t
 
≈ages
;

305 
	`dumbvm_ˇn_¶ìp
();

308 
sz
 +
vaddr
 & ~(
vaddr_t
)
PAGE_FRAME
;

309 
vaddr
 &
PAGE_FRAME
;

312 
sz
 = (sz + 
PAGE_SIZE
 - 1Ë& 
PAGE_FRAME
;

314 
≈ages
 = 
sz
 / 
PAGE_SIZE
;

317 ()
ªadabÀ
;

318 ()
wrôóbÀ
;

319 ()
execuèbÀ
;

321 i‡(
as
->
as_vba£1
 == 0) {

322 
as
->
as_vba£1
 = 
vaddr
;

323 
as
->
as_≈ages1
 = 
≈ages
;

327 i‡(
as
->
as_vba£2
 == 0) {

328 
as
->
as_vba£2
 = 
vaddr
;

329 
as
->
as_≈ages2
 = 
≈ages
;

336 
	`k¥ötf
("dumbvm: Warning:Åoo manyÑegions\n");

337  
ENOSYS
;

338 
	}
}

342 
	$as_zîo_ªgi⁄
(
∑ddr_t
 
∑ddr
, 
≈ages
)

344 
	`bzîo
((*)
	`PADDR_TO_KVADDR
(
∑ddr
), 
≈ages
 * 
PAGE_SIZE
);

345 
	}
}

348 
	$as_¥ï¨e_lﬂd
(
addr•a˚
 *
as
)

350 
	`KASSERT
(
as
->
as_pba£1
 == 0);

351 
	`KASSERT
(
as
->
as_pba£2
 == 0);

352 
	`KASSERT
(
as
->
as_°ackpba£
 == 0);

354 
	`dumbvm_ˇn_¶ìp
();

356 
as
->
as_pba£1
 = 
	`gëµages
◊s->
as_≈ages1
);

357 i‡(
as
->
as_pba£1
 == 0) {

358  
ENOMEM
;

361 
as
->
as_pba£2
 = 
	`gëµages
◊s->
as_≈ages2
);

362 i‡(
as
->
as_pba£2
 == 0) {

363  
ENOMEM
;

366 
as
->
as_°ackpba£
 = 
	`gëµages
(
DUMBVM_STACKPAGES
);

367 i‡(
as
->
as_°ackpba£
 == 0) {

368  
ENOMEM
;

371 
	`as_zîo_ªgi⁄
(
as
->
as_pba£1
,ás->
as_≈ages1
);

372 
	`as_zîo_ªgi⁄
(
as
->
as_pba£2
,ás->
as_≈ages2
);

373 
	`as_zîo_ªgi⁄
(
as
->
as_°ackpba£
, 
DUMBVM_STACKPAGES
);

376 
	}
}

379 
	$as_com∂ëe_lﬂd
(
addr•a˚
 *
as
)

381 
	`dumbvm_ˇn_¶ìp
();

382 ()
as
;

384 
	}
}

387 
	$as_deföe_°ack
(
addr•a˚
 *
as
, 
vaddr_t
 *
°ack±r
)

389 
	`KASSERT
(
as
->
as_°ackpba£
 != 0);

391 *
°ack±r
 = 
USERSTACK
;

393 
	}
}

396 
	$as_c›y
(
addr•a˚
 *
ﬁd
, addr•a˚ **
ªt
)

398 
addr•a˚
 *
√w
;

400 
	`dumbvm_ˇn_¶ìp
();

402 
√w
 = 
	`as_¸óã
();

403 i‡(
√w
==
NULL
) {

404  
ENOMEM
;

407 
√w
->
as_vba£1
 = 
ﬁd
->as_vbase1;

408 
√w
->
as_≈ages1
 = 
ﬁd
->as_npages1;

409 
√w
->
as_vba£2
 = 
ﬁd
->as_vbase2;

410 
√w
->
as_≈ages2
 = 
ﬁd
->as_npages2;

413 i‡(
	`as_¥ï¨e_lﬂd
(
√w
)) {

414 
	`as_de°roy
(
√w
);

415  
ENOMEM
;

418 
	`KASSERT
(
√w
->
as_pba£1
 != 0);

419 
	`KASSERT
(
√w
->
as_pba£2
 != 0);

420 
	`KASSERT
(
√w
->
as_°ackpba£
 != 0);

422 
	`memmove
((*)
	`PADDR_TO_KVADDR
(
√w
->
as_pba£1
),

423 (c⁄° *)
	`PADDR_TO_KVADDR
(
ﬁd
->
as_pba£1
),

424 
ﬁd
->
as_≈ages1
*
PAGE_SIZE
);

426 
	`memmove
((*)
	`PADDR_TO_KVADDR
(
√w
->
as_pba£2
),

427 (c⁄° *)
	`PADDR_TO_KVADDR
(
ﬁd
->
as_pba£2
),

428 
ﬁd
->
as_≈ages2
*
PAGE_SIZE
);

430 
	`memmove
((*)
	`PADDR_TO_KVADDR
(
√w
->
as_°ackpba£
),

431 (c⁄° *)
	`PADDR_TO_KVADDR
(
ﬁd
->
as_°ackpba£
),

432 
DUMBVM_STACKPAGES
*
PAGE_SIZE
);

434 *
ªt
 = 
√w
;

436 
	}
}

	@/home/trinity/src/kern/arch/mips/vm/ram.c

30 
	~<ty≥s.h
>

31 
	~<lib.h
>

32 
	~<vm.h
>

33 
	~<maöbus.h
>

36 
vaddr_t
 
	gfú°‰ì
;

38 
∑ddr_t
 
	gfú°∑ddr
;

39 
∑ddr_t
 
	gœ°∑ddr
;

46 
	$øm_boŸ°øp
()

48 
size_t
 
ømsize
;

51 
ømsize
 = 
	`maöbus_ømsize
();

60 i‡(
ømsize
 > 512*1024*1024) {

61 
ømsize
 = 512*1024*1024;

64 
œ°∑ddr
 = 
ømsize
;

70 
fú°∑ddr
 = 
fú°‰ì
 - 
MIPS_KSEG0
;

72 
	`k¥ötf
("%ukÖhysical memoryávailable\n",

73 (
œ°∑ddr
-
fú°∑ddr
)/1024);

74 
	}
}

94 
∑ddr_t


95 
	$øm_°ólmem
(
≈ages
)

97 
size_t
 
size
;

98 
∑ddr_t
 
∑ddr
;

100 
size
 = 
≈ages
 * 
PAGE_SIZE
;

102 i‡(
fú°∑ddr
 + 
size
 > 
œ°∑ddr
) {

106 
∑ddr
 = 
fú°∑ddr
;

107 
fú°∑ddr
 +
size
;

109  
∑ddr
;

110 
	}
}

127 
∑ddr_t


128 
	$øm_gësize
()

130  
œ°∑ddr
;

131 
	}
}

145 
∑ddr_t


146 
	$øm_gëfú°‰ì
()

148 
∑ddr_t
 
ªt
;

150 
ªt
 = 
fú°∑ddr
;

151 
fú°∑ddr
 = 
œ°∑ddr
 = 0;

152  
ªt
;

153 
	}
}

	@/home/trinity/src/kern/arch/mips/vm/tlb-mips161.S

30 
	~<kîn/mùs/ªgdefs.h
>

31 
	~<mùs/•ecüÃeg.h
>

48 .
	gãxt


49 .
£t
 
	gn‹e‹dî


50 .
£t
 
	gmùs32


59 .
globl
 
	géb_øndom


60 .
ty≥
 
	géb_øndom
,@
	gfun˘i⁄


61 .
ít
 
éb_øndom


62 
	géb_øndom
:

63 
mtc0
 
a0
, 
c0_íåyhi


64 
mtc0
 
	ga1
, 
c0_íåylo


65 
s¢›


66 
s¢›


67 
ébwr


68 
j
 
ø


69 
	gn›


70 .
íd
 
	géb_øndom


79 .
	gãxt


80 .
globl
 
	géb_wrôe


81 .
ty≥
 
	géb_wrôe
,@
	gfun˘i⁄


82 .
ít
 
éb_wrôe


83 
	géb_wrôe
:

84 
mtc0
 
a0
, 
c0_íåyhi


85 
mtc0
 
	ga1
, 
c0_íåylo


86 
¶l
 
	gt0
, 
	ga2
, 
CIN_INDEXSHIFT


87 
mtc0
 
	gt0
, 
c0_ödex


88 
s¢›


89 
s¢›


90 
ébwi


91 
j
 
ø


92 
	gn›


93 .
íd
 
	géb_wrôe


103 .
	gãxt


104 .
globl
 
	géb_ªad


105 .
ty≥
 
	géb_ªad
,@
	gfun˘i⁄


106 .
ít
 
éb_ªad


107 
	géb_ªad
:

108 
¶l
 
t0
, 
	ga2
, 
CIN_INDEXSHIFT


109 
mtc0
 
	gt0
, 
c0_ödex


110 
s¢›


111 
s¢›


112 
ébr


113 
s¢›


114 
s¢›


115 
s¢›


116 
mfc0
 
	gt0
, 
c0_íåyhi


117 
mfc0
 
	gt1
, 
c0_íåylo


118 
sw
 
	gt0
, 0(
	ga0
)

119 
j
 
ø


120 
sw
 
	gt1
, 0(
	ga1
)

121 .
íd
 
	géb_ªad


131 .
	gãxt


132 .
globl
 
	géb_¥obe


133 .
ty≥
 
	géb_¥obe
,@
	gfun˘i⁄


134 .
ít
 
éb_¥obe


135 
	géb_¥obe
:

136 
mtc0
 
a0
, 
c0_íåyhi


137 
mtc0
 
	ga1
, 
c0_íåylo


138 
s¢›


139 
s¢›


140 
ébp


141 
s¢›


142 
s¢›


143 
mfc0
 
	gt0
, 
c0_ödex


150 
bgez
 
	gt0
, 1f

151 
n›


152 
addi
 
	gv0
, 
	gz0
, -1

153 
j
 
ø


154 
	gn›


158 
™di
 
t1
, 
	gt0
, 
CIN_INDEX


159 
j
 
ø


160 
§a
 
	gv0
, 
	gt1
, 
	gCIN_INDEXSHIFT


161 .
íd
 
	géb_¥obe


178 .
	gãxt


179 .
globl
 
	géb_ª£t


180 .
ty≥
 
	géb_ª£t
,@
	gfun˘i⁄


181 .
ít
 
éb_ª£t


182 
	géb_ª£t
:

183 
li
 
t0
, 0

184 
li
 
	gt1
, 0x81000000

186 
mtc0
 
$0
, 
c0_íåylo


187 
mtc0
 
	gt1
, 
c0_íåyhi


188 
s¢›


189 
s¢›


190 
ébp


191 
s¢›


192 
s¢›


193 
mfc0
 
	gt2
, 
c0_ödex


194 
bgez
 
	gt2
, 1b

195 
addiu
 
	gt1
,Å1, 0x1000

196 
mtc0
 
	gt0
, 
c0_ödex


197 
s¢›


198 
s¢›


199 
addiu
 
	gt0
,Å0, 0x100

200 
b√
 
	gt0
, 0x4000, 1b

201 
ébwi


202 
j
 
ø


203 
	gn›


204 .
íd
 
	géb_ª£t


	@/home/trinity/src/kern/arch/sys161/dev/lamebus_machdep.c

30 
	~<ty≥s.h
>

31 
	~<kîn/uni°d.h
>

32 
	~<lib.h
>

33 
	~<mùs/•ecüÃeg.h
>

34 
	~<mùs/å≠‰ame.h
>

35 
	~<˝u.h
>

36 
	~<•l.h
>

37 
	~<˛ock.h
>

38 
	~<thªad.h
>

39 
	~<cuºít.h
>

40 
	~<memb¨.h
>

41 
	~<synch.h
>

42 
	~<maöbus.h
>

43 
	~<sys161/bus.h
>

44 
	~<œmebus/œmebus.h
>

45 
	~<œmebus/…ø˚.h
>

46 
	~"autoc⁄f.h
"

54 
	#CPU_FREQUENCY
 25000000

	)

65 
	$mùs_timî_£t
(
uöt32_t
 
cou¡
)

71 
__asm
 volatile(

76 :: "r" (
cou¡
));

77 
	}
}

84 
œmebus_so·c
 *
	gœmebus
;

87 
	$maöbus_boŸ°øp
()

90 
	`KASSERT
(
cuπhªad
->
t_cur•l
 > 0);

93 
œmebus
 = 
	`œmebus_öô
();

96 
	`œmebus_föd_˝us
(
œmebus
);

101 
	`k¥ötf
("lamebus0 (system main bus)\n");

108 
	`•l0
();

114 
	`autoc⁄f_œmebus
(
œmebus
, 0);

119 
	`mùs_timî_£t
(
CPU_FREQUENCY
 / 
HZ
);

120 
	}
}

126 
	$maöbus_°¨t_˝us
()

128 
	`œmebus_°¨t_˝us
(
œmebus
);

129 
	}
}

137 
	$œmebus_m≠_¨ó
(
œmebus_so·c
 *
bus
, 
¶Ÿ
, 
uöt32_t
 
off£t
)

139 
uöt32_t
 
addªss
;

141 ()
bus
;

143 
	`KASSERT
(
¶Ÿ
 >0 && slŸ < 
LB_NSLOTS
);

145 
addªss
 = 
LB_BASEADDR
 + 
¶Ÿ
*
LB_SLOT_SIZE
 + 
off£t
;

146  (*)
addªss
;

147 
	}
}

152 
uöt32_t


153 
	$œmebus_ªad_ªgi°î
(
œmebus_so·c
 *
bus
, 
¶Ÿ
, 
uöt32_t
 
off£t
)

155 
uöt32_t
 *
±r
;

157 
±r
 = 
	`œmebus_m≠_¨ó
(
bus
, 
¶Ÿ
, 
off£t
);

163 
	`memb¨_lﬂd_lﬂd
();

165  *
±r
;

166 
	}
}

172 
	$œmebus_wrôe_ªgi°î
(
œmebus_so·c
 *
bus
, 
¶Ÿ
,

173 
uöt32_t
 
off£t
, uöt32_à
vÆ
)

175 
uöt32_t
 *
±r
;

177 
±r
 = 
	`œmebus_m≠_¨ó
(
bus
, 
¶Ÿ
, 
off£t
);

178 *
±r
 = 
vÆ
;

184 
	`memb¨_°‹e_°‹e
();

185 
	}
}

192 
	$maöbus_powîoff
()

200 
	`œmebus_powîoff
(
œmebus
);

201 
	}
}

207 
	$maöbus_ªboŸ
()

216 
	`k¥ötf
("CannotÑeboot -Öowering off instead, sorry.\n");

217 
	`maöbus_powîoff
();

218 
	}
}

226 
	$maöbus_hÆt
()

228 
	`˝u_hÆt
();

229 
	}
}

239 
	$maöbus_∑nic
()

241 
	`maöbus_powîoff
();

242 
	}
}

248 
uöt32_t


249 
	$maöbus_ømsize
()

251 
uöt32_t
 
ømsize
;

253 
ømsize
 = 
	`œmebus_ømsize
();

263 i‡(
ømsize
 > 508*1024*1024) {

264 
ømsize
 = 508*1024*1024;

267  
ømsize
;

268 
	}
}

274 
	$maöbus_£nd_ùi
(
˝u
 *
èrgë
)

276 
	`œmebus_as£π_ùi
(
œmebus
, 
èrgë
);

277 
	}
}

283 
	$maöbus_debuggî
()

285 
	`…ø˚_°›
(0);

286 
	}
}

293 
	#LAMEBUS_IRQ_BIT
 0x00000400

	)

294 
	#LAMEBUS_IPI_BIT
 0x00000800

	)

295 
	#MIPS_TIMER_BIT
 0x00008000

	)

298 
	$maöbus_öãºu±
(
å≠‰ame
 *
tf
)

300 
uöt32_t
 
ˇu£
;

301 
boﬁ
 
£í
 = 
Ál£
;

304 
	`KASSERT
(
cuπhªad
->
t_cur•l
 > 0);

306 
ˇu£
 = 
tf
->
tf_ˇu£
;

307 i‡(
ˇu£
 & 
LAMEBUS_IRQ_BIT
) {

308 
	`œmebus_öãºu±
(
œmebus
);

309 
£í
 = 
åue
;

311 i‡(
ˇu£
 & 
LAMEBUS_IPI_BIT
) {

312 
	`öãΩro˚ss‹_öãºu±
();

313 
	`œmebus_˛ór_ùi
(
œmebus
, 
cur˝u
);

314 
£í
 = 
åue
;

316 i‡(
ˇu£
 & 
MIPS_TIMER_BIT
) {

318 
	`mùs_timî_£t
(
CPU_FREQUENCY
 / 
HZ
);

320 
	`h¨d˛ock
();

321 
£í
 = 
åue
;

324 i‡(!
£í
) {

325 i‡((
ˇu£
 & 
CCA_IRQS
) == 0) {

340 
	`∑nic
("Unknown interrupt; causeÑegister is %08x\n",

341 
ˇu£
);

344 
	}
}

	@/home/trinity/src/kern/arch/sys161/include/bus.h

30 #i‚de‡
_SYS161_BUS_H_


31 
	#_SYS161_BUS_H_


	)

40 
	~<machöe/vm.h
>

41 
	~<œmebus/œmebus.h
>

43 
	#bus_wrôe_ªgi°î
(
bus
, 
¶Ÿ
, 
off£t
, 
vÆ
) \

44 
	`œmebus_wrôe_ªgi°î
(
bus
, 
¶Ÿ
, 
off£t
, 
vÆ
)

	)

46 
	#bus_ªad_ªgi°î
(
bus
, 
¶Ÿ
, 
off£t
) \

47 
	`œmebus_ªad_ªgi°î
(
bus
, 
¶Ÿ
, 
off£t
)

	)

49 
	#bus_m≠_¨ó
(
bus
, 
¶Ÿ
, 
off£t
) \

50 
	`œmebus_m≠_¨ó
(
bus
, 
¶Ÿ
, 
off£t
)

	)

57 
	#LB_BASEADDR
 (
MIPS_KSEG1
 + 0x1„00000)

	)

	@/home/trinity/src/kern/arch/sys161/include/maxcpus.h

30 #i‚de‡
_SYS161_MAXCPUS_H_


31 
	#_SYS161_MAXCPUS_H_


	)

42 
	#MAXCPUS
 32

	)

	@/home/trinity/src/kern/arch/sys161/main/start.S

30 
	~<kîn/mùs/ªgdefs.h
>

31 
	~<mùs/•ecüÃeg.h
>

33 .
£t
 
	gn‹e‹dî


35 .
	gãxt


36 .
globl
 
	g__°¨t


37 .
ty≥
 
	g__°¨t
,@
	gfun˘i⁄


38 .
ít
 
__°¨t


39 
	g__°¨t
:

52 .
‰ame
 
•
, 24, 
	g$0


53 .
	gmask
 0x80000000, -4

54 
addiu
 
	g•
, sp, -24

55 
sw
 
	gø
, 20(
	g•
)

89 
œ
 
	gs0
, 
_íd


91 
move
 
	ga1
, 
a0


92 
move
 
	ga0
, 
s0


93 
jÆ
 
°r˝y


94 
n›


96 
move
 
	ga0
, 
s0


97 
jÆ
 
°æí


98 
n›


100 
add
 
	gt0
, 
	gs0
, 
v0


101 
addi
 
	gt0
,Å0, 1

104 
addi
 
	gt0
,Å0, 4095

105 
li
 
	gt1
, 0xfffff000

106 
™d
 
	gt0
,Å0, 
t1


108 
addi
 
	gt0
,Å0, 4096

110 
move
 
	g•
, 
t0


112 
sw
 
	gt0
, 
fú°‰ì


127 
addiu
 
	g•
, sp, -24

128 
sw
 
	g$0
, 20(
	g•
)

134 
li
 
	ga0
, 
EXADDR_UTLB


135 
œ
 
	ga1
, 
mùs_uéb_h™dÀr


136 
œ
 
	ga2
, 
mùs_uéb_íd


137 
sub
 
	ga2
,á2, 
a1


138 
jÆ
 
memmove


139 
n›


141 
li
 
	ga0
, 
EXADDR_GENERAL


142 
œ
 
	ga1
, 
mùs_gíîÆ_h™dÀr


143 
œ
 
	ga2
, 
mùs_gíîÆ_íd


144 
sub
 
	ga2
,á2, 
a1


145 
jÆ
 
memmove


146 
n›


152 
jÆ
 
mùs_Êushiˇche


153 
n›


158 
jÆ
 
éb_ª£t


159 
n›


164 
li
 
	gs7
, 0

190 
li
 
	gt0
, 
CST_IRQMASK


191 
mtc0
 
	gt0
, 
c0_°©us


201 
mtc0
 
	g$0
, 
c0_c⁄ãxt


209 
œ
 
	ggp
, 
_gp


215 
jÆ
 
kmaö


216 
move
 
	ga0
, 
	gs0


224 
œ
 
a0
, 
∑nic°r


225 
jÆ
 
∑nic


226 
n›


227 
	gj
 1b

228 
	gn›


229 .
íd
 
	g__°¨t


231 .
rd©a


232 
	g∑nic°r
:

233 .
asciz
 "kmainÑeturned\n"

238 .
ãxt


239 .
globl
 
˝u_°¨t_£c⁄d¨y


240 .
ty≥
 
˝u_°¨t_£c⁄d¨y
,@
	gfun˘i⁄


241 .
ít
 
˝u_°¨t_£c⁄d¨y


242 
	g˝u_°¨t_£c⁄d¨y
:

266 .
‰ame
 
•
, 24, 
	g$0


267 .
	gmask
 0x80000000, -4

268 
addiu
 
	g•
, sp, -24

269 
sw
 
	gø
, 20(
	g•
)

274 
lui
 
	gt0
, %
	$hi
(
˝u°acks
)

275 
¶l
 
v0
, 
a0
, 2

276 
addu
 
t0
,Å0, 
v0


277 
lw
 
•
, %
	$lo
(
˝u°acks
)(
t0
)

282 
lui
 
t0
, %
	$hi
(
˝uthªads
)

283 
¶l
 
v0
, 
a0
, 2

284 
addu
 
t0
,Å0, 
v0


285 
lw
 
s7
, %
	$lo
(
˝uthªads
)(
t0
)

290 
jÆ
 
éb_ª£t


291 
n›


296 
li
 
t0
, 
CST_IRQMASK


297 
mtc0
 
t0
, 
c0_°©us


303 
¶l
 
v0
, 
a0
, 
CTX_PTBASESHIFT


304 
mtc0
 
v0
, 
c0_c⁄ãxt


313 
li
 
v0
, 100000

314 
mtc0
 
v0
, 
c0_com∑ª


320 
œ
 
gp
, 
_gp


326 
addiu
 
•
, sp, -24

327 
sw
 
z0
, 20(
•
)

333 
j
 
˝u_h©ch


334 
n›


335 .
íd
 
˝u_°¨t_£c⁄d¨y


	@/home/trinity/src/kern/compile/DUMBVM/.depend.__printf.c

1 
	g__¥ötf
.
	go
: ../../../
comm⁄
/
libc
/
¥ötf
/
__¥ötf
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
°d¨g
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.adddi3.c

1 
	gadddi3
.
	go
: ../../../
comm⁄
/
gcc
-
mûlicode
/
adddi3
.
c
 \

2 ../../../
comm⁄
/
gcc
-
mûlicode
/
l⁄gl⁄g
.
h
 ../../
ö˛ude
/
ty≥s
.h \

3 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

4 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

5 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h \

6 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limits.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.anddi3.c

1 
	g™ddi3
.
	go
: ../../../
comm⁄
/
gcc
-
mûlicode
/
™ddi3
.
c
 \

2 ../../../
comm⁄
/
gcc
-
mûlicode
/
l⁄gl⁄g
.
h
 ../../
ö˛ude
/
ty≥s
.h \

3 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

4 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

5 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h \

6 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limits.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.array.c

1 
	g¨øy
.
	go
: ../../
lib
/
¨øy
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
ö˛ude
/
¨øy
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.arraytest.c

1 
	g¨øyã°
.
	go
: ../../
ã°
/
¨øyã°
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
¨øy
.h ../../ö˛ude/
ã°
.h \

5 ../../
ö˛ude
/
kîn
/
£¸ë
.
h
 
›t
-
synch¥obs
.h o±-
autom©i⁄ã°
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.ashldi3.c

1 
	gashldi3
.
	go
: ../../../
comm⁄
/
gcc
-
mûlicode
/
ashldi3
.
c
 \

2 ../../../
comm⁄
/
gcc
-
mûlicode
/
l⁄gl⁄g
.
h
 ../../
ö˛ude
/
ty≥s
.h \

3 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

4 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

5 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h \

6 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limits.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.ashrdi3.c

1 
	gashrdi3
.
	go
: ../../../
comm⁄
/
gcc
-
mûlicode
/
ashrdi3
.
c
 \

2 ../../../
comm⁄
/
gcc
-
mûlicode
/
l⁄gl⁄g
.
h
 ../../
ö˛ude
/
ty≥s
.h \

3 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

4 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

5 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h \

6 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limits.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.atoi.c

1 
	g©oi
.
	go
: ../../../
comm⁄
/
libc
/
°dlib
/
©oi
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.autoconf.c

1 
	gautoc⁄f
.
	go
: ../../
compûe
/
DUMBVM
/
autoc⁄f
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
compûe
/
DUMBVM
/
autoc⁄f
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.beep.c

1 
	gbìp
.
	go
: ../../
dev
/
gíîic
/
bìp
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
dev
/
gíîic
/
bìp
.
h
 
autoc⁄f
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.beep_ltimer.c

1 
	gbìp_…imî
.
	go
: ../../
dev
/
œmebus
/
bìp_…imî
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
dev
/
gíîic
/
bìp
.h ../../dev/
œmebus
/
…imî
.h \

5 
autoc⁄f
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.bitmap.c

1 
	gbôm≠
.
	go
: ../../
lib
/
bôm≠
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
ö˛ude
/
bôm≠
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.bitmaptest.c

1 
	gbôm≠ã°
.
	go
: ../../
ã°
/
bôm≠ã°
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
bôm≠
.h ../../ö˛ude/
ã°
.h \

5 ../../
ö˛ude
/
kîn
/
£¸ë
.
h
 
›t
-
synch¥obs
.h o±-
autom©i⁄ã°
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.bswap.c

1 
	gbsw≠
.
	go
: ../../
lib
/
bsw≠
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

4 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.bzero.c

1 
	gbzîo
.
	go
: ../../../
comm⁄
/
libc
/
°rög
/
bzîo
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.cache-mips161.S

1 
	gˇche
-
	gmùs161
.
	go
: ../../
¨ch
/
mùs
/
loc‹e
/
ˇche
-
mùs161
.
S
 \

2 
ö˛udñöks
/
kîn
/
mùs
/
ªgdefs
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.clock.c

1 
	g˛ock
.
	go
: ../../
thªad
/
˛ock
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
˝u
.h ../../ö˛ude/
•ölock
.h \

5 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

6 ../../
ö˛ude
/
thªadli°
.
h
 
ö˛udñöks
/
machöe
/
vm
.h \

7 ../../
ö˛ude
/
wch™
.
h
 ../../ö˛ude/
˛ock
.h ../../ö˛ude/
kîn
/
time
.h \

8 ../../
ö˛ude
/
thªad
.
h
 ../../ö˛ude/
¨øy
.h \

9 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

10 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
cuºít
.h \

11 
ö˛udñöks
/
machöe
/
cuºít
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.cmpdi2.c

1 
	gcmpdi2
.
	go
: ../../../
comm⁄
/
gcc
-
mûlicode
/
cmpdi2
.
c
 \

2 ../../../
comm⁄
/
gcc
-
mûlicode
/
l⁄gl⁄g
.
h
 ../../
ö˛ude
/
ty≥s
.h \

3 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

4 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

5 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h \

6 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limits.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.con_lser.c

1 
	gc⁄_l£r
.
	go
: ../../
dev
/
œmebus
/
c⁄_l£r
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
dev
/
gíîic
/
c⁄sﬁe
.h ../../dev/
œmebus
/
l£r
.h \

5 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

6 
ö˛udñöks
/
machöe
/
•ölock
.
h
 
autoc⁄f
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.console.c

1 
	gc⁄sﬁe
.
	go
: ../../
dev
/
gíîic
/
c⁄sﬁe
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
ö˛ude
/
uio
.
h
 ../../ö˛ude/
kîn
/
iovec
.h ../../ö˛ude/
˝u
.h \

6 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

7 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
thªadli°
.h \

8 
ö˛udñöks
/
machöe
/
vm
.
h
 ../../
ö˛ude
/
thªad
.h ../../ö˛ude/
¨øy
.h \

9 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

10 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
cuºít
.h \

11 
ö˛udñöks
/
machöe
/
cuºít
.
h
 ../../
ö˛ude
/
synch
.h \

12 ../../
dev
/
gíîic
/
c⁄sﬁe
.
h
 ../../
ö˛ude
/
vfs
.h ../../ö˛ude/
devi˚
.h \

13 
autoc⁄f
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.copyinout.c

1 
	gc›yöout
.
	go
: ../../
vm
/
c›yöout
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
ö˛ude
/
£tjmp
.
h
 
ö˛udñöks
/
kîn
/
machöe
/setjmp.h \

6 ../../
ö˛ude
/
thªad
.
h
 ../../ö˛ude/
¨øy
.h ../../ö˛ude/
•ölock
.h \

7 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

8 ../../
ö˛ude
/
thªadli°
.
h
 
ö˛udñöks
/
machöe
/
thªad
.h \

9 ../../
ö˛ude
/
cuºít
.
h
 
ö˛udñöks
/
machöe
/current.h \

10 ../../
ö˛ude
/
vm
.
h
 
ö˛udñöks
/
machöe
/vm.h ../../ö˛ude/
c›yöout
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.cpu.c

1 
	g˝u
.
	go
: ../../
¨ch
/
mùs
/
thªad
/
˝u
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 
ö˛udñöks
/
mùs
/
•ecüÃeg
.h \

5 
ö˛udñöks
/
mùs
/
å≠‰ame
.
h
 in˛udñöks/
∂©f‹m
/
max˝us
.h \

6 ../../
ö˛ude
/
˝u
.
h
 ../../ö˛ude/
•ölock
.h ../../ö˛ude/
h™gm™
.h \

7 
›t
-
h™gm™
.
h
 
ö˛udñöks
/
machöe
/
•ölock
.h ../../
ö˛ude
/
thªadli°
.h \

8 
ö˛udñöks
/
machöe
/
vm
.
h
 ../../
ö˛ude
/
thªad
.h ../../ö˛ude/
¨øy
.h \

9 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

10 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.device.c

1 
	gdevi˚
.
	go
: ../../
vfs
/
devi˚
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
kîn
/
f˙é
.
h
 ../../ö˛ude/
°©
.h \

5 ../../
ö˛ude
/
kîn
/
°©
.
h
 ../../ö˛ude/kîn/
°©ty≥s
.h \

6 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

7 ../../
ö˛ude
/
uio
.
h
 ../../ö˛ude/
kîn
/
iovec
.h ../../ö˛ude/
synch
.h \

8 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

9 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
vnode
.h \

10 ../../
ö˛ude
/
devi˚
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.devnull.c

1 
	gdevnuŒ
.
	go
: ../../
vfs
/
devnuŒ
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
ö˛ude
/
uio
.
h
 ../../ö˛ude/
kîn
/
iovec
.h ../../ö˛ude/
vfs
.h \

6 ../../
ö˛ude
/
¨øy
.
h
 ../../ö˛ude/
devi˚
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.divdi3.c

1 
	gdivdi3
.
	go
: ../../../
comm⁄
/
gcc
-
mûlicode
/
divdi3
.
c
 \

2 ../../../
comm⁄
/
gcc
-
mûlicode
/
l⁄gl⁄g
.
h
 ../../
ö˛ude
/
ty≥s
.h \

3 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

4 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

5 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h \

6 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limits.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.dumbvm.c

1 
	gdumbvm
.
	go
: ../../
¨ch
/
mùs
/
vm
/
dumbvm
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
ö˛ude
/
•l
.
h
 ../../ö˛ude/
˝u
.h ../../ö˛ude/
•ölock
.h \

6 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

7 ../../
ö˛ude
/
thªadli°
.
h
 
ö˛udñöks
/
machöe
/
vm
.h \

8 ../../
ö˛ude
/
¥oc
.
h
 ../../ö˛ude/
cuºít
.h \

9 
ö˛udñöks
/
machöe
/
cuºít
.
h
 ../../
ö˛ude
/
thªad
.h \

10 ../../
ö˛ude
/
¨øy
.
h
 
ö˛udñöks
/
machöe
/
thªad
.h \

11 ../../
ö˛ude
/
£tjmp
.
h
 
ö˛udñöks
/
kîn
/
machöe
/setjmp.h \

12 
ö˛udñöks
/
mùs
/
éb
.
h
 ../../
ö˛ude
/
addr•a˚
.h ../../ö˛ude/
vm
.h \

13 
›t
-
dumbvm
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.emu.c

1 
	gemu
.
	go
: ../../
dev
/
œmebus
/
emu
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
kîn
/
f˙é
.
h
 ../../ö˛ude/
°©
.h \

5 ../../
ö˛ude
/
kîn
/
°©
.
h
 ../../ö˛ude/kîn/
°©ty≥s
.h \

6 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

7 ../../
ö˛ude
/
¨øy
.
h
 ../../ö˛ude/
uio
.h ../../ö˛ude/
kîn
/
iovec
.h \

8 ../../
ö˛ude
/
memb¨
.
h
 
ö˛udñöks
/
machöe
/membar.h \

9 ../../
ö˛ude
/
synch
.
h
 ../../ö˛ude/
•ölock
.h ../../ö˛ude/
h™gm™
.h \

10 
›t
-
h™gm™
.
h
 
ö˛udñöks
/
machöe
/
•ölock
.h ../../
dev
/
œmebus
/
emu
.h \

11 
ö˛udñöks
/
∂©f‹m
/
bus
.
h
 in˛udñöks/
machöe
/
vm
.h \

12 ../../
dev
/
œmebus
/œmebus.
h
 ../../
ö˛ude
/
˝u
.h \

13 ../../
ö˛ude
/
thªadli°
.
h
 ../../ö˛ude/
vfs
.h ../../ö˛ude/
emufs
.h \

14 ../../
ö˛ude
/
fs
.
h
 ../../ö˛ude/
vnode
.h 
autoc⁄f
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.emu_att.c

1 
	gemu_©t
.
	go
: ../../
dev
/
œmebus
/
emu_©t
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
dev
/
œmebus
/œmebus.h ../../
ö˛ude
/
˝u
.h \

5 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

6 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
thªadli°
.h \

7 
ö˛udñöks
/
machöe
/
vm
.
h
 ../../
dev
/
œmebus
/
emu
.h 
autoc⁄f
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.exception-mips1.S

1 
	gex˚±i⁄
-
	gmùs1
.
	go
: ../../
¨ch
/
mùs
/
loc‹e
/
ex˚±i⁄
-
mùs1
.
S
 \

2 
ö˛udñöks
/
kîn
/
mùs
/
ªgdefs
.
h
 in˛udñöks/mùs/
•ecüÃeg
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.fstest.c

1 
	gf°e°
.
	go
: ../../
ã°
/
f°e°
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
kîn
/
f˙é
.
h
 ../../ö˛ude/
lib
.h ../../ö˛ude/
cdefs
.h \

5 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
uio
.h ../../ö˛ude/
kîn
/
iovec
.h \

6 ../../
ö˛ude
/
thªad
.
h
 ../../ö˛ude/
¨øy
.h ../../ö˛ude/
•ölock
.h \

7 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

8 ../../
ö˛ude
/
thªadli°
.
h
 
ö˛udñöks
/
machöe
/
thªad
.h \

9 ../../
ö˛ude
/
£tjmp
.
h
 
ö˛udñöks
/
kîn
/
machöe
/setjmp.h \

10 ../../
ö˛ude
/
synch
.
h
 ../../ö˛ude/
vfs
.h ../../ö˛ude/
fs
.h \

11 ../../
ö˛ude
/
vnode
.
h
 ../../ö˛ude/
ã°
.h ../../ö˛ude/
kîn
/
£¸ë
.h \

12 
›t
-
synch¥obs
.
h
 o±-
autom©i⁄ã°
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.hmacunit.c

1 
	ghmacunô
.
	go
: ../../
ã°
/
hmacunô
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
•ölock
.h ../../ö˛ude/
h™gm™
.h \

5 
›t
-
h™gm™
.
h
 
ö˛udñöks
/
machöe
/
•ölock
.h ../../
ö˛ude
/
synch
.h \

6 ../../
ö˛ude
/
thªad
.
h
 ../../ö˛ude/
¨øy
.h ../../ö˛ude/
thªadli°
.h \

7 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

8 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
cuºít
.h \

9 
ö˛udñöks
/
machöe
/
cuºít
.
h
 ../../
ö˛ude
/
˛ock
.h \

10 ../../
ö˛ude
/
kîn
/
time
.
h
 ../../ö˛ude/
ã°
.h \

11 ../../
ö˛ude
/
kîn
/
£¸ë
.
h
 
›t
-
synch¥obs
.h o±-
autom©i⁄ã°
.h \

12 ../../
ö˛ude
/
kîn
/
£cuª
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.iordi3.c

1 
	gi‹di3
.
	go
: ../../../
comm⁄
/
gcc
-
mûlicode
/
i‹di3
.
c
 \

2 ../../../
comm⁄
/
gcc
-
mûlicode
/
l⁄gl⁄g
.
h
 ../../
ö˛ude
/
ty≥s
.h \

3 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

4 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

5 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h \

6 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limits.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.kgets.c

1 
	gkgës
.
	go
: ../../
lib
/
kgës
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.kmalloc.c

1 
	gkmÆloc
.
	go
: ../../
vm
/
kmÆloc
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
•ölock
.h ../../ö˛ude/
h™gm™
.h \

5 
›t
-
h™gm™
.
h
 
ö˛udñöks
/
machöe
/
•ölock
.h ../../
ö˛ude
/
vm
.h \

6 
ö˛udñöks
/
machöe
/
vm
.
h
 ../../
ö˛ude
/
kîn
/
ã°161
.h \

7 ../../
ö˛ude
/
kîn
/
£¸ë
.
h
 ../../ö˛ude/
ã°
.h 
›t
-
synch¥obs
.h \

8 
›t
-
autom©i⁄ã°
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.kmalloctest.c

1 
	gkmÆlo˘e°
.
	go
: ../../
ã°
/
kmÆlo˘e°
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
ö˛ude
/
˝u
.
h
 ../../ö˛ude/
•ölock
.h ../../ö˛ude/
h™gm™
.h \

6 
›t
-
h™gm™
.
h
 
ö˛udñöks
/
machöe
/
•ölock
.h ../../
ö˛ude
/
thªadli°
.h \

7 
ö˛udñöks
/
machöe
/
vm
.
h
 ../../
ö˛ude
/
thªad
.h ../../ö˛ude/
¨øy
.h \

8 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

9 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
synch
.h \

10 ../../
ö˛ude
/
vm
.
h
 ../../ö˛ude/
ã°
.h ../../ö˛ude/
kîn
/
£¸ë
.h \

11 
›t
-
synch¥obs
.
h
 o±-
autom©i⁄ã°
.h ../../
ö˛ude
/
kîn
/
ã°161
.h \

12 ../../
ö˛ude
/
maöbus
.
h
 
›t
-
dumbvm
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.kprintf.c

1 
	gk¥ötf
.
	go
: ../../
lib
/
k¥ötf
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
uni°d
.h \

4 ../../
ö˛ude
/
°d¨g
.
h
 ../../ö˛ude/
cdefs
.h ../../ö˛ude/
lib
.h \

5 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
•l
.h ../../ö˛ude/
˝u
.h \

6 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

7 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
thªadli°
.h \

8 
ö˛udñöks
/
machöe
/
vm
.
h
 ../../
ö˛ude
/
thªad
.h ../../ö˛ude/
¨øy
.h \

9 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

10 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
cuºít
.h \

11 
ö˛udñöks
/
machöe
/
cuºít
.
h
 ../../
ö˛ude
/
synch
.h \

12 ../../
ö˛ude
/
maöbus
.
h
 ../../ö˛ude/
vfs
.h ../../
dev
/
œmebus
/
…ø˚
.h \

13 ../../
ö˛ude
/
kîn
/
£¸ë
.
h
 ../../ö˛ude/
ã°
.h 
›t
-
synch¥obs
.h \

14 
›t
-
autom©i⁄ã°
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.lamebus.c

1 
	gœmebus
.
	go
: ../../
dev
/
œmebus
/œmebus.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
˝u
.h ../../ö˛ude/
•ölock
.h \

5 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

6 ../../
ö˛ude
/
thªadli°
.
h
 
ö˛udñöks
/
machöe
/
vm
.h \

7 ../../
ö˛ude
/
memb¨
.
h
 
ö˛udñöks
/
machöe
/membar.h \

8 ../../
ö˛ude
/
cuºít
.
h
 
ö˛udñöks
/
machöe
/current.h \

9 ../../
ö˛ude
/
thªad
.
h
 ../../ö˛ude/
¨øy
.h \

10 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

11 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
dev
/
œmebus
/lamebus.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.lamebus_machdep.c

1 
	gœmebus_machdï
.
	go
: ../../
¨ch
/
sys161
/
dev
/
œmebus_machdï
.
c
 \

2 ../../
ö˛ude
/
ty≥s
.
h
 ../../ö˛ude/
kîn
/types.h \

3 
ö˛udñöks
/
kîn
/
machöe
/
ty≥s
.
h
 includelinks/machine/types.h \

4 ../../
ö˛ude
/
kîn
/
uni°d
.
h
 ../../ö˛ude/
lib
.h ../../ö˛ude/
cdefs
.h \

5 
›t
-
nﬂs£πs
.
h
 
ö˛udñöks
/
mùs
/
•ecüÃeg
.h \

6 
ö˛udñöks
/
mùs
/
å≠‰ame
.
h
 ../../
ö˛ude
/
˝u
.h \

7 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

8 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
thªadli°
.h \

9 
ö˛udñöks
/
machöe
/
vm
.
h
 ../../
ö˛ude
/
•l
.h ../../ö˛ude/
˛ock
.h \

10 ../../
ö˛ude
/
kîn
/
time
.
h
 ../../ö˛ude/
thªad
.h ../../ö˛ude/
¨øy
.h \

11 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

12 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
cuºít
.h \

13 
ö˛udñöks
/
machöe
/
cuºít
.
h
 ../../
ö˛ude
/
memb¨
.h \

14 
ö˛udñöks
/
machöe
/
memb¨
.
h
 ../../
ö˛ude
/
synch
.h \

15 ../../
ö˛ude
/
maöbus
.
h
 
ö˛udñöks
/
sys161
/
bus
.h \

16 ../../
dev
/
œmebus
/œmebus.
h
 ../../dev/œmebus/
…ø˚
.h 
autoc⁄f
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.lhd.c

1 
	glhd
.
	go
: ../../
dev
/
œmebus
/
lhd
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
ö˛ude
/
uio
.
h
 ../../ö˛ude/
kîn
/
iovec
.h ../../ö˛ude/
memb¨
.h \

6 
ö˛udñöks
/
machöe
/
memb¨
.
h
 ../../
ö˛ude
/
synch
.h \

7 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

8 
ö˛udñöks
/
machöe
/
•ölock
.
h
 in˛udñöks/
∂©f‹m
/
bus
.h \

9 
ö˛udñöks
/
machöe
/
vm
.
h
 ../../
dev
/
œmebus
/lamebus.h \

10 ../../
ö˛ude
/
˝u
.
h
 ../../ö˛ude/
thªadli°
.h ../../ö˛ude/
vfs
.h \

11 ../../
ö˛ude
/
¨øy
.
h
 ../../
dev
/
œmebus
/
lhd
.h ../../ö˛ude/
devi˚
.h \

12 
autoc⁄f
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.lhd_att.c

1 
	glhd_©t
.
	go
: ../../
dev
/
œmebus
/
lhd_©t
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
dev
/
œmebus
/œmebus.h ../../
ö˛ude
/
˝u
.h \

5 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

6 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
thªadli°
.h \

7 
ö˛udñöks
/
machöe
/
vm
.
h
 ../../
dev
/
œmebus
/
lhd
.h ../../
ö˛ude
/
devi˚
.h \

8 
autoc⁄f
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.lib.c

1 
	glib
.
	go
: ../../
ã°
/
lib
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 ../../ö˛ude/
kîn
/types.h \

2 
ö˛udñöks
/
kîn
/
machöe
/
ty≥s
.
h
 includelinks/machine/types.h \

3 ../../
ö˛ude
/
thªad
.
h
 ../../ö˛ude/
¨øy
.h ../../ö˛ude/
cdefs
.h \

4 ../../
ö˛ude
/
lib
.
h
 
›t
-
nﬂs£πs
.h ../../ö˛ude/
•ölock
.h \

5 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

6 ../../
ö˛ude
/
thªadli°
.
h
 
ö˛udñöks
/
machöe
/
thªad
.h \

7 ../../
ö˛ude
/
£tjmp
.
h
 
ö˛udñöks
/
kîn
/
machöe
/setjmp.h \

8 ../../
ö˛ude
/
ã°
.
h
 ../../ö˛ude/
kîn
/
£¸ë
.h 
›t
-
synch¥obs
.h \

9 
›t
-
autom©i⁄ã°
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.loadelf.c

1 
	glﬂdñf
.
	go
: ../../
sysˇŒ
/
lﬂdñf
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
ö˛ude
/
uio
.
h
 ../../ö˛ude/
kîn
/
iovec
.h ../../ö˛ude/
¥oc
.h \

6 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

7 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
cuºít
.h \

8 
ö˛udñöks
/
machöe
/
cuºít
.
h
 ../../
ö˛ude
/
thªad
.h \

9 ../../
ö˛ude
/
¨øy
.
h
 ../../ö˛ude/
thªadli°
.h \

10 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

11 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
addr•a˚
.h \

12 ../../
ö˛ude
/
vm
.
h
 
ö˛udñöks
/
machöe
/vm.h 
›t
-
dumbvm
.h \

13 ../../
ö˛ude
/
vnode
.
h
 ../../ö˛ude/
ñf
.h 
ö˛udñöks
/
machöe
/elf.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.lrandom.c

1 
	gÃ™dom
.
	go
: ../../
dev
/
œmebus
/
Ã™dom
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
uio
.h ../../ö˛ude/
kîn
/
iovec
.h \

5 
ö˛udñöks
/
∂©f‹m
/
bus
.
h
 in˛udñöks/
machöe
/
vm
.h \

6 ../../
dev
/
œmebus
/œmebus.
h
 ../../
ö˛ude
/
˝u
.h ../../ö˛ude/
•ölock
.h \

7 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

8 ../../
ö˛ude
/
thªadli°
.
h
 ../../
dev
/
œmebus
/
Ã™dom
.h 
autoc⁄f
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.lrandom_att.c

1 
	gÃ™dom_©t
.
	go
: ../../
dev
/
œmebus
/
Ã™dom_©t
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
dev
/
œmebus
/œmebus.h ../../
ö˛ude
/
˝u
.h \

5 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

6 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
thªadli°
.h \

7 
ö˛udñöks
/
machöe
/
vm
.
h
 ../../
dev
/
œmebus
/
Ã™dom
.h 
autoc⁄f
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.lser.c

1 
	gl£r
.
	go
: ../../
dev
/
œmebus
/
l£r
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
•ölock
.h ../../ö˛ude/
h™gm™
.h \

5 
›t
-
h™gm™
.
h
 
ö˛udñöks
/
machöe
/
•ölock
.h \

6 
ö˛udñöks
/
∂©f‹m
/
bus
.
h
 in˛udñöks/
machöe
/
vm
.h \

7 ../../
dev
/
œmebus
/œmebus.
h
 ../../
ö˛ude
/
˝u
.h \

8 ../../
ö˛ude
/
thªadli°
.
h
 ../../
dev
/
œmebus
/
l£r
.h 
autoc⁄f
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.lser_att.c

1 
	gl£r_©t
.
	go
: ../../
dev
/
œmebus
/
l£r_©t
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
dev
/
œmebus
/œmebus.h ../../
ö˛ude
/
˝u
.h \

5 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

6 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
thªadli°
.h \

7 
ö˛udñöks
/
machöe
/
vm
.
h
 ../../
dev
/
œmebus
/
l£r
.h 
autoc⁄f
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.lshldi3.c

1 
	glshldi3
.
	go
: ../../../
comm⁄
/
gcc
-
mûlicode
/
lshldi3
.
c
 \

2 ../../../
comm⁄
/
gcc
-
mûlicode
/
l⁄gl⁄g
.
h
 ../../
ö˛ude
/
ty≥s
.h \

3 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

4 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

5 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h \

6 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limits.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.lshrdi3.c

1 
	glshrdi3
.
	go
: ../../../
comm⁄
/
gcc
-
mûlicode
/
lshrdi3
.
c
 \

2 ../../../
comm⁄
/
gcc
-
mûlicode
/
l⁄gl⁄g
.
h
 ../../
ö˛ude
/
ty≥s
.h \

3 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

4 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

5 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h \

6 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limits.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.ltimer.c

1 
	g…imî
.
	go
: ../../
dev
/
œmebus
/
…imî
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
•l
.h ../../ö˛ude/
˛ock
.h \

5 ../../
ö˛ude
/
kîn
/
time
.
h
 
ö˛udñöks
/
∂©f‹m
/
bus
.h \

6 
ö˛udñöks
/
machöe
/
vm
.
h
 ../../
dev
/
œmebus
/lamebus.h \

7 ../../
ö˛ude
/
˝u
.
h
 ../../ö˛ude/
•ölock
.h ../../ö˛ude/
h™gm™
.h \

8 
›t
-
h™gm™
.
h
 
ö˛udñöks
/
machöe
/
•ölock
.h ../../
ö˛ude
/
thªadli°
.h \

9 ../../
dev
/
œmebus
/
…imî
.
h
 
autoc⁄f
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.ltimer_att.c

1 
	g…imî_©t
.
	go
: ../../
dev
/
œmebus
/
…imî_©t
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
dev
/
œmebus
/œmebus.h ../../
ö˛ude
/
˝u
.h \

5 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

6 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
thªadli°
.h \

7 
ö˛udñöks
/
machöe
/
vm
.
h
 ../../
dev
/
œmebus
/
…imî
.h 
autoc⁄f
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.ltrace.c

1 
	g…ø˚
.
	go
: ../../
dev
/
œmebus
/
…ø˚
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 
ö˛udñöks
/
∂©f‹m
/
bus
.h in˛udñöks/
machöe
/
vm
.h \

5 ../../
dev
/
œmebus
/œmebus.
h
 ../../
ö˛ude
/
˝u
.h ../../ö˛ude/
•ölock
.h \

6 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

7 ../../
ö˛ude
/
thªadli°
.
h
 ../../
dev
/
œmebus
/
…ø˚
.h 
autoc⁄f
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.ltrace_att.c

1 
	g…ø˚_©t
.
	go
: ../../
dev
/
œmebus
/
…ø˚_©t
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
dev
/
œmebus
/œmebus.h ../../
ö˛ude
/
˝u
.h \

5 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

6 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
thªadli°
.h \

7 
ö˛udñöks
/
machöe
/
vm
.
h
 ../../
dev
/
œmebus
/
…ø˚
.h 
autoc⁄f
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.main.c

1 
	gmaö
.
	go
: ../../
maö
/maö.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
kîn
/
ªboŸ
.
h
 ../../ö˛ude/kîn/
uni°d
.h \

5 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

6 ../../
ö˛ude
/
•l
.
h
 ../../ö˛ude/
˛ock
.h ../../ö˛ude/
kîn
/
time
.h \

7 ../../
ö˛ude
/
thªad
.
h
 ../../ö˛ude/
¨øy
.h ../../ö˛ude/
•ölock
.h \

8 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

9 ../../
ö˛ude
/
thªadli°
.
h
 
ö˛udñöks
/
machöe
/
thªad
.h \

10 ../../
ö˛ude
/
£tjmp
.
h
 
ö˛udñöks
/
kîn
/
machöe
/setjmp.h \

11 ../../
ö˛ude
/
¥oc
.
h
 ../../ö˛ude/
cuºít
.h \

12 
ö˛udñöks
/
machöe
/
cuºít
.
h
 ../../
ö˛ude
/
synch
.h ../../ö˛ude/
vm
.h \

13 
ö˛udñöks
/
machöe
/
vm
.
h
 ../../
ö˛ude
/
maöbus
.h ../../ö˛ude/
vfs
.h \

14 ../../
ö˛ude
/
devi˚
.
h
 ../../ö˛ude/
sysˇŒ
.h ../../ö˛ude/
ã°
.h \

15 ../../
ö˛ude
/
kîn
/
£¸ë
.
h
 
›t
-
synch¥obs
.h o±-
autom©i⁄ã°
.h \

16 ../../
ö˛ude
/
kîn
/
ã°161
.
h
 ../../ö˛ude/
vîsi⁄
.h 
autoc⁄f
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.memcpy.c

1 
	gmem˝y
.
	go
: ../../../
comm⁄
/
libc
/
°rög
/
mem˝y
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.memmove.c

1 
	gmemmove
.
	go
: ../../../
comm⁄
/
libc
/
°rög
/
memmove
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.memset.c

1 
	gmem£t
.
	go
: ../../../
comm⁄
/
libc
/
°rög
/
mem£t
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.menu.c

1 
	gmíu
.
	go
: ../../
maö
/
míu
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
kîn
/
ªboŸ
.
h
 ../../ö˛ude/kîn/
uni°d
.h \

5 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limôs.h ../../ö˛ude/
lib
.h \

6 ../../
ö˛ude
/
cdefs
.
h
 
›t
-
nﬂs£πs
.h ../../ö˛ude/
uio
.h \

7 ../../
ö˛ude
/
kîn
/
iovec
.
h
 ../../ö˛ude/
˛ock
.h \

8 ../../
ö˛ude
/
kîn
/
time
.
h
 ../../ö˛ude/
maöbus
.h ../../ö˛ude/
synch
.h \

9 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

10 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
thªad
.h \

11 ../../
ö˛ude
/
¨øy
.
h
 ../../ö˛ude/
thªadli°
.h \

12 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

13 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
¥oc
.h \

14 ../../
ö˛ude
/
vfs
.
h
 ../../ö˛ude/
sfs
.h ../../ö˛ude/
fs
.h \

15 ../../
ö˛ude
/
vnode
.
h
 ../../ö˛ude/
kîn
/
sfs
.h ../../ö˛ude/
sysˇŒ
.h \

16 ../../
ö˛ude
/
ã°
.
h
 ../../ö˛ude/
kîn
/
£¸ë
.h 
›t
-
synch¥obs
.h \

17 
›t
-
autom©i⁄ã°
.
h
 ../../
ö˛ude
/
¥om±
.h o±-
sfs
.h o±-
√t
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.misc.c

1 
	gmisc
.
	go
: ../../
lib
/
misc
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 ../../ö˛ude/
kîn
/types.h \

2 
ö˛udñöks
/
kîn
/
machöe
/
ty≥s
.
h
 includelinks/machine/types.h \

3 ../../
ö˛ude
/
kîn
/
îrmsg
.
h
 ../../ö˛ude/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.moddi3.c

1 
	gmoddi3
.
	go
: ../../../
comm⁄
/
gcc
-
mûlicode
/
moddi3
.
c
 \

2 ../../../
comm⁄
/
gcc
-
mûlicode
/
l⁄gl⁄g
.
h
 ../../
ö˛ude
/
ty≥s
.h \

3 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

4 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

5 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h \

6 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limits.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.muldi3.c

1 
	gmuldi3
.
	go
: ../../../
comm⁄
/
gcc
-
mûlicode
/
muldi3
.
c
 \

2 ../../../
comm⁄
/
gcc
-
mûlicode
/
l⁄gl⁄g
.
h
 ../../
ö˛ude
/
ty≥s
.h \

3 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

4 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

5 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h \

6 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limits.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.negdi2.c

1 
	g√gdi2
.
	go
: ../../../
comm⁄
/
gcc
-
mûlicode
/
√gdi2
.
c
 \

2 ../../../
comm⁄
/
gcc
-
mûlicode
/
l⁄gl⁄g
.
h
 ../../
ö˛ude
/
ty≥s
.h \

3 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

4 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

5 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h \

6 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limits.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.notdi2.c

1 
	gnŸdi2
.
	go
: ../../../
comm⁄
/
gcc
-
mûlicode
/
nŸdi2
.
c
 \

2 ../../../
comm⁄
/
gcc
-
mûlicode
/
l⁄gl⁄g
.
h
 ../../
ö˛ude
/
ty≥s
.h \

3 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

4 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

5 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h \

6 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limits.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.proc.c

1 
	g¥oc
.
	go
: ../../
¥oc
/¥oc.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
•l
.h ../../ö˛ude/
cdefs
.h \

4 ../../
ö˛ude
/
¥oc
.
h
 ../../ö˛ude/
•ölock
.h ../../ö˛ude/
h™gm™
.h \

5 
›t
-
h™gm™
.
h
 
ö˛udñöks
/
machöe
/
•ölock
.h ../../
ö˛ude
/
cuºít
.h \

6 
ö˛udñöks
/
machöe
/
cuºít
.
h
 ../../
ö˛ude
/
thªad
.h \

7 ../../
ö˛ude
/
¨øy
.
h
 ../../ö˛ude/
lib
.h 
›t
-
nﬂs£πs
.h \

8 ../../
ö˛ude
/
thªadli°
.
h
 
ö˛udñöks
/
machöe
/
thªad
.h \

9 ../../
ö˛ude
/
£tjmp
.
h
 
ö˛udñöks
/
kîn
/
machöe
/setjmp.h \

10 ../../
ö˛ude
/
addr•a˚
.
h
 ../../ö˛ude/
vm
.h 
ö˛udñöks
/
machöe
/vm.h \

11 
›t
-
dumbvm
.
h
 ../../
ö˛ude
/
vnode
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.qdivrem.c

1 
	gqdivªm
.
	go
: ../../../
comm⁄
/
gcc
-
mûlicode
/
qdivªm
.
c
 \

2 ../../../
comm⁄
/
gcc
-
mûlicode
/
l⁄gl⁄g
.
h
 ../../
ö˛ude
/
ty≥s
.h \

3 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

4 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

5 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h \

6 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limits.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.ram.c

1 
	gøm
.
	go
: ../../
¨ch
/
mùs
/
vm
/
øm
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
vm
.h 
ö˛udñöks
/
machöe
/vm.h \

5 ../../
ö˛ude
/
maöbus
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.random.c

1 
	gøndom
.
	go
: ../../
dev
/
gíîic
/
øndom
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
kîn
/
f˙é
.
h
 ../../ö˛ude/
lib
.h ../../ö˛ude/
cdefs
.h \

5 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
uio
.h ../../ö˛ude/
kîn
/
iovec
.h \

6 ../../
ö˛ude
/
vfs
.
h
 ../../ö˛ude/
¨øy
.h ../../
dev
/
gíîic
/
øndom
.h \

7 ../../
ö˛ude
/
devi˚
.
h
 
autoc⁄f
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.random_lrandom.c

1 
	gøndom_Ã™dom
.
	go
: ../../
dev
/
œmebus
/
øndom_Ã™dom
.
c
 \

2 ../../
ö˛ude
/
ty≥s
.
h
 ../../ö˛ude/
kîn
/types.h \

3 
ö˛udñöks
/
kîn
/
machöe
/
ty≥s
.
h
 includelinks/machine/types.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
dev
/
gíîic
/
øndom
.
h
 ../../
ö˛ude
/
devi˚
.h \

6 ../../
dev
/
œmebus
/
Ã™dom
.
h
 
autoc⁄f
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.rtclock.c

1 
	gπ˛ock
.
	go
: ../../
dev
/
gíîic
/
π˛ock
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
ö˛ude
/
˛ock
.
h
 ../../ö˛ude/
kîn
/
time
.h \

6 ../../
dev
/
gíîic
/
π˛ock
.
h
 
autoc⁄f
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.rtclock_ltimer.c

1 
	gπ˛ock_…imî
.
	go
: ../../
dev
/
œmebus
/
π˛ock_…imî
.
c
 \

2 ../../
ö˛ude
/
ty≥s
.
h
 ../../ö˛ude/
kîn
/types.h \

3 
ö˛udñöks
/
kîn
/
machöe
/
ty≥s
.
h
 includelinks/machine/types.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
dev
/
gíîic
/
π˛ock
.
h
 ../../dev/
œmebus
/
…imî
.h 
autoc⁄f
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.runprogram.c

1 
	gru≈rogøm
.
	go
: ../../
sysˇŒ
/
ru≈rogøm
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
kîn
/
f˙é
.
h
 ../../ö˛ude/
lib
.h ../../ö˛ude/
cdefs
.h \

5 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
¥oc
.h ../../ö˛ude/
•ölock
.h \

6 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

7 ../../
ö˛ude
/
cuºít
.
h
 
ö˛udñöks
/
machöe
/current.h \

8 ../../
ö˛ude
/
thªad
.
h
 ../../ö˛ude/
¨øy
.h ../../ö˛ude/
thªadli°
.h \

9 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

10 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
addr•a˚
.h \

11 ../../
ö˛ude
/
vm
.
h
 
ö˛udñöks
/
machöe
/vm.h 
›t
-
dumbvm
.h \

12 ../../
ö˛ude
/
vfs
.
h
 ../../ö˛ude/
sysˇŒ
.h ../../ö˛ude/
ã°
.h \

13 ../../
ö˛ude
/
kîn
/
£¸ë
.
h
 
›t
-
synch¥obs
.h o±-
autom©i⁄ã°
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.rwtest.c

1 
	grwã°
.
	go
: ../../
ã°
/
rwã°
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
˛ock
.h ../../ö˛ude/
kîn
/
time
.h \

5 ../../
ö˛ude
/
thªad
.
h
 ../../ö˛ude/
¨øy
.h ../../ö˛ude/
•ölock
.h \

6 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

7 ../../
ö˛ude
/
thªadli°
.
h
 
ö˛udñöks
/
machöe
/
thªad
.h \

8 ../../
ö˛ude
/
£tjmp
.
h
 
ö˛udñöks
/
kîn
/
machöe
/setjmp.h \

9 ../../
ö˛ude
/
synch
.
h
 ../../ö˛ude/
ã°
.h ../../ö˛ude/
kîn
/
£¸ë
.h \

10 
›t
-
synch¥obs
.
h
 o±-
autom©i⁄ã°
.h ../../
ö˛ude
/
kîn
/
ã°161
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.secure.c

1 
	g£cuª
.
	go
: ../../../
comm⁄
/
libã°161
/
£cuª
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h ../../ö˛ude/kîn/
£cuª
.h \

5 ../../../
comm⁄
/
libã°161
/
sha256
.
h
 ../../../comm⁄/libã°161/
c⁄fig
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.semfs_fsops.c

1 
	g£mfs_fs›s
.
	go
: ../../
fs
/
£mfs
/
£mfs_fs›s
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
synch
.
h
 ../../ö˛ude/
•ölock
.h ../../ö˛ude/
cdefs
.h \

5 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

6 ../../
ö˛ude
/
vfs
.
h
 ../../ö˛ude/
¨øy
.h ../../ö˛ude/
lib
.h \

7 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
fs
.h ../../ö˛ude/
vnode
.h \

8 ../../
fs
/
£mfs
/£mfs.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.semfs_obj.c

1 
	g£mfs_obj
.
	go
: ../../
fs
/
£mfs
/
£mfs_obj
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
synch
.
h
 ../../ö˛ude/
•ölock
.h ../../ö˛ude/
cdefs
.h \

5 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

6 ../../
fs
/
£mfs
/£mfs.
h
 ../../
ö˛ude
/
¨øy
.h ../../ö˛ude/
lib
.h \

7 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
fs
.h ../../ö˛ude/
vnode
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.semfs_vnops.c

1 
	g£mfs_vn›s
.
	go
: ../../
fs
/
£mfs
/
£mfs_vn›s
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
kîn
/
f˙é
.
h
 ../../ö˛ude/
°©
.h \

5 ../../
ö˛ude
/
kîn
/
°©
.
h
 ../../ö˛ude/kîn/
°©ty≥s
.h \

6 ../../
ö˛ude
/
uio
.
h
 ../../ö˛ude/
kîn
/
iovec
.h ../../ö˛ude/
synch
.h \

7 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
cdefs
.h ../../ö˛ude/
h™gm™
.h \

8 
›t
-
h™gm™
.
h
 
ö˛udñöks
/
machöe
/
•ölock
.h ../../
ö˛ude
/
thªad
.h \

9 ../../
ö˛ude
/
¨øy
.
h
 ../../ö˛ude/
lib
.h 
›t
-
nﬂs£πs
.h \

10 ../../
ö˛ude
/
thªadli°
.
h
 
ö˛udñöks
/
machöe
/
thªad
.h \

11 ../../
ö˛ude
/
£tjmp
.
h
 
ö˛udñöks
/
kîn
/
machöe
/setjmp.h \

12 ../../
ö˛ude
/
¥oc
.
h
 ../../ö˛ude/
cuºít
.h \

13 
ö˛udñöks
/
machöe
/
cuºít
.
h
 ../../
ö˛ude
/
vfs
.h ../../ö˛ude/
vnode
.h \

14 ../../
fs
/
£mfs
/£mfs.
h
 ../../
ö˛ude
/fs.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.semunit.c

1 
	g£munô
.
	go
: ../../
ã°
/
£munô
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
•ölock
.h ../../ö˛ude/
h™gm™
.h \

5 
›t
-
h™gm™
.
h
 
ö˛udñöks
/
machöe
/
•ölock
.h ../../
ö˛ude
/
synch
.h \

6 ../../
ö˛ude
/
thªad
.
h
 ../../ö˛ude/
¨øy
.h ../../ö˛ude/
thªadli°
.h \

7 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

8 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
cuºít
.h \

9 
ö˛udñöks
/
machöe
/
cuºít
.
h
 ../../
ö˛ude
/
˛ock
.h \

10 ../../
ö˛ude
/
kîn
/
time
.
h
 ../../ö˛ude/
ã°
.h \

11 ../../
ö˛ude
/
kîn
/
£¸ë
.
h
 
›t
-
synch¥obs
.h o±-
autom©i⁄ã°
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.setjmp.S

1 
	g£tjmp
.
	go
: ../../../
comm⁄
/
libc
/
¨ch
/
mùs
/
£tjmp
.
S
 \

2 
ö˛udñöks
/
kîn
/
mùs
/
ªgdefs
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.sfs_balloc.c

1 
	gsfs_bÆloc
.
	go
: ../../
fs
/
sfs
/
sfs_bÆloc
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
bôm≠
.h ../../ö˛ude/
sfs
.h \

5 ../../
ö˛ude
/
fs
.
h
 ../../ö˛ude/
vnode
.h ../../ö˛ude/
•ölock
.h \

6 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

7 ../../
ö˛ude
/
kîn
/
sfs
.
h
 ../../
fs
/sfs/
sf•riv©e
.h ../../ö˛ude/
uio
.h \

8 ../../
ö˛ude
/
kîn
/
iovec
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.sfs_bmap.c

1 
	gsfs_bm≠
.
	go
: ../../
fs
/
sfs
/
sfs_bm≠
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
ö˛ude
/
vfs
.
h
 ../../ö˛ude/
¨øy
.h ../../ö˛ude/
sfs
.h \

6 ../../
ö˛ude
/
fs
.
h
 ../../ö˛ude/
vnode
.h ../../ö˛ude/
•ölock
.h \

7 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

8 ../../
ö˛ude
/
kîn
/
sfs
.
h
 ../../
fs
/sfs/
sf•riv©e
.h ../../ö˛ude/
uio
.h \

9 ../../
ö˛ude
/
kîn
/
iovec
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.sfs_dir.c

1 
	gsfs_dú
.
	go
: ../../
fs
/
sfs
/
sfs_dú
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
ö˛ude
/
vfs
.
h
 ../../ö˛ude/
¨øy
.h ../../ö˛ude/
sfs
.h \

6 ../../
ö˛ude
/
fs
.
h
 ../../ö˛ude/
vnode
.h ../../ö˛ude/
•ölock
.h \

7 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

8 ../../
ö˛ude
/
kîn
/
sfs
.
h
 ../../
fs
/sfs/
sf•riv©e
.h ../../ö˛ude/
uio
.h \

9 ../../
ö˛ude
/
kîn
/
iovec
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.sfs_fsops.c

1 
	gsfs_fs›s
.
	go
: ../../
fs
/
sfs
/
sfs_fs›s
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
ö˛ude
/
¨øy
.
h
 ../../ö˛ude/
bôm≠
.h ../../ö˛ude/
uio
.h \

6 ../../
ö˛ude
/
kîn
/
iovec
.
h
 ../../ö˛ude/
vfs
.h ../../ö˛ude/
devi˚
.h \

7 ../../
ö˛ude
/
sfs
.
h
 ../../ö˛ude/
fs
.h ../../ö˛ude/
vnode
.h \

8 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

9 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
kîn
/
sfs
.h \

10 ../../
fs
/
sfs
/
sf•riv©e
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.sfs_inode.c

1 
	gsfs_öode
.
	go
: ../../
fs
/
sfs
/
sfs_öode
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
ö˛ude
/
vfs
.
h
 ../../ö˛ude/
¨øy
.h ../../ö˛ude/
sfs
.h \

6 ../../
ö˛ude
/
fs
.
h
 ../../ö˛ude/
vnode
.h ../../ö˛ude/
•ölock
.h \

7 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

8 ../../
ö˛ude
/
kîn
/
sfs
.
h
 ../../
fs
/sfs/
sf•riv©e
.h ../../ö˛ude/
uio
.h \

9 ../../
ö˛ude
/
kîn
/
iovec
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.sfs_io.c

1 
	gsfs_io
.
	go
: ../../
fs
/
sfs
/
sfs_io
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
ö˛ude
/
uio
.
h
 ../../ö˛ude/
kîn
/
iovec
.h ../../ö˛ude/
vfs
.h \

6 ../../
ö˛ude
/
¨øy
.
h
 ../../ö˛ude/
devi˚
.h ../../ö˛ude/
sfs
.h \

7 ../../
ö˛ude
/
fs
.
h
 ../../ö˛ude/
vnode
.h ../../ö˛ude/
•ölock
.h \

8 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

9 ../../
ö˛ude
/
kîn
/
sfs
.
h
 ../../
fs
/sfs/
sf•riv©e
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.sfs_vnops.c

1 
	gsfs_vn›s
.
	go
: ../../
fs
/
sfs
/
sfs_vn›s
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
kîn
/
f˙é
.
h
 ../../ö˛ude/
°©
.h \

5 ../../
ö˛ude
/
kîn
/
°©
.
h
 ../../ö˛ude/kîn/
°©ty≥s
.h \

6 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

7 ../../
ö˛ude
/
uio
.
h
 ../../ö˛ude/
kîn
/
iovec
.h ../../ö˛ude/
vfs
.h \

8 ../../
ö˛ude
/
¨øy
.
h
 ../../ö˛ude/
sfs
.h ../../ö˛ude/
fs
.h \

9 ../../
ö˛ude
/
vnode
.
h
 ../../ö˛ude/
•ölock
.h ../../ö˛ude/
h™gm™
.h \

10 
›t
-
h™gm™
.
h
 
ö˛udñöks
/
machöe
/
•ölock
.h ../../
ö˛ude
/
kîn
/
sfs
.h \

11 ../../
fs
/
sfs
/
sf•riv©e
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.sha256.c

1 
	gsha256
.
	go
: ../../../
comm⁄
/
libã°161
/
sha256
.
c
 \

2 ../../../
comm⁄
/
libã°161
/
c⁄fig
.
h
 ../../../comm⁄/libã°161/
sha256
.h \

3 ../../
ö˛ude
/
ty≥s
.
h
 ../../ö˛ude/
kîn
/types.h \

4 
ö˛udñöks
/
kîn
/
machöe
/
ty≥s
.
h
 includelinks/machine/types.h \

5 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.snprintf.c

1 
	g¢¥ötf
.
	go
: ../../../
comm⁄
/
libc
/
¥ötf
/
¢¥ötf
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
°d¨g
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.spinlock.c

1 
	g•ölock
.
	go
: ../../
thªad
/
•ölock
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
˝u
.h ../../ö˛ude/
•ölock
.h \

5 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

6 ../../
ö˛ude
/
thªadli°
.
h
 
ö˛udñöks
/
machöe
/
vm
.h ../../ö˛ude/
•l
.h \

7 ../../
ö˛ude
/
memb¨
.
h
 
ö˛udñöks
/
machöe
/membar.h \

8 ../../
ö˛ude
/
cuºít
.
h
 
ö˛udñöks
/
machöe
/current.h \

9 ../../
ö˛ude
/
thªad
.
h
 ../../ö˛ude/
¨øy
.h \

10 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

11 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.spl.c

1 
	g•l
.
	go
: ../../
thªad
/
•l
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
˝u
.h ../../ö˛ude/
•ölock
.h \

5 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

6 ../../
ö˛ude
/
thªadli°
.
h
 
ö˛udñöks
/
machöe
/
vm
.h ../../ö˛ude/
•l
.h \

7 ../../
ö˛ude
/
thªad
.
h
 ../../ö˛ude/
¨øy
.h \

8 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

9 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
cuºít
.h \

10 
ö˛udñöks
/
machöe
/
cuºít
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.start.S

1 
	g°¨t
.
	go
: ../../
¨ch
/
sys161
/
maö
/
°¨t
.
S
 
ö˛udñöks
/
kîn
/
mùs
/
ªgdefs
.
h
 \

2 
ö˛udñöks
/
mùs
/
•ecüÃeg
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.stoplight.c

1 
	g°›light
.
	go
: ../../
synch¥obs
/
°›light
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
thªad
.h ../../ö˛ude/
¨øy
.h \

5 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

6 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
thªadli°
.h \

7 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

8 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
ã°
.h \

9 ../../
ö˛ude
/
kîn
/
£¸ë
.
h
 
›t
-
synch¥obs
.h o±-
autom©i⁄ã°
.h \

10 ../../
ö˛ude
/
synch
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.strcat.c

1 
	g°rˇt
.
	go
: ../../../
comm⁄
/
libc
/
°rög
/
°rˇt
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.strchr.c

1 
	g°rchr
.
	go
: ../../../
comm⁄
/
libc
/
°rög
/
°rchr
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.strcmp.c

1 
	g°rcmp
.
	go
: ../../../
comm⁄
/
libc
/
°rög
/
°rcmp
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.strcpy.c

1 
	g°r˝y
.
	go
: ../../../
comm⁄
/
libc
/
°rög
/
°r˝y
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.strlen.c

1 
	g°æí
.
	go
: ../../../
comm⁄
/
libc
/
°rög
/
°æí
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.strrchr.c

1 
	g°ºchr
.
	go
: ../../../
comm⁄
/
libc
/
°rög
/
°ºchr
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.strtok_r.c

1 
	g°πok_r
.
	go
: ../../../
comm⁄
/
libc
/
°rög
/
°πok_r
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.subdi3.c

1 
	gsubdi3
.
	go
: ../../../
comm⁄
/
gcc
-
mûlicode
/
subdi3
.
c
 \

2 ../../../
comm⁄
/
gcc
-
mûlicode
/
l⁄gl⁄g
.
h
 ../../
ö˛ude
/
ty≥s
.h \

3 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

4 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

5 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h \

6 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limits.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.switch.S

1 .
	go
: ../../
¨ch
/
mùs
/
thªad
/.
S
 \

2 
ö˛udñöks
/
kîn
/
mùs
/
ªgdefs
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.switchframe.c

1 
	gswôch‰ame
.
	go
: ../../
¨ch
/
mùs
/
thªad
/
swôch‰ame
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
thªad
.h ../../ö˛ude/
¨øy
.h \

5 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

6 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
thªadli°
.h \

7 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

8 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
thªad¥iv©e
.h \

9 ../../
¨ch
/
mùs
/
thªad
/
swôch‰ame
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.synch.c

1 
	gsynch
.
	go
: ../../
thªad
/
synch
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
•ölock
.h ../../ö˛ude/
h™gm™
.h \

5 
›t
-
h™gm™
.
h
 
ö˛udñöks
/
machöe
/
•ölock
.h ../../
ö˛ude
/
wch™
.h \

6 ../../
ö˛ude
/
thªad
.
h
 ../../ö˛ude/
¨øy
.h ../../ö˛ude/
thªadli°
.h \

7 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

8 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
cuºít
.h \

9 
ö˛udñöks
/
machöe
/
cuºít
.
h
 ../../
ö˛ude
/
synch
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.synchprobs.c

1 
	gsynch¥obs
.
	go
: ../../
ã°
/
synch¥obs
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
thªad
.h ../../ö˛ude/
¨øy
.h \

5 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

6 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
thªadli°
.h \

7 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

8 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
ã°
.h \

9 ../../
ö˛ude
/
kîn
/
£¸ë
.
h
 
›t
-
synch¥obs
.h o±-
autom©i⁄ã°
.h \

10 ../../
ö˛ude
/
cuºít
.
h
 
ö˛udñöks
/
machöe
/current.h \

11 ../../
ö˛ude
/
synch
.
h
 ../../ö˛ude/
kîn
/
ã°161
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.synchtest.c

1 
	gsynchã°
.
	go
: ../../
ã°
/
synchã°
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
˛ock
.h ../../ö˛ude/
kîn
/
time
.h \

5 ../../
ö˛ude
/
thªad
.
h
 ../../ö˛ude/
¨øy
.h ../../ö˛ude/
•ölock
.h \

6 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

7 ../../
ö˛ude
/
thªadli°
.
h
 
ö˛udñöks
/
machöe
/
thªad
.h \

8 ../../
ö˛ude
/
£tjmp
.
h
 
ö˛udñöks
/
kîn
/
machöe
/setjmp.h \

9 ../../
ö˛ude
/
synch
.
h
 ../../ö˛ude/
ã°
.h ../../ö˛ude/
kîn
/
£¸ë
.h \

10 
›t
-
synch¥obs
.
h
 o±-
autom©i⁄ã°
.h ../../
ö˛ude
/
kîn
/
ã°161
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.syscall.c

1 
	gsysˇŒ
.
	go
: ../../
¨ch
/
mùs
/
sysˇŒ
/sysˇŒ.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
kîn
/
sysˇŒ
.
h
 ../../ö˛ude/
lib
.h ../../ö˛ude/
cdefs
.h \

5 
›t
-
nﬂs£πs
.
h
 
ö˛udñöks
/
mùs
/
å≠‰ame
.h ../../
ö˛ude
/
thªad
.h \

6 ../../
ö˛ude
/
¨øy
.
h
 ../../ö˛ude/
•ölock
.h ../../ö˛ude/
h™gm™
.h \

7 
›t
-
h™gm™
.
h
 
ö˛udñöks
/
machöe
/
•ölock
.h ../../
ö˛ude
/
thªadli°
.h \

8 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

9 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
cuºít
.h \

10 
ö˛udñöks
/
machöe
/
cuºít
.
h
 ../../
ö˛ude
/
sysˇŒ
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.test161.c

1 
	gã°161
.
	go
: ../../../
comm⁄
/
libã°161
/
ã°161
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
synch
.h ../../ö˛ude/
•ölock
.h \

5 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

6 ../../
ö˛ude
/
kîn
/
î∫o
.
h
 ../../ö˛ude/kîn/
£cuª
.h \

7 ../../
ö˛ude
/
kîn
/
ã°161
.
h
 ../../ö˛ude/kîn/
£¸ë
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.thread.c

1 
	gthªad
.
	go
: ../../
thªad
/thªad.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
ö˛ude
/
¨øy
.
h
 ../../ö˛ude/
˝u
.h ../../ö˛ude/
•ölock
.h \

6 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

7 ../../
ö˛ude
/
thªadli°
.
h
 
ö˛udñöks
/
machöe
/
vm
.h ../../ö˛ude/
•l
.h \

8 ../../
ö˛ude
/
wch™
.
h
 ../../ö˛ude/
thªad
.h \

9 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

10 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
thªad¥iv©e
.h \

11 ../../
ö˛ude
/
¥oc
.
h
 ../../ö˛ude/
cuºít
.h \

12 
ö˛udñöks
/
machöe
/
cuºít
.
h
 ../../
ö˛ude
/
synch
.h \

13 ../../
ö˛ude
/
addr•a˚
.
h
 ../../ö˛ude/
vm
.h 
›t
-
dumbvm
.h \

14 ../../
ö˛ude
/
maöbus
.
h
 ../../ö˛ude/
vnode
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.thread_machdep.c

1 
	gthªad_machdï
.
	go
: ../../
¨ch
/
mùs
/
thªad
/
thªad_machdï
.
c
 \

2 ../../
ö˛ude
/
ty≥s
.
h
 ../../ö˛ude/
kîn
/types.h \

3 
ö˛udñöks
/
kîn
/
machöe
/
ty≥s
.
h
 includelinks/machine/types.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
ö˛ude
/
thªad
.
h
 ../../ö˛ude/
¨øy
.h ../../ö˛ude/
•ölock
.h \

6 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

7 ../../
ö˛ude
/
thªadli°
.
h
 
ö˛udñöks
/
machöe
/
thªad
.h \

8 ../../
ö˛ude
/
£tjmp
.
h
 
ö˛udñöks
/
kîn
/
machöe
/setjmp.h \

9 ../../
ö˛ude
/
thªad¥iv©e
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.threadlist.c

1 
	gthªadli°
.
	go
: ../../
thªad
/
thªadli°
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
thªad
.h ../../ö˛ude/
¨øy
.h \

5 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

6 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
thªadli°
.h \

7 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

8 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.threadlisttest.c

1 
	gthªadli°ã°
.
	go
: ../../
ã°
/
thªadli°ã°
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
thªad
.h ../../ö˛ude/
¨øy
.h \

5 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

6 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
thªadli°
.h \

7 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

8 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
ã°
.h \

9 ../../
ö˛ude
/
kîn
/
£¸ë
.
h
 
›t
-
synch¥obs
.h o±-
autom©i⁄ã°
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.threadstart.S

1 
	gthªad°¨t
.
	go
: ../../
¨ch
/
mùs
/
thªad
/
thªad°¨t
.
S
 \

2 
ö˛udñöks
/
kîn
/
mùs
/
ªgdefs
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.threadtest.c

1 
	gthªadã°
.
	go
: ../../
ã°
/
thªadã°
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
thªad
.h ../../ö˛ude/
¨øy
.h \

5 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

6 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
thªadli°
.h \

7 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

8 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
synch
.h \

9 ../../
ö˛ude
/
ã°
.
h
 ../../ö˛ude/
kîn
/
£¸ë
.h 
›t
-
synch¥obs
.h \

10 
›t
-
autom©i⁄ã°
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.time.c

1 
	gtime
.
	go
: ../../
lib
/
time
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 ../../ö˛ude/
kîn
/types.h \

2 
ö˛udñöks
/
kîn
/
machöe
/
ty≥s
.
h
 includelinks/machine/types.h \

3 ../../
ö˛ude
/
˛ock
.
h
 ../../ö˛ude/
kîn
/
time
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.time_syscalls.c

1 
	gtime_sysˇŒs
.
	go
: ../../
sysˇŒ
/
time_sysˇŒs
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
˛ock
.h \

4 ../../
ö˛ude
/
kîn
/
time
.
h
 ../../ö˛ude/
c›yöout
.h \

5 ../../
ö˛ude
/
sysˇŒ
.
h
 ../../ö˛ude/
cdefs
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.tlb-mips161.S

1 
	géb
-
	gmùs161
.
	go
: ../../
¨ch
/
mùs
/
vm
/
éb
-
mùs161
.
S
 \

2 
ö˛udñöks
/
kîn
/
mùs
/
ªgdefs
.
h
 in˛udñöks/mùs/
•ecüÃeg
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.trap.c

1 
	gå≠
.
	go
: ../../
¨ch
/
mùs
/
loc‹e
/
å≠
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
sig«l
.h \

4 
ö˛udñöks
/
kîn
/
machöe
/
sig«l
.
h
 ../../
ö˛ude
/kern/signal.h \

5 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

6 
ö˛udñöks
/
mùs
/
•ecüÃeg
.
h
 in˛udñöks/mùs/
å≠‰ame
.h \

7 ../../
ö˛ude
/
˝u
.
h
 ../../ö˛ude/
•ölock
.h ../../ö˛ude/
h™gm™
.h \

8 
›t
-
h™gm™
.
h
 
ö˛udñöks
/
machöe
/
•ölock
.h ../../
ö˛ude
/
thªadli°
.h \

9 
ö˛udñöks
/
machöe
/
vm
.
h
 ../../
ö˛ude
/
•l
.h ../../ö˛ude/
thªad
.h \

10 ../../
ö˛ude
/
¨øy
.
h
 
ö˛udñöks
/
machöe
/
thªad
.h \

11 ../../
ö˛ude
/
£tjmp
.
h
 
ö˛udñöks
/
kîn
/
machöe
/setjmp.h \

12 ../../
ö˛ude
/
cuºít
.
h
 
ö˛udñöks
/
machöe
/current.h \

13 ../../
ö˛ude
/
vm
.
h
 ../../ö˛ude/
maöbus
.h ../../ö˛ude/
sysˇŒ
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.tt3.c

1 
	gâ3
.
	go
: ../../
ã°
/
â3
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 ../../ö˛ude/
kîn
/types.h \

2 
ö˛udñöks
/
kîn
/
machöe
/
ty≥s
.
h
 includelinks/machine/types.h \

3 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

4 ../../
ö˛ude
/
wch™
.
h
 ../../ö˛ude/
thªad
.h ../../ö˛ude/
¨øy
.h \

5 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

6 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
thªadli°
.h \

7 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

8 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
synch
.h \

9 ../../
ö˛ude
/
ã°
.
h
 ../../ö˛ude/
kîn
/
£¸ë
.h 
›t
-
synch¥obs
.h \

10 
›t
-
autom©i⁄ã°
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.ucmpdi2.c

1 
	gucmpdi2
.
	go
: ../../../
comm⁄
/
gcc
-
mûlicode
/
ucmpdi2
.
c
 \

2 ../../../
comm⁄
/
gcc
-
mûlicode
/
l⁄gl⁄g
.
h
 ../../
ö˛ude
/
ty≥s
.h \

3 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

4 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

5 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h \

6 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limits.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.udivdi3.c

1 
	gudivdi3
.
	go
: ../../../
comm⁄
/
gcc
-
mûlicode
/
udivdi3
.
c
 \

2 ../../../
comm⁄
/
gcc
-
mûlicode
/
l⁄gl⁄g
.
h
 ../../
ö˛ude
/
ty≥s
.h \

3 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

4 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

5 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h \

6 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limits.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.uio.c

1 
	guio
.
	go
: ../../
lib
/
uio
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 ../../ö˛ude/
kîn
/types.h \

2 
ö˛udñöks
/
kîn
/
machöe
/
ty≥s
.
h
 includelinks/machine/types.h \

3 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

4 ../../
ö˛ude
/
uio
.
h
 ../../ö˛ude/
kîn
/
iovec
.h ../../ö˛ude/
¥oc
.h \

5 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

6 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
cuºít
.h \

7 
ö˛udñöks
/
machöe
/
cuºít
.
h
 ../../
ö˛ude
/
thªad
.h \

8 ../../
ö˛ude
/
¨øy
.
h
 ../../ö˛ude/
thªadli°
.h \

9 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

10 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
c›yöout
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.umoddi3.c

1 
	gumoddi3
.
	go
: ../../../
comm⁄
/
gcc
-
mûlicode
/
umoddi3
.
c
 \

2 ../../../
comm⁄
/
gcc
-
mûlicode
/
l⁄gl⁄g
.
h
 ../../
ö˛ude
/
ty≥s
.h \

3 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

4 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

5 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h \

6 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limits.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.vfscwd.c

1 
	gvfscwd
.
	go
: ../../
vfs
/
vfscwd
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
°©
.
h
 ../../ö˛ude/
kîn
/stat.h \

5 ../../
ö˛ude
/
kîn
/
°©ty≥s
.
h
 ../../ö˛ude/
lib
.h ../../ö˛ude/
cdefs
.h \

6 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
uio
.h ../../ö˛ude/
kîn
/
iovec
.h \

7 ../../
ö˛ude
/
¥oc
.
h
 ../../ö˛ude/
•ölock
.h ../../ö˛ude/
h™gm™
.h \

8 
›t
-
h™gm™
.
h
 
ö˛udñöks
/
machöe
/
•ölock
.h ../../
ö˛ude
/
cuºít
.h \

9 
ö˛udñöks
/
machöe
/
cuºít
.
h
 ../../
ö˛ude
/
thªad
.h \

10 ../../
ö˛ude
/
¨øy
.
h
 ../../ö˛ude/
thªadli°
.h \

11 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

12 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
vfs
.h \

13 ../../
ö˛ude
/
fs
.
h
 ../../ö˛ude/
vnode
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.vfsfail.c

1 
	gvfsÁû
.
	go
: ../../
vfs
/
vfsÁû
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
vnode
.
h
 ../../ö˛ude/
•ölock
.h ../../ö˛ude/
cdefs
.h \

5 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.vfslist.c

1 
	gvf¶i°
.
	go
: ../../
vfs
/
vf¶i°
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
ö˛ude
/
¨øy
.
h
 ../../ö˛ude/
synch
.h ../../ö˛ude/
•ölock
.h \

6 ../../
ö˛ude
/
h™gm™
.
h
 
›t
-h™gm™.h 
ö˛udñöks
/
machöe
/
•ölock
.h \

7 ../../
ö˛ude
/
vfs
.
h
 ../../ö˛ude/
fs
.h ../../ö˛ude/
vnode
.h \

8 ../../
ö˛ude
/
devi˚
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.vfslookup.c

1 
	gvf¶ookup
.
	go
: ../../
vfs
/
vf¶ookup
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limôs.h ../../ö˛ude/
lib
.h \

5 ../../
ö˛ude
/
cdefs
.
h
 
›t
-
nﬂs£πs
.h ../../ö˛ude/
synch
.h \

6 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

7 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
vfs
.h \

8 ../../
ö˛ude
/
¨øy
.
h
 ../../ö˛ude/
fs
.h ../../ö˛ude/
vnode
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.vfspath.c

1 
	gvf•©h
.
	go
: ../../
vfs
/
vf•©h
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
kîn
/
f˙é
.
h
 ../../ö˛ude/
limôs
.h \

5 ../../
ö˛ude
/
kîn
/
limôs
.
h
 ../../ö˛ude/
lib
.h ../../ö˛ude/
cdefs
.h \

6 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
vfs
.h ../../ö˛ude/
¨øy
.h \

7 ../../
ö˛ude
/
vnode
.
h
 ../../ö˛ude/
•ölock
.h ../../ö˛ude/
h™gm™
.h \

8 
›t
-
h™gm™
.
h
 
ö˛udñöks
/
machöe
/
•ölock
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.vnode.c

1 
	gvnode
.
	go
: ../../
vfs
/
vnode
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
kîn
/
î∫o
.h \

4 ../../
ö˛ude
/
lib
.
h
 ../../ö˛ude/
cdefs
.h 
›t
-
nﬂs£πs
.h \

5 ../../
ö˛ude
/
synch
.
h
 ../../ö˛ude/
•ölock
.h ../../ö˛ude/
h™gm™
.h \

6 
›t
-
h™gm™
.
h
 
ö˛udñöks
/
machöe
/
•ölock
.h ../../
ö˛ude
/
vfs
.h \

7 ../../
ö˛ude
/
¨øy
.
h
 ../../ö˛ude/
vnode
.h

	@/home/trinity/src/kern/compile/DUMBVM/.depend.whalemating.c

1 
	gwhÆem©ög
.
	go
: ../../
synch¥obs
/
whÆem©ög
.
c
 ../../
ö˛ude
/
ty≥s
.
h
 \

2 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

3 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
lib
.h ../../ö˛ude/
cdefs
.h \

4 
›t
-
nﬂs£πs
.
h
 ../../
ö˛ude
/
thªad
.h ../../ö˛ude/
¨øy
.h \

5 ../../
ö˛ude
/
•ölock
.
h
 ../../ö˛ude/
h™gm™
.h 
›t
-hangman.h \

6 
ö˛udñöks
/
machöe
/
•ölock
.
h
 ../../
ö˛ude
/
thªadli°
.h \

7 
ö˛udñöks
/
machöe
/
thªad
.
h
 ../../
ö˛ude
/
£tjmp
.h \

8 
ö˛udñöks
/
kîn
/
machöe
/
£tjmp
.
h
 ../../
ö˛ude
/
ã°
.h \

9 ../../
ö˛ude
/
kîn
/
£¸ë
.
h
 
›t
-
synch¥obs
.h o±-
autom©i⁄ã°
.h \

10 ../../
ö˛ude
/
synch
.
h


	@/home/trinity/src/kern/compile/DUMBVM/.depend.xordi3.c

1 
	gx‹di3
.
	go
: ../../../
comm⁄
/
gcc
-
mûlicode
/
x‹di3
.
c
 \

2 ../../../
comm⁄
/
gcc
-
mûlicode
/
l⁄gl⁄g
.
h
 ../../
ö˛ude
/
ty≥s
.h \

3 ../../
ö˛ude
/
kîn
/
ty≥s
.
h
 
ö˛udñöks
/kîn/
machöe
/types.h \

4 
ö˛udñöks
/
machöe
/
ty≥s
.
h
 ../../
ö˛ude
/
ídün
.h \

5 ../../
ö˛ude
/
kîn
/
ídün
.
h
 
ö˛udñöks
/kîn/
machöe
/endian.h \

6 ../../
ö˛ude
/
limôs
.
h
 ../../ö˛ude/
kîn
/limits.h

	@/home/trinity/src/kern/compile/DUMBVM/Makefile

1 #Autom©iˇŒy 
gíî©ed
 
by
 
c⁄fig
; dÿ
nŸ
 
edô
.

4 #T› 
of
 
the
 
kî√l
 
åì


5 
	gKTOP
=../..

6 #T› 
of
 
the
 
whﬁe
 
åì


7 
TOP
=
$
(
KTOP
)/..

8 #Debug 
vs
. 
›timize


9 
KDEBUG
=-
g
 -
Og


10 #Namê
of
 
the
 
kî√l
 
c⁄fig
 
fûe


11 
CONFNAME
=
DUMBVM


13 .
ö˛ude
 "$(TOP)/mk/os161.config.mk"

14 .
ö˛ude
 "files.mk"

15 .
ö˛ude
 "$(TOP)/mk/os161.kernel.mk"

	@/home/trinity/src/kern/compile/DUMBVM/autoconf.c

2 
	~<ty≥s.h
>

3 
	~<lib.h
>

4 
	~"autoc⁄f.h
"

6 
autoc⁄f_bìp
(
bìp_so·c
 *, );

7 
autoc⁄f_c⁄
(
c⁄_so·c
 *, );

8 
autoc⁄f_emu
(
emu_so·c
 *, );

9 
autoc⁄f_lhd
(
lhd_so·c
 *, );

10 
autoc⁄f_Ã™dom
(
Ã™dom_so·c
 *, );

11 
autoc⁄f_l£r
(
l£r_so·c
 *, );

12 
autoc⁄f_…imî
(
…imî_so·c
 *, );

13 
autoc⁄f_…ø˚
(
…ø˚_so·c
 *, );

14 
autoc⁄f_øndom
(
øndom_so·c
 *, );

15 
autoc⁄f_π˛ock
(
π˛ock_so·c
 *, );

16 
	g√xtunô_bìp
;

17 
	g√xtunô_c⁄
;

18 
	g√xtunô_emu
;

19 
	g√xtunô_lhd
;

20 
	g√xtunô_Ã™dom
;

21 
	g√xtunô_l£r
;

22 
	g√xtunô_…imî
;

23 
	g√xtunô_…ø˚
;

24 
	g√xtunô_øndom
;

25 
	g√xtunô_π˛ock
;

29 
	$åy©èch_emu_to_œmebus
(
devunô
, 
œmebus_so·c
 *
bus
, 
busunô
)

31 
emu_so·c
 *
dev
;

32 
ªsu…
;

34 
dev
 = 
	`©èch_emu_to_œmebus
(
devunô
, 
bus
);

35 i‡(
dev
==
NULL
) {

38 
	`k¥ötf
("emu%dáàœmebus%d", 
devunô
, 
busunô
);

39 
ªsu…
 = 
	`c⁄fig_emu
(
dev
, 
devunô
);

40 i‡(
ªsu…
 != 0) {

41 
	`k¥ötf
(": %s\n", 
	`°ªº‹
(
ªsu…
));

43  
ªsu…
;

45 
	`k¥ötf
("\n");

46 
√xtunô_emu
 = 
devunô
+1;

47 
	`autoc⁄f_emu
(
dev
, 
devunô
);

49 
	}
}

53 
	$åy©èch_…ø˚_to_œmebus
(
devunô
, 
œmebus_so·c
 *
bus
, 
busunô
)

55 
…ø˚_so·c
 *
dev
;

56 
ªsu…
;

58 
dev
 = 
	`©èch_…ø˚_to_œmebus
(
devunô
, 
bus
);

59 i‡(
dev
==
NULL
) {

62 
	`k¥ötf
("…ø˚%dáàœmebus%d", 
devunô
, 
busunô
);

63 
ªsu…
 = 
	`c⁄fig_…ø˚
(
dev
, 
devunô
);

64 i‡(
ªsu…
 != 0) {

65 
	`k¥ötf
(": %s\n", 
	`°ªº‹
(
ªsu…
));

67  
ªsu…
;

69 
	`k¥ötf
("\n");

70 
√xtunô_…ø˚
 = 
devunô
+1;

71 
	`autoc⁄f_…ø˚
(
dev
, 
devunô
);

73 
	}
}

77 
	$åy©èch_…imî_to_œmebus
(
devunô
, 
œmebus_so·c
 *
bus
, 
busunô
)

79 
…imî_so·c
 *
dev
;

80 
ªsu…
;

82 
dev
 = 
	`©èch_…imî_to_œmebus
(
devunô
, 
bus
);

83 i‡(
dev
==
NULL
) {

86 
	`k¥ötf
("…imî%dáàœmebus%d", 
devunô
, 
busunô
);

87 
ªsu…
 = 
	`c⁄fig_…imî
(
dev
, 
devunô
);

88 i‡(
ªsu…
 != 0) {

89 
	`k¥ötf
(": %s\n", 
	`°ªº‹
(
ªsu…
));

91  
ªsu…
;

93 
	`k¥ötf
("\n");

94 
√xtunô_…imî
 = 
devunô
+1;

95 
	`autoc⁄f_…imî
(
dev
, 
devunô
);

97 
	}
}

101 
	$åy©èch_Ã™dom_to_œmebus
(
devunô
, 
œmebus_so·c
 *
bus
, 
busunô
)

103 
Ã™dom_so·c
 *
dev
;

104 
ªsu…
;

106 
dev
 = 
	`©èch_Ã™dom_to_œmebus
(
devunô
, 
bus
);

107 i‡(
dev
==
NULL
) {

110 
	`k¥ötf
("Ã™dom%dáàœmebus%d", 
devunô
, 
busunô
);

111 
ªsu…
 = 
	`c⁄fig_Ã™dom
(
dev
, 
devunô
);

112 i‡(
ªsu…
 != 0) {

113 
	`k¥ötf
(": %s\n", 
	`°ªº‹
(
ªsu…
));

115  
ªsu…
;

117 
	`k¥ötf
("\n");

118 
√xtunô_Ã™dom
 = 
devunô
+1;

119 
	`autoc⁄f_Ã™dom
(
dev
, 
devunô
);

121 
	}
}

125 
	$åy©èch_lhd_to_œmebus
(
devunô
, 
œmebus_so·c
 *
bus
, 
busunô
)

127 
lhd_so·c
 *
dev
;

128 
ªsu…
;

130 
dev
 = 
	`©èch_lhd_to_œmebus
(
devunô
, 
bus
);

131 i‡(
dev
==
NULL
) {

134 
	`k¥ötf
("lhd%dáàœmebus%d", 
devunô
, 
busunô
);

135 
ªsu…
 = 
	`c⁄fig_lhd
(
dev
, 
devunô
);

136 i‡(
ªsu…
 != 0) {

137 
	`k¥ötf
(": %s\n", 
	`°ªº‹
(
ªsu…
));

139  
ªsu…
;

141 
	`k¥ötf
("\n");

142 
√xtunô_lhd
 = 
devunô
+1;

143 
	`autoc⁄f_lhd
(
dev
, 
devunô
);

145 
	}
}

149 
	$åy©èch_l£r_to_œmebus
(
devunô
, 
œmebus_so·c
 *
bus
, 
busunô
)

151 
l£r_so·c
 *
dev
;

152 
ªsu…
;

154 
dev
 = 
	`©èch_l£r_to_œmebus
(
devunô
, 
bus
);

155 i‡(
dev
==
NULL
) {

158 
	`k¥ötf
("l£r%dáàœmebus%d", 
devunô
, 
busunô
);

159 
ªsu…
 = 
	`c⁄fig_l£r
(
dev
, 
devunô
);

160 i‡(
ªsu…
 != 0) {

161 
	`k¥ötf
(": %s\n", 
	`°ªº‹
(
ªsu…
));

163  
ªsu…
;

165 
	`k¥ötf
("\n");

166 
√xtunô_l£r
 = 
devunô
+1;

167 
	`autoc⁄f_l£r
(
dev
, 
devunô
);

169 
	}
}

173 
	$åy©èch_bìp_to_…imî
(
devunô
, 
…imî_so·c
 *
bus
, 
busunô
)

175 
bìp_so·c
 *
dev
;

176 
ªsu…
;

178 
dev
 = 
	`©èch_bìp_to_…imî
(
devunô
, 
bus
);

179 i‡(
dev
==
NULL
) {

182 
	`k¥ötf
("bìp%dáà…imî%d", 
devunô
, 
busunô
);

183 
ªsu…
 = 
	`c⁄fig_bìp
(
dev
, 
devunô
);

184 i‡(
ªsu…
 != 0) {

185 
	`k¥ötf
(": %s\n", 
	`°ªº‹
(
ªsu…
));

187  
ªsu…
;

189 
	`k¥ötf
("\n");

190 
√xtunô_bìp
 = 
devunô
+1;

191 
	`autoc⁄f_bìp
(
dev
, 
devunô
);

193 
	}
}

197 
	$åy©èch_c⁄_to_l£r
(
devunô
, 
l£r_so·c
 *
bus
, 
busunô
)

199 
c⁄_so·c
 *
dev
;

200 
ªsu…
;

202 
dev
 = 
	`©èch_c⁄_to_l£r
(
devunô
, 
bus
);

203 i‡(
dev
==
NULL
) {

206 
	`k¥ötf
("c⁄%dáàl£r%d", 
devunô
, 
busunô
);

207 
ªsu…
 = 
	`c⁄fig_c⁄
(
dev
, 
devunô
);

208 i‡(
ªsu…
 != 0) {

209 
	`k¥ötf
(": %s\n", 
	`°ªº‹
(
ªsu…
));

211  
ªsu…
;

213 
	`k¥ötf
("\n");

214 
√xtunô_c⁄
 = 
devunô
+1;

215 
	`autoc⁄f_c⁄
(
dev
, 
devunô
);

217 
	}
}

221 
	$åy©èch_π˛ock_to_…imî
(
devunô
, 
…imî_so·c
 *
bus
, 
busunô
)

223 
π˛ock_so·c
 *
dev
;

224 
ªsu…
;

226 
dev
 = 
	`©èch_π˛ock_to_…imî
(
devunô
, 
bus
);

227 i‡(
dev
==
NULL
) {

230 
	`k¥ötf
("π˛ock%dáà…imî%d", 
devunô
, 
busunô
);

231 
ªsu…
 = 
	`c⁄fig_π˛ock
(
dev
, 
devunô
);

232 i‡(
ªsu…
 != 0) {

233 
	`k¥ötf
(": %s\n", 
	`°ªº‹
(
ªsu…
));

235  
ªsu…
;

237 
	`k¥ötf
("\n");

238 
√xtunô_π˛ock
 = 
devunô
+1;

239 
	`autoc⁄f_π˛ock
(
dev
, 
devunô
);

241 
	}
}

245 
	$åy©èch_øndom_to_Ã™dom
(
devunô
, 
Ã™dom_so·c
 *
bus
, 
busunô
)

247 
øndom_so·c
 *
dev
;

248 
ªsu…
;

250 
dev
 = 
	`©èch_øndom_to_Ã™dom
(
devunô
, 
bus
);

251 i‡(
dev
==
NULL
) {

254 
	`k¥ötf
("øndom%dáàÃ™dom%d", 
devunô
, 
busunô
);

255 
ªsu…
 = 
	`c⁄fig_øndom
(
dev
, 
devunô
);

256 i‡(
ªsu…
 != 0) {

257 
	`k¥ötf
(": %s\n", 
	`°ªº‹
(
ªsu…
));

259  
ªsu…
;

261 
	`k¥ötf
("\n");

262 
√xtunô_øndom
 = 
devunô
+1;

263 
	`autoc⁄f_øndom
(
dev
, 
devunô
);

265 
	}
}

270 
	$autoc⁄f_c⁄
(
c⁄_so·c
 *
bus
, 
busunô
)

272 ()
bus
; ()
busunô
;

273 
	}
}

277 
	$autoc⁄f_l£r
(
l£r_so·c
 *
bus
, 
busunô
)

279 ()
bus
; ()
busunô
;

281 i‡(
√xtunô_c⁄
 <= 0) {

282 
	`åy©èch_c⁄_to_l£r
(0, 
bus
, 
busunô
);

285 
	}
}

289 
	$autoc⁄f_lhd
(
lhd_so·c
 *
bus
, 
busunô
)

291 ()
bus
; ()
busunô
;

292 
	}
}

296 
	$autoc⁄f_emu
(
emu_so·c
 *
bus
, 
busunô
)

298 ()
bus
; ()
busunô
;

299 
	}
}

303 
	$autoc⁄f_øndom
(
øndom_so·c
 *
bus
, 
busunô
)

305 ()
bus
; ()
busunô
;

306 
	}
}

310 
	$autoc⁄f_…imî
(
…imî_so·c
 *
bus
, 
busunô
)

312 ()
bus
; ()
busunô
;

314 i‡(
√xtunô_bìp
 <= 0) {

315 
	`åy©èch_bìp_to_…imî
(0, 
bus
, 
busunô
);

319 i‡(
√xtunô_π˛ock
 <= 0) {

320 
	`åy©èch_π˛ock_to_…imî
(0, 
bus
, 
busunô
);

323 
	}
}

326 
	$autoc⁄f_œmebus
(
œmebus_so·c
 *
bus
, 
busunô
)

328 ()
bus
; ()
busunô
;

330 
ªsu…
, 
devunô
=
√xtunô_emu
;

332 
ªsu…
 = 
	`åy©èch_emu_to_œmebus
(
devunô
, 
bus
, 
busunô
);

333 
devunô
++;

334 } 
ªsu…
==0);

337 
ªsu…
, 
devunô
=
√xtunô_…ø˚
;

339 
ªsu…
 = 
	`åy©èch_…ø˚_to_œmebus
(
devunô
, 
bus
, 
busunô
);

340 
devunô
++;

341 } 
ªsu…
==0);

344 
ªsu…
, 
devunô
=
√xtunô_…imî
;

346 
ªsu…
 = 
	`åy©èch_…imî_to_œmebus
(
devunô
, 
bus
, 
busunô
);

347 
devunô
++;

348 } 
ªsu…
==0);

351 
ªsu…
, 
devunô
=
√xtunô_Ã™dom
;

353 
ªsu…
 = 
	`åy©èch_Ã™dom_to_œmebus
(
devunô
, 
bus
, 
busunô
);

354 
devunô
++;

355 } 
ªsu…
==0);

358 
ªsu…
, 
devunô
=
√xtunô_lhd
;

360 
ªsu…
 = 
	`åy©èch_lhd_to_œmebus
(
devunô
, 
bus
, 
busunô
);

361 
devunô
++;

362 } 
ªsu…
==0);

365 
ªsu…
, 
devunô
=
√xtunô_l£r
;

367 
ªsu…
 = 
	`åy©èch_l£r_to_œmebus
(
devunô
, 
bus
, 
busunô
);

368 
devunô
++;

369 } 
ªsu…
==0);

371 
	}
}

375 
	$autoc⁄f_bìp
(
bìp_so·c
 *
bus
, 
busunô
)

377 ()
bus
; ()
busunô
;

378 
	}
}

382 
	$autoc⁄f_Ã™dom
(
Ã™dom_so·c
 *
bus
, 
busunô
)

384 ()
bus
; ()
busunô
;

386 i‡(
√xtunô_øndom
 <= 0) {

387 
	`åy©èch_øndom_to_Ã™dom
(0, 
bus
, 
busunô
);

390 
	}
}

394 
	$autoc⁄f_π˛ock
(
π˛ock_so·c
 *
bus
, 
busunô
)

396 ()
bus
; ()
busunô
;

397 
	}
}

401 
	$autoc⁄f_…ø˚
(
…ø˚_so·c
 *
bus
, 
busunô
)

403 ()
bus
; ()
busunô
;

404 
	}
}

407 
	$p£udoc⁄fig
()

409 
	}
}

	@/home/trinity/src/kern/compile/DUMBVM/autoconf.h

2 #i‚de‡
_AUTOCONF_H_


3 
	#_AUTOCONF_H_


	)

5 
	gœmebus_so·c
;

6 
	gemu_so·c
;

7 
	g…ø˚_so·c
;

8 
	g…imî_so·c
;

9 
	gÃ™dom_so·c
;

10 
	glhd_so·c
;

11 
	gl£r_so·c
;

12 
	gbìp_so·c
;

13 
	gc⁄_so·c
;

14 
	gπ˛ock_so·c
;

15 
	gøndom_so·c
;

17 
autoc⁄f_œmebus
(
œmebus_so·c
 *
dev
, 
unô
);

19 
emu_so·c
 *
©èch_emu_to_œmebus
(
devunô
, 
œmebus_so·c
 *
bus
);

20 
…ø˚_so·c
 *
©èch_…ø˚_to_œmebus
(
devunô
, 
œmebus_so·c
 *
bus
);

21 
…imî_so·c
 *
©èch_…imî_to_œmebus
(
devunô
, 
œmebus_so·c
 *
bus
);

22 
Ã™dom_so·c
 *
©èch_Ã™dom_to_œmebus
(
devunô
, 
œmebus_so·c
 *
bus
);

23 
lhd_so·c
 *
©èch_lhd_to_œmebus
(
devunô
, 
œmebus_so·c
 *
bus
);

24 
l£r_so·c
 *
©èch_l£r_to_œmebus
(
devunô
, 
œmebus_so·c
 *
bus
);

25 
bìp_so·c
 *
©èch_bìp_to_…imî
(
devunô
, 
…imî_so·c
 *
bus
);

26 
c⁄_so·c
 *
©èch_c⁄_to_l£r
(
devunô
, 
l£r_so·c
 *
bus
);

27 
π˛ock_so·c
 *
©èch_π˛ock_to_…imî
(
devunô
, 
…imî_so·c
 *
bus
);

28 
øndom_so·c
 *
©èch_øndom_to_Ã™dom
(
devunô
, 
Ã™dom_so·c
 *
bus
);

30 
c⁄fig_emu
(
emu_so·c
 *
dev
, 
unô
);

31 
c⁄fig_…ø˚
(
…ø˚_so·c
 *
dev
, 
unô
);

32 
c⁄fig_…imî
(
…imî_so·c
 *
dev
, 
unô
);

33 
c⁄fig_Ã™dom
(
Ã™dom_so·c
 *
dev
, 
unô
);

34 
c⁄fig_lhd
(
lhd_so·c
 *
dev
, 
unô
);

35 
c⁄fig_l£r
(
l£r_so·c
 *
dev
, 
unô
);

36 
c⁄fig_bìp
(
bìp_so·c
 *
dev
, 
unô
);

37 
c⁄fig_c⁄
(
c⁄_so·c
 *
dev
, 
unô
);

38 
c⁄fig_π˛ock
(
π˛ock_so·c
 *
dev
, 
unô
);

39 
c⁄fig_øndom
(
øndom_so·c
 *
dev
, 
unô
);

41 
p£udoc⁄fig
();

	@/home/trinity/src/kern/compile/DUMBVM/files.mk

1 #Autom©iˇŒy 
gíî©ed
 
by
 
c⁄fig
; dÿ
nŸ
 
edô


2 
	gSRCS
+=
$
(
TOP
)/
comm⁄
/
libc
/
¥ötf
/
__¥ötf
.
c


3 
SRCS
+=
$
(
TOP
)/
comm⁄
/
libc
/
¥ötf
/
¢¥ötf
.
c


4 
SRCS
+=
$
(
TOP
)/
comm⁄
/
libc
/
°dlib
/
©oi
.
c


5 
SRCS
+=
$
(
TOP
)/
comm⁄
/
libc
/
°rög
/
bzîo
.
c


6 
SRCS
+=
$
(
TOP
)/
comm⁄
/
libc
/
°rög
/
mem˝y
.
c


7 
SRCS
+=
$
(
TOP
)/
comm⁄
/
libc
/
°rög
/
memmove
.
c


8 
SRCS
+=
$
(
TOP
)/
comm⁄
/
libc
/
°rög
/
mem£t
.
c


9 
SRCS
+=
$
(
TOP
)/
comm⁄
/
libc
/
°rög
/
°rˇt
.
c


10 
SRCS
+=
$
(
TOP
)/
comm⁄
/
libc
/
°rög
/
°rchr
.
c


11 
SRCS
+=
$
(
TOP
)/
comm⁄
/
libc
/
°rög
/
°rcmp
.
c


12 
SRCS
+=
$
(
TOP
)/
comm⁄
/
libc
/
°rög
/
°r˝y
.
c


13 
SRCS
+=
$
(
TOP
)/
comm⁄
/
libc
/
°rög
/
°æí
.
c


14 
SRCS
+=
$
(
TOP
)/
comm⁄
/
libc
/
°rög
/
°ºchr
.
c


15 
SRCS
+=
$
(
TOP
)/
comm⁄
/
libc
/
°rög
/
°πok_r
.
c


16 
SRCS
+=
$
(
TOP
)/
comm⁄
/
libã°161
/
£cuª
.
c


17 
SRCS
+=
$
(
TOP
)/
comm⁄
/
libã°161
/
sha256
.
c


18 
SRCS
+=
$
(
TOP
)/
comm⁄
/
libã°161
/
ã°161
.
c


19 
SRCS
+=
$
(
KTOP
)/
compûe
/
DUMBVM
/
autoc⁄f
.
c


20 
SRCS
+=
$
(
KTOP
)/
dev
/
gíîic
/
bìp
.
c


21 
SRCS
+=
$
(
KTOP
)/
dev
/
gíîic
/
c⁄sﬁe
.
c


22 
SRCS
+=
$
(
KTOP
)/
dev
/
gíîic
/
øndom
.
c


23 
SRCS
+=
$
(
KTOP
)/
dev
/
gíîic
/
π˛ock
.
c


24 
SRCS
+=
$
(
KTOP
)/
dev
/
œmebus
/
bìp_…imî
.
c


25 
SRCS
+=
$
(
KTOP
)/
dev
/
œmebus
/
c⁄_l£r
.
c


26 
SRCS
+=
$
(
KTOP
)/
dev
/
œmebus
/
emu_©t
.
c


27 
SRCS
+=
$
(
KTOP
)/
dev
/
œmebus
/
emu
.
c


28 
SRCS
+=
$
(
KTOP
)/
dev
/
œmebus
/œmebus.
c


29 
SRCS
+=
$
(
KTOP
)/
dev
/
œmebus
/
lhd_©t
.
c


30 
SRCS
+=
$
(
KTOP
)/
dev
/
œmebus
/
lhd
.
c


31 
SRCS
+=
$
(
KTOP
)/
dev
/
œmebus
/
Ã™dom_©t
.
c


32 
SRCS
+=
$
(
KTOP
)/
dev
/
œmebus
/
Ã™dom
.
c


33 
SRCS
+=
$
(
KTOP
)/
dev
/
œmebus
/
l£r_©t
.
c


34 
SRCS
+=
$
(
KTOP
)/
dev
/
œmebus
/
l£r
.
c


35 
SRCS
+=
$
(
KTOP
)/
dev
/
œmebus
/
…imî_©t
.
c


36 
SRCS
+=
$
(
KTOP
)/
dev
/
œmebus
/
…imî
.
c


37 
SRCS
+=
$
(
KTOP
)/
dev
/
œmebus
/
…ø˚_©t
.
c


38 
SRCS
+=
$
(
KTOP
)/
dev
/
œmebus
/
…ø˚
.
c


39 
SRCS
+=
$
(
KTOP
)/
dev
/
œmebus
/
øndom_Ã™dom
.
c


40 
SRCS
+=
$
(
KTOP
)/
dev
/
œmebus
/
π˛ock_…imî
.
c


41 
SRCS
+=
$
(
KTOP
)/
fs
/
£mfs
/
£mfs_fs›s
.
c


42 
SRCS
+=
$
(
KTOP
)/
fs
/
£mfs
/
£mfs_obj
.
c


43 
SRCS
+=
$
(
KTOP
)/
fs
/
£mfs
/
£mfs_vn›s
.
c


44 
SRCS
+=
$
(
KTOP
)/
fs
/
sfs
/
sfs_bÆloc
.
c


45 
SRCS
+=
$
(
KTOP
)/
fs
/
sfs
/
sfs_bm≠
.
c


46 
SRCS
+=
$
(
KTOP
)/
fs
/
sfs
/
sfs_dú
.
c


47 
SRCS
+=
$
(
KTOP
)/
fs
/
sfs
/
sfs_fs›s
.
c


48 
SRCS
+=
$
(
KTOP
)/
fs
/
sfs
/
sfs_öode
.
c


49 
SRCS
+=
$
(
KTOP
)/
fs
/
sfs
/
sfs_io
.
c


50 
SRCS
+=
$
(
KTOP
)/
fs
/
sfs
/
sfs_vn›s
.
c


51 
SRCS
+=
$
(
KTOP
)/
lib
/
¨øy
.
c


52 
SRCS
+=
$
(
KTOP
)/
lib
/
bôm≠
.
c


53 
SRCS
+=
$
(
KTOP
)/
lib
/
bsw≠
.
c


54 
SRCS
+=
$
(
KTOP
)/
lib
/
kgës
.
c


55 
SRCS
+=
$
(
KTOP
)/
lib
/
k¥ötf
.
c


56 
SRCS
+=
$
(
KTOP
)/
lib
/
misc
.
c


57 
SRCS
+=
$
(
KTOP
)/
lib
/
time
.
c


58 
SRCS
+=
$
(
KTOP
)/
lib
/
uio
.
c


59 
SRCS
+=
$
(
KTOP
)/
maö
/maö.
c


60 
SRCS
+=
$
(
KTOP
)/
maö
/
míu
.
c


61 
SRCS
.
MACHINE
.
mùs
+=
$
(
KTOP
)/
¨ch
/mùs/
loc‹e
/
å≠
.
c


62 
SRCS
.
MACHINE
.
mùs
+=
$
(
KTOP
)/
¨ch
/mùs/
sysˇŒ
/sysˇŒ.
c


63 
SRCS
.
MACHINE
.
mùs
+=
$
(
KTOP
)/
¨ch
/mùs/
thªad
/
˝u
.
c


64 
SRCS
.
MACHINE
.
mùs
+=
$
(
KTOP
)/
¨ch
/mùs/
thªad
/
swôch‰ame
.
c


65 
SRCS
.
MACHINE
.
mùs
+=
$
(
KTOP
)/
¨ch
/mùs/
thªad
/.
S


66 
SRCS
.
MACHINE
.
mùs
+=
$
(
KTOP
)/
¨ch
/mùs/
thªad
/
thªad_machdï
.
c


67 
SRCS
.
MACHINE
.
mùs
+=
$
(
KTOP
)/
¨ch
/mùs/
thªad
/
thªad°¨t
.
S


68 
SRCS
.
MACHINE
.
mùs
+=
$
(
KTOP
)/
¨ch
/mùs/
vm
/
dumbvm
.
c


69 
SRCS
.
MACHINE
.
mùs
+=
$
(
KTOP
)/
¨ch
/mùs/
vm
/
øm
.
c


70 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
gcc
-
mûlicode
/
adddi3
.
c


71 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
gcc
-
mûlicode
/
™ddi3
.
c


72 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
gcc
-
mûlicode
/
ashldi3
.
c


73 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
gcc
-
mûlicode
/
ashrdi3
.
c


74 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
gcc
-
mûlicode
/
cmpdi2
.
c


75 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
gcc
-
mûlicode
/
divdi3
.
c


76 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
gcc
-
mûlicode
/
i‹di3
.
c


77 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
gcc
-
mûlicode
/
lshldi3
.
c


78 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
gcc
-
mûlicode
/
lshrdi3
.
c


79 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
gcc
-
mûlicode
/
moddi3
.
c


80 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
gcc
-
mûlicode
/
muldi3
.
c


81 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
gcc
-
mûlicode
/
√gdi2
.
c


82 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
gcc
-
mûlicode
/
nŸdi2
.
c


83 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
gcc
-
mûlicode
/
qdivªm
.
c


84 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
gcc
-
mûlicode
/
subdi3
.
c


85 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
gcc
-
mûlicode
/
ucmpdi2
.
c


86 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
gcc
-
mûlicode
/
udivdi3
.
c


87 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
gcc
-
mûlicode
/
umoddi3
.
c


88 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
gcc
-
mûlicode
/
x‹di3
.
c


89 
SRCS
.
MACHINE
.
mùs
+=
$
(
TOP
)/
comm⁄
/
libc
/
¨ch
/mùs/
£tjmp
.
S


90 
SRCS
.
MACHINE
.
mùs
+=
$
(
KTOP
)/
vm
/
c›yöout
.
c


91 
SRCS
+=
$
(
KTOP
)/
¥oc
/¥oc.
c


92 
SRCS
+=
$
(
KTOP
)/
synch¥obs
/
°›light
.
c


93 
SRCS
+=
$
(
KTOP
)/
synch¥obs
/
whÆem©ög
.
c


94 
SRCS
.
PLATFORM
.
sys161
+=
$
(
KTOP
)/
¨ch
/
mùs
/
loc‹e
/
ˇche
-
mùs161
.
S


95 
SRCS
.
PLATFORM
.
sys161
+=
$
(
KTOP
)/
¨ch
/
mùs
/
loc‹e
/
ex˚±i⁄
-
mùs1
.
S


96 
SRCS
.
PLATFORM
.
sys161
+=
$
(
KTOP
)/
¨ch
/
mùs
/
vm
/
éb
-
mùs161
.
S


97 
SRCS
.
PLATFORM
.
sys161
+=
$
(
KTOP
)/
¨ch
/sys161/
dev
/
œmebus_machdï
.
c


98 
SRCS
.
PLATFORM
.
sys161
+=
$
(
KTOP
)/
¨ch
/sys161/
maö
/
°¨t
.
S


99 
SRCS
+=
$
(
KTOP
)/
sysˇŒ
/
lﬂdñf
.
c


100 
SRCS
+=
$
(
KTOP
)/
sysˇŒ
/
ru≈rogøm
.
c


101 
SRCS
+=
$
(
KTOP
)/
sysˇŒ
/
time_sysˇŒs
.
c


102 
SRCS
+=
$
(
KTOP
)/
ã°
/
¨øyã°
.
c


103 
SRCS
+=
$
(
KTOP
)/
ã°
/
bôm≠ã°
.
c


104 
SRCS
+=
$
(
KTOP
)/
ã°
/
f°e°
.
c


105 
SRCS
+=
$
(
KTOP
)/
ã°
/
hmacunô
.
c


106 
SRCS
+=
$
(
KTOP
)/
ã°
/
kmÆlo˘e°
.
c


107 
SRCS
+=
$
(
KTOP
)/
ã°
/
lib
.
c


108 
SRCS
+=
$
(
KTOP
)/
ã°
/
rwã°
.
c


109 
SRCS
+=
$
(
KTOP
)/
ã°
/
£munô
.
c


110 
SRCS
+=
$
(
KTOP
)/
ã°
/
synch¥obs
.
c


111 
SRCS
+=
$
(
KTOP
)/
ã°
/
synchã°
.
c


112 
SRCS
+=
$
(
KTOP
)/
ã°
/
thªadli°ã°
.
c


113 
SRCS
+=
$
(
KTOP
)/
ã°
/
thªadã°
.
c


114 
SRCS
+=
$
(
KTOP
)/
ã°
/
â3
.
c


115 
SRCS
+=
$
(
KTOP
)/
thªad
/
˛ock
.
c


116 
SRCS
+=
$
(
KTOP
)/
thªad
/
•ölock
.
c


117 
SRCS
+=
$
(
KTOP
)/
thªad
/
•l
.
c


118 
SRCS
+=
$
(
KTOP
)/
thªad
/
synch
.
c


119 
SRCS
+=
$
(
KTOP
)/
thªad
/thªad.
c


120 
SRCS
+=
$
(
KTOP
)/
thªad
/
thªadli°
.
c


121 
SRCS
+=
$
(
KTOP
)/
vfs
/
devi˚
.
c


122 
SRCS
+=
$
(
KTOP
)/
vfs
/
devnuŒ
.
c


123 
SRCS
+=
$
(
KTOP
)/
vfs
/
vfscwd
.
c


124 
SRCS
+=
$
(
KTOP
)/
vfs
/
vfsÁû
.
c


125 
SRCS
+=
$
(
KTOP
)/
vfs
/
vf¶i°
.
c


126 
SRCS
+=
$
(
KTOP
)/
vfs
/
vf¶ookup
.
c


127 
SRCS
+=
$
(
KTOP
)/
vfs
/
vf•©h
.
c


128 
SRCS
+=
$
(
KTOP
)/
vfs
/
vnode
.
c


129 
SRCS
+=
$
(
KTOP
)/
vm
/
kmÆloc
.
c


	@/home/trinity/src/kern/compile/DUMBVM/opt-automationtest.h

2 #i‚de‡
_OPT_AUTOMATIONTEST_H_


3 
	#_OPT_AUTOMATIONTEST_H_


	)

4 
	#OPT_AUTOMATIONTEST
 0

	)

	@/home/trinity/src/kern/compile/DUMBVM/opt-dumbvm.h

2 #i‚de‡
_OPT_DUMBVM_H_


3 
	#_OPT_DUMBVM_H_


	)

4 
	#OPT_DUMBVM
 1

	)

	@/home/trinity/src/kern/compile/DUMBVM/opt-hangman.h

2 #i‚de‡
_OPT_HANGMAN_H_


3 
	#_OPT_HANGMAN_H_


	)

4 
	#OPT_HANGMAN
 0

	)

	@/home/trinity/src/kern/compile/DUMBVM/opt-net.h

2 #i‚de‡
_OPT_NET_H_


3 
	#_OPT_NET_H_


	)

4 
	#OPT_NET
 0

	)

	@/home/trinity/src/kern/compile/DUMBVM/opt-netfs.h

2 #i‚de‡
_OPT_NETFS_H_


3 
	#_OPT_NETFS_H_


	)

4 
	#OPT_NETFS
 0

	)

	@/home/trinity/src/kern/compile/DUMBVM/opt-noasserts.h

2 #i‚de‡
_OPT_NOASSERTS_H_


3 
	#_OPT_NOASSERTS_H_


	)

4 
	#OPT_NOASSERTS
 0

	)

	@/home/trinity/src/kern/compile/DUMBVM/opt-semfs.h

2 #i‚de‡
_OPT_SEMFS_H_


3 
	#_OPT_SEMFS_H_


	)

4 
	#OPT_SEMFS
 1

	)

	@/home/trinity/src/kern/compile/DUMBVM/opt-sfs.h

2 #i‚de‡
_OPT_SFS_H_


3 
	#_OPT_SFS_H_


	)

4 
	#OPT_SFS
 1

	)

	@/home/trinity/src/kern/compile/DUMBVM/opt-synchprobs.h

2 #i‚de‡
_OPT_SYNCHPROBS_H_


3 
	#_OPT_SYNCHPROBS_H_


	)

4 
	#OPT_SYNCHPROBS
 1

	)

	@/home/trinity/src/kern/compile/DUMBVM/vers.c

2 c⁄° 
	gbuûdvîsi⁄
 = 15;

3 c⁄° 
	gbuûdc⁄fig
[] = "DUMBVM";

	@/home/trinity/src/kern/dev/generic/beep.c

30 
	~<ty≥s.h
>

31 
	~<kîn/î∫o.h
>

32 
	~<lib.h
>

33 
	~<gíîic/bìp.h
>

34 
	~"autoc⁄f.h
"

47 
bìp_so·c
 *
	gthe_bìp
 = 
NULL
;

50 
	$c⁄fig_bìp
(
bìp_so·c
 *
bs
, 
unô
)

53 i‡(
unô
!=0) {

54  
ENODEV
;

57 
	`KASSERT
(
the_bìp
==
NULL
);

58 
the_bìp
 = 
bs
;

60 
	}
}

63 
	$bìp
()

65 i‡(
the_bìp
!=
NULL
) {

66 
the_bìp
->
	`bs_bìp
—he_bìp->
bs_devd©a
);

69 
	`k¥ötf
("beep: Warning:Ço beep device\n");

71 
	}
}

	@/home/trinity/src/kern/dev/generic/beep.h

30 #i‚de‡
_GENERIC_BEEP_H_


31 
	#_GENERIC_BEEP_H_


	)

38 
	sbìp_so·c
 {

39 *
	mbs_devd©a
;

40 (*
	mbs_bìp
)(*
	mdevd©a
);

	@/home/trinity/src/kern/dev/generic/console.c

50 
	~<ty≥s.h
>

51 
	~<kîn/î∫o.h
>

52 
	~<lib.h
>

53 
	~<uio.h
>

54 
	~<˝u.h
>

55 
	~<thªad.h
>

56 
	~<cuºít.h
>

57 
	~<synch.h
>

58 
	~<gíîic/c⁄sﬁe.h
>

59 
	~<vfs.h
>

60 
	~<devi˚.h
>

61 
	~"autoc⁄f.h
"

66 
c⁄_so·c
 *
	gthe_c⁄sﬁe
 = 
NULL
;

72 
lock
 *
	gc⁄_u£æock_ªad
 = 
NULL
;

73 
lock
 *
	gc⁄_u£æock_wrôe
 = 
NULL
;

82 
	#DELAYBUFSIZE
 1024

	)

83 
	gdñayed_outbuf
[
DELAYBUFSIZE
];

84 
size_t
 
	gdñayed_outbuf_pos
=0;

88 
	$putch_dñayed
(
ch
)

95 
	`KASSERT
(
dñayed_outbuf_pos
 < (
dñayed_outbuf
));

96 
dñayed_outbuf
[
dñayed_outbuf_pos
++] = 
ch
;

97 
	}
}

101 
	$Êush_dñay_buf
()

103 
size_t
 
i
;

104 
i
=0; i<
dñayed_outbuf_pos
; i++) {

105 
	`putch
(
dñayed_outbuf
[
i
]);

107 
dñayed_outbuf_pos
 = 0;

108 
	}
}

118 
	$putch_pﬁÀd
(
c⁄_so·c
 *
cs
, 
ch
)

120 
cs
->
	`cs_£ndpﬁÀd
(cs->
cs_devd©a
, 
ch
);

121 
	}
}

130 
	$putch_öå
(
c⁄_so·c
 *
cs
, 
ch
)

132 
	`P
(
cs
->
cs_w£m
);

133 
cs
->
	`cs_£nd
(cs->
cs_devd©a
, 
ch
);

134 
	}
}

141 
	$gëch_öå
(
c⁄_so·c
 *
cs
)

143 
ªt
;

145 
	`P
(
cs
->
cs_r£m
);

146 
ªt
 = 
cs
->
cs_gŸch¨s
[cs->
cs_gŸch¨s_èû
];

147 
cs
->
cs_gŸch¨s_èû
 =

148 (
cs
->
cs_gŸch¨s_èû
 + 1Ë% 
CONSOLE_INPUT_BUFFER_SIZE
;

149  
ªt
;

150 
	}
}

162 
	$c⁄_öput
(*
vcs
, 
ch
)

164 
c⁄_so·c
 *
cs
 = 
vcs
;

165 
√xthód
;

167 
√xthód
 = (
cs
->
cs_gŸch¨s_hód
 + 1Ë% 
CONSOLE_INPUT_BUFFER_SIZE
;

168 i‡(
√xthód
 =
cs
->
cs_gŸch¨s_èû
) {

173 
cs
->
cs_gŸch¨s
[cs->
cs_gŸch¨s_hód
] = 
ch
;

174 
cs
->
cs_gŸch¨s_hód
 = 
√xthód
;

176 
	`V
(
cs
->
cs_r£m
);

177 
	}
}

183 
	$c⁄_°¨t
(*
vcs
)

185 
c⁄_so·c
 *
cs
 = 
vcs
;

187 
	`V
(
cs
->
cs_w£m
);

188 
	}
}

201 
	$putch
(
ch
)

203 
c⁄_so·c
 *
cs
 = 
the_c⁄sﬁe
;

205 i‡(
cs
==
NULL
) {

206 
	`putch_dñayed
(
ch
);

208 i‡(
cuπhªad
->
t_ö_öãºu±
 ||

209 
cuπhªad
->
t_cur•l
 > 0 ||

210 
cur˝u
->
c_•ölocks
 > 0) {

211 
	`putch_pﬁÀd
(
cs
, 
ch
);

214 
	`putch_öå
(
cs
, 
ch
);

216 
	}
}

219 
	$gëch
()

221 
c⁄_so·c
 *
cs
 = 
the_c⁄sﬁe
;

222 
	`KASSERT
(
cs
 !
NULL
);

223 
	`KASSERT
(!
cuπhªad
->
t_ö_öãºu±
 && cuπhªad->
t_ùlhigh_cou¡
 == 0);

225  
	`gëch_öå
(
cs
);

226 
	}
}

236 
	$c⁄_óch›í
(
devi˚
 *
dev
, 
›íÊags
)

238 ()
dev
;

239 ()
›íÊags
;

241 
	}
}

245 
	$c⁄_io
(
devi˚
 *
dev
, 
uio
 *uio)

247 
ªsu…
;

248 
ch
;

249 
lock
 *
lk
;

251 ()
dev
;

253 i‡(
uio
->
uio_rw
==
UIO_READ
) {

254 
lk
 = 
c⁄_u£æock_ªad
;

257 
lk
 = 
c⁄_u£æock_wrôe
;

260 
	`KASSERT
(
lk
 !
NULL
);

261 
	`lock_acquúe
(
lk
);

263 
uio
->
uio_ªsid
 > 0) {

264 i‡(
uio
->
uio_rw
==
UIO_READ
) {

265 
ch
 = 
	`gëch
();

266 i‡(
ch
=='\r') {

267 
ch
 = '\n';

269 
ªsu…
 = 
	`uiomove
(&
ch
, 1, 
uio
);

270 i‡(
ªsu…
) {

271 
	`lock_ªÀa£
(
lk
);

272  
ªsu…
;

274 i‡(
ch
=='\n') {

279 
ªsu…
 = 
	`uiomove
(&
ch
, 1, 
uio
);

280 i‡(
ªsu…
) {

281 
	`lock_ªÀa£
(
lk
);

282  
ªsu…
;

284 i‡(
ch
=='\n') {

285 
	`putch
('\r');

287 
	`putch
(
ch
);

290 
	`lock_ªÀa£
(
lk
);

292 
	}
}

296 
	$c⁄_io˘l
(
devi˚
 *
dev
, 
›
, 
u£Ωå_t
 
d©a
)

299 ()
dev
;

300 ()
›
;

301 ()
d©a
;

302  
EINVAL
;

303 
	}
}

305 c⁄° 
devi˚_›s
 
	gc⁄sﬁe_dev›s
 = {

306 .
dev›_óch›í
 = 
c⁄_óch›í
,

307 .
	gdev›_io
 = 
c⁄_io
,

308 .
	gdev›_io˘l
 = 
c⁄_io˘l
,

313 
	$©èch_c⁄sﬁe_to_vfs
(
c⁄_so·c
 *
cs
)

315 
devi˚
 *
dev
;

316 
ªsu…
;

318 
dev
 = 
	`kmÆloc
((*dev));

319 i‡(
dev
==
NULL
) {

320  
ENOMEM
;

323 
dev
->
d_›s
 = &
c⁄sﬁe_dev›s
;

324 
dev
->
d_blocks
 = 0;

325 
dev
->
d_blocksize
 = 1;

326 
dev
->
d_d©a
 = 
cs
;

328 
ªsu…
 = 
	`vfs_adddev
("c⁄", 
dev
, 0);

329 i‡(
ªsu…
) {

330 
	`k‰ì
(
dev
);

331  
ªsu…
;

335 
	}
}

344 
	$c⁄fig_c⁄
(
c⁄_so·c
 *
cs
, 
unô
)

346 
£m≠h‹e
 *
r£m
, *
w£m
;

347 
lock
 *
æk
, *
wlk
;

356 i‡(
unô
>0) {

357 
	`KASSERT
(
the_c⁄sﬁe
!=
NULL
);

358  
ENODEV
;

360 
	`KASSERT
(
the_c⁄sﬁe
==
NULL
);

362 
r£m
 = 
	`£m_¸óã
("consoleÑead", 0);

363 i‡(
r£m
 =
NULL
) {

364  
ENOMEM
;

366 
w£m
 = 
	`£m_¸óã
("console write", 1);

367 i‡(
w£m
 =
NULL
) {

368 
	`£m_de°roy
(
r£m
);

369  
ENOMEM
;

371 
æk
 = 
	`lock_¸óã
("console-lock-read");

372 i‡(
æk
 =
NULL
) {

373 
	`£m_de°roy
(
r£m
);

374 
	`£m_de°roy
(
w£m
);

375  
ENOMEM
;

377 
wlk
 = 
	`lock_¸óã
("console-lock-write");

378 i‡(
wlk
 =
NULL
) {

379 
	`lock_de°roy
(
æk
);

380 
	`£m_de°roy
(
r£m
);

381 
	`£m_de°roy
(
w£m
);

382  
ENOMEM
;

385 
cs
->
cs_r£m
 = 
r£m
;

386 
cs
->
cs_w£m
 = 
w£m
;

387 
cs
->
cs_gŸch¨s_hód
 = 0;

388 
cs
->
cs_gŸch¨s_èû
 = 0;

390 
the_c⁄sﬁe
 = 
cs
;

391 
c⁄_u£æock_ªad
 = 
æk
;

392 
c⁄_u£æock_wrôe
 = 
wlk
;

394 
	`Êush_dñay_buf
();

396  
	`©èch_c⁄sﬁe_to_vfs
(
cs
);

397 
	}
}

	@/home/trinity/src/kern/dev/generic/console.h

30 #i‚de‡
_GENERIC_CONSOLE_H_


31 
	#_GENERIC_CONSOLE_H_


	)

40 
	#CONSOLE_INPUT_BUFFER_SIZE
 32

	)

42 
	sc⁄_so·c
 {

44 *
	mcs_devd©a
;

45 (*
	mcs_£nd
)(*
	mdevd©a
, 
	mch
);

46 (*
	mcs_£ndpﬁÀd
)(*
	mdevd©a
, 
	mch
);

49 
£m≠h‹e
 *
	mcs_r£m
;

50 
£m≠h‹e
 *
	mcs_w£m
;

51 
	mcs_gŸch¨s
[
CONSOLE_INPUT_BUFFER_SIZE
];

52 
	mcs_gŸch¨s_hód
;

53 
	mcs_gŸch¨s_èû
;

59 
c⁄_öput
–*
cs
, 
ch
);

60 
c⁄_°¨t
–*
cs
);

	@/home/trinity/src/kern/dev/generic/random.c

30 
	~<ty≥s.h
>

31 
	~<kîn/î∫o.h
>

32 
	~<kîn/f˙é.h
>

33 
	~<lib.h
>

34 
	~<uio.h
>

35 
	~<vfs.h
>

36 
	~<gíîic/øndom.h
>

37 
	~"autoc⁄f.h
"

50 
øndom_so·c
 *
	gthe_øndom
 = 
NULL
;

58 
	$øndóch›í
(
devi˚
 *
dev
, 
›íÊags
)

60 ()
dev
;

62 i‡(
›íÊags
 !
O_RDONLY
) {

63  
EIO
;

67 
	}
}

74 
	$øndio
(
devi˚
 *
dev
, 
uio
 *uio)

76 
øndom_so·c
 *
rs
 = 
dev
->
d_d©a
;

78 i‡(
uio
->
uio_rw
 !
UIO_READ
) {

79  
EIO
;

82  
rs
->
	`rs_ªad
‘s->
rs_devd©a
, 
uio
);

83 
	}
}

90 
	$øndio˘l
(
devi˚
 *
dev
, 
›
, 
u£Ωå_t
 
d©a
)

95 ()
dev
;

96 ()
›
;

97 ()
d©a
;

98  
EIOCTL
;

99 
	}
}

101 c⁄° 
devi˚_›s
 
	gøndom_dev›s
 = {

102 .
dev›_óch›í
 = 
øndóch›í
,

103 .
	gdev›_io
 = 
øndio
,

104 .
	gdev›_io˘l
 = 
øndio˘l
,

111 
	$c⁄fig_øndom
(
øndom_so·c
 *
rs
, 
unô
)

113 
ªsu…
;

116 i‡(
unô
!=0) {

117  
ENODEV
;

120 
	`KASSERT
(
the_øndom
==
NULL
);

121 
the_øndom
 = 
rs
;

123 
rs
->
rs_dev
.
d_›s
 = &
øndom_dev›s
;

124 
rs
->
rs_dev
.
d_blocks
 = 0;

125 
rs
->
rs_dev
.
d_blocksize
 = 1;

126 
rs
->
rs_dev
.
d_d©a
 =Ñs;

129 
ªsu…
 = 
	`vfs_adddev
("øndom", &
rs
->
rs_dev
, 0);

130 i‡(
ªsu…
) {

131  
ªsu…
;

135 
	}
}

142 
uöt32_t


143 
	$øndom
()

145 i‡(
the_øndom
==
NULL
) {

146 
	`∑nic
("NoÑandom device\n");

148  
the_øndom
->
	`rs_øndom
—he_øndom->
rs_devd©a
);

149 
	}
}

151 
uöt32_t


152 
	$øndmax
()

154 i‡(
the_øndom
==
NULL
) {

155 
	`∑nic
("NoÑandom device\n");

157  
the_øndom
->
	`rs_øndmax
—he_øndom->
rs_devd©a
);

158 
	}
}

	@/home/trinity/src/kern/dev/generic/random.h

30 #i‚de‡
_GENERIC_RANDOM_H_


31 
	#_GENERIC_RANDOM_H_


	)

33 
	~<devi˚.h
>

34 
	guio
;

36 
	søndom_so·c
 {

38 *
	mrs_devd©a
;

39 
uöt32_t
 (*
rs_øndom
)(*
	mdevd©a
);

40 
uöt32_t
 (*
rs_øndmax
)(*
	mdevd©a
);

41 (*
	mrs_ªad
)(*
	mdevd©a
, 
uio
 *
	muio
);

43 
devi˚
 
	mrs_dev
;

	@/home/trinity/src/kern/dev/generic/rtclock.c

43 
	~<ty≥s.h
>

44 
	~<kîn/î∫o.h
>

45 
	~<lib.h
>

46 
	~<˛ock.h
>

47 
	~<gíîic/π˛ock.h
>

48 
	~"autoc⁄f.h
"

50 
π˛ock_so·c
 *
	gthe_˛ock
 = 
NULL
;

53 
	$c⁄fig_π˛ock
(
π˛ock_so·c
 *
πc
, 
unô
)

56 i‡(
unô
!=0) {

57  
ENODEV
;

60 
	`KASSERT
(
the_˛ock
==
NULL
);

61 
the_˛ock
 = 
πc
;

63 
	}
}

66 
	$gëtime
(
time•ec
 *
ts
)

68 
	`KASSERT
(
the_˛ock
!=
NULL
);

69 
the_˛ock
->
	`πc_gëtime
—he_˛ock->
πc_devd©a
, 
ts
);

70 
	}
}

	@/home/trinity/src/kern/dev/generic/rtclock.h

30 #i‚de‡
_GENERIC_RTCLOCK_H_


31 
	#_GENERIC_RTCLOCK_H_


	)

38 
	gtime•ec
;

40 
	sπ˛ock_so·c
 {

41 *
	mπc_devd©a
;

42 (*
	mπc_gëtime
)(*
	mdevd©a
, 
	mtime•ec
 *);

	@/home/trinity/src/kern/dev/lamebus/beep_ltimer.c

35 
	~<ty≥s.h
>

36 
	~<lib.h
>

37 
	~<gíîic/bìp.h
>

38 
	~<œmebus/…imî.h
>

39 
	~"autoc⁄f.h
"

41 
bìp_so·c
 *

42 
	$©èch_bìp_to_…imî
(
bì≤o
, 
…imî_so·c
 *
ls
)

44 
bìp_so·c
 *
bs
 = 
	`kmÆloc
((beep_softc));

45 i‡(
bs
==
NULL
) {

46  
NULL
;

49 ()
bì≤o
;

51 
bs
->
bs_devd©a
 = 
ls
;

52 
bs
->
bs_bìp
 = 
…imî_bìp
;

54  
bs
;

55 
	}
}

	@/home/trinity/src/kern/dev/lamebus/con_lscreen.c

35 
	~<ty≥s.h
>

36 
	~<lib.h
>

37 
	~<gíîic/c⁄sﬁe.h
>

38 
	~<œmebus/ls¸ìn.h
>

39 
	~"autoc⁄f.h
"

41 
c⁄_so·c
 *

42 
	$©èch_c⁄_to_ls¸ìn
(
c⁄¢o
, 
ls¸ìn_so·c
 *
ls
)

44 
c⁄_so·c
 *
cs
 = 
	`kmÆloc
((con_softc));

45 i‡(
cs
==
NULL
) {

46  
NULL
;

49 
cs
->
cs_devd©a
 = 
ls
;

50 
cs
->
cs_£nd
 = 
ls¸ìn_wrôe
;

51 
cs
->
cs_£ndpﬁÀd
 = 
ls¸ìn_wrôe
;

53 
ls
->
ls_devd©a
 = 
cs
;

54 
ls
->
ls_°¨t
 = 
c⁄_°¨t
;

55 
ls
->
ls_öput
 = 
c⁄_öput
;

57  
cs
;

58 
	}
}

	@/home/trinity/src/kern/dev/lamebus/con_lser.c

35 
	~<ty≥s.h
>

36 
	~<lib.h
>

37 
	~<gíîic/c⁄sﬁe.h
>

38 
	~<œmebus/l£r.h
>

39 
	~"autoc⁄f.h
"

41 
c⁄_so·c
 *

42 
	$©èch_c⁄_to_l£r
(
c⁄¢o
, 
l£r_so·c
 *
ls
)

44 
c⁄_so·c
 *
cs
 = 
	`kmÆloc
((con_softc));

45 i‡(
cs
==
NULL
) {

46  
NULL
;

49 ()
c⁄¢o
;

51 
cs
->
cs_devd©a
 = 
ls
;

52 
cs
->
cs_£nd
 = 
l£r_wrôe
;

53 
cs
->
cs_£ndpﬁÀd
 = 
l£r_wrôïﬁÀd
;

55 
ls
->
ls_devd©a
 = 
cs
;

56 
ls
->
ls_°¨t
 = 
c⁄_°¨t
;

57 
ls
->
ls_öput
 = 
c⁄_öput
;

59  
cs
;

60 
	}
}

	@/home/trinity/src/kern/dev/lamebus/emu.c

43 
	~<ty≥s.h
>

44 
	~<kîn/î∫o.h
>

45 
	~<kîn/f˙é.h
>

46 
	~<°©.h
>

47 
	~<lib.h
>

48 
	~<¨øy.h
>

49 
	~<uio.h
>

50 
	~<memb¨.h
>

51 
	~<synch.h
>

52 
	~<œmebus/emu.h
>

53 
	~<∂©f‹m/bus.h
>

54 
	~<vfs.h
>

55 
	~<emufs.h
>

56 
	~"autoc⁄f.h
"

59 
	#REG_HANDLE
 0

	)

60 
	#REG_OFFSET
 4

	)

61 
	#REG_IOLEN
 8

	)

62 
	#REG_OPER
 12

	)

63 
	#REG_RESULT
 16

	)

66 
	#EMU_BUFFER
 32768

	)

69 
	#EMU_OP_OPEN
 1

	)

70 
	#EMU_OP_CREATE
 2

	)

71 
	#EMU_OP_EXCLCREATE
 3

	)

72 
	#EMU_OP_CLOSE
 4

	)

73 
	#EMU_OP_READ
 5

	)

74 
	#EMU_OP_READDIR
 6

	)

75 
	#EMU_OP_WRITE
 7

	)

76 
	#EMU_OP_GETSIZE
 8

	)

77 
	#EMU_OP_TRUNC
 9

	)

80 
	#EMU_RES_SUCCESS
 1

	)

81 
	#EMU_RES_BADHANDLE
 2

	)

82 
	#EMU_RES_BADOP
 3

	)

83 
	#EMU_RES_BADPATH
 4

	)

84 
	#EMU_RES_BADSIZE
 5

	)

85 
	#EMU_RES_EXISTS
 6

	)

86 
	#EMU_RES_ISDIR
 7

	)

87 
	#EMU_RES_MEDIA
 8

	)

88 
	#EMU_RES_NOHANDLES
 9

	)

89 
	#EMU_RES_NOSPACE
 10

	)

90 
	#EMU_RES_NOTDIR
 11

	)

91 
	#EMU_RES_UNKNOWN
 12

	)

92 
	#EMU_RES_UNSUPP
 13

	)

103 
ölöe


104 
uöt32_t


105 
	$emu_ºeg
(
emu_so·c
 *
sc
, 
uöt32_t
 
ªg
)

107  
	`bus_ªad_ªgi°î
(
sc
->
e_busd©a
, sc->
e_bu•os
, 
ªg
);

108 
	}
}

114 
ölöe


116 
	$emu_wªg
(
emu_so·c
 *
sc
, 
uöt32_t
 
ªg
, uöt32_à
vÆ
)

118 
	`bus_wrôe_ªgi°î
(
sc
->
e_busd©a
, sc->
e_bu•os
, 
ªg
, 
vÆ
);

119 
	}
}

125 
	$emu_úq
(*
dev
)

127 
emu_so·c
 *
sc
 = 
dev
;

129 
sc
->
e_ªsu…
 = 
	`emu_ºeg
(sc, 
REG_RESULT
);

130 
	`emu_wªg
(
sc
, 
REG_RESULT
, 0);

132 
	`V
(
sc
->
e_£m
);

133 
	}
}

140 
uöt32_t


141 
	$å™¶©e_îr
(
emu_so·c
 *
sc
, 
uöt32_t
 
code
)

143 
code
) {

144 
EMU_RES_SUCCESS
:  0;

145 
EMU_RES_BADHANDLE
:

146 
EMU_RES_BADOP
:

147 
EMU_RES_BADSIZE
:

148 
	`∑nic
("emu%d: gŸ f©ÆÑesu… codê%d\n", 
sc
->
e_unô
, 
code
);

149 
EMU_RES_BADPATH
:  
ENOENT
;

150 
EMU_RES_EXISTS
:  
EEXIST
;

151 
EMU_RES_ISDIR
:  
EISDIR
;

152 
EMU_RES_MEDIA
:  
EIO
;

153 
EMU_RES_NOHANDLES
:  
ENFILE
;

154 
EMU_RES_NOSPACE
:  
ENOSPC
;

155 
EMU_RES_NOTDIR
:  
ENOTDIR
;

156 
EMU_RES_UNKNOWN
:  
EIO
;

157 
EMU_RES_UNSUPP
:  
ENOSYS
;

159 
	`k¥ötf
("emu%d: Unknow¿ªsu… codê%d\n", 
sc
->
e_unô
, 
code
);

160  
EAGAIN
;

161 
	}
}

168 
	$emu_waôd⁄e
(
emu_so·c
 *
sc
)

170 
	`P
(
sc
->
e_£m
);

171  
	`å™¶©e_îr
(
sc
, sc->
e_ªsu…
);

172 
	}
}

182 
	$emu_›í
(
emu_so·c
 *
sc
, 
uöt32_t
 
h™dÀ
, c⁄° *
«me
,

183 
boﬁ
 
¸óã
, boﬁ 
ex˛
, 
mode_t
 
mode
,

184 
uöt32_t
 *
√wh™dÀ
, *
√wisdú
)

186 
uöt32_t
 
›
;

187 
ªsu…
;

189 i‡(
	`°æí
(
«me
)+1 > 
EMU_MAXIO
) {

190  
ENAMETOOLONG
;

193 i‡(
¸óã
 && 
ex˛
) {

194 
›
 = 
EMU_OP_EXCLCREATE
;

196 i‡(
¸óã
) {

197 
›
 = 
EMU_OP_CREATE
;

200 
›
 = 
EMU_OP_OPEN
;

204 ()
mode
;

206 
	`lock_acquúe
(
sc
->
e_lock
);

208 
	`°r˝y
(
sc
->
e_iobuf
, 
«me
);

209 
	`memb¨_°‹e_°‹e
();

210 
	`emu_wªg
(
sc
, 
REG_IOLEN
, 
	`°æí
(
«me
));

211 
	`emu_wªg
(
sc
, 
REG_HANDLE
, 
h™dÀ
);

212 
	`emu_wªg
(
sc
, 
REG_OPER
, 
›
);

213 
ªsu…
 = 
	`emu_waôd⁄e
(
sc
);

215 i‡(
ªsu…
==0) {

216 *
√wh™dÀ
 = 
	`emu_ºeg
(
sc
, 
REG_HANDLE
);

217 *
√wisdú
 = 
	`emu_ºeg
(
sc
, 
REG_IOLEN
)>0;

220 
	`lock_ªÀa£
(
sc
->
e_lock
);

221  
ªsu…
;

222 
	}
}

231 
	$emu_˛o£
(
emu_so·c
 *
sc
, 
uöt32_t
 
h™dÀ
)

233 
ªsu…
;

234 
boﬁ
 
möe
;

235 
ªåõs
 = 0;

237 
möe
 = 
	`lock_do_i_hﬁd
(
sc
->
e_lock
);

238 i‡(!
möe
) {

239 
	`lock_acquúe
(
sc
->
e_lock
);

245 
	`emu_wªg
(
sc
, 
REG_HANDLE
, 
h™dÀ
);

246 
	`emu_wªg
(
sc
, 
REG_OPER
, 
EMU_OP_CLOSE
);

247 
ªsu…
 = 
	`emu_waôd⁄e
(
sc
);

249 i‡(
ªsu…
==
EIO
 && 
ªåõs
 < 10) {

250 
	`k¥ötf
("emu%d: I/OÉrror on close,Ñetrying\n",

251 
sc
->
e_unô
);

252 
ªåõs
++;

258 i‡(!
möe
) {

259 
	`lock_ªÀa£
(
sc
->
e_lock
);

261  
ªsu…
;

262 
	}
}

269 
	$emu_d‹ód
(
emu_so·c
 *
sc
, 
uöt32_t
 
h™dÀ
, uöt32_à
Àn
,

270 
uöt32_t
 
›
, 
uio
 *uio)

272 
ªsu…
;

274 
	`KASSERT
(
uio
->
uio_rw
 =
UIO_READ
);

276 i‡(
uio
->
uio_off£t
 > (
off_t
)0xffffffff) {

281 
	`lock_acquúe
(
sc
->
e_lock
);

283 
	`emu_wªg
(
sc
, 
REG_HANDLE
, 
h™dÀ
);

284 
	`emu_wªg
(
sc
, 
REG_IOLEN
, 
Àn
);

285 
	`emu_wªg
(
sc
, 
REG_OFFSET
, 
uio
->
uio_off£t
);

286 
	`emu_wªg
(
sc
, 
REG_OPER
, 
›
);

287 
ªsu…
 = 
	`emu_waôd⁄e
(
sc
);

288 i‡(
ªsu…
) {

289 
out
;

292 
	`memb¨_lﬂd_lﬂd
();

293 
ªsu…
 = 
	`uiomove
(
sc
->
e_iobuf
, 
	`emu_ºeg
(sc, 
REG_IOLEN
), 
uio
);

295 
uio
->
uio_off£t
 = 
	`emu_ºeg
(
sc
, 
REG_OFFSET
);

297 
out
:

298 
	`lock_ªÀa£
(
sc
->
e_lock
);

299  
ªsu…
;

300 
	}
}

307 
	$emu_ªad
(
emu_so·c
 *
sc
, 
uöt32_t
 
h™dÀ
, uöt32_à
Àn
,

308 
uio
 *uio)

310  
	`emu_d‹ód
(
sc
, 
h™dÀ
, 
Àn
, 
EMU_OP_READ
, 
uio
);

311 
	}
}

318 
	$emu_ªaddú
(
emu_so·c
 *
sc
, 
uöt32_t
 
h™dÀ
, uöt32_à
Àn
,

319 
uio
 *uio)

321  
	`emu_d‹ód
(
sc
, 
h™dÀ
, 
Àn
, 
EMU_OP_READDIR
, 
uio
);

322 
	}
}

329 
	$emu_wrôe
(
emu_so·c
 *
sc
, 
uöt32_t
 
h™dÀ
, uöt32_à
Àn
,

330 
uio
 *uio)

332 
ªsu…
;

334 
	`KASSERT
(
uio
->
uio_rw
 =
UIO_WRITE
);

336 i‡(
uio
->
uio_off£t
 > (
off_t
)0xffffffff) {

337  
EFBIG
;

340 
	`lock_acquúe
(
sc
->
e_lock
);

342 
	`emu_wªg
(
sc
, 
REG_HANDLE
, 
h™dÀ
);

343 
	`emu_wªg
(
sc
, 
REG_IOLEN
, 
Àn
);

344 
	`emu_wªg
(
sc
, 
REG_OFFSET
, 
uio
->
uio_off£t
);

346 
ªsu…
 = 
	`uiomove
(
sc
->
e_iobuf
, 
Àn
, 
uio
);

347 
	`memb¨_°‹e_°‹e
();

348 i‡(
ªsu…
) {

349 
out
;

352 
	`emu_wªg
(
sc
, 
REG_OPER
, 
EMU_OP_WRITE
);

353 
ªsu…
 = 
	`emu_waôd⁄e
(
sc
);

355 
out
:

356 
	`lock_ªÀa£
(
sc
->
e_lock
);

357  
ªsu…
;

358 
	}
}

365 
	$emu_gësize
(
emu_so·c
 *
sc
, 
uöt32_t
 
h™dÀ
, 
off_t
 *
ªtvÆ
)

367 
ªsu…
;

369 
	`lock_acquúe
(
sc
->
e_lock
);

371 
	`emu_wªg
(
sc
, 
REG_HANDLE
, 
h™dÀ
);

372 
	`emu_wªg
(
sc
, 
REG_OPER
, 
EMU_OP_GETSIZE
);

373 
ªsu…
 = 
	`emu_waôd⁄e
(
sc
);

374 i‡(
ªsu…
==0) {

375 *
ªtvÆ
 = 
	`emu_ºeg
(
sc
, 
REG_IOLEN
);

378 
	`lock_ªÀa£
(
sc
->
e_lock
);

379  
ªsu…
;

380 
	}
}

387 
	$emu_åunc
(
emu_so·c
 *
sc
, 
uöt32_t
 
h™dÀ
, 
off_t
 
Àn
)

389 
ªsu…
;

391 
	`KASSERT
(
Àn
 >= 0);

393 
	`lock_acquúe
(
sc
->
e_lock
);

395 
	`emu_wªg
(
sc
, 
REG_HANDLE
, 
h™dÀ
);

396 
	`emu_wªg
(
sc
, 
REG_IOLEN
, 
Àn
);

397 
	`emu_wªg
(
sc
, 
REG_OPER
, 
EMU_OP_TRUNC
);

398 
ªsu…
 = 
	`emu_waôd⁄e
(
sc
);

400 
	`lock_ªÀa£
(
sc
->
e_lock
);

401  
ªsu…
;

402 
	}
}

414 
emufs_lﬂdvnode
(
emufs_fs
 *
ef
, 
uöt32_t
 
h™dÀ
, 
isdú
,

415 
emufs_vnode
 **
ªt
);

422 
	$emufs_óch›í
(
vnode
 *
v
, 
›íÊags
)

432 ()
v
;

433 ()
›íÊags
;

436 
	}
}

443 
	$emufs_óch›ídú
(
vnode
 *
v
, 
›íÊags
)

445 
›íÊags
 & 
O_ACCMODE
) {

446 
O_RDONLY
:

448 
O_WRONLY
:

449 
O_RDWR
:

451  
EISDIR
;

453 i‡(
›íÊags
 & 
O_APPEND
) {

454  
EISDIR
;

457 ()
v
;

459 
	}
}

468 
	$emufs_ª˛aim
(
vnode
 *
v
)

470 
emufs_vnode
 *
ev
 = 
v
->
vn_d©a
;

471 
emufs_fs
 *
ef
 = 
v
->
vn_fs
->
fs_d©a
;

472 
ix
, 
i
, 
num
;

473 
ªsu…
;

481 
	`vfs_biglock_acquúe
();

482 
	`lock_acquúe
(
ef
->
ef_emu
->
e_lock
);

483 
	`•ölock_acquúe
(&
ev
->
ev_v
.
vn_cou¡lock
);

485 i‡(
ev
->
ev_v
.
vn_ªfcou¡
 > 1) {

487 
ev
->
ev_v
.
vn_ªfcou¡
--;

489 
	`•ölock_ªÀa£
(&
ev
->
ev_v
.
vn_cou¡lock
);

490 
	`lock_ªÀa£
(
ef
->
ef_emu
->
e_lock
);

491 
	`vfs_biglock_ªÀa£
();

492  
EBUSY
;

494 
	`KASSERT
(
ev
->
ev_v
.
vn_ªfcou¡
 == 1);

500 
	`•ölock_ªÀa£
(&
ev
->
ev_v
.
vn_cou¡lock
);

503 
ªsu…
 = 
	`emu_˛o£
(
ev
->
ev_emu
,Év->
ev_h™dÀ
);

504 i‡(
ªsu…
) {

505 
	`lock_ªÀa£
(
ef
->
ef_emu
->
e_lock
);

506 
	`vfs_biglock_ªÀa£
();

507  
ªsu…
;

510 
num
 = 
	`vnodóºay_num
(
ef
->
ef_vnodes
);

511 
ix
 = 
num
;

512 
i
=0; i<
num
; i++) {

513 
vnode
 *
vx
;

515 
vx
 = 
	`vnodóºay_gë
(
ef
->
ef_vnodes
, 
i
);

516 i‡(
vx
 =
v
) {

517 
ix
 = 
i
;

521 i‡(
ix
 =
num
) {

522 
	`∑nic
("emu%d:Ñeclaim vnode %uÇot in vnodeÖool\n",

523 
ef
->
ef_emu
->
e_unô
, 
ev
->
ev_h™dÀ
);

526 
	`vnodóºay_ªmove
(
ef
->
ef_vnodes
, 
ix
);

527 
	`vnode_˛ónup
(&
ev
->
ev_v
);

529 
	`lock_ªÀa£
(
ef
->
ef_emu
->
e_lock
);

530 
	`vfs_biglock_ªÀa£
();

532 
	`k‰ì
(
ev
);

534 
	}
}

541 
	$emufs_ªad
(
vnode
 *
v
, 
uio
 *uio)

543 
emufs_vnode
 *
ev
 = 
v
->
vn_d©a
;

544 
uöt32_t
 
amt
;

545 
size_t
 
ﬁdªsid
;

546 
ªsu…
;

548 
	`KASSERT
(
uio
->
uio_rw
==
UIO_READ
);

550 
uio
->
uio_ªsid
 > 0) {

551 
amt
 = 
uio
->
uio_ªsid
;

552 i‡(
amt
 > 
EMU_MAXIO
) {

553 
amt
 = 
EMU_MAXIO
;

556 
ﬁdªsid
 = 
uio
->
uio_ªsid
;

558 
ªsu…
 = 
	`emu_ªad
(
ev
->
ev_emu
,Év->
ev_h™dÀ
, 
amt
, 
uio
);

559 i‡(
ªsu…
) {

560  
ªsu…
;

563 i‡(
uio
->
uio_ªsid
 =
ﬁdªsid
) {

570 
	}
}

577 
	$emufs_gëdúíåy
(
vnode
 *
v
, 
uio
 *uio)

579 
emufs_vnode
 *
ev
 = 
v
->
vn_d©a
;

580 
uöt32_t
 
amt
;

582 
	`KASSERT
(
uio
->
uio_rw
==
UIO_READ
);

584 
amt
 = 
uio
->
uio_ªsid
;

585 i‡(
amt
 > 
EMU_MAXIO
) {

586 
amt
 = 
EMU_MAXIO
;

589  
	`emu_ªaddú
(
ev
->
ev_emu
,Év->
ev_h™dÀ
, 
amt
, 
uio
);

590 
	}
}

597 
	$emufs_wrôe
(
vnode
 *
v
, 
uio
 *uio)

599 
emufs_vnode
 *
ev
 = 
v
->
vn_d©a
;

600 
uöt32_t
 
amt
;

601 
size_t
 
ﬁdªsid
;

602 
ªsu…
;

604 
	`KASSERT
(
uio
->
uio_rw
==
UIO_WRITE
);

606 
uio
->
uio_ªsid
 > 0) {

607 
amt
 = 
uio
->
uio_ªsid
;

608 i‡(
amt
 > 
EMU_MAXIO
) {

609 
amt
 = 
EMU_MAXIO
;

612 
ﬁdªsid
 = 
uio
->
uio_ªsid
;

614 
ªsu…
 = 
	`emu_wrôe
(
ev
->
ev_emu
,Év->
ev_h™dÀ
, 
amt
, 
uio
);

615 i‡(
ªsu…
) {

616  
ªsu…
;

619 i‡(
uio
->
uio_ªsid
 =
ﬁdªsid
) {

626 
	}
}

633 
	$emufs_io˘l
(
vnode
 *
v
, 
›
, 
u£Ωå_t
 
d©a
)

639 ()
v
;

640 ()
›
;

641 ()
d©a
;

643  
EINVAL
;

644 
	}
}

651 
	$emufs_°©
(
vnode
 *
v
, 
°©
 *
°©buf
)

653 
emufs_vnode
 *
ev
 = 
v
->
vn_d©a
;

654 
ªsu…
;

656 
	`bzîo
(
°©buf
, (
°©
));

658 
ªsu…
 = 
	`emu_gësize
(
ev
->
ev_emu
,Év->
ev_h™dÀ
, &
°©buf
->
°_size
);

659 i‡(
ªsu…
) {

660  
ªsu…
;

663 
ªsu…
 = 
	`VOP_GETTYPE
(
v
, &
°©buf
->
°_mode
);

664 i‡(
ªsu…
) {

665  
ªsu…
;

667 
°©buf
->
°_mode
 |= 0644;

668 
°©buf
->
°_∆ök
 = 1;

669 
°©buf
->
°_blocks
 = 0;

672 
	}
}

679 
	$emufs_fûe_gëty≥
(
vnode
 *
v
, 
uöt32_t
 *
ªsu…
)

681 ()
v
;

682 *
ªsu…
 = 
S_IFREG
;

684 
	}
}

691 
	$emufs_dú_gëty≥
(
vnode
 *
v
, 
uöt32_t
 *
ªsu…
)

693 ()
v
;

694 *
ªsu…
 = 
S_IFDIR
;

696 
	}
}

702 
boﬁ


703 
	$emufs_is£ekabÀ
(
vnode
 *
v
)

705 ()
v
;

706  
åue
;

707 
	}
}

714 
	$emufs_fsync
(
vnode
 *
v
)

716 ()
v
;

718 
	}
}

725 
	$emufs_åunˇã
(
vnode
 *
v
, 
off_t
 
Àn
)

727 
emufs_vnode
 *
ev
 = 
v
->
vn_d©a
;

728  
	`emu_åunc
(
ev
->
ev_emu
,Év->
ev_h™dÀ
, 
Àn
);

729 
	}
}

736 
	$emufs_¸ót
(
vnode
 *
dú
, c⁄° *
«me
, 
boﬁ
 
ex˛
, 
mode_t
 
mode
,

737 
vnode
 **
ªt
)

739 
emufs_vnode
 *
ev
 = 
dú
->
vn_d©a
;

740 
emufs_fs
 *
ef
 = 
dú
->
vn_fs
->
fs_d©a
;

741 
emufs_vnode
 *
√wguy
;

742 
uöt32_t
 
h™dÀ
;

743 
ªsu…
;

744 
isdú
;

746 
ªsu…
 = 
	`emu_›í
(
ev
->
ev_emu
,Év->
ev_h™dÀ
, 
«me
, 
åue
, 
ex˛
, 
mode
,

747 &
h™dÀ
, &
isdú
);

748 i‡(
ªsu…
) {

749  
ªsu…
;

752 
ªsu…
 = 
	`emufs_lﬂdvnode
(
ef
, 
h™dÀ
, 
isdú
, &
√wguy
);

753 i‡(
ªsu…
) {

754 
	`emu_˛o£
(
ev
->
ev_emu
, 
h™dÀ
);

755  
ªsu…
;

758 *
ªt
 = &
√wguy
->
ev_v
;

760 
	}
}

767 
	$emufs_lookup
(
vnode
 *
dú
, *
∑th«me
, vnodê**
ªt
)

769 
emufs_vnode
 *
ev
 = 
dú
->
vn_d©a
;

770 
emufs_fs
 *
ef
 = 
dú
->
vn_fs
->
fs_d©a
;

771 
emufs_vnode
 *
√wguy
;

772 
uöt32_t
 
h™dÀ
;

773 
ªsu…
;

774 
isdú
;

776 
ªsu…
 = 
	`emu_›í
(
ev
->
ev_emu
,Év->
ev_h™dÀ
, 
∑th«me
, 
Ál£
, false, 0,

777 &
h™dÀ
, &
isdú
);

778 i‡(
ªsu…
) {

779  
ªsu…
;

782 
ªsu…
 = 
	`emufs_lﬂdvnode
(
ef
, 
h™dÀ
, 
isdú
, &
√wguy
);

783 i‡(
ªsu…
) {

784 
	`emu_˛o£
(
ev
->
ev_emu
, 
h™dÀ
);

785  
ªsu…
;

788 *
ªt
 = &
√wguy
->
ev_v
;

790 
	}
}

797 
	$emufs_look∑ª¡
(
vnode
 *
dú
, *
∑th«me
, vnodê**
ªt
,

798 *
buf
, 
size_t
 
Àn
)

800 *
s
;

802 
s
 = 
	`°ºchr
(
∑th«me
, '/');

803 i‡(
s
==
NULL
) {

805 i‡(
	`°æí
(
∑th«me
)+1 > 
Àn
) {

806  
ENAMETOOLONG
;

808 
	`VOP_INCREF
(
dú
);

809 *
ªt
 = 
dú
;

810 
	`°r˝y
(
buf
, 
∑th«me
);

814 *
s
 = 0;

815 
s
++;

816 i‡(
	`°æí
(
s
)+1 > 
Àn
) {

817  
ENAMETOOLONG
;

819 
	`°r˝y
(
buf
, 
s
);

821  
	`emufs_lookup
(
dú
, 
∑th«me
, 
ªt
);

822 
	}
}

829 
	$emufs_«mefûe
(
vnode
 *
v
, 
uio
 *uio)

831 
emufs_vnode
 *
ev
 = 
v
->
vn_d©a
;

832 
emufs_fs
 *
ef
 = 
v
->
vn_fs
->
fs_d©a
;

834 i‡(
ev
 =
ef
->
ef_roŸ
) {

841 ()
uio
;

843  
ENOSYS
;

844 
	}
}

851 
	$emufs_mm≠
(
vnode
 *
v
)

853 ()
v
;

854  
ENOSYS
;

855 
	}
}

865 
	$emufs_symlök
(
vnode
 *
v
, c⁄° *
c⁄ã¡s
, c⁄° *
«me
)

867 ()
v
;

868 ()
c⁄ã¡s
;

869 ()
«me
;

870  
ENOSYS
;

871 
	}
}

875 
	$emufs_mkdú
(
vnode
 *
v
, c⁄° *
«me
, 
mode_t
 
mode
)

877 ()
v
;

878 ()
«me
;

879 ()
mode
;

880  
ENOSYS
;

881 
	}
}

885 
	$emufs_lök
(
vnode
 *
v
, c⁄° *
«me
, vnodê*
èrgë
)

887 ()
v
;

888 ()
«me
;

889 ()
èrgë
;

890  
ENOSYS
;

891 
	}
}

895 
	$emufs_ªmove
(
vnode
 *
v
, c⁄° *
«me
)

897 ()
v
;

898 ()
«me
;

899  
ENOSYS
;

900 
	}
}

904 
	$emufs_rmdú
(
vnode
 *
v
, c⁄° *
«me
)

906 ()
v
;

907 ()
«me
;

908  
ENOSYS
;

909 
	}
}

913 
	$emufs_ª«me
(
vnode
 *
v1
, c⁄° *
n1
,

914 
vnode
 *
v2
, c⁄° *
n2
)

916 ()
v1
;

917 ()
n1
;

918 ()
v2
;

919 ()
n2
;

920  
ENOSYS
;

921 
	}
}

940 
	$emufs_void_›_isdú
(
vnode
 *
v
)

942 ()
v
;

943  
EISDIR
;

944 
	}
}

948 
	$emufs_uio_›_isdú
(
vnode
 *
v
, 
uio
 *uio)

950 ()
v
;

951 ()
uio
;

952  
EISDIR
;

953 
	}
}

957 
	$emufs_uio_›_nŸdú
(
vnode
 *
v
, 
uio
 *uio)

959 ()
v
;

960 ()
uio
;

961  
ENOTDIR
;

962 
	}
}

966 
	$emufs_«me_›_nŸdú
(
vnode
 *
v
, c⁄° *
«me
)

968 ()
v
;

969 ()
«me
;

970  
ENOTDIR
;

971 
	}
}

975 
	$emufs_ªadlök_nŸlök
(
vnode
 *
v
, 
uio
 *uio)

977 ()
v
;

978 ()
uio
;

979  
EINVAL
;

980 
	}
}

984 
	$emufs_¸ót_nŸdú
(
vnode
 *
v
, c⁄° *
«me
, 
boﬁ
 
ex˛
, 
mode_t
 
mode
,

985 
vnode
 **
ªtvÆ
)

987 ()
v
;

988 ()
«me
;

989 ()
ex˛
;

990 ()
mode
;

991 ()
ªtvÆ
;

992  
ENOTDIR
;

993 
	}
}

997 
	$emufs_symlök_nŸdú
(
vnode
 *
v
, c⁄° *
c⁄ã¡s
, c⁄° *
«me
)

999 ()
v
;

1000 ()
c⁄ã¡s
;

1001 ()
«me
;

1002  
ENOTDIR
;

1003 
	}
}

1007 
	$emufs_mkdú_nŸdú
(
vnode
 *
v
, c⁄° *
«me
, 
mode_t
 
mode
)

1009 ()
v
;

1010 ()
«me
;

1011 ()
mode
;

1012  
ENOTDIR
;

1013 
	}
}

1017 
	$emufs_lök_nŸdú
(
vnode
 *
v
, c⁄° *
«me
, vnodê*
èrgë
)

1019 ()
v
;

1020 ()
«me
;

1021 ()
èrgë
;

1022  
ENOTDIR
;

1023 
	}
}

1027 
	$emufs_ª«me_nŸdú
(
vnode
 *
v1
, c⁄° *
n1
,

1028 
vnode
 *
v2
, c⁄° *
n2
)

1030 ()
v1
;

1031 ()
n1
;

1032 ()
v2
;

1033 ()
n2
;

1034  
ENOTDIR
;

1035 
	}
}

1039 
	$emufs_lookup_nŸdú
(
vnode
 *
v
, *
∑th«me
, vnodê**
ªsu…
)

1041 ()
v
;

1042 ()
∑th«me
;

1043 ()
ªsu…
;

1044  
ENOTDIR
;

1045 
	}
}

1049 
	$emufs_look∑ª¡_nŸdú
(
vnode
 *
v
, *
∑th«me
, vnodê**
ªsu…
,

1050 *
buf
, 
size_t
 
Àn
)

1052 ()
v
;

1053 ()
∑th«me
;

1054 ()
ªsu…
;

1055 ()
buf
;

1056 ()
Àn
;

1057  
ENOTDIR
;

1058 
	}
}

1063 
	$emufs_åunˇã_isdú
(
vnode
 *
v
, 
off_t
 
Àn
)

1065 ()
v
;

1066 ()
Àn
;

1067  
ENOTDIR
;

1068 
	}
}

1075 c⁄° 
vnode_›s
 
	gemufs_fûe›s
 = {

1076 .
v›_magic
 = 
VOP_MAGIC
,

1078 .
	gv›_óch›í
 = 
emufs_óch›í
,

1079 .
	gv›_ª˛aim
 = 
emufs_ª˛aim
,

1081 .
	gv›_ªad
 = 
emufs_ªad
,

1082 .
	gv›_ªadlök
 = 
emufs_ªadlök_nŸlök
,

1083 .
	gv›_gëdúíåy
 = 
emufs_uio_›_nŸdú
,

1084 .
	gv›_wrôe
 = 
emufs_wrôe
,

1085 .
	gv›_io˘l
 = 
emufs_io˘l
,

1086 .
	gv›_°©
 = 
emufs_°©
,

1087 .
	gv›_gëty≥
 = 
emufs_fûe_gëty≥
,

1088 .
	gv›_is£ekabÀ
 = 
emufs_is£ekabÀ
,

1089 .
	gv›_fsync
 = 
emufs_fsync
,

1090 .
	gv›_mm≠
 = 
emufs_mm≠
,

1091 .
	gv›_åunˇã
 = 
emufs_åunˇã
,

1092 .
	gv›_«mefûe
 = 
emufs_uio_›_nŸdú
,

1094 .
	gv›_¸ót
 = 
emufs_¸ót_nŸdú
,

1095 .
	gv›_symlök
 = 
emufs_symlök_nŸdú
,

1096 .
	gv›_mkdú
 = 
emufs_mkdú_nŸdú
,

1097 .
	gv›_lök
 = 
emufs_lök_nŸdú
,

1098 .
	gv›_ªmove
 = 
emufs_«me_›_nŸdú
,

1099 .
	gv›_rmdú
 = 
emufs_«me_›_nŸdú
,

1100 .
	gv›_ª«me
 = 
emufs_ª«me_nŸdú
,

1102 .
	gv›_lookup
 = 
emufs_lookup_nŸdú
,

1103 .
	gv›_look∑ª¡
 = 
emufs_look∑ª¡_nŸdú
,

1109 c⁄° 
vnode_›s
 
	gemufs_dú›s
 = {

1110 .
v›_magic
 = 
VOP_MAGIC
,

1112 .
	gv›_óch›í
 = 
emufs_óch›ídú
,

1113 .
	gv›_ª˛aim
 = 
emufs_ª˛aim
,

1115 .
	gv›_ªad
 = 
emufs_uio_›_isdú
,

1116 .
	gv›_ªadlök
 = 
emufs_uio_›_isdú
,

1117 .
	gv›_gëdúíåy
 = 
emufs_gëdúíåy
,

1118 .
	gv›_wrôe
 = 
emufs_uio_›_isdú
,

1119 .
	gv›_io˘l
 = 
emufs_io˘l
,

1120 .
	gv›_°©
 = 
emufs_°©
,

1121 .
	gv›_gëty≥
 = 
emufs_dú_gëty≥
,

1122 .
	gv›_is£ekabÀ
 = 
emufs_is£ekabÀ
,

1123 .
	gv›_fsync
 = 
emufs_void_›_isdú
,

1124 .
	gv›_mm≠
 = 
emufs_void_›_isdú
,

1125 .
	gv›_åunˇã
 = 
emufs_åunˇã_isdú
,

1126 .
	gv›_«mefûe
 = 
emufs_«mefûe
,

1128 .
	gv›_¸ót
 = 
emufs_¸ót
,

1129 .
	gv›_symlök
 = 
emufs_symlök
,

1130 .
	gv›_mkdú
 = 
emufs_mkdú
,

1131 .
	gv›_lök
 = 
emufs_lök
,

1132 .
	gv›_ªmove
 = 
emufs_ªmove
,

1133 .
	gv›_rmdú
 = 
emufs_rmdú
,

1134 .
	gv›_ª«me
 = 
emufs_ª«me
,

1136 .
	gv›_lookup
 = 
emufs_lookup
,

1137 .
	gv›_look∑ª¡
 = 
emufs_look∑ª¡
,

1145 
	$emufs_lﬂdvnode
(
emufs_fs
 *
ef
, 
uöt32_t
 
h™dÀ
, 
isdú
,

1146 
emufs_vnode
 **
ªt
)

1148 
vnode
 *
v
;

1149 
emufs_vnode
 *
ev
;

1150 
i
, 
num
;

1151 
ªsu…
;

1153 
	`vfs_biglock_acquúe
();

1154 
	`lock_acquúe
(
ef
->
ef_emu
->
e_lock
);

1156 
num
 = 
	`vnodóºay_num
(
ef
->
ef_vnodes
);

1157 
i
=0; i<
num
; i++) {

1158 
v
 = 
	`vnodóºay_gë
(
ef
->
ef_vnodes
, 
i
);

1159 
ev
 = 
v
->
vn_d©a
;

1160 i‡(
ev
->
ev_h™dÀ
 =
h™dÀ
) {

1163 
	`VOP_INCREF
(&
ev
->
ev_v
);

1165 
	`lock_ªÀa£
(
ef
->
ef_emu
->
e_lock
);

1166 
	`vfs_biglock_ªÀa£
();

1167 *
ªt
 = 
ev
;

1174 
ev
 = 
	`kmÆloc
((
emufs_vnode
));

1175 i‡(
ev
==
NULL
) {

1176 
	`lock_ªÀa£
(
ef
->
ef_emu
->
e_lock
);

1177  
ENOMEM
;

1180 
ev
->
ev_emu
 = 
ef
->
ef_emu
;

1181 
ev
->
ev_h™dÀ
 = 
h™dÀ
;

1183 
ªsu…
 = 
	`vnode_öô
(&
ev
->
ev_v
, 
isdú
 ? &
emufs_dú›s
 : &
emufs_fûe›s
,

1184 &
ef
->
ef_fs
, 
ev
);

1185 i‡(
ªsu…
) {

1186 
	`lock_ªÀa£
(
ef
->
ef_emu
->
e_lock
);

1187 
	`vfs_biglock_ªÀa£
();

1188 
	`k‰ì
(
ev
);

1189  
ªsu…
;

1192 
ªsu…
 = 
	`vnodóºay_add
(
ef
->
ef_vnodes
, &
ev
->
ev_v
, 
NULL
);

1193 i‡(
ªsu…
) {

1195 
	`vnode_˛ónup
(&
ev
->
ev_v
);

1196 
	`lock_ªÀa£
(
ef
->
ef_emu
->
e_lock
);

1197 
	`vfs_biglock_ªÀa£
();

1198 
	`k‰ì
(
ev
);

1199  
ªsu…
;

1202 
	`lock_ªÀa£
(
ef
->
ef_emu
->
e_lock
);

1203 
	`vfs_biglock_ªÀa£
();

1205 *
ªt
 = 
ev
;

1207 
	}
}

1222 
	$emufs_sync
(
fs
 *fs)

1224 ()
fs
;

1226 
	}
}

1233 
	$emufs_gëvﬁ«me
(
fs
 *fs)

1236 ()
fs
;

1237  
NULL
;

1238 
	}
}

1245 
	$emufs_gëroŸ
(
fs
 *fs, 
vnode
 **
ªt
)

1247 
emufs_fs
 *
ef
;

1249 
	`KASSERT
(
fs
 !
NULL
);

1251 
ef
 = 
fs
->
fs_d©a
;

1253 
	`KASSERT
(
ef
 !
NULL
);

1254 
	`KASSERT
(
ef
->
ef_roŸ
 !
NULL
);

1256 
	`VOP_INCREF
(&
ef
->
ef_roŸ
->
ev_v
);

1257 *
ªt
 = &
ef
->
ef_roŸ
->
ev_v
;

1259 
	}
}

1266 
	$emufs_unmou¡
(
fs
 *fs)

1269 ()
fs
;

1270  
EBUSY
;

1271 
	}
}

1276 c⁄° 
fs_›s
 
	gemufs_fs›s
 = {

1277 .
fs›_sync
 = 
emufs_sync
,

1278 .
	gfs›_gëvﬁ«me
 = 
emufs_gëvﬁ«me
,

1279 .
	gfs›_gëroŸ
 = 
emufs_gëroŸ
,

1280 .
	gfs›_unmou¡
 = 
emufs_unmou¡
,

1292 
	$emufs_addtovfs
(
emu_so·c
 *
sc
, c⁄° *
dev«me
)

1294 
emufs_fs
 *
ef
;

1295 
ªsu…
;

1297 
ef
 = 
	`kmÆloc
((
emufs_fs
));

1298 i‡(
ef
==
NULL
) {

1299  
ENOMEM
;

1302 
ef
->
ef_fs
.
fs_d©a
 =Éf;

1303 
ef
->
ef_fs
.
fs_›s
 = &
emufs_fs›s
;

1305 
ef
->
ef_emu
 = 
sc
;

1306 
ef
->
ef_roŸ
 = 
NULL
;

1307 
ef
->
ef_vnodes
 = 
	`vnodóºay_¸óã
();

1308 i‡(
ef
->
ef_vnodes
 =
NULL
) {

1309 
	`k‰ì
(
ef
);

1310  
ENOMEM
;

1313 
ªsu…
 = 
	`emufs_lﬂdvnode
(
ef
, 
EMU_ROOTHANDLE
, 1, &ef->
ef_roŸ
);

1314 i‡(
ªsu…
) {

1315 
	`k‰ì
(
ef
);

1316  
ªsu…
;

1319 
	`KASSERT
(
ef
->
ef_roŸ
!=
NULL
);

1321 
ªsu…
 = 
	`vfs_addfs
(
dev«me
, &
ef
->
ef_fs
);

1322 i‡(
ªsu…
) {

1323 
	`VOP_DECREF
(&
ef
->
ef_roŸ
->
ev_v
);

1324 
	`k‰ì
(
ef
);

1326  
ªsu…
;

1327 
	}
}

1338 
	$c⁄fig_emu
(
emu_so·c
 *
sc
, 
emuno
)

1340 
«me
[32];

1342 
sc
->
e_lock
 = 
	`lock_¸óã
("emufs-lock");

1343 i‡(
sc
->
e_lock
 =
NULL
) {

1344  
ENOMEM
;

1346 
sc
->
e_£m
 = 
	`£m_¸óã
("emufs-sem", 0);

1347 i‡(
sc
->
e_£m
 =
NULL
) {

1348 
	`lock_de°roy
(
sc
->
e_lock
);

1349 
sc
->
e_lock
 = 
NULL
;

1350  
ENOMEM
;

1352 
sc
->
e_iobuf
 = 
	`bus_m≠_¨ó
(sc->
e_busd©a
, sc->
e_bu•os
, 
EMU_BUFFER
);

1354 
	`¢¥ötf
(
«me
, “ame), "emu%d", 
emuno
);

1356  
	`emufs_addtovfs
(
sc
, 
«me
);

1357 
	}
}

	@/home/trinity/src/kern/dev/lamebus/emu.h

30 #i‚de‡
_LAMEBUS_EMU_H_


31 
	#_LAMEBUS_EMU_H_


	)

34 
	#EMU_MAXIO
 16384

	)

35 
	#EMU_ROOTHANDLE
 0

	)

43 
	semu_so·c
 {

45 *
	me_busd©a
;

46 
uöt32_t
 
	me_bu•os
;

47 
	me_unô
;

50 
lock
 *
	me_lock
;

51 
£m≠h‹e
 *
	me_£m
;

52 *
	me_iobuf
;

55 
uöt32_t
 
	me_ªsu…
;

59 
emu_úq
( *);

	@/home/trinity/src/kern/dev/lamebus/emu_att.c

34 
	~<ty≥s.h
>

35 
	~<lib.h
>

36 
	~<œmebus/œmebus.h
>

37 
	~<œmebus/emu.h
>

38 
	~"autoc⁄f.h
"

41 
	#LOW_VERSION
 1

	)

43 
emu_so·c
 *

44 
	$©èch_emu_to_œmebus
(
emuno
, 
œmebus_so·c
 *
sc
)

46 
emu_so·c
 *
es
;

47 
¶Ÿ
 = 
	`œmebus_¥obe
(
sc
, 
LB_VENDOR_CS161
, 
LBCS161_EMUFS
,

48 
LOW_VERSION
, 
NULL
);

49 i‡(
¶Ÿ
 < 0) {

50  
NULL
;

53 
es
 = 
	`kmÆloc
((
emu_so·c
));

54 i‡(
es
==
NULL
) {

55  
NULL
;

58 
es
->
e_busd©a
 = 
sc
;

59 
es
->
e_bu•os
 = 
¶Ÿ
;

60 
es
->
e_unô
 = 
emuno
;

62 
	`œmebus_m¨k
(
sc
, 
¶Ÿ
);

63 
	`œmebus_©èch_öãºu±
(
sc
, 
¶Ÿ
, 
es
, 
emu_úq
);

65  
es
;

66 
	}
}

	@/home/trinity/src/kern/dev/lamebus/lamebus.c

34 
	~<ty≥s.h
>

35 
	~<lib.h
>

36 
	~<˝u.h
>

37 
	~<memb¨.h
>

38 
	~<•ölock.h
>

39 
	~<cuºít.h
>

40 
	~<œmebus/œmebus.h
>

43 
	#CFGREG_VID
 0

	)

44 
	#CFGREG_DID
 4

	)

45 
	#CFGREG_DRL
 8

	)

48 
	#CTLREG_RAMSZ
 0x200

	)

49 
	#CTLREG_IRQS
 0x204

	)

50 
	#CTLREG_PWR
 0x208

	)

51 
	#CTLREG_IRQE
 0x20c

	)

52 
	#CTLREG_CPUS
 0x210

	)

53 
	#CTLREG_CPUE
 0x214

	)

54 
	#CTLREG_SELF
 0x218

	)

57 
	#CTLCPU_CIRQE
 0x000

	)

58 
	#CTLCPU_CIPI
 0x004

	)

59 
	#CTLCPU_CRAM
 0x300

	)

66 
ölöe


67 
uöt32_t


68 
	$ªad_cfg_ªgi°î
(
œmebus_so·c
 *
lb
, 
¶Ÿ
, 
uöt32_t
 
off£t
)

71 
off£t
 +
LB_CONFIG_SIZE
*
¶Ÿ
;

72  
	`œmebus_ªad_ªgi°î
(
lb
, 
LB_CONTROLLER_SLOT
, 
off£t
);

73 
	}
}

79 
ölöe


81 
	$wrôe_cfg_ªgi°î
(
œmebus_so·c
 *
lb
, 
¶Ÿ
, 
uöt32_t
 
off£t
,

82 
uöt32_t
 
vÆ
)

84 
off£t
 +
LB_CONFIG_SIZE
*
¶Ÿ
;

85 
	`œmebus_wrôe_ªgi°î
(
lb
, 
LB_CONTROLLER_SLOT
, 
off£t
, 
vÆ
);

86 
	}
}

92 
ölöe


93 
uöt32_t


94 
	$ªad_˘l_ªgi°î
(
œmebus_so·c
 *
lb
, 
uöt32_t
 
off£t
)

97  
	`ªad_cfg_ªgi°î
(
lb
, 
LB_CONTROLLER_SLOT
, 
off£t
);

98 
	}
}

104 
ölöe


106 
	$wrôe_˘l_ªgi°î
(
œmebus_so·c
 *
lb
, 
uöt32_t
 
off£t
, uöt32_à
vÆ
)

108 
	`wrôe_cfg_ªgi°î
(
lb
, 
LB_CONTROLLER_SLOT
, 
off£t
, 
vÆ
);

109 
	}
}

115 
ölöe


117 
	$wrôe_˘l˝u_ªgi°î
(
œmebus_so·c
 *
lb
, 
hw_˝unum
,

118 
uöt32_t
 
off£t
, uöt32_à
vÆ
)

120 
off£t
 +
LB_CTLCPU_OFFSET
 + 
hw_˝unum
 * 
LB_CTLCPU_SIZE
;

121 
	`œmebus_wrôe_ªgi°î
(
lb
, 
LB_CONTROLLER_SLOT
, 
off£t
, 
vÆ
);

122 
	}
}

128 
	$œmebus_föd_˝us
(
œmebus_so·c
 *
œmebus
)

130 
uöt32_t
 
maöbﬂrd_vid
, 
maöbﬂrd_did
;

131 
uöt32_t
 
˝umask
, 
£lf
, 
bô
, 
vÆ
;

132 
i
, 
num˝us
, 
boŸ˝u
;

133 
hwnum
[32];

135 
maöbﬂrd_vid
 = 
	`ªad_cfg_ªgi°î
(
œmebus
, 
LB_CONTROLLER_SLOT
,

136 
CFGREG_VID
);

137 
maöbﬂrd_did
 = 
	`ªad_cfg_ªgi°î
(
œmebus
, 
LB_CONTROLLER_SLOT
,

138 
CFGREG_DID
);

139 i‡(
maöbﬂrd_vid
 =
LB_VENDOR_CS161
 &&

140 
maöbﬂrd_did
 =
LBCS161_UPBUSCTL
) {

142 
œmebus
->
ls_unùro˚ss‹
 = 1;

146 
˝umask
 = 
	`ªad_˘l_ªgi°î
(
œmebus
, 
CTLREG_CPUS
);

147 
£lf
 = 
	`ªad_˘l_ªgi°î
(
œmebus
, 
CTLREG_SELF
);

149 
num˝us
 = 0;

150 
boŸ˝u
 = 0;

151 
i
=0; i<32; i++) {

152 
bô
 = (
uöt32_t
)1 << 
i
;

153 i‡((
˝umask
 & 
bô
) != 0) {

154 i‡(
£lf
 & 
bô
) {

155 
boŸ˝u
 = 
num˝us
;

156 
cur˝u
->
c_h¨dw¨e_numbî
 = 
i
;

158 
hwnum
[
num˝us
] = 
i
;

159 
num˝us
++;

163 
i
=0; i<
num˝us
; i++) {

164 i‡(
i
 !
boŸ˝u
) {

165 
	`˝u_¸óã
(
hwnum
[
i
]);

175 
i
=0; i<
num˝us
; i++) {

176 i‡(
i
 !
boŸ˝u
) {

177 
vÆ
 = 0;

180 
vÆ
 = 0xffffffff;

182 
	`wrôe_˘l˝u_ªgi°î
(
œmebus
, 
hwnum
[
i
], 
CTLCPU_CIRQE
, 
vÆ
);

184 
	}
}

197 
	$œmebus_°¨t_˝us
(
œmebus_so·c
 *
œmebus
)

199 
uöt32_t
 
˝umask
, 
£lf
, 
bô
;

200 
uöt32_t
 
˘l˝uoff£t
;

201 
uöt32_t
 *
¸am
;

202 
i
;

203 
˝unum
;

205 i‡(
œmebus
->
ls_unùro˚ss‹
) {

209 
˝umask
 = 
	`ªad_˘l_ªgi°î
(
œmebus
, 
CTLREG_CPUS
);

210 
£lf
 = 
	`ªad_˘l_ªgi°î
(
œmebus
, 
CTLREG_SELF
);

213 
˝unum
 = 1;

214 
i
=0; i<32; i++) {

215 
bô
 = (
uöt32_t
)1 << 
i
;

216 i‡((
˝umask
 & 
bô
) != 0) {

217 i‡(
£lf
 & 
bô
) {

220 
˘l˝uoff£t
 = 
LB_CTLCPU_OFFSET
 + 
i
 * 
LB_CTLCPU_SIZE
;

221 
¸am
 = 
	`œmebus_m≠_¨ó
(
œmebus
,

222 
LB_CONTROLLER_SLOT
,

223 
˘l˝uoff£t
 + 
CTLCPU_CRAM
);

224 
¸am
[0] = (
uöt32_t
)
˝u_°¨t_£c⁄d¨y
;

225 
¸am
[1] = 
˝unum
++;

229 
	`memb¨_°‹e_°‹e
();

232 
	`wrôe_˘l_ªgi°î
(
œmebus
, 
CTLREG_CPUE
, 
˝umask
);

233 
	}
}

251 
	$œmebus_¥obe
(
œmebus_so·c
 *
sc
,

252 
uöt32_t
 
víd‹id
, uöt32_à
devi˚id
,

253 
uöt32_t
 
lowvî
, uöt32_à*
vîsi⁄_ªt
)

255 
¶Ÿ
;

256 
uöt32_t
 
vÆ
;

263 
	`•ölock_acquúe
(&
sc
->
ls_lock
);

265 
¶Ÿ
=0; slŸ<
LB_NSLOTS
; slot++) {

266 i‡(
sc
->
ls_¶Ÿsöu£
 & (1<<
¶Ÿ
)) {

271 
vÆ
 = 
	`ªad_cfg_ªgi°î
(
sc
, 
¶Ÿ
, 
CFGREG_VID
);

272 i‡(
vÆ
!=
víd‹id
) {

277 
vÆ
 = 
	`ªad_cfg_ªgi°î
(
sc
, 
¶Ÿ
, 
CFGREG_DID
);

278 i‡(
vÆ
 !
devi˚id
) {

283 
vÆ
 = 
	`ªad_cfg_ªgi°î
(
sc
, 
¶Ÿ
, 
CFGREG_DRL
);

284 i‡(
vÆ
 < 
lowvî
) {

288 i‡(
vîsi⁄_ªt
 !
NULL
) {

289 *
vîsi⁄_ªt
 = 
vÆ
;

294 
	`•ölock_ªÀa£
(&
sc
->
ls_lock
);

295  
¶Ÿ
;

300 
	`•ölock_ªÀa£
(&
sc
->
ls_lock
);

302 
	}
}

310 
	$œmebus_m¨k
(
œmebus_so·c
 *
sc
, 
¶Ÿ
)

312 
uöt32_t
 
mask
 = ((uöt32_t)1Ë<< 
¶Ÿ
;

313 
	`KASSERT
(
¶Ÿ
>=0 && slŸ < 
LB_NSLOTS
);

315 
	`•ölock_acquúe
(&
sc
->
ls_lock
);

317 i‡((
sc
->
ls_¶Ÿsöu£
 & 
mask
)!=0) {

318 
	`∑nic
("œmebus_m¨k: slŸ %dáÃódy i¿u£\n", 
¶Ÿ
);

321 
sc
->
ls_¶Ÿsöu£
 |
mask
;

323 
	`•ölock_ªÀa£
(&
sc
->
ls_lock
);

324 
	}
}

330 
	$œmebus_unm¨k
(
œmebus_so·c
 *
sc
, 
¶Ÿ
)

332 
uöt32_t
 
mask
 = ((uöt32_t)1Ë<< 
¶Ÿ
;

333 
	`KASSERT
(
¶Ÿ
>=0 && slŸ < 
LB_NSLOTS
);

335 
	`•ölock_acquúe
(&
sc
->
ls_lock
);

337 i‡((
sc
->
ls_¶Ÿsöu£
 & 
mask
)==0) {

338 
	`∑nic
("œmebus_m¨k: slŸ %dÇŸ m¨ked i¿u£\n", 
¶Ÿ
);

341 
sc
->
ls_¶Ÿsöu£
 &~
mask
;

343 
	`•ölock_ªÀa£
(&
sc
->
ls_lock
);

344 
	}
}

351 
	$œmebus_©èch_öãºu±
(
œmebus_so·c
 *
sc
, 
¶Ÿ
,

352 *
devd©a
,

353 (*
úqfunc
)(*
devd©a
))

355 
uöt32_t
 
mask
 = ((uöt32_t)1Ë<< 
¶Ÿ
;

356 
	`KASSERT
(
¶Ÿ
>=0 && slŸ < 
LB_NSLOTS
);

358 
	`•ölock_acquúe
(&
sc
->
ls_lock
);

360 i‡((
sc
->
ls_¶Ÿsöu£
 & 
mask
)==0) {

361 
	`∑nic
("lamebus_attach_interrupt: slot %dÇot marked in use\n",

362 
¶Ÿ
);

365 
	`KASSERT
(
sc
->
ls_devd©a
[
¶Ÿ
]==
NULL
);

366 
	`KASSERT
(
sc
->
ls_úqfuncs
[
¶Ÿ
]==
NULL
);

368 
sc
->
ls_devd©a
[
¶Ÿ
] = 
devd©a
;

369 
sc
->
ls_úqfuncs
[
¶Ÿ
] = 
úqfunc
;

371 
	`•ölock_ªÀa£
(&
sc
->
ls_lock
);

372 
	}
}

379 
	$œmebus_dëach_öãºu±
(
œmebus_so·c
 *
sc
, 
¶Ÿ
)

381 
uöt32_t
 
mask
 = ((uöt32_t)1Ë<< 
¶Ÿ
;

382 
	`KASSERT
(
¶Ÿ
>=0 && slŸ < 
LB_NSLOTS
);

384 
	`•ölock_acquúe
(&
sc
->
ls_lock
);

386 i‡((
sc
->
ls_¶Ÿsöu£
 & 
mask
)==0) {

387 
	`∑nic
("lamebus_detach_interrupt: slot %dÇot marked in use\n",

388 
¶Ÿ
);

391 
	`KASSERT
(
sc
->
ls_úqfuncs
[
¶Ÿ
]!=
NULL
);

393 
sc
->
ls_devd©a
[
¶Ÿ
] = 
NULL
;

394 
sc
->
ls_úqfuncs
[
¶Ÿ
] = 
NULL
;

396 
	`•ölock_ªÀa£
(&
sc
->
ls_lock
);

397 
	}
}

403 
	$œmebus_mask_öãºu±
(
œmebus_so·c
 *
œmebus
, 
¶Ÿ
)

405 
uöt32_t
 
bôs
, 
mask
 = ((uöt32_t)1Ë<< 
¶Ÿ
;

406 
	`KASSERT
(
¶Ÿ
 >0 && slŸ < 
LB_NSLOTS
);

408 
	`•ölock_acquúe
(&
œmebus
->
ls_lock
);

409 
bôs
 = 
	`ªad_˘l_ªgi°î
(
œmebus
, 
CTLREG_IRQE
);

410 
bôs
 &~
mask
;

411 
	`wrôe_˘l_ªgi°î
(
œmebus
, 
CTLREG_IRQE
, 
bôs
);

412 
	`•ölock_ªÀa£
(&
œmebus
->
ls_lock
);

413 
	}
}

416 
	$œmebus_unmask_öãºu±
(
œmebus_so·c
 *
œmebus
, 
¶Ÿ
)

418 
uöt32_t
 
bôs
, 
mask
 = ((uöt32_t)1Ë<< 
¶Ÿ
;

419 
	`KASSERT
(
¶Ÿ
 >0 && slŸ < 
LB_NSLOTS
);

421 
	`•ölock_acquúe
(&
œmebus
->
ls_lock
);

422 
bôs
 = 
	`ªad_˘l_ªgi°î
(
œmebus
, 
CTLREG_IRQE
);

423 
bôs
 |
mask
;

424 
	`wrôe_˘l_ªgi°î
(
œmebus
, 
CTLREG_IRQE
, 
bôs
);

425 
	`•ölock_ªÀa£
(&
œmebus
->
ls_lock
);

426 
	}
}

433 
	$œmebus_öãºu±
(
œmebus_so·c
 *
œmebus
)

446 
¶Ÿ
;

447 
uöt32_t
 
mask
;

448 
uöt32_t
 
úqs
;

449 (*
h™dÀr
)(*);

450 *
d©a
;

453 
duds
 = 0;

454 
duds_this_time
 = 0;

457 
	`KASSERT
(
œmebus
 !
NULL
);

460 
	`•ölock_acquúe
(&
œmebus
->
ls_lock
);

466 
úqs
 = 
	`ªad_˘l_ªgi°î
(
œmebus
, 
CTLREG_IRQS
);

468 i‡(
úqs
 == 0) {

472 
	`k¥ötf
("lamebus: stray interrupt on cpu %u\n",

473 
cur˝u
->
c_numbî
);

474 
duds
++;

475 
duds_this_time
++;

495 
mask
=1, 
¶Ÿ
=0; slŸ<
LB_NSLOTS
; mask<<=1, slot++) {

496 i‡((
úqs
 & 
mask
) == 0) {

505 i‡((
œmebus
->
ls_¶Ÿsöu£
 & 
mask
)==0) {

509 
duds
++;

510 
duds_this_time
++;

514 i‡(
œmebus
->
ls_úqfuncs
[
¶Ÿ
]==
NULL
) {

519 
duds
++;

520 
duds_this_time
++;

529 
h™dÀr
 = 
œmebus
->
ls_úqfuncs
[
¶Ÿ
];

530 
d©a
 = 
œmebus
->
ls_devd©a
[
¶Ÿ
];

531 
	`•ölock_ªÀa£
(&
œmebus
->
ls_lock
);

533 
	`h™dÀr
(
d©a
);

535 
	`•ölock_acquúe
(&
œmebus
->
ls_lock
);

543 
úqs
 = 
	`ªad_˘l_ªgi°î
(
œmebus
, 
CTLREG_IRQS
);

565 i‡(
duds_this_time
 =0 && 
duds
 > 0) {

566 
	`k¥ötf
("œmebus: %d dud i¡îru±s\n", 
duds
);

567 
duds
 = 0;

570 i‡(
duds
 > 10000) {

571 
	`∑nic
("œmebus:Åoÿm™y (%dËdud i¡îru±s\n", 
duds
);

575 
	`•ölock_ªÀa£
(&
œmebus
->
ls_lock
);

576 
	}
}

582 
	$œmebus_powîoff
(
œmebus_so·c
 *
œmebus
)

588 
	`˝u_úqoff
();

589 
	`wrôe_˘l_ªgi°î
(
œmebus
, 
CTLREG_PWR
, 0);

592 
	`˝u_hÆt
();

593 
	}
}

598 
uöt32_t


599 
	$œmebus_ømsize
()

608  
	`ªad_˘l_ªgi°î
(
NULL
, 
CTLREG_RAMSZ
);

609 
	}
}

615 
	$œmebus_as£π_ùi
(
œmebus_so·c
 *
œmebus
, 
˝u
 *
èrgë
)

617 i‡(
œmebus
->
ls_unùro˚ss‹
) {

620 
	`wrôe_˘l˝u_ªgi°î
(
œmebus
, 
èrgë
->
c_h¨dw¨e_numbî
,

621 
CTLCPU_CIPI
, 1);

622 
	}
}

625 
	$œmebus_˛ór_ùi
(
œmebus_so·c
 *
œmebus
, 
˝u
 *
èrgë
)

627 i‡(
œmebus
->
ls_unùro˚ss‹
) {

630 
	`wrôe_˘l˝u_ªgi°î
(
œmebus
, 
èrgë
->
c_h¨dw¨e_numbî
,

631 
CTLCPU_CIPI
, 0);

632 
	}
}

638 
œmebus_so·c
 *

639 
	$œmebus_öô
()

641 
œmebus_so·c
 *
œmebus
;

642 
i
;

645 
œmebus
 = 
	`kmÆloc
((
œmebus_so·c
));

646 i‡(
œmebus
==
NULL
) {

647 
	`∑nic
("lamebus_init: Out of memory\n");

650 
	`•ölock_öô
(&
œmebus
->
ls_lock
);

655 
œmebus
->
ls_¶Ÿsöu£
 = 1 << 
LB_CONTROLLER_SLOT
;

657 
i
=0; i<
LB_NSLOTS
; i++) {

658 
œmebus
->
ls_devd©a
[
i
] = 
NULL
;

659 
œmebus
->
ls_úqfuncs
[
i
] = 
NULL
;

662 
œmebus
->
ls_unùro˚ss‹
 = 0;

664  
œmebus
;

665 
	}
}

	@/home/trinity/src/kern/dev/lamebus/lamebus.h

30 #i‚de‡
_LAMEBUS_H_


31 
	#_LAMEBUS_H_


	)

33 
	~<˝u.h
>

34 
	~<•ölock.h
>

44 
	#LB_VENDOR_CS161
 1

	)

47 
	#LBCS161_UPBUSCTL
 1

	)

48 
	#LBCS161_TIMER
 2

	)

49 
	#LBCS161_DISK
 3

	)

50 
	#LBCS161_SERIAL
 4

	)

51 
	#LBCS161_SCREEN
 5

	)

52 
	#LBCS161_NET
 6

	)

53 
	#LBCS161_EMUFS
 7

	)

54 
	#LBCS161_TRACE
 8

	)

55 
	#LBCS161_RANDOM
 9

	)

56 
	#LBCS161_MPBUSCTL
 10

	)

59 
	#LB_CONTROLLER_SLOT
 31

	)

62 
	#LB_NSLOTS
 32

	)

65 
	#LB_CONFIG_SIZE
 1024

	)

68 
	#LB_CTLCPU_SIZE
 1024

	)

71 
	#LB_CTLCPU_OFFSET
 32768

	)

74 
	#LB_SLOT_SIZE
 65536

	)

77 (*
	tlb_úqfunc
)(*
	tdevd©a
);

82 
	sœmebus_so·c
 {

83 
•ölock
 
ls_lock
;

86 
uöt32_t
 
ls_¶Ÿsöu£
;

87 *
ls_devd©a
[
LB_NSLOTS
];

88 
lb_úqfunc
 
ls_úqfuncs
[
LB_NSLOTS
];

91 
ls_unùro˚ss‹
;

97 
œmebus_so·c
 *
	`œmebus_öô
();

102 
	`œmebus_föd_˝us
(
œmebus_so·c
 *
œmebus
);

107 
	`œmebus_°¨t_˝us
(
œmebus_so·c
 *
œmebus
);

116 
	`œmebus_¥obe
(
œmebus_so·c
 *,

117 
uöt32_t
 
víd‹id
, uöt32_à
devi˚id
,

118 
uöt32_t
 
lowvî
, uöt32_à*
vîsi⁄_ªt
);

125 
	`œmebus_m¨k
(
œmebus_so·c
 *, 
¶Ÿ
);

126 
	`œmebus_unm¨k
(
œmebus_so·c
 *, 
¶Ÿ
);

131 
	`œmebus_©èch_öãºu±
(
œmebus_so·c
 *, 
¶Ÿ
,

132 *
devd©a
,

133 (*
úqfunc
)(*
devd©a
));

137 
	`œmebus_dëach_öãºu±
(
œmebus_so·c
 *, 
¶Ÿ
);

142 
	`œmebus_mask_öãºu±
(
œmebus_so·c
 *, 
¶Ÿ
);

143 
	`œmebus_unmask_öãºu±
(
œmebus_so·c
 *, 
¶Ÿ
);

148 
	`œmebus_öãºu±
(
œmebus_so·c
 *);

153 
	`œmebus_powîoff
(
œmebus_so·c
 *);

158 
size_t
 
	`œmebus_ømsize
();

163 
	`œmebus_as£π_ùi
(
œmebus_so·c
 *, 
˝u
 *
èrgë˝u
);

164 
	`œmebus_˛ór_ùi
(
œmebus_so·c
 *, 
˝u
 *
èrgë˝u
);

170 
uöt32_t
 
	`œmebus_ªad_ªgi°î
(
œmebus_so·c
 *, 
¶Ÿ
,

171 
uöt32_t
 
off£t
);

172 
	`œmebus_wrôe_ªgi°î
(
œmebus_so·c
 *, 
¶Ÿ
,

173 
uöt32_t
 
off£t
, uöt32_à
vÆ
);

178 *
	`œmebus_m≠_¨ó
(
œmebus_so·c
 *, 
¶Ÿ
,

179 
uöt32_t
 
off£t
);

	@/home/trinity/src/kern/dev/lamebus/lhd.c

34 
	~<ty≥s.h
>

35 
	~<kîn/î∫o.h
>

36 
	~<lib.h
>

37 
	~<uio.h
>

38 
	~<memb¨.h
>

39 
	~<synch.h
>

40 
	~<∂©f‹m/bus.h
>

41 
	~<vfs.h
>

42 
	~<œmebus/lhd.h
>

43 
	~"autoc⁄f.h
"

46 
	#LHD_REG_NSECT
 0

	)

47 
	#LHD_REG_STAT
 4

	)

48 
	#LHD_REG_SECT
 8

	)

49 
	#LHD_REG_RPM
 12

	)

52 
	#LHD_IDLE
 0

	)

53 
	#LHD_WORKING
 1

	)

54 
	#LHD_OK
 4

	)

55 
	#LHD_INVSECT
 12

	)

56 
	#LHD_MEDIA
 20

	)

57 
	#LHD_ISWRITE
 2

	)

58 
	#LHD_STATEMASK
 0x1d

	)

61 
	#LHD_BUFFER
 32768

	)

67 
ölöe


68 
uöt32_t
 
	$lhd_rdªg
(
lhd_so·c
 *
lh
, 
uöt32_t
 
ªg
)

70  
	`bus_ªad_ªgi°î
(
lh
->
lh_busd©a
,Üh->
lh_bu•os
, 
ªg
);

71 
	}
}

77 
ölöe


78 
	$lhd_wªg
(
lhd_so·c
 *
lh
, 
uöt32_t
 
ªg
, uöt32_à
vÆ
)

80 
	`bus_wrôe_ªgi°î
(
lh
->
lh_busd©a
,Üh->
lh_bu•os
, 
ªg
, 
vÆ
);

81 
	}
}

87 
	$lhd_code_to_î∫o
(
lhd_so·c
 *
lh
, 
code
)

89 
code
 & 
LHD_STATEMASK
) {

90 
LHD_OK
:  0;

91 
LHD_INVSECT
:  
EINVAL
;

92 
LHD_MEDIA
:  
EIO
;

94 
	`k¥ötf
("lhd%d: Unknow¿ªsu… codê%d\n", 
lh
->
lh_unô
, 
code
);

95  
EAGAIN
;

96 
	}
}

104 
	$lhd_iod⁄e
(
lhd_so·c
 *
lh
, 
îr
)

106 
lh
->
lh_ªsu…
 = 
îr
;

107 
	`V
(
lh
->
lh_d⁄e
);

108 
	}
}

116 
	$lhd_úq
(*
vlh
)

118 
lhd_so·c
 *
lh
 = 
vlh
;

119 
uöt32_t
 
vÆ
;

121 
vÆ
 = 
	`lhd_rdªg
(
lh
, 
LHD_REG_STAT
);

123 
vÆ
 & 
LHD_STATEMASK
) {

124 
LHD_IDLE
:

125 
LHD_WORKING
:

127 
LHD_OK
:

128 
LHD_INVSECT
:

129 
LHD_MEDIA
:

130 
	`lhd_wªg
(
lh
, 
LHD_REG_STAT
, 0);

131 
	`lhd_iod⁄e
(
lh
, 
	`lhd_code_to_î∫o
÷h, 
vÆ
));

134 
	}
}

141 
	$lhd_óch›í
(
devi˚
 *
d
, 
›íÊags
)

146 ()
d
;

147 ()
›íÊags
;

150 
	}
}

157 
	$lhd_io˘l
(
devi˚
 *
d
, 
›
, 
u£Ωå_t
 
d©a
)

162 ()
d
;

163 ()
›
;

164 ()
d©a
;

165  
EIOCTL
;

166 
	}
}

176 
	$lhd_ª£t
(
lhd_so·c
 *
lh
)

178 
	`lhd_wªg
(
lh
, 
LHD_REG_STAT
, 0);

179 
	}
}

187 
	$lhd_io
(
devi˚
 *
d
, 
uio
 *uio)

189 
lhd_so·c
 *
lh
 = 
d
->
d_d©a
;

191 
uöt32_t
 
£˘‹
 = 
uio
->
uio_off£t
 / 
LHD_SECTSIZE
;

192 
uöt32_t
 
£˘off
 = 
uio
->
uio_off£t
 % 
LHD_SECTSIZE
;

193 
uöt32_t
 
Àn
 = 
uio
->
uio_ªsid
 / 
LHD_SECTSIZE
;

194 
uöt32_t
 
Ànoff
 = 
uio
->
uio_ªsid
 % 
LHD_SECTSIZE
;

195 
uöt32_t
 
i
;

196 
uöt32_t
 
°©vÆ
 = 
LHD_WORKING
;

197 
ªsu…
;

200 i‡(
£˘off
 !0 || 
Ànoff
 != 0) {

201  
EINVAL
;

206 i‡(
£˘‹
+
Àn
 > 
lh
->
lh_dev
.
d_blocks
) {

207  
EINVAL
;

211 i‡(
uio
->
uio_rw
==
UIO_WRITE
) {

212 
°©vÆ
 |
LHD_ISWRITE
;

216 
i
=0; i<
Àn
; i++) {

219 
	`P
(
lh
->
lh_˛ór
);

225 i‡(
uio
->
uio_rw
 =
UIO_WRITE
) {

226 
ªsu…
 = 
	`uiomove
(
lh
->
lh_buf
, 
LHD_SECTSIZE
, 
uio
);

227 
	`memb¨_°‹e_°‹e
();

228 i‡(
ªsu…
) {

229 
	`V
(
lh
->
lh_˛ór
);

230  
ªsu…
;

235 
	`lhd_wªg
(
lh
, 
LHD_REG_SECT
, 
£˘‹
+
i
);

238 
	`lhd_wªg
(
lh
, 
LHD_REG_STAT
, 
°©vÆ
);

241 
	`P
(
lh
->
lh_d⁄e
);

244 
ªsu…
 = 
lh
->
lh_ªsu…
;

250 i‡(
ªsu…
==0 && 
uio
->
uio_rw
==
UIO_READ
) {

251 
	`memb¨_lﬂd_lﬂd
();

252 
ªsu…
 = 
	`uiomove
(
lh
->
lh_buf
, 
LHD_SECTSIZE
, 
uio
);

256 
	`V
(
lh
->
lh_˛ór
);

259 i‡(
ªsu…
) {

260  
ªsu…
;

265 
	}
}

267 c⁄° 
devi˚_›s
 
	glhd_dev›s
 = {

268 .
dev›_óch›í
 = 
lhd_óch›í
,

269 .
	gdev›_io
 = 
lhd_io
,

270 .
	gdev›_io˘l
 = 
lhd_io˘l
,

277 
	$c⁄fig_lhd
(
lhd_so·c
 *
lh
, 
lhdno
)

279 
«me
[32];

282 
	`¢¥ötf
(
«me
, “ame), "lhd%d", 
lhdno
);

285 
lh
->
lh_buf
 = 
	`bus_m≠_¨ó
÷h->
lh_busd©a
,Üh->
lh_bu•os
, 
LHD_BUFFER
);

288 
lh
->
lh_˛ór
 = 
	`£m_¸óã
("lhd-clear", 1);

289 i‡(
lh
->
lh_˛ór
 =
NULL
) {

290  
ENOMEM
;

292 
lh
->
lh_d⁄e
 = 
	`£m_¸óã
("lhd-done", 0);

293 i‡(
lh
->
lh_d⁄e
 =
NULL
) {

294 
	`£m_de°roy
(
lh
->
lh_˛ór
);

295 
lh
->
lh_˛ór
 = 
NULL
;

296  
ENOMEM
;

300 
lh
->
lh_dev
.
d_›s
 = &
lhd_dev›s
;

301 
lh
->
lh_dev
.
d_blocks
 = 
	`bus_ªad_ªgi°î
÷h->
lh_busd©a
,Üh->
lh_bu•os
,

302 
LHD_REG_NSECT
);

303 
lh
->
lh_dev
.
d_blocksize
 = 
LHD_SECTSIZE
;

304 
lh
->
lh_dev
.
d_d©a
 =Üh;

307  
	`vfs_adddev
(
«me
, &
lh
->
lh_dev
, 1);

308 
	}
}

	@/home/trinity/src/kern/dev/lamebus/lhd.h

30 #i‚de‡
_LAMEBUS_LHD_H_


31 
	#_LAMEBUS_LHD_H_


	)

33 
	~<devi˚.h
>

38 
	#LHD_SECTSIZE
 512

	)

43 
	slhd_so·c
 {

45 *
	mlh_busd©a
;

46 
uöt32_t
 
	mlh_bu•os
;

47 
	mlh_unô
;

53 *
	mlh_buf
;

54 
	mlh_ªsu…
;

55 
£m≠h‹e
 *
	mlh_˛ór
;

56 
£m≠h‹e
 *
	mlh_d⁄e
;

58 
devi˚
 
	mlh_dev
;

62 
lhd_úq
( *);

	@/home/trinity/src/kern/dev/lamebus/lhd_att.c

33 
	~<ty≥s.h
>

34 
	~<lib.h
>

35 
	~<œmebus/œmebus.h
>

36 
	~<œmebus/lhd.h
>

37 
	~"autoc⁄f.h
"

40 
	#LOW_VERSION
 2

	)

42 
lhd_so·c
 *

43 
	$©èch_lhd_to_œmebus
(
lhdno
, 
œmebus_so·c
 *
sc
)

45 
lhd_so·c
 *
lh
;

46 
¶Ÿ
 = 
	`œmebus_¥obe
(
sc
, 
LB_VENDOR_CS161
, 
LBCS161_DISK
,

47 
LOW_VERSION
, 
NULL
);

48 i‡(
¶Ÿ
 < 0) {

50  
NULL
;

53 
lh
 = 
	`kmÆloc
((
lhd_so·c
));

54 i‡(
lh
==
NULL
) {

56  
NULL
;

60 
lh
->
lh_busd©a
 = 
sc
;

61 
lh
->
lh_bu•os
 = 
¶Ÿ
;

62 
lh
->
lh_unô
 = 
lhdno
;

65 
	`œmebus_m¨k
(
sc
, 
¶Ÿ
);

66 
	`œmebus_©èch_öãºu±
(
sc
, 
¶Ÿ
, 
lh
, 
lhd_úq
);

68  
lh
;

69 
	}
}

	@/home/trinity/src/kern/dev/lamebus/lnet.c

30 
	~<ty≥s.h
>

31 
	~<kîn/î∫o.h
>

32 
	~<lib.h
>

34 
	~"autoc⁄f.h
"

37 
	$c⁄fig_ ë
(
 ë_so·c
 *
sc
, 
 ëno
)

39 ()
sc
;

41 
	`k¥ötf
(" ë%d: Nÿ√tw‹k suµ‹àö sy°em\n", 
 ëno
);

43  
ENODEV
;

44 
	}
}

	@/home/trinity/src/kern/dev/lamebus/lnet_att.c

30 
	~<ty≥s.h
>

31 
	~<lib.h
>

32 
	~<œmebus/œmebus.h
>

33 
	~"autoc⁄f.h
"

36 
	#LOW_VERSION
 1

	)

38 
	#HIGH_VERSION
 1

	)

40 
 ë_so·c
 *

41 
	$©èch_ ë_to_œmebus
(
 ëno
, 
œmebus_so·c
 *
sc
)

43 
¶Ÿ
 = 
	`œmebus_¥obe
(
sc
, 
LB_VENDOR_CS161
, 
LBCS161_NET
,

44 
LOW_VERSION
, 
HIGH_VERSION
);

45 i‡(
¶Ÿ
 < 0) {

46  
NULL
;

49 
	`k¥ötf
(" ë%d: Nÿ√tw‹k suµ‹àö sy°em\n", 
 ëno
);

51  
NULL
;

52 
	}
}

	@/home/trinity/src/kern/dev/lamebus/lrandom.c

33 
	~<ty≥s.h
>

34 
	~<lib.h
>

35 
	~<uio.h
>

36 
	~<∂©f‹m/bus.h
>

37 
	~<œmebus/Ã™dom.h
>

38 
	~"autoc⁄f.h
"

41 
	#LR_REG_RAND
 0

	)

44 
	#LR_RANDMAX
 0xffffffff

	)

47 
	$c⁄fig_Ã™dom
(
Ã™dom_so·c
 *
Ã
, 
Ã™domno
)

49 ()
Ã™domno
;

50 ()
Ã
;

52 
	}
}

54 
uöt32_t


55 
	$Ã™dom_øndom
(*
devd©a
)

57 
Ã™dom_so·c
 *
Ã
 = 
devd©a
;

58  
	`bus_ªad_ªgi°î
(
Ã
->
Ã_bus
,Ür->
Ã_bu•os
, 
LR_REG_RAND
);

59 
	}
}

61 
uöt32_t


62 
	$Ã™dom_øndmax
(*
devd©a
)

64 ()
devd©a
;

65  
LR_RANDMAX
;

66 
	}
}

69 
	$Ã™dom_ªad
(*
devd©a
, 
uio
 *uio)

71 
Ã™dom_so·c
 *
Ã
 = 
devd©a
;

72 
uöt32_t
 
vÆ
;

73 
ªsu…
;

75 
uio
->
uio_ªsid
 > 0) {

76 
vÆ
 = 
	`bus_ªad_ªgi°î
(
Ã
->
Ã_bus
,Ür->
Ã_bu•os
,

77 
LR_REG_RAND
);

78 
ªsu…
 = 
	`uiomove
(&
vÆ
, (vÆ), 
uio
);

79 i‡(
ªsu…
) {

80  
ªsu…
;

85 
	}
}

	@/home/trinity/src/kern/dev/lamebus/lrandom.h

30 #i‚de‡
_LAMEBUS_LRANDOM_H_


31 
	#_LAMEBUS_LRANDOM_H_


	)

33 
	guio
;

35 
	sÃ™dom_so·c
 {

37 *
	mÃ_bus
;

38 
uöt32_t
 
	mÃ_bu•os
;

42 
uöt32_t
 
Ã™dom_øndom
–*
devd©a
);

43 
uöt32_t
 
Ã™dom_øndmax
–*
devd©a
);

44 
Ã™dom_ªad
–*, 
uio
 *);

	@/home/trinity/src/kern/dev/lamebus/lrandom_att.c

30 
	~<ty≥s.h
>

31 
	~<lib.h
>

32 
	~<œmebus/œmebus.h
>

33 
	~<œmebus/Ã™dom.h
>

34 
	~"autoc⁄f.h
"

37 
	#LOW_VERSION
 1

	)

39 
Ã™dom_so·c
 *

40 
	$©èch_Ã™dom_to_œmebus
(
Ã™domno
, 
œmebus_so·c
 *
sc
)

42 
Ã™dom_so·c
 *
Ã
;

43 
¶Ÿ
 = 
	`œmebus_¥obe
(
sc
, 
LB_VENDOR_CS161
, 
LBCS161_RANDOM
,

44 
LOW_VERSION
, 
NULL
);

45 i‡(
¶Ÿ
 < 0) {

46  
NULL
;

49 
Ã
 = 
	`kmÆloc
((
Ã™dom_so·c
));

50 i‡(
Ã
==
NULL
) {

51  
NULL
;

54 ()
Ã™domno
;

56 
Ã
->
Ã_bus
 = 
sc
;

57 
Ã
->
Ã_bu•os
 = 
¶Ÿ
;

59 
	`œmebus_m¨k
(
sc
, 
¶Ÿ
);

61  
Ã
;

62 
	}
}

	@/home/trinity/src/kern/dev/lamebus/lscreen.c

36 
	~<ty≥s.h
>

37 
	~<lib.h
>

38 
	~<•ölock.h
>

39 
	~<∂©f‹m/bus.h
>

40 
	~<œmebus/ls¸ìn.h
>

41 
	~"autoc⁄f.h
"

44 
	#LSCR_REG_POSN
 0

	)

45 
	#LSCR_REG_SIZE
 4

	)

46 
	#LSCR_REG_CHAR
 8

	)

47 
	#LSCR_REG_RIRQ
 12

	)

50 
	#LSCR_IRQ_ENABLE
 1

	)

51 
	#LSCR_IRQ_ACTIVE
 2

	)

54 
	#LSCR_SCREEN
 32768

	)

58 
ölöe


60 
	$•lôxy
(
uöt32_t
 
xy
, *
x
, *
y
)

62 *
x
 = 
xy
 >> 16;

63 *
y
 = 
xy
 & 0xffff;

64 
	}
}

68 
ölöe


69 
uöt32_t


70 
	$mîgexy
(
x
, 
y
)

72 
uöt32_t
 
vÆ
 = 
x
;

74  (
vÆ
 << 16Ë| 
y
;

75 
	}
}

83 
	$ls¸ìn_úq
(*
vsc
)

85 
ls¸ìn_so·c
 *
sc
 = 
vsc
;

86 
uöt32_t
 
ch
, 
x
;

88 
	`•ölock_acquúe
(&
sc
->
ls_lock
);

90 
x
 = 
	`bus_ªad_ªgi°î
(
sc
->
ls_busd©a
, sc->
ls_bu•os
, 
LSCR_REG_RIRQ
);

91 i‡(
x
 & 
LSCR_IRQ_ACTIVE
) {

92 
ch
 = 
	`bus_ªad_ªgi°î
(
sc
->
ls_busd©a
, sc->
ls_bu•os
,

93 
LSCR_REG_CHAR
);

94 
	`bus_wrôe_ªgi°î
(
sc
->
ls_busd©a
, sc->
ls_bu•os
,

95 
LSCR_REG_RIRQ
, 
LSCR_IRQ_ENABLE
);

97 
	`•ölock_ªÀa£
(&
sc
->
ls_lock
);

98 i‡(
sc
->
ls_öput
) {

99 
sc
->
	`ls_öput
(sc->
ls_devd©a
, 
ch
);

103 
	`•ölock_ªÀa£
(&
sc
->
ls_lock
);

105 
	}
}

114 
	$ls¸ìn_√wlöe
(
ls¸ìn_so·c
 *
sc
)

116 i‡(
sc
->
ls_cy
 >sc->
ls_height
-1) {

121 
	`memmove
(
sc
->
ls_s¸ìn
, sc->ls_s¸ì¿+ sc->
ls_width
,

122 
sc
->
ls_width
 * (sc->
ls_height
-1));

123 
	`bzîo
(
sc
->
ls_s¸ìn
 + sc->
ls_width
 * (sc->
ls_height
-1),

124 
sc
->
ls_width
);

127 
sc
->
ls_cy
++;

129 
sc
->
ls_cx
=0;

130 
	}
}

137 
	$ls¸ìn_ch¨
(
ls¸ìn_so·c
 *
sc
, 
ch
)

139 i‡(
sc
->
ls_cx
 >sc->
ls_width
) {

140 
	`ls¸ìn_√wlöe
(
sc
);

143 
sc
->
ls_s¸ìn
[sc->
ls_cy
*sc->
ls_width
 + sc->
ls_cx
] = 
ch
;

144 
sc
->
ls_cx
++;

145 
	}
}

152 
	$ls¸ìn_wrôe
(*
vsc
, 
ch
)

154 
ls¸ìn_so·c
 *
sc
 = 
vsc
;

155 
ccx
, 
ccy
;

157 
	`•ölock_acquúe
(&
sc
->
ls_lock
);

159 
ch
) {

160 '\n': 
	`ls¸ìn_√wlöe
(
sc
); ;

161 : 
	`ls¸ìn_ch¨
(
sc
, 
ch
); ;

169 
ccx
 = 
sc
->
ls_cx
;

170 
ccy
 = 
sc
->
ls_cy
;

171 i‡(
ccx
==
sc
->
ls_width
) {

172 
ccx
--;

176 
	`bus_wrôe_ªgi°î
(
sc
->
ls_busd©a
, sc->
ls_bu•os
,

177 
LSCR_REG_POSN
, 
	`mîgexy
(
ccx
, 
ccy
));

179 
	`•ölock_ªÀa£
(&
sc
->
ls_lock
);

180 
	}
}

188 
	$c⁄fig_ls¸ìn
(
ls¸ìn_so·c
 *
sc
, 
ls¸ì¬o
)

190 
uöt32_t
 
vÆ
;

192 ()
ls¸ì¬o
;

194 
	`•ölock_öô
(&
sc
->
ls_lock
);

200 
	`bus_wrôe_ªgi°î
(
sc
->
ls_busd©a
, sc->
ls_bu•os
,

201 
LSCR_REG_RIRQ
, 
LSCR_IRQ_ENABLE
);

206 
vÆ
 = 
	`bus_ªad_ªgi°î
(
sc
->
ls_busd©a
, sc->
ls_bu•os
,

207 
LSCR_REG_SIZE
);

208 
	`•lôxy
(
vÆ
, &
sc
->
ls_width
, &sc->
ls_height
);

213 
vÆ
 = 
	`bus_ªad_ªgi°î
(
sc
->
ls_busd©a
, sc->
ls_bu•os
,

214 
LSCR_REG_POSN
);

215 
	`•lôxy
(
vÆ
, &
sc
->
ls_cx
, &sc->
ls_cy
);

220 
sc
->
ls_s¸ìn
 = 
	`bus_m≠_¨ó
(sc->
ls_busd©a
, sc->
ls_bu•os
,

221 
LSCR_SCREEN
);

224 
	}
}

	@/home/trinity/src/kern/dev/lamebus/lscreen.h

30 #i‚de‡
_LAMEBUS_LSCREEN_H_


31 
	#_LAMEBUS_LSCREEN_H_


	)

36 
	sls¸ìn_so·c
 {

38 
•ölock
 
	mls_lock
;

39 
	mls_width
, 
	mls_height
;

40 
	mls_cx
, 
	mls_cy
;

41 *
	mls_s¸ìn
;

44 *
	mls_busd©a
;

45 
uöt32_t
 
	mls_bu•os
;

48 *
	mls_devd©a
;

49 (*
	mls_°¨t
)(*
	mdevd©a
);

50 (*
	mls_öput
)(*
	mdevd©a
, 
	mch
);

54 
ls¸ìn_úq
–*
sc
);

57 
ls¸ìn_wrôe
–*
sc
, 
ch
);

	@/home/trinity/src/kern/dev/lamebus/lscreen_att.c

33 
	~<ty≥s.h
>

34 
	~<lib.h
>

35 
	~<œmebus/œmebus.h
>

36 
	~<œmebus/ls¸ìn.h
>

37 
	~"autoc⁄f.h
"

40 
	#LOW_VERSION
 1

	)

42 
	#HIGH_VERSION
 1

	)

44 
ls¸ìn_so·c
 *

45 
	$©èch_ls¸ìn_to_œmebus
(
ls¸ì¬o
, 
œmebus_so·c
 *
sc
)

47 
ls¸ìn_so·c
 *
ls
;

48 
¶Ÿ
 = 
	`œmebus_¥obe
(
sc
, 
LB_VENDOR_CS161
, 
LBCS161_SCREEN
,

49 
LOW_VERSION
, 
HIGH_VERSION
);

50 i‡(
¶Ÿ
 < 0) {

52  
NULL
;

55 
ls
 = 
	`kmÆloc
((
ls¸ìn_so·c
));

56 i‡(
ls
==
NULL
) {

58  
NULL
;

62 
ls
->
ls_busd©a
 = 
sc
;

63 
ls
->
ls_bu•os
 = 
¶Ÿ
;

66 
	`œmebus_m¨k
(
sc
, 
¶Ÿ
);

67 
	`œmebus_©èch_öãºu±
(
sc
, 
¶Ÿ
, 
ls
, 
ls¸ìn_úq
);

69  
ls
;

70 
	}
}

	@/home/trinity/src/kern/dev/lamebus/lser.c

30 
	~<ty≥s.h
>

31 
	~<lib.h
>

32 
	~<•ölock.h
>

33 
	~<∂©f‹m/bus.h
>

34 
	~<œmebus/l£r.h
>

35 
	~"autoc⁄f.h
"

38 
	#LSER_REG_CHAR
 0

	)

39 
	#LSER_REG_WIRQ
 4

	)

40 
	#LSER_REG_RIRQ
 8

	)

43 
	#LSER_IRQ_ENABLE
 1

	)

44 
	#LSER_IRQ_ACTIVE
 2

	)

45 
	#LSER_IRQ_FORCE
 4

	)

48 
	$l£r_úq
(*
vsc
)

50 
l£r_so·c
 *
sc
 = 
vsc
;

51 
uöt32_t
 
x
;

52 
boﬁ
 
˛ór_to_wrôe
 = 
Ál£
;

53 
boﬁ
 
gŸ_a_ªad
 = 
Ál£
;

54 
uöt32_t
 
ch
 = 0;

56 
	`•ölock_acquúe
(&
sc
->
ls_lock
);

58 
x
 = 
	`bus_ªad_ªgi°î
(
sc
->
ls_busd©a
, sc->
ls_bu•os
, 
LSER_REG_WIRQ
);

59 i‡(
x
 & 
LSER_IRQ_ACTIVE
) {

60 
x
 = 
LSER_IRQ_ENABLE
;

61 
sc
->
ls_wbusy
 = 0;

62 
˛ór_to_wrôe
 = 
åue
;

63 
	`bus_wrôe_ªgi°î
(
sc
->
ls_busd©a
, sc->
ls_bu•os
,

64 
LSER_REG_WIRQ
, 
x
);

67 
x
 = 
	`bus_ªad_ªgi°î
(
sc
->
ls_busd©a
, sc->
ls_bu•os
, 
LSER_REG_RIRQ
);

68 i‡(
x
 & 
LSER_IRQ_ACTIVE
) {

69 
x
 = 
LSER_IRQ_ENABLE
;

70 
ch
 = 
	`bus_ªad_ªgi°î
(
sc
->
ls_busd©a
, sc->
ls_bu•os
,

71 
LSER_REG_CHAR
);

72 
gŸ_a_ªad
 = 
åue
;

73 
	`bus_wrôe_ªgi°î
(
sc
->
ls_busd©a
, sc->
ls_bu•os
,

74 
LSER_REG_RIRQ
, 
x
);

77 
	`•ölock_ªÀa£
(&
sc
->
ls_lock
);

79 i‡(
˛ór_to_wrôe
 && 
sc
->
ls_°¨t
 !
NULL
) {

80 
sc
->
	`ls_°¨t
(sc->
ls_devd©a
);

82 i‡(
gŸ_a_ªad
 && 
sc
->
ls_öput
 !
NULL
) {

83 
sc
->
	`ls_öput
(sc->
ls_devd©a
, 
ch
);

85 
	}
}

88 
	$l£r_wrôe
(*
vls
, 
ch
)

90 
l£r_so·c
 *
ls
 = 
vls
;

92 
	`•ölock_acquúe
(&
ls
->
ls_lock
);

94 i‡(
ls
->
ls_wbusy
) {

106 
	`∑nic
("lser: Not clearÅo write\n");

108 
ls
->
ls_wbusy
 = 
åue
;

110 
	`bus_wrôe_ªgi°î
(
ls
->
ls_busd©a
,Üs->
ls_bu•os
, 
LSER_REG_CHAR
, 
ch
);

112 
	`•ölock_ªÀa£
(&
ls
->
ls_lock
);

113 
	}
}

117 
	$l£r_pﬁl_u¡û_wrôe
(
l£r_so·c
 *
sc
)

119 
uöt32_t
 
vÆ
;

121 
	`KASSERT
(
	`•ölock_do_i_hﬁd
(&
sc
->
ls_lock
));

124 
vÆ
 = 
	`bus_ªad_ªgi°î
(
sc
->
ls_busd©a
, sc->
ls_bu•os
,

125 
LSER_REG_WIRQ
);

127 (
vÆ
 & 
LSER_IRQ_ACTIVE
) == 0);

128 
	}
}

131 
	$l£r_wrôïﬁÀd
(*
vsc
, 
ch
)

133 
l£r_so·c
 *
sc
 = 
vsc
;

134 
boﬁ
 
úq≥ndög
;

136 
	`•ölock_acquúe
(&
sc
->
ls_lock
);

138 i‡(
sc
->
ls_wbusy
) {

139 
úq≥ndög
 = 
åue
;

140 
	`l£r_pﬁl_u¡û_wrôe
(
sc
);

142 
	`bus_wrôe_ªgi°î
(
sc
->
ls_busd©a
, sc->
ls_bu•os
,

143 
LSER_REG_WIRQ
,

144 
LSER_IRQ_FORCE
|
LSER_IRQ_ENABLE
);

147 
úq≥ndög
 = 
Ál£
;

149 
	`bus_wrôe_ªgi°î
(
sc
->
ls_busd©a
, sc->
ls_bu•os
,

150 
LSER_REG_WIRQ
, 0);

154 
	`bus_wrôe_ªgi°î
(
sc
->
ls_busd©a
, sc->
ls_bu•os
, 
LSER_REG_CHAR
, 
ch
);

157 
	`l£r_pﬁl_u¡û_wrôe
(
sc
);

166 i‡(!
úq≥ndög
) {

167 
	`bus_wrôe_ªgi°î
(
sc
->
ls_busd©a
, sc->
ls_bu•os
,

168 
LSER_REG_WIRQ
, 
LSER_IRQ_ENABLE
);

171 
	`•ölock_ªÀa£
(&
sc
->
ls_lock
);

172 
	}
}

175 
	$c⁄fig_l£r
(
l£r_so·c
 *
sc
, 
l£∫o
)

177 ()
l£∫o
;

183 
	`•ölock_öô
(&
sc
->
ls_lock
);

184 
sc
->
ls_wbusy
 = 
Ál£
;

186 
	`bus_wrôe_ªgi°î
(
sc
->
ls_busd©a
, sc->
ls_bu•os
,

187 
LSER_REG_RIRQ
, 
LSER_IRQ_ENABLE
);

188 
	`bus_wrôe_ªgi°î
(
sc
->
ls_busd©a
, sc->
ls_bu•os
,

189 
LSER_REG_WIRQ
, 
LSER_IRQ_ENABLE
);

192 
	}
}

	@/home/trinity/src/kern/dev/lamebus/lser.h

30 #i‚de‡
_LAMEBUS_LSER_H_


31 
	#_LAMEBUS_LSER_H_


	)

33 
	~<•ölock.h
>

35 
	sl£r_so·c
 {

37 
•ölock
 
	mls_lock
;

38 vﬁ©ûê
boﬁ
 
	mls_wbusy
;

41 *
	mls_busd©a
;

42 
uöt32_t
 
	mls_bu•os
;

45 *
	mls_devd©a
;

46 (*
	mls_°¨t
)(*
	mdevd©a
);

47 (*
	mls_öput
)(*
	mdevd©a
, 
	mch
);

51 
l£r_úq
–*
sc
);

54 
l£r_wrôe
–*
sc
, 
ch
);

55 
l£r_wrôïﬁÀd
–*
sc
, 
ch
);

	@/home/trinity/src/kern/dev/lamebus/lser_att.c

30 
	~<ty≥s.h
>

31 
	~<lib.h
>

32 
	~<œmebus/œmebus.h
>

33 
	~<œmebus/l£r.h
>

34 
	~"autoc⁄f.h
"

37 
	#LOW_VERSION
 1

	)

39 
l£r_so·c
 *

40 
	$©èch_l£r_to_œmebus
(
l£∫o
, 
œmebus_so·c
 *
sc
)

42 
l£r_so·c
 *
ls
;

43 
¶Ÿ
 = 
	`œmebus_¥obe
(
sc
, 
LB_VENDOR_CS161
, 
LBCS161_SERIAL
,

44 
LOW_VERSION
, 
NULL
);

45 i‡(
¶Ÿ
 < 0) {

46  
NULL
;

49 
ls
 = 
	`kmÆloc
((
l£r_so·c
));

50 i‡(
ls
==
NULL
) {

51  
NULL
;

54 ()
l£∫o
;

56 
ls
->
ls_busd©a
 = 
sc
;

57 
ls
->
ls_bu•os
 = 
¶Ÿ
;

59 
	`œmebus_m¨k
(
sc
, 
¶Ÿ
);

60 
	`œmebus_©èch_öãºu±
(
sc
, 
¶Ÿ
, 
ls
, 
l£r_úq
);

62  
ls
;

63 
	}
}

	@/home/trinity/src/kern/dev/lamebus/ltimer.c

33 
	~<ty≥s.h
>

34 
	~<lib.h
>

35 
	~<•l.h
>

36 
	~<˛ock.h
>

37 
	~<∂©f‹m/bus.h
>

38 
	~<œmebus/…imî.h
>

39 
	~"autoc⁄f.h
"

42 
	#LT_REG_SEC
 0

	)

43 
	#LT_REG_NSEC
 4

	)

44 
	#LT_REG_ROE
 8

	)

45 
	#LT_REG_IRQ
 12

	)

46 
	#LT_REG_COUNT
 16

	)

47 
	#LT_REG_SPKR
 20

	)

50 
	#LT_GRANULARITY
 1000000

	)

52 
boﬁ
 
	ghavëimî˛ock
;

58 
	$c⁄fig_…imî
(
…imî_so·c
 *
…
, 
…imîno
)

83 ()
…imîno
;

84 
…
->
…_h¨d˛ock
 = 0;

90 i‡(!
havëimî˛ock
) {

91 
havëimî˛ock
 = 
åue
;

92 
…
->
…_timî˛ock
 = 1;

95 
	`bus_wrôe_ªgi°î
(
…
->
…_bus
,Üt->
…_bu•os
, 
LT_REG_ROE
, 1);

96 
	`bus_wrôe_ªgi°î
(
…
->
…_bus
,Üt->
…_bu•os
, 
LT_REG_COUNT
,

97 
LT_GRANULARITY
);

101 
	}
}

107 
	$…imî_úq
(*
v…
)

109 
…imî_so·c
 *
…
 = 
v…
;

110 
uöt32_t
 
vÆ
;

112 
vÆ
 = 
	`bus_ªad_ªgi°î
(
…
->
…_bus
,Üt->
…_bu•os
, 
LT_REG_IRQ
);

113 i‡(
vÆ
) {

118 i‡(
…
->
…_h¨d˛ock
) {

119 
	`h¨d˛ock
();

124 i‡(
…
->
…_timî˛ock
) {

125 
	`timî˛ock
();

128 
	}
}

136 
	$…imî_bìp
(*
v…
)

138 
…imî_so·c
 *
…
 = 
v…
;

140 
	`bus_wrôe_ªgi°î
(
…
->
…_bus
,Üt->
…_bu•os
, 
LT_REG_SPKR
, 440);

141 
	}
}

149 
	$…imî_gëtime
(*
v…
, 
time•ec
 *
ts
)

151 
…imî_so·c
 *
…
 = 
v…
;

152 
uöt32_t
 
£cs1
, 
£cs2
;

153 
•l
;

170 
•l
 = 
	`•lhigh
();

172 
£cs1
 = 
	`bus_ªad_ªgi°î
(
…
->
…_bus
,Üt->
…_bu•os
,

173 
LT_REG_SEC
);

174 
ts
->
tv_n£c
 = 
	`bus_ªad_ªgi°î
(
…
->
…_bus
,Üt->
…_bu•os
,

175 
LT_REG_NSEC
);

176 
£cs2
 = 
	`bus_ªad_ªgi°î
(
…
->
…_bus
,Üt->
…_bu•os
,

177 
LT_REG_SEC
);

179 
	`•lx
(
•l
);

181 i‡(
ts
->
tv_n£c
 < 5000000) {

182 
ts
->
tv_£c
 = 
£cs2
;

185 
ts
->
tv_£c
 = 
£cs1
;

187 
	}
}

	@/home/trinity/src/kern/dev/lamebus/ltimer.h

30 #i‚de‡
_LAMEBUS_LTIMER_H_


31 
	#_LAMEBUS_LTIMER_H_


	)

33 
	gtime•ec
;

38 
	s…imî_so·c
 {

40 
	m…_h¨d˛ock
;

41 
	m…_timî˛ock
;

44 *
	m…_bus
;

45 
uöt32_t
 
	m…_bu•os
;

49 
…imî_úq
–*
…
);

52 
…imî_bìp
–*
devd©a
);

53 
…imî_gëtime
–*
devd©a
,

54 
time•ec
 *
ts
);

	@/home/trinity/src/kern/dev/lamebus/ltimer_att.c

33 
	~<ty≥s.h
>

34 
	~<lib.h
>

35 
	~<œmebus/œmebus.h
>

36 
	~<œmebus/…imî.h
>

37 
	~"autoc⁄f.h
"

40 
	#LOW_VERSION
 1

	)

42 
…imî_so·c
 *

43 
	$©èch_…imî_to_œmebus
(
…imîno
, 
œmebus_so·c
 *
sc
)

45 
…imî_so·c
 *
…
;

46 
¶Ÿ
 = 
	`œmebus_¥obe
(
sc
, 
LB_VENDOR_CS161
, 
LBCS161_TIMER
,

47 
LOW_VERSION
, 
NULL
);

48 i‡(
¶Ÿ
 < 0) {

50  
NULL
;

53 
…
 = 
	`kmÆloc
((
…imî_so·c
));

54 i‡(
…
==
NULL
) {

56  
NULL
;

59 ()
…imîno
;

62 
…
->
…_bus
 = 
sc
;

63 
…
->
…_bu•os
 = 
¶Ÿ
;

66 
	`œmebus_m¨k
(
sc
, 
¶Ÿ
);

67 
	`œmebus_©èch_öãºu±
(
sc
, 
¶Ÿ
, 
…
, 
…imî_úq
);

69  
…
;

70 
	}
}

	@/home/trinity/src/kern/dev/lamebus/ltrace.c

30 
	~<ty≥s.h
>

31 
	~<lib.h
>

32 
	~<∂©f‹m/bus.h
>

33 
	~<œmebus/…ø˚.h
>

34 
	~"autoc⁄f.h
"

37 
	#LTRACE_REG_TRON
 0

	)

38 
	#LTRACE_REG_TROFF
 4

	)

39 
	#LTRACE_REG_DEBUG
 8

	)

40 
	#LTRACE_REG_DUMP
 12

	)

41 
	#LTRACE_REG_STOP
 16

	)

42 
	#LTRACE_REG_PROFEN
 20

	)

43 
	#LTRACE_REG_PROFCL
 24

	)

45 
…ø˚_so·c
 *
	gthe_åa˚
;

48 
	$…ø˚_⁄
(
uöt32_t
 
code
)

50 i‡(
the_åa˚
 !
NULL
) {

51 
	`bus_wrôe_ªgi°î
(
the_åa˚
->
…_busd©a
,Åhe_åa˚->
…_bu•os
,

52 
LTRACE_REG_TRON
, 
code
);

54 
	}
}

57 
	$…ø˚_off
(
uöt32_t
 
code
)

59 i‡(
the_åa˚
 !
NULL
) {

60 
	`bus_wrôe_ªgi°î
(
the_åa˚
->
…_busd©a
,Åhe_åa˚->
…_bu•os
,

61 
LTRACE_REG_TROFF
, 
code
);

63 
	}
}

66 
	$…ø˚_debug
(
uöt32_t
 
code
)

68 i‡(
the_åa˚
 !
NULL
) {

69 
	`bus_wrôe_ªgi°î
(
the_åa˚
->
…_busd©a
,Åhe_åa˚->
…_bu•os
,

70 
LTRACE_REG_DEBUG
, 
code
);

72 
	}
}

75 
	$…ø˚_dump
(
uöt32_t
 
code
)

77 i‡(
the_åa˚
 !
NULL
) {

78 
	`bus_wrôe_ªgi°î
(
the_åa˚
->
…_busd©a
,Åhe_åa˚->
…_bu•os
,

79 
LTRACE_REG_DUMP
, 
code
);

81 
	}
}

84 
	$…ø˚_°›
(
uöt32_t
 
code
)

86 i‡(
the_åa˚
 !
NULL
 &&Åhe_åa˚->
…_ˇn°›
) {

87 
	`bus_wrôe_ªgi°î
(
the_åa˚
->
…_busd©a
,Åhe_åa˚->
…_bu•os
,

88 
LTRACE_REG_STOP
, 
code
);

90 
	}
}

93 
	$…ø˚_£çrof
(
uöt32_t
 
⁄off
)

95 i‡(
the_åa˚
 !
NULL
 &&Åhe_åa˚->
…_ˇ≈rof
) {

96 
	`bus_wrôe_ªgi°î
(
the_åa˚
->
…_busd©a
,Åhe_åa˚->
…_bu•os
,

97 
LTRACE_REG_PROFEN
, 
⁄off
);

99 
	}
}

102 
	$…ø˚_îa£¥of
()

104 i‡(
the_åa˚
 !
NULL
 &&Åhe_åa˚->
…_ˇ≈rof
) {

105 
	`bus_wrôe_ªgi°î
(
the_åa˚
->
…_busd©a
,Åhe_åa˚->
…_bu•os
,

106 
LTRACE_REG_PROFCL
, 1);

108 
	}
}

111 
	$c⁄fig_…ø˚
(
…ø˚_so·c
 *
sc
, 
…ø˚no
)

113 ()
…ø˚no
;

114 
the_åa˚
 = 
sc
;

116 
	}
}

	@/home/trinity/src/kern/dev/lamebus/ltrace.h

30 #i‚de‡
_LAMEBUS_LTRACE_H_


31 
	#_LAMEBUS_LTRACE_H_


	)

33 
	s…ø˚_so·c
 {

35 *
	m…_busd©a
;

36 
uöt32_t
 
	m…_bu•os
;

37 
boﬁ
 
	m…_ˇn°›
;

38 
boﬁ
 
	m…_ˇ≈rof
;

82 
…ø˚_⁄
(
uöt32_t
 
code
);

83 
…ø˚_off
(
uöt32_t
 
code
);

84 
…ø˚_debug
(
uöt32_t
 
code
);

85 
…ø˚_dump
(
uöt32_t
 
code
);

86 
…ø˚_°›
(
uöt32_t
 
code
);

87 
…ø˚_£çrof
(
uöt32_t
 
⁄off
);

88 
…ø˚_îa£¥of
();

	@/home/trinity/src/kern/dev/lamebus/ltrace_att.c

30 
	~<ty≥s.h
>

31 
	~<lib.h
>

32 
	~<œmebus/œmebus.h
>

33 
	~<œmebus/…ø˚.h
>

34 
	~"autoc⁄f.h
"

37 
	#LOW_VERSION
 1

	)

39 
	#STOP_VERSION
 2

	)

41 
	#PROF_VERSION
 3

	)

43 
…ø˚_so·c
 *

44 
	$©èch_…ø˚_to_œmebus
(
…ø˚no
, 
œmebus_so·c
 *
sc
)

46 
…ø˚_so·c
 *
…
;

47 
uöt32_t
 
dæ
;

48 
¶Ÿ
 = 
	`œmebus_¥obe
(
sc
, 
LB_VENDOR_CS161
, 
LBCS161_TRACE
,

49 
LOW_VERSION
, &
dæ
);

50 i‡(
¶Ÿ
 < 0) {

51  
NULL
;

54 
…
 = 
	`kmÆloc
((
…ø˚_so·c
));

55 i‡(
…
==
NULL
) {

56  
NULL
;

59 ()
…ø˚no
;

61 
…
->
…_busd©a
 = 
sc
;

62 
…
->
…_bu•os
 = 
¶Ÿ
;

63 
…
->
…_ˇn°›
 = 
dæ
 >
STOP_VERSION
;

64 
…
->
…_ˇ≈rof
 = 
dæ
 >
PROF_VERSION
;

66 
	`œmebus_m¨k
(
sc
, 
¶Ÿ
);

68  
…
;

69 
	}
}

	@/home/trinity/src/kern/dev/lamebus/random_lrandom.c

35 
	~<ty≥s.h
>

36 
	~<lib.h
>

37 
	~<gíîic/øndom.h
>

38 
	~<œmebus/Ã™dom.h
>

39 
	~"autoc⁄f.h
"

41 
øndom_so·c
 *

42 
	$©èch_øndom_to_Ã™dom
(
øndomno
, 
Ã™dom_so·c
 *
ls
)

44 
øndom_so·c
 *
rs
 = 
	`kmÆloc
((random_softc));

45 i‡(
rs
==
NULL
) {

46  
NULL
;

49 ()
øndomno
;

51 
rs
->
rs_devd©a
 = 
ls
;

52 
rs
->
rs_øndom
 = 
Ã™dom_øndom
;

53 
rs
->
rs_øndmax
 = 
Ã™dom_øndmax
;

54 
rs
->
rs_ªad
 = 
Ã™dom_ªad
;

56  
rs
;

57 
	}
}

	@/home/trinity/src/kern/dev/lamebus/rtclock_ltimer.c

41 
	~<ty≥s.h
>

42 
	~<lib.h
>

43 
	~<gíîic/π˛ock.h
>

44 
	~<œmebus/…imî.h
>

45 
	~"autoc⁄f.h
"

47 
π˛ock_so·c
 *

48 
	$©èch_π˛ock_to_…imî
(
π˛ockno
, 
…imî_so·c
 *
ls
)

54 
π˛ock_so·c
 *
πc
 = 
	`kmÆloc
((rtclock_softc));

55 i‡(
πc
==
NULL
) {

57  
NULL
;

60 ()
π˛ockno
;

62 
πc
->
πc_devd©a
 = 
ls
;

63 
πc
->
πc_gëtime
 = 
…imî_gëtime
;

65  
πc
;

66 
	}
}

	@/home/trinity/src/kern/fs/semfs/semfs.h

30 #i‚de‡
SEMFS_H


31 
	#SEMFS_H


	)

33 
	~<¨øy.h
>

34 
	~<fs.h
>

35 
	~<vnode.h
>

37 #i‚de‡
SEMFS_INLINE


38 
	#SEMFS_INLINE
 
INLINE


	)

45 
	#SEMFS_ROOTDIR
 0xffffffffU

	)

54 
	s£mfs_£m
 {

55 
lock
 *
	m£ms_lock
;

56 
cv
 *
	m£ms_cv
;

57 
	m£ms_cou¡
;

58 
boﬁ
 
	m£ms_hasvnode
;

59 
boﬁ
 
	m£ms_löked
;

61 
DECLARRAY
(
£mfs_£m
, 
SEMFS_INLINE
);

66 
	s£mfs_dúíåy
 {

67 *
	m£md_«me
;

68 
	m£md_£mnum
;

70 
DECLARRAY
(
£mfs_dúíåy
, 
SEMFS_INLINE
);

79 
	s£mfs_vnode
 {

80 
vnode
 
	m£mv_absvn
;

81 
£mfs
 *
	m£mv_£mfs
;

82 
	m£mv_£mnum
;

89 
	s£mfs
 {

90 
fs
 
	m£mfs_absfs
;

92 
lock
 *
	m£mfs_èbÀlock
;

93 
vnodóºay
 *
	m£mfs_vnodes
;

94 
£mfs_£m¨øy
 *
	m£mfs_£ms
;

96 
lock
 *
	m£mfs_dúlock
;

97 
£mfs_dúíåy¨øy
 *
	m£mfs_díts
;

104 
DEFARRAY
(
£mfs_£m
, 
SEMFS_INLINE
);

105 
DEFARRAY
(
£mfs_dúíåy
, 
SEMFS_INLINE
);

113 
£mfs_£m
 *
£mfs_£m_¸óã
(c⁄° *
«me
);

114 
£mfs_£m_ö£π
(
£mfs
 *, 
£mfs_£m
 *, *);

115 
£mfs_£m_de°roy
(
£mfs_£m
 *);

116 
£mfs_dúíåy
 *
£mfs_dúíåy_¸óã
(c⁄° *
«me
, 
£mno
);

117 
£mfs_dúíåy_de°roy
(
£mfs_dúíåy
 *);

120 
£mfs_gëvnode
(
£mfs
 *, , 
vnode
 **
ªt
);

	@/home/trinity/src/kern/fs/semfs/semfs_fsops.c

30 
	~<ty≥s.h
>

31 
	~<kîn/î∫o.h
>

32 
	~<synch.h
>

33 
	~<vfs.h
>

34 
	~<fs.h
>

35 
	~<vnode.h
>

37 
	~"£mfs.h
"

47 
	$£mfs_sync
(
fs
 *fs)

49 ()
fs
;

51 
	}
}

58 
	$£mfs_gëvﬁ«me
(
fs
 *fs)

60 ()
fs
;

62 
	}
}

69 
	$£mfs_gëroŸ
(
fs
 *fs, 
vnode
 **
ªt
)

71 
£mfs
 *£mf†
fs
->
fs_d©a
;

72 
vnode
 *
vn
;

73 
ªsu…
;

75 
ªsu…
 = 
	`£mfs_gëvnode
(
£mfs
, 
SEMFS_ROOTDIR
, &
vn
);

76 i‡(
ªsu…
) {

77 
	`k¥ötf
("semfs: couldn'tÜoadÑoot vnode: %s\n",

78 
	`°ªº‹
(
ªsu…
));

79  
ªsu…
;

81 *
ªt
 = 
vn
;

83 
	}
}

94 
	$£mfs_de°roy
(
£mfs
 *semfs)

96 
£mfs_£m
 *
£m
;

97 
£mfs_dúíåy
 *
dít
;

98 
i
, 
num
;

100 
num
 = 
	`£mfs_£m¨øy_num
(
£mfs
->
£mfs_£ms
);

101 
i
=0; i<
num
; i++) {

102 
£m
 = 
	`£mfs_£m¨øy_gë
(
£mfs
->
£mfs_£ms
, 
i
);

103 
	`£mfs_£m_de°roy
(
£m
);

105 
	`£mfs_£m¨øy_£tsize
(
£mfs
->
£mfs_£ms
, 0);

107 
num
 = 
	`£mfs_dúíåy¨øy_num
(
£mfs
->
£mfs_díts
);

108 
i
=0; i<
num
; i++) {

109 
dít
 = 
	`£mfs_dúíåy¨øy_gë
(
£mfs
->
£mfs_díts
, 
i
);

110 
	`£mfs_dúíåy_de°roy
(
dít
);

112 
	`£mfs_dúíåy¨øy_£tsize
(
£mfs
->
£mfs_díts
, 0);

114 
	`£mfs_dúíåy¨øy_de°roy
(
£mfs
->
£mfs_díts
);

115 
	`lock_de°roy
(
£mfs
->
£mfs_dúlock
);

116 
	`£mfs_£m¨øy_de°roy
(
£mfs
->
£mfs_£ms
);

117 
	`vnodóºay_de°roy
(
£mfs
->
£mfs_vnodes
);

118 
	`lock_de°roy
(
£mfs
->
£mfs_èbÀlock
);

119 
	`k‰ì
(
£mfs
);

120 
	}
}

128 
	$£mfs_unmou¡
(
fs
 *fs)

130 
£mfs
 *£mf†
fs
->
fs_d©a
;

132 
	`lock_acquúe
(
£mfs
->
£mfs_èbÀlock
);

133 i‡(
	`vnodóºay_num
(
£mfs
->
£mfs_vnodes
) > 0) {

134 
	`lock_ªÀa£
(
£mfs
->
£mfs_èbÀlock
);

135  
EBUSY
;

138 
	`lock_ªÀa£
(
£mfs
->
£mfs_èbÀlock
);

139 
	`£mfs_de°roy
(
£mfs
);

142 
	}
}

147 c⁄° 
fs_›s
 
	g£mfs_fs›s
 = {

148 .
fs›_sync
 = 
£mfs_sync
,

149 .
	gfs›_gëvﬁ«me
 = 
£mfs_gëvﬁ«me
,

150 .
	gfs›_gëroŸ
 = 
£mfs_gëroŸ
,

151 .
	gfs›_unmou¡
 = 
£mfs_unmou¡
,

158 
£mfs
 *

159 
	$£mfs_¸óã
()

161 
£mfs
 *semfs;

163 
£mfs
 = 
	`kmÆloc
((*semfs));

164 i‡(
£mfs
 =
NULL
) {

165 
Áû_tŸÆ
;

168 
£mfs
->
£mfs_èbÀlock
 = 
	`lock_¸óã
("semfs_table");

169 i‡(
£mfs
->
£mfs_èbÀlock
 =
NULL
) {

170 
Áû_£mfs
;

172 
£mfs
->
£mfs_vnodes
 = 
	`vnodóºay_¸óã
();

173 i‡(
£mfs
->
£mfs_vnodes
 =
NULL
) {

174 
Áû_èbÀlock
;

176 
£mfs
->
£mfs_£ms
 = 
	`£mfs_£m¨øy_¸óã
();

177 i‡(
£mfs
->
£mfs_£ms
 =
NULL
) {

178 
Áû_vnodes
;

181 
£mfs
->
£mfs_dúlock
 = 
	`lock_¸óã
("semfs_dir");

182 i‡(
£mfs
->
£mfs_dúlock
 =
NULL
) {

183 
Áû_£ms
;

185 
£mfs
->
£mfs_díts
 = 
	`£mfs_dúíåy¨øy_¸óã
();

186 i‡(
£mfs
->
£mfs_díts
 =
NULL
) {

187 
Áû_dúlock
;

190 
£mfs
->
£mfs_absfs
.
fs_d©a
 = semfs;

191 
£mfs
->
£mfs_absfs
.
fs_›s
 = &
£mfs_fs›s
;

192  
£mfs
;

194 
Áû_dúlock
:

195 
	`lock_de°roy
(
£mfs
->
£mfs_dúlock
);

196 
Áû_£ms
:

197 
	`£mfs_£m¨øy_de°roy
(
£mfs
->
£mfs_£ms
);

198 
Áû_vnodes
:

199 
	`vnodóºay_de°roy
(
£mfs
->
£mfs_vnodes
);

200 
Áû_èbÀlock
:

201 
	`lock_de°roy
(
£mfs
->
£mfs_èbÀlock
);

202 
Áû_£mfs
:

203 
	`k‰ì
(
£mfs
);

204 
Áû_tŸÆ
:

205  
NULL
;

206 
	}
}

213 
	$£mfs_boŸ°øp
()

215 
£mfs
 *semfs;

216 
ªsu…
;

218 
£mfs
 = 
	`£mfs_¸óã
();

219 i‡(
£mfs
 =
NULL
) {

220 
	`∑nic
("Out of memory creating semfs\n");

222 
ªsu…
 = 
	`vfs_addfs
("£m", &
£mfs
->
£mfs_absfs
);

223 i‡(
ªsu…
) {

224 
	`∑nic
("Aâachög semfs: %s\n", 
	`°ªº‹
(
ªsu…
));

226 
	}
}

	@/home/trinity/src/kern/fs/semfs/semfs_obj.c

30 
	~<ty≥s.h
>

31 
	~<kîn/î∫o.h
>

32 
	~<synch.h
>

34 
	#SEMFS_INLINE


	)

35 
	~"£mfs.h
"

43 
£mfs_£m
 *

44 
	$£mfs_£m_¸óã
(c⁄° *
«me
)

46 
£mfs_£m
 *
£m
;

47 
lock«me
[32];

48 
cv«me
[32];

50 
	`¢¥ötf
(
lock«me
, ÷ock«me), "£m:l.%s", 
«me
);

51 
	`¢¥ötf
(
cv«me
, (cv«me), "£m:%s", 
«me
);

53 
£m
 = 
	`kmÆloc
((*sem));

54 i‡(
£m
 =
NULL
) {

55 
Áû_ªtu∫
;

57 
£m
->
£ms_lock
 = 
	`lock_¸óã
(
lock«me
);

58 i‡(
£m
->
£ms_lock
 =
NULL
) {

59 
Áû_£m
;

61 
£m
->
£ms_cv
 = 
	`cv_¸óã
(
cv«me
);

62 i‡(
£m
->
£ms_cv
 =
NULL
) {

63 
Áû_lock
;

65 
£m
->
£ms_cou¡
 = 0;

66 
£m
->
£ms_hasvnode
 = 
Ál£
;

67 
£m
->
£ms_löked
 = 
Ál£
;

68  
£m
;

70 
Áû_lock
:

71 
	`lock_de°roy
(
£m
->
£ms_lock
);

72 
Áû_£m
:

73 
	`k‰ì
(
£m
);

74 
Áû_ªtu∫
:

75  
NULL
;

76 
	}
}

82 
	$£mfs_£m_de°roy
(
£mfs_£m
 *
£m
)

84 
	`cv_de°roy
(
£m
->
£ms_cv
);

85 
	`lock_de°roy
(
£m
->
£ms_lock
);

86 
	`k‰ì
(
£m
);

87 
	}
}

93 
	$£mfs_£m_ö£π
(
£mfs
 *£mfs, 
£mfs_£m
 *
£m
, *
ªt
)

95 
i
, 
num
;

97 
	`KASSERT
(
	`lock_do_i_hﬁd
(
£mfs
->
£mfs_èbÀlock
));

98 
num
 = 
	`£mfs_£m¨øy_num
(
£mfs
->
£mfs_£ms
);

99 i‡(
num
 =
SEMFS_ROOTDIR
) {

101  
ENOSPC
;

103 
i
=0; i<
num
; i++) {

104 i‡(
	`£mfs_£m¨øy_gë
(
£mfs
->
£mfs_£ms
, 
i
Ë=
NULL
) {

105 
	`£mfs_£m¨øy_£t
(
£mfs
->
£mfs_£ms
, 
i
, 
£m
);

106 *
ªt
 = 
i
;

110  
	`£mfs_£m¨øy_add
(
£mfs
->
£mfs_£ms
, 
£m
, 
ªt
);

111 
	}
}

119 
£mfs_dúíåy
 *

120 
	$£mfs_dúíåy_¸óã
(c⁄° *
«me
, 
£mnum
)

122 
£mfs_dúíåy
 *
dít
;

124 
dít
 = 
	`kmÆloc
((*dent));

125 i‡(
dít
 =
NULL
) {

126  
NULL
;

128 
dít
->
£md_«me
 = 
	`k°rdup
(
«me
);

129 i‡(
dít
->
£md_«me
 =
NULL
) {

130 
	`k‰ì
(
dít
);

131  
NULL
;

133 
dít
->
£md_£mnum
 = 
£mnum
;

134  
dít
;

135 
	}
}

141 
	$£mfs_dúíåy_de°roy
(
£mfs_dúíåy
 *
dít
)

143 
	`k‰ì
(
dít
->
£md_«me
);

144 
	`k‰ì
(
dít
);

145 
	}
}

	@/home/trinity/src/kern/fs/semfs/semfs_vnops.c

30 
	~<ty≥s.h
>

31 
	~<kîn/î∫o.h
>

32 
	~<kîn/f˙é.h
>

33 
	~<°©.h
>

34 
	~<uio.h
>

35 
	~<synch.h
>

36 
	~<thªad.h
>

37 
	~<¥oc.h
>

38 
	~<cuºít.h
>

39 
	~<vfs.h
>

40 
	~<vnode.h
>

42 
	~"£mfs.h
"

49 
	$£mfs_óch›í
(
vnode
 *
vn
, 
›íÊags
)

51 
£mfs_vnode
 *
£mv
 = 
vn
->
vn_d©a
;

53 i‡(
£mv
->
£mv_£mnum
 =
SEMFS_ROOTDIR
) {

54 i‡((
›íÊags
 & 
O_ACCMODE
Ë!
O_RDONLY
) {

55  
EISDIR
;

57 i‡(
›íÊags
 & 
O_APPEND
) {

58  
EISDIR
;

63 
	}
}

67 
	$£mfs_io˘l
(
vnode
 *
vn
, 
›
, 
u£Ωå_t
 
d©a
)

69 ()
vn
;

70 ()
›
;

71 ()
d©a
;

72  
EINVAL
;

73 
	}
}

77 
	$£mfs_gëty≥
(
vnode
 *
vn
, 
mode_t
 *
ªt
)

79 
£mfs_vnode
 *
£mv
 = 
vn
->
vn_d©a
;

81 *
ªt
 = 
£mv
->
£mv_£mnum
 =
SEMFS_ROOTDIR
 ? 
S_IFDIR
 : 
S_IFREG
;

83 
	}
}

86 
boﬁ


87 
	$£mfs_is£ekabÀ
(
vnode
 *
vn
)

89 
£mfs_vnode
 *
£mv
 = 
vn
->
vn_d©a
;

91 i‡(
£mv
->
£mv_£mnum
 !
SEMFS_ROOTDIR
) {

93  
Ál£
;

95  
åue
;

96 
	}
}

100 
	$£mfs_fsync
(
vnode
 *
vn
)

102 ()
vn
;

104 
	}
}

114 
£mfs_£m
 *

115 
	$£mfs_gë£mbynum
(
£mfs
 *£mfs, 
£mnum
)

117 
£mfs_£m
 *
£m
;

119 
	`lock_acquúe
(
£mfs
->
£mfs_èbÀlock
);

120 
£m
 = 
	`£mfs_£m¨øy_gë
(
£mfs
->
£mfs_£ms
, 
£mnum
);

121 
	`lock_ªÀa£
(
£mfs
->
£mfs_èbÀlock
);

123  
£m
;

124 
	}
}

127 
£mfs_£m
 *

128 
	$£mfs_gë£m
(
£mfs_vnode
 *
£mv
)

130 
£mfs
 *£mf†
£mv
->
£mv_£mfs
;

132  
	`£mfs_gë£mbynum
(
£mfs
, 
£mv
->
£mv_£mnum
);

133 
	}
}

143 
	$£mfs_wakeup
(
£mfs_£m
 *
£m
, 
√wcou¡
)

145 i‡(
£m
->
£ms_cou¡
 > 0 || 
√wcou¡
 == 0) {

148 i‡(
√wcou¡
 == 1) {

149 
	`cv_sig«l
(
£m
->
£ms_cv
, sem->
£ms_lock
);

152 
	`cv_brﬂdˇ°
(
£m
->
£ms_cv
, sem->
£ms_lock
);

154 
	}
}

161 
	$£mfs_£m°©
(
vnode
 *
vn
, 
°©
 *
buf
)

163 
£mfs_vnode
 *
£mv
 = 
vn
->
vn_d©a
;

164 
£mfs_£m
 *
£m
;

166 
£m
 = 
	`£mfs_gë£m
(
£mv
);

168 
	`bzîo
(
buf
, (*buf));

170 
	`lock_acquúe
(
£m
->
£ms_lock
);

171 
buf
->
°_size
 = 
£m
->
£ms_cou¡
;

172 
buf
->
°_∆ök
 = 
£m
->
£ms_löked
 ? 1 : 0;

173 
	`lock_ªÀa£
(
£m
->
£ms_lock
);

175 
buf
->
°_mode
 = 
S_IFREG
 | 0666;

176 
buf
->
°_blocks
 = 0;

177 
buf
->
°_dev
 = 0;

178 
buf
->
°_öo
 = 
£mv
->
£mv_£mnum
;

181 
	}
}

189 
	$£mfs_ªad
(
vnode
 *
vn
, 
uio
 *uio)

191 
£mfs_vnode
 *
£mv
 = 
vn
->
vn_d©a
;

192 
£mfs_£m
 *
£m
;

193 
size_t
 
c⁄sume
;

195 
£m
 = 
	`£mfs_gë£m
(
£mv
);

197 
	`lock_acquúe
(
£m
->
£ms_lock
);

198 
uio
->
uio_ªsid
 > 0) {

199 i‡(
£m
->
£ms_cou¡
 > 0) {

200 
c⁄sume
 = 
uio
->
uio_ªsid
;

201 i‡(
c⁄sume
 > 
£m
->
£ms_cou¡
) {

202 
c⁄sume
 = 
£m
->
£ms_cou¡
;

204 
	`DEBUG
(
DB_SEMFS
, "semfs: sem%u: P, count %u -> %u\n",

205 
£mv
->
£mv_£mnum
, 
£m
->
£ms_cou¡
,

206 
£m
->
£ms_cou¡
 - 
c⁄sume
);

207 
£m
->
£ms_cou¡
 -
c⁄sume
;

209 
uio
->
uio_off£t
 +
c⁄sume
;

210 
uio
->
uio_ªsid
 -
c⁄sume
;

212 i‡(
uio
->
uio_ªsid
 == 0) {

215 i‡(
£m
->
£ms_cou¡
 == 0) {

216 
	`DEBUG
(
DB_SEMFS
, "semfs: sem%u: blocking\n",

217 
£mv
->
£mv_£mnum
);

218 
	`cv_waô
(
£m
->
£ms_cv
, sem->
£ms_lock
);

221 
	`lock_ªÀa£
(
£m
->
£ms_lock
);

223 
	}
}

231 
	$£mfs_wrôe
(
vnode
 *
vn
, 
uio
 *uio)

233 
£mfs_vnode
 *
£mv
 = 
vn
->
vn_d©a
;

234 
£mfs_£m
 *
£m
;

235 
√wcou¡
;

237 
£m
 = 
	`£mfs_gë£m
(
£mv
);

239 
	`lock_acquúe
(
£m
->
£ms_lock
);

240 
uio
->
uio_ªsid
 > 0) {

241 
√wcou¡
 = 
£m
->
£ms_cou¡
 + 
uio
->
uio_ªsid
;

242 i‡(
√wcou¡
 < 
£m
->
£ms_cou¡
) {

244 
	`lock_ªÀa£
(
£m
->
£ms_lock
);

245  
EFBIG
;

247 
	`DEBUG
(
DB_SEMFS
, "semfs: sem%u: V, count %u -> %u\n",

248 
£mv
->
£mv_£mnum
, 
£m
->
£ms_cou¡
, 
√wcou¡
);

249 
	`£mfs_wakeup
(
£m
, 
√wcou¡
);

250 
£m
->
£ms_cou¡
 = 
√wcou¡
;

251 
uio
->
uio_off£t
 +uio->
uio_ªsid
;

252 
uio
->
uio_ªsid
 = 0;

254 
	`lock_ªÀa£
(
£m
->
£ms_lock
);

256 
	}
}

267 
	$£mfs_åunˇã
(
vnode
 *
vn
, 
off_t
 
Àn
)

270 c⁄° 
max
 = ()-1;

272 
£mfs_vnode
 *
£mv
 = 
vn
->
vn_d©a
;

273 
£mfs_£m
 *
£m
;

274 
√wcou¡
;

276 i‡(
Àn
 < 0) {

277  
EINVAL
;

279 i‡(
Àn
 > (
off_t
)
max
) {

280  
EFBIG
;

282 
√wcou¡
 = 
Àn
;

284 
£m
 = 
	`£mfs_gë£m
(
£mv
);

286 
	`lock_acquúe
(
£m
->
£ms_lock
);

287 
	`£mfs_wakeup
(
£m
, 
√wcou¡
);

288 
£m
->
£ms_cou¡
 = 
√wcou¡
;

289 
	`lock_ªÀa£
(
£m
->
£ms_lock
);

292 
	}
}

303 
	$£mfs_gëdúíåy
(
vnode
 *
dúvn
, 
uio
 *uio)

305 
£mfs_vnode
 *
dú£mv
 = 
dúvn
->
vn_d©a
;

306 
£mfs
 *£mf†
dú£mv
->
£mv_£mfs
;

307 
£mfs_dúíåy
 *
dít
;

308 
num
, 
pos
;

309 
ªsu…
;

311 
	`KASSERT
(
uio
->
uio_off£t
 >= 0);

312 
pos
 = 
uio
->
uio_off£t
;

314 
	`lock_acquúe
(
£mfs
->
£mfs_dúlock
);

316 
num
 = 
	`£mfs_dúíåy¨øy_num
(
£mfs
->
£mfs_díts
);

317 i‡(
pos
 >
num
) {

319 
ªsu…
 = 0;

322 
dít
 = 
	`£mfs_dúíåy¨øy_gë
(
£mfs
->
£mfs_díts
, 
pos
);

323 
ªsu…
 = 
	`uiomove
(
dít
->
£md_«me
, 
	`°æí
(dent->semd_name),

324 
uio
);

327 
	`lock_ªÀa£
(
£mfs
->
£mfs_dúlock
);

328  
ªsu…
;

329 
	}
}

336 
	$£mfs_dú°©
(
vnode
 *
vn
, 
°©
 *
buf
)

338 
£mfs_vnode
 *
£mv
 = 
vn
->
vn_d©a
;

339 
£mfs
 *£mf†
£mv
->
£mv_£mfs
;

341 
	`bzîo
(
buf
, (*buf));

343 
	`lock_acquúe
(
£mfs
->
£mfs_dúlock
);

344 
buf
->
°_size
 = 
	`£mfs_dúíåy¨øy_num
(
£mfs
->
£mfs_díts
);

345 
	`lock_ªÀa£
(
£mfs
->
£mfs_dúlock
);

347 
buf
->
°_mode
 = 
S_IFDIR
 | 1777;

348 
buf
->
°_∆ök
 = 2;

349 
buf
->
°_blocks
 = 0;

350 
buf
->
°_dev
 = 0;

351 
buf
->
°_öo
 = 
SEMFS_ROOTDIR
;

354 
	}
}

362 
	$£mfs_«mefûe
(
vnode
 *
vn
, 
uio
 *uio)

364 ()
vn
;

365 ()
uio
;

367 
	}
}

374 
	$£mfs_¸ót
(
vnode
 *
dúvn
, c⁄° *
«me
, 
boﬁ
 
ex˛
, 
mode_t
 
mode
,

375 
vnode
 **
ªsu…vn
)

377 
£mfs_vnode
 *
dú£mv
 = 
dúvn
->
vn_d©a
;

378 
£mfs
 *£mf†
dú£mv
->
£mv_£mfs
;

379 
£mfs_dúíåy
 *
dít
;

380 
£mfs_£m
 *
£m
;

381 
i
, 
num
, 
em±y
, 
£mnum
;

382 
ªsu…
;

384 ()
mode
;

385 i‡(!
	`°rcmp
(
«me
, ".") || !strcmp(name, "..")) {

386  
EEXIST
;

389 
	`lock_acquúe
(
£mfs
->
£mfs_dúlock
);

390 
num
 = 
	`£mfs_dúíåy¨øy_num
(
£mfs
->
£mfs_díts
);

391 
em±y
 = 
num
;

392 
i
=0; i<
num
; i++) {

393 
dít
 = 
	`£mfs_dúíåy¨øy_gë
(
£mfs
->
£mfs_díts
, 
i
);

394 i‡(
dít
 =
NULL
) {

395 i‡(
em±y
 =
num
) {

396 
em±y
 = 
i
;

400 i‡(!
	`°rcmp
(
dít
->
£md_«me
, 
«me
)) {

402 i‡(
ex˛
) {

403 
	`lock_ªÀa£
(
£mfs
->
£mfs_dúlock
);

404  
EEXIST
;

406 
ªsu…
 = 
	`£mfs_gëvnode
(
£mfs
, 
dít
->
£md_£mnum
,

407 
ªsu…vn
);

408 
	`lock_ªÀa£
(
£mfs
->
£mfs_dúlock
);

409  
ªsu…
;

414 
£m
 = 
	`£mfs_£m_¸óã
(
«me
);

415 i‡(
£m
 =
NULL
) {

416 
ªsu…
 = 
ENOMEM
;

417 
Áû_u∆ock
;

419 
	`lock_acquúe
(
£mfs
->
£mfs_èbÀlock
);

420 
ªsu…
 = 
	`£mfs_£m_ö£π
(
£mfs
, 
£m
, &
£mnum
);

421 
	`lock_ªÀa£
(
£mfs
->
£mfs_èbÀlock
);

422 i‡(
ªsu…
) {

423 
Áû_un¸óã
;

426 
dít
 = 
	`£mfs_dúíåy_¸óã
(
«me
, 
£mnum
);

427 i‡(
dít
 =
NULL
) {

428 
Áû_unö£π
;

431 i‡(
em±y
 < 
num
) {

432 
	`£mfs_dúíåy¨øy_£t
(
£mfs
->
£mfs_díts
, 
em±y
, 
dít
);

435 
ªsu…
 = 
	`£mfs_dúíåy¨øy_add
(
£mfs
->
£mfs_díts
, 
dít
,

436 &
em±y
);

437 i‡(
ªsu…
) {

438 
Áû_undít
;

442 
ªsu…
 = 
	`£mfs_gëvnode
(
£mfs
, 
£mnum
, 
ªsu…vn
);

443 i‡(
ªsu…
) {

444 
Áû_undú
;

447 
£m
->
£ms_löked
 = 
åue
;

448 
	`lock_ªÀa£
(
£mfs
->
£mfs_dúlock
);

451 
Áû_undú
:

452 
	`£mfs_dúíåy¨øy_£t
(
£mfs
->
£mfs_díts
, 
em±y
, 
NULL
);

453 
Áû_undít
:

454 
	`£mfs_dúíåy_de°roy
(
dít
);

455 
Áû_unö£π
:

456 
	`lock_acquúe
(
£mfs
->
£mfs_èbÀlock
);

457 
	`£mfs_£m¨øy_£t
(
£mfs
->
£mfs_£ms
, 
£mnum
, 
NULL
);

458 
	`lock_ªÀa£
(
£mfs
->
£mfs_èbÀlock
);

459 
Áû_un¸óã
:

460 
	`£mfs_£m_de°roy
(
£m
);

461 
Áû_u∆ock
:

462 
	`lock_ªÀa£
(
£mfs
->
£mfs_dúlock
);

463  
ªsu…
;

464 
	}
}

472 
	$£mfs_ªmove
(
vnode
 *
dúvn
, c⁄° *
«me
)

474 
£mfs_vnode
 *
dú£mv
 = 
dúvn
->
vn_d©a
;

475 
£mfs
 *£mf†
dú£mv
->
£mv_£mfs
;

476 
£mfs_dúíåy
 *
dít
;

477 
£mfs_£m
 *
£m
;

478 
i
, 
num
;

479 
ªsu…
;

481 i‡(!
	`°rcmp
(
«me
, ".") || !strcmp(name, "..")) {

482  
EINVAL
;

485 
	`lock_acquúe
(
£mfs
->
£mfs_dúlock
);

486 
num
 = 
	`£mfs_dúíåy¨øy_num
(
£mfs
->
£mfs_díts
);

487 
i
=0; i<
num
; i++) {

488 
dít
 = 
	`£mfs_dúíåy¨øy_gë
(
£mfs
->
£mfs_díts
, 
i
);

489 i‡(
dít
 =
NULL
) {

492 i‡(!
	`°rcmp
(
«me
, 
dít
->
£md_«me
)) {

494 
£m
 = 
	`£mfs_gë£mbynum
(
£mfs
, 
dít
->
£md_£mnum
);

495 
	`lock_acquúe
(
£m
->
£ms_lock
);

496 
	`KASSERT
(
£m
->
£ms_löked
);

497 
£m
->
£ms_löked
 = 
Ál£
;

498 i‡(
£m
->
£ms_hasvnode
 =
Ál£
) {

499 
	`lock_acquúe
(
£mfs
->
£mfs_èbÀlock
);

500 
	`£mfs_£m¨øy_£t
(
£mfs
->
£mfs_£ms
,

501 
dít
->
£md_£mnum
, 
NULL
);

502 
	`lock_ªÀa£
(
£mfs
->
£mfs_èbÀlock
);

503 
	`lock_ªÀa£
(
£m
->
£ms_lock
);

504 
	`£mfs_£m_de°roy
(
£m
);

507 
	`lock_ªÀa£
(
£m
->
£ms_lock
);

509 
	`£mfs_dúíåy¨øy_£t
(
£mfs
->
£mfs_díts
, 
i
, 
NULL
);

510 
	`£mfs_dúíåy_de°roy
(
dít
);

511 
ªsu…
 = 0;

512 
out
;

515 
ªsu…
 = 
ENOENT
;

516 
out
:

517 
	`lock_ªÀa£
(
£mfs
->
£mfs_dúlock
);

518  
ªsu…
;

519 
	}
}

526 
	$£mfs_lookup
(
vnode
 *
dúvn
, *
∑th
, vnodê**
ªsu…vn
)

528 
£mfs_vnode
 *
dú£mv
 = 
dúvn
->
vn_d©a
;

529 
£mfs
 *£mf†
dú£mv
->
£mv_£mfs
;

530 
£mfs_dúíåy
 *
dít
;

531 
i
, 
num
;

532 
ªsu…
;

534 i‡(!
	`°rcmp
(
∑th
, ".") || !strcmp(path, "..")) {

535 
	`VOP_INCREF
(
dúvn
);

536 *
ªsu…vn
 = 
dúvn
;

540 
	`lock_acquúe
(
£mfs
->
£mfs_dúlock
);

541 
num
 = 
	`£mfs_dúíåy¨øy_num
(
£mfs
->
£mfs_díts
);

542 
i
=0; i<
num
; i++) {

543 
dít
 = 
	`£mfs_dúíåy¨øy_gë
(
£mfs
->
£mfs_díts
, 
i
);

544 i‡(
dít
 =
NULL
) {

547 i‡(!
	`°rcmp
(
∑th
, 
dít
->
£md_«me
)) {

548 
ªsu…
 = 
	`£mfs_gëvnode
(
£mfs
, 
dít
->
£md_£mnum
,

549 
ªsu…vn
);

550 
	`lock_ªÀa£
(
£mfs
->
£mfs_dúlock
);

551  
ªsu…
;

554 
	`lock_ªÀa£
(
£mfs
->
£mfs_dúlock
);

555  
ENOENT
;

556 
	}
}

564 
	$£mfs_look∑ª¡
(
vnode
 *
dúvn
, *
∑th
,

565 
vnode
 **
ªsu…dúvn
, *
«mebuf
, 
size_t
 
bufmax
)

567 i‡(
	`°æí
(
∑th
)+1 > 
bufmax
) {

568  
ENAMETOOLONG
;

570 
	`°r˝y
(
«mebuf
, 
∑th
);

572 
	`VOP_INCREF
(
dúvn
);

573 *
ªsu…dúvn
 = 
dúvn
;

575 
	}
}

585 
	$£mfs_vnode_de°roy
(
£mfs_vnode
 *
£mv
)

587 
	`vnode_˛ónup
(&
£mv
->
£mv_absvn
);

588 
	`k‰ì
(
£mv
);

589 
	}
}

596 
	$£mfs_ª˛aim
(
vnode
 *
vn
)

598 
£mfs_vnode
 *
£mv
 = 
vn
->
vn_d©a
;

599 
£mfs
 *£mf†
£mv
->
£mv_£mfs
;

600 
vnode
 *
vn2
;

601 
£mfs_£m
 *
£m
;

602 
i
, 
num
;

604 
	`lock_acquúe
(
£mfs
->
£mfs_èbÀlock
);

607 
	`•ölock_acquúe
(&
vn
->
vn_cou¡lock
);

608 i‡(
vn
->
vn_ªfcou¡
 > 1) {

610 
vn
->
vn_ªfcou¡
--;

612 
	`•ölock_ªÀa£
(&
vn
->
vn_cou¡lock
);

613 
	`lock_ªÀa£
(
£mfs
->
£mfs_èbÀlock
);

614  
EBUSY
;

617 
	`•ölock_ªÀa£
(&
vn
->
vn_cou¡lock
);

620 
num
 = 
	`vnodóºay_num
(
£mfs
->
£mfs_vnodes
);

621 
i
=0; i<
num
; i++) {

622 
vn2
 = 
	`vnodóºay_gë
(
£mfs
->
£mfs_vnodes
, 
i
);

623 i‡(
vn2
 =
vn
) {

624 
	`vnodóºay_ªmove
(
£mfs
->
£mfs_vnodes
, 
i
);

629 i‡(
£mv
->
£mv_£mnum
 !
SEMFS_ROOTDIR
) {

630 
£m
 = 
	`£mfs_£m¨øy_gë
(
£mfs
->
£mfs_£ms
, 
£mv
->
£mv_£mnum
);

631 
	`KASSERT
(
£m
->
£ms_hasvnode
);

632 
£m
->
£ms_hasvnode
 = 
Ál£
;

633 i‡(
£m
->
£ms_löked
 =
Ál£
) {

634 
	`£mfs_£m¨øy_£t
(
£mfs
->
£mfs_£ms
,

635 
£mv
->
£mv_£mnum
, 
NULL
);

636 
	`£mfs_£m_de°roy
(
£m
);

641 
	`lock_ªÀa£
(
£mfs
->
£mfs_èbÀlock
);

644 
	`£mfs_vnode_de°roy
(
£mv
);

646 
	}
}

651 c⁄° 
vnode_›s
 
	g£mfs_dú›s
 = {

652 .
v›_magic
 = 
VOP_MAGIC
,

654 .
	gv›_óch›í
 = 
£mfs_óch›í
,

655 .
	gv›_ª˛aim
 = 
£mfs_ª˛aim
,

657 .
	gv›_ªad
 = 
v›Áû_uio_isdú
,

658 .
	gv›_ªadlök
 = 
v›Áû_uio_isdú
,

659 .
	gv›_gëdúíåy
 = 
£mfs_gëdúíåy
,

660 .
	gv›_wrôe
 = 
v›Áû_uio_isdú
,

661 .
	gv›_io˘l
 = 
£mfs_io˘l
,

662 .
	gv›_°©
 = 
£mfs_dú°©
,

663 .
	gv›_gëty≥
 = 
£mfs_gëty≥
,

664 .
	gv›_is£ekabÀ
 = 
£mfs_is£ekabÀ
,

665 .
	gv›_fsync
 = 
£mfs_fsync
,

666 .
	gv›_mm≠
 = 
v›Áû_mm≠_isdú
,

667 .
	gv›_åunˇã
 = 
v›Áû_åunˇã_isdú
,

668 .
	gv›_«mefûe
 = 
£mfs_«mefûe
,

670 .
	gv›_¸ót
 = 
£mfs_¸ót
,

671 .
	gv›_symlök
 = 
v›Áû_symlök_nosys
,

672 .
	gv›_mkdú
 = 
v›Áû_mkdú_nosys
,

673 .
	gv›_lök
 = 
v›Áû_lök_nosys
,

674 .
	gv›_ªmove
 = 
£mfs_ªmove
,

675 .
	gv›_rmdú
 = 
v›Áû_°rög_nosys
,

676 .
	gv›_ª«me
 = 
v›Áû_ª«me_nosys
,

677 .
	gv›_lookup
 = 
£mfs_lookup
,

678 .
	gv›_look∑ª¡
 = 
£mfs_look∑ª¡
,

684 c⁄° 
vnode_›s
 
	g£mfs_£m›s
 = {

685 .
v›_magic
 = 
VOP_MAGIC
,

687 .
	gv›_óch›í
 = 
£mfs_óch›í
,

688 .
	gv›_ª˛aim
 = 
£mfs_ª˛aim
,

690 .
	gv›_ªad
 = 
£mfs_ªad
,

691 .
	gv›_ªadlök
 = 
v›Áû_uio_övÆ
,

692 .
	gv›_gëdúíåy
 = 
v›Áû_uio_nŸdú
,

693 .
	gv›_wrôe
 = 
£mfs_wrôe
,

694 .
	gv›_io˘l
 = 
£mfs_io˘l
,

695 .
	gv›_°©
 = 
£mfs_£m°©
,

696 .
	gv›_gëty≥
 = 
£mfs_gëty≥
,

697 .
	gv›_is£ekabÀ
 = 
£mfs_is£ekabÀ
,

698 .
	gv›_fsync
 = 
£mfs_fsync
,

699 .
	gv›_mm≠
 = 
v›Áû_mm≠_≥rm
,

700 .
	gv›_åunˇã
 = 
£mfs_åunˇã
,

701 .
	gv›_«mefûe
 = 
v›Áû_uio_nŸdú
,

703 .
	gv›_¸ót
 = 
v›Áû_¸ót_nŸdú
,

704 .
	gv›_symlök
 = 
v›Áû_symlök_nŸdú
,

705 .
	gv›_mkdú
 = 
v›Áû_mkdú_nŸdú
,

706 .
	gv›_lök
 = 
v›Áû_lök_nŸdú
,

707 .
	gv›_ªmove
 = 
v›Áû_°rög_nŸdú
,

708 .
	gv›_rmdú
 = 
v›Áû_°rög_nŸdú
,

709 .
	gv›_ª«me
 = 
v›Áû_ª«me_nŸdú
,

710 .
	gv›_lookup
 = 
v›Áû_lookup_nŸdú
,

711 .
	gv›_look∑ª¡
 = 
v›Áû_look∑ª¡_nŸdú
,

718 
£mfs_vnode
 *

719 
	$£mfs_vnode_¸óã
(
£mfs
 *£mfs, 
£mnum
)

721 c⁄° 
vnode_›s
 *
›èbÀ
;

722 
£mfs_vnode
 *
£mv
;

723 
ªsu…
;

725 i‡(
£mnum
 =
SEMFS_ROOTDIR
) {

726 
›èbÀ
 = &
£mfs_dú›s
;

729 
›èbÀ
 = &
£mfs_£m›s
;

732 
£mv
 = 
	`kmÆloc
((*semv));

733 i‡(
£mv
 =
NULL
) {

734  
NULL
;

737 
£mv
->
£mv_£mfs
 = 
£mfs
;

738 
£mv
->
£mv_£mnum
 = 
£mnum
;

740 
ªsu…
 = 
	`vnode_öô
(&
£mv
->
£mv_absvn
, 
›èbÀ
,

741 &
£mfs
->
£mfs_absfs
, 
£mv
);

743 
	`KASSERT
(
ªsu…
 == 0);

745  
£mv
;

746 
	}
}

753 
	$£mfs_gëvnode
(
£mfs
 *£mfs, 
£mnum
, 
vnode
 **
ªt
)

755 
vnode
 *
vn
;

756 
£mfs_vnode
 *
£mv
;

757 
£mfs_£m
 *
£m
;

758 
i
, 
num
;

759 
ªsu…
;

762 
	`lock_acquúe
(
£mfs
->
£mfs_èbÀlock
);

765 
num
 = 
	`vnodóºay_num
(
£mfs
->
£mfs_vnodes
);

766 
i
=0; i<
num
; i++) {

767 
vn
 = 
	`vnodóºay_gë
(
£mfs
->
£mfs_vnodes
, 
i
);

768 
£mv
 = 
vn
->
vn_d©a
;

769 i‡(
£mv
->
£mv_£mnum
 =
£mnum
) {

770 
	`VOP_INCREF
(
vn
);

771 
	`lock_ªÀa£
(
£mfs
->
£mfs_èbÀlock
);

772 *
ªt
 = 
vn
;

778 
£mv
 = 
	`£mfs_vnode_¸óã
(
£mfs
, 
£mnum
);

779 i‡(
£mv
 =
NULL
) {

780 
	`lock_ªÀa£
(
£mfs
->
£mfs_èbÀlock
);

781  
ENOMEM
;

783 
ªsu…
 = 
	`vnodóºay_add
(
£mfs
->
£mfs_vnodes
, &
£mv
->
£mv_absvn
, 
NULL
);

784 i‡(
ªsu…
) {

785 
	`£mfs_vnode_de°roy
(
£mv
);

786 
	`lock_ªÀa£
(
£mfs
->
£mfs_èbÀlock
);

787  
ENOMEM
;

789 i‡(
£mnum
 !
SEMFS_ROOTDIR
) {

790 
£m
 = 
	`£mfs_£m¨øy_gë
(
£mfs
->
£mfs_£ms
, 
£mnum
);

791 
	`KASSERT
(
£m
 !
NULL
);

792 
	`KASSERT
(
£m
->
£ms_hasvnode
 =
Ál£
);

793 
£m
->
£ms_hasvnode
 = 
åue
;

795 
	`lock_ªÀa£
(
£mfs
->
£mfs_èbÀlock
);

797 *
ªt
 = &
£mv
->
£mv_absvn
;

799 
	}
}

	@/home/trinity/src/kern/fs/sfs/sfs_balloc.c

35 
	~<ty≥s.h
>

36 
	~<lib.h
>

37 
	~<bôm≠.h
>

38 
	~<sfs.h
>

39 
	~"sf•riv©e.h
"

46 
	$sfs_˛órblock
(
sfs_fs
 *
sfs
, 
daddr_t
 
block
)

49 
zîos
[
SFS_BLOCKSIZE
];

51  
	`sfs_wrôeblock
(
sfs
, 
block
, 
zîos
, 
SFS_BLOCKSIZE
);

52 
	}
}

58 
	$sfs_bÆloc
(
sfs_fs
 *
sfs
, 
daddr_t
 *
diskblock
)

60 
ªsu…
;

62 
ªsu…
 = 
	`bôm≠_Æloc
(
sfs
->
sfs_‰ìm≠
, 
diskblock
);

63 i‡(
ªsu…
) {

64  
ªsu…
;

66 
sfs
->
sfs_‰ìm≠dúty
 = 
åue
;

68 i‡(*
diskblock
 >
sfs
->
sfs_sb
.
sb_nblocks
) {

69 
	`∑nic
("sfs: %s: balloc: invalid block %u\n",

70 
sfs
->
sfs_sb
.
sb_vﬁ«me
, *
diskblock
);

74 
ªsu…
 = 
	`sfs_˛órblock
(
sfs
, *
diskblock
);

75 i‡(
ªsu…
) {

76 
	`bôm≠_unm¨k
(
sfs
->
sfs_‰ìm≠
, *
diskblock
);

78  
ªsu…
;

79 
	}
}

85 
	$sfs_b‰ì
(
sfs_fs
 *
sfs
, 
daddr_t
 
diskblock
)

87 
	`bôm≠_unm¨k
(
sfs
->
sfs_‰ìm≠
, 
diskblock
);

88 
sfs
->
sfs_‰ìm≠dúty
 = 
åue
;

89 
	}
}

95 
	$sfs_bu£d
(
sfs_fs
 *
sfs
, 
daddr_t
 
diskblock
)

97 i‡(
diskblock
 >
sfs
->
sfs_sb
.
sb_nblocks
) {

98 
	`∑nic
("sfs: %s: sfs_bused called on out ofÑange block %u\n",

99 
sfs
->
sfs_sb
.
sb_vﬁ«me
, 
diskblock
);

101  
	`bôm≠_is£t
(
sfs
->
sfs_‰ìm≠
, 
diskblock
);

102 
	}
}

	@/home/trinity/src/kern/fs/sfs/sfs_bmap.c

35 
	~<ty≥s.h
>

36 
	~<kîn/î∫o.h
>

37 
	~<lib.h
>

38 
	~<vfs.h
>

39 
	~<sfs.h
>

40 
	~"sf•riv©e.h
"

49 
	$sfs_bm≠
(
sfs_vnode
 *
sv
, 
uöt32_t
 
fûeblock
, 
boﬁ
 
dﬂŒoc
,

50 
daddr_t
 *
diskblock
)

59 
uöt32_t
 
idbuf
[
SFS_DBPERIDB
];

61 
sfs_fs
 *
sfs
 = 
sv
->
sv_absvn
.
vn_fs
->
fs_d©a
;

62 
daddr_t
 
block
;

63 
daddr_t
 
idblock
;

64 
uöt32_t
 
idnum
, 
idoff
;

65 
ªsu…
;

67 
	`KASSERT
((
idbuf
)==
SFS_BLOCKSIZE
);

70 
	`KASSERT
(
	`vfs_biglock_do_i_hﬁd
());

75 i‡(
fûeblock
 < 
SFS_NDIRECT
) {

79 
block
 = 
sv
->
sv_i
.
sfi_dúe˘
[
fûeblock
];

84 i‡(
block
==0 && 
dﬂŒoc
) {

85 
ªsu…
 = 
	`sfs_bÆloc
(
sfs
, &
block
);

86 i‡(
ªsu…
) {

87  
ªsu…
;

91 
sv
->
sv_i
.
sfi_dúe˘
[
fûeblock
] = 
block
;

92 
sv
->
sv_dúty
 = 
åue
;

98 i‡(
block
 !0 && !
	`sfs_bu£d
(
sfs
, block)) {

99 
	`∑nic
("sfs: %s: Data block %u (block %u of file %u) "

100 "m¨ked fªe\n", 
sfs
->
sfs_sb
.
sb_vﬁ«me
,

101 
block
, 
fûeblock
, 
sv
->
sv_öo
);

103 *
diskblock
 = 
block
;

113 
fûeblock
 -
SFS_NDIRECT
;

116 
idnum
 = 
fûeblock
 / 
SFS_DBPERIDB
;

117 
idoff
 = 
fûeblock
 % 
SFS_DBPERIDB
;

123 i‡(
idnum
 >
SFS_NINDIRECT
) {

124  
EFBIG
;

128 
idblock
 = 
sv
->
sv_i
.
sfi_ödúe˘
;

130 i‡(
idblock
==0 && !
dﬂŒoc
) {

136 *
diskblock
 = 0;

139 i‡(
idblock
==0) {

146 
ªsu…
 = 
	`sfs_bÆloc
(
sfs
, &
idblock
);

147 i‡(
ªsu…
) {

148  
ªsu…
;

152 
sv
->
sv_i
.
sfi_ödúe˘
 = 
idblock
;

155 
sv
->
sv_dúty
 = 
åue
;

158 
	`bzîo
(
idbuf
, (idbuf));

164 
ªsu…
 = 
	`sfs_ªadblock
(
sfs
, 
idblock
, 
idbuf
, (idbuf));

165 i‡(
ªsu…
) {

166  
ªsu…
;

171 
block
 = 
idbuf
[
idoff
];

174 i‡(
block
==0 && 
dﬂŒoc
) {

175 
ªsu…
 = 
	`sfs_bÆloc
(
sfs
, &
block
);

176 i‡(
ªsu…
) {

177  
ªsu…
;

181 
idbuf
[
idoff
] = 
block
;

184 
ªsu…
 = 
	`sfs_wrôeblock
(
sfs
, 
idblock
, 
idbuf
, (idbuf));

185 i‡(
ªsu…
) {

186  
ªsu…
;

191 i‡(
block
 !0 && !
	`sfs_bu£d
(
sfs
, block)) {

192 
	`∑nic
("sfs: %s: Data block %u (block %u of file %u) "

193 "m¨ked fªe\n", 
sfs
->
sfs_sb
.
sb_vﬁ«me
,

194 
block
, 
fûeblock
, 
sv
->
sv_öo
);

196 *
diskblock
 = 
block
;

198 
	}
}

204 
	$sfs_ôrunc
(
sfs_vnode
 *
sv
, 
off_t
 
Àn
)

213 
uöt32_t
 
idbuf
[
SFS_DBPERIDB
];

215 
sfs_fs
 *
sfs
 = 
sv
->
sv_absvn
.
vn_fs
->
fs_d©a
;

218 
uöt32_t
 
blockÀn
 = 
	`DIVROUNDUP
(
Àn
, 
SFS_BLOCKSIZE
);

220 
uöt32_t
 
i
, 
j
;

221 
daddr_t
 
block
, 
idblock
;

222 
uöt32_t
 
ba£block
, 
highblock
;

223 
ªsu…
;

224 
ha¢⁄zîo
, 
iddúty
;

226 
	`KASSERT
((
idbuf
)==
SFS_BLOCKSIZE
);

228 
	`vfs_biglock_acquúe
();

234 
i
=0; i<
SFS_NDIRECT
; i++) {

235 
block
 = 
sv
->
sv_i
.
sfi_dúe˘
[
i
];

236 i‡(
i
 >
blockÀn
 && 
block
 != 0) {

237 
	`sfs_b‰ì
(
sfs
, 
block
);

238 
sv
->
sv_i
.
sfi_dúe˘
[
i
] = 0;

239 
sv
->
sv_dúty
 = 
åue
;

244 
idblock
 = 
sv
->
sv_i
.
sfi_ödúe˘
;

247 
ba£block
 = 
SFS_NDIRECT
;

250 
highblock
 = 
ba£block
 + 
SFS_DBPERIDB
 - 1;

252 i‡(
blockÀn
 < 
highblock
 && 
idblock
 != 0) {

256 
ªsu…
 = 
	`sfs_ªadblock
(
sfs
, 
idblock
, 
idbuf
, (idbuf));

257 i‡(
ªsu…
) {

258 
	`vfs_biglock_ªÀa£
();

259  
ªsu…
;

262 
ha¢⁄zîo
 = 0;

263 
iddúty
 = 0;

264 
j
=0; j<
SFS_DBPERIDB
; j++) {

266 i‡(
blockÀn
 < 
ba£block
+
j
 && 
idbuf
[j] != 0) {

267 
	`sfs_b‰ì
(
sfs
, 
idbuf
[
j
]);

268 
idbuf
[
j
] = 0;

269 
iddúty
 = 1;

272 i‡(
idbuf
[
j
]!=0) {

273 
ha¢⁄zîo
=1;

277 i‡(!
ha¢⁄zîo
) {

279 
	`sfs_b‰ì
(
sfs
, 
idblock
);

280 
sv
->
sv_i
.
sfi_ödúe˘
 = 0;

281 
sv
->
sv_dúty
 = 
åue
;

283 i‡(
iddúty
) {

285 
ªsu…
 = 
	`sfs_wrôeblock
(
sfs
, 
idblock
, 
idbuf
,

286 (
idbuf
));

287 i‡(
ªsu…
) {

288 
	`vfs_biglock_ªÀa£
();

289  
ªsu…
;

295 
sv
->
sv_i
.
sfi_size
 = 
Àn
;

298 
sv
->
sv_dúty
 = 
åue
;

300 
	`vfs_biglock_ªÀa£
();

302 
	}
}

	@/home/trinity/src/kern/fs/sfs/sfs_dir.c

35 
	~<ty≥s.h
>

36 
	~<kîn/î∫o.h
>

37 
	~<lib.h
>

38 
	~<vfs.h
>

39 
	~<sfs.h
>

40 
	~"sf•riv©e.h
"

48 
	$sfs_ªaddú
(
sfs_vnode
 *
sv
, 
¶Ÿ
, 
sfs_dúíåy
 *
sd
)

50 
off_t
 
a˘uÆpos
;

53 
a˘uÆpos
 = 
¶Ÿ
 * (
sfs_dúíåy
);

55  
	`sfs_mëaio
(
sv
, 
a˘uÆpos
, 
sd
, (*sd), 
UIO_READ
);

56 
	}
}

64 
	$sfs_wrôedú
(
sfs_vnode
 *
sv
, 
¶Ÿ
, 
sfs_dúíåy
 *
sd
)

66 
off_t
 
a˘uÆpos
;

69 
	`KASSERT
(
¶Ÿ
>=0);

70 
a˘uÆpos
 = 
¶Ÿ
 * (
sfs_dúíåy
);

72  
	`sfs_mëaio
(
sv
, 
a˘uÆpos
, 
sd
, (*sd), 
UIO_WRITE
);

73 
	}
}

82 
	$sfs_dú_√¡rõs
(
sfs_vnode
 *
sv
)

84 
sfs_fs
 *
sfs
 = 
sv
->
sv_absvn
.
vn_fs
->
fs_d©a
;

85 
off_t
 
size
;

87 
	`KASSERT
(
sv
->
sv_i
.
sfi_ty≥
 =
SFS_TYPE_DIR
);

89 
size
 = 
sv
->
sv_i
.
sfi_size
;

90 i‡(
size
 % (
sfs_dúíåy
) != 0) {

91 
	`∑nic
("sfs: %s: directory %u: Invalid size %llu\n",

92 
sfs
->
sfs_sb
.
sb_vﬁ«me
, 
sv
->
sv_öo
, 
size
);

95  
size
 / (
sfs_dúíåy
);

96 
	}
}

104 
	$sfs_dú_föd«me
(
sfs_vnode
 *
sv
, c⁄° *
«me
,

105 
uöt32_t
 *
öo
, *
¶Ÿ
, *
em±y¶Ÿ
)

107 
sfs_dúíåy
 
tsd
;

108 
found
, 
√¡rõs
, 
i
, 
ªsu…
;

110 
√¡rõs
 = 
	`sfs_dú_√¡rõs
(
sv
);

113 
found
 = 0;

114 
i
=0; i<
√¡rõs
; i++) {

117 
ªsu…
 = 
	`sfs_ªaddú
(
sv
, 
i
, &
tsd
);

118 i‡(
ªsu…
) {

119  
ªsu…
;

121 i‡(
tsd
.
sfd_öo
 =
SFS_NOINO
) {

123 i‡(
em±y¶Ÿ
 !
NULL
) {

124 *
em±y¶Ÿ
 = 
i
;

129 
tsd
.
sfd_«me
[(tsd.sfd_name)-1] = 0;

130 i‡(!
	`°rcmp
(
tsd
.
sfd_«me
, 
«me
)) {

133 
	`KASSERT
(
found
==0);

135 
found
 = 1;

136 i‡(
¶Ÿ
 !
NULL
) {

137 *
¶Ÿ
 = 
i
;

139 i‡(
öo
 !
NULL
) {

140 *
öo
 = 
tsd
.
sfd_öo
;

146  
found
 ? 0 : 
ENOENT
;

147 
	}
}

154 
	$sfs_dú_lök
(
sfs_vnode
 *
sv
, c⁄° *
«me
, 
uöt32_t
 
öo
, *
¶Ÿ
)

156 
em±y¶Ÿ
 = -1;

157 
ªsu…
;

158 
sfs_dúíåy
 
sd
;

161 
ªsu…
 = 
	`sfs_dú_föd«me
(
sv
, 
«me
, 
NULL
, NULL, &
em±y¶Ÿ
);

162 i‡(
ªsu…
!=0 &&Ñesu…!=
ENOENT
) {

163  
ªsu…
;

165 i‡(
ªsu…
==0) {

166  
EEXIST
;

169 i‡(
	`°æí
(
«me
)+1 > (
sd
.
sfd_«me
)) {

170  
ENAMETOOLONG
;

174 i‡(
em±y¶Ÿ
 < 0) {

175 
em±y¶Ÿ
 = 
	`sfs_dú_√¡rõs
(
sv
);

179 
	`bzîo
(&
sd
, (sd));

180 
sd
.
sfd_öo
 = 
öo
;

181 
	`°r˝y
(
sd
.
sfd_«me
, 
«me
);

184 i‡(
¶Ÿ
) {

185 *
¶Ÿ
 = 
em±y¶Ÿ
;

189  
	`sfs_wrôedú
(
sv
, 
em±y¶Ÿ
, &
sd
);

190 
	}
}

196 
	$sfs_dú_u∆ök
(
sfs_vnode
 *
sv
, 
¶Ÿ
)

198 
sfs_dúíåy
 
sd
;

201 
	`bzîo
(&
sd
, (sd));

202 
sd
.
sfd_öo
 = 
SFS_NOINO
;

205  
	`sfs_wrôedú
(
sv
, 
¶Ÿ
, &
sd
);

206 
	}
}

213 
	$sfs_look⁄˚
(
sfs_vnode
 *
sv
, c⁄° *
«me
,

214 
sfs_vnode
 **
ªt
,

215 *
¶Ÿ
)

217 
sfs_fs
 *
sfs
 = 
sv
->
sv_absvn
.
vn_fs
->
fs_d©a
;

218 
uöt32_t
 
öo
;

219 
ªsu…
;

221 
ªsu…
 = 
	`sfs_dú_föd«me
(
sv
, 
«me
, &
öo
, 
¶Ÿ
, 
NULL
);

222 i‡(
ªsu…
) {

223  
ªsu…
;

226 
ªsu…
 = 
	`sfs_lﬂdvnode
(
sfs
, 
öo
, 
SFS_TYPE_INVAL
, 
ªt
);

227 i‡(
ªsu…
) {

228  
ªsu…
;

231 i‡((*
ªt
)->
sv_i
.
sfi_lökcou¡
 == 0) {

232 
	`∑nic
("sfs: %s:Çame %s (inode %u) in dir %u has "

233 "lökcou¡ 0\n", 
sfs
->
sfs_sb
.
sb_vﬁ«me
,

234 
«me
, (*
ªt
)->
sv_öo
, 
sv
->sv_ino);

238 
	}
}

	@/home/trinity/src/kern/fs/sfs/sfs_fsops.c

36 
	~<ty≥s.h
>

37 
	~<kîn/î∫o.h
>

38 
	~<lib.h
>

39 
	~<¨øy.h
>

40 
	~<bôm≠.h
>

41 
	~<uio.h
>

42 
	~<vfs.h
>

43 
	~<devi˚.h
>

44 
	~<sfs.h
>

45 
	~"sf•riv©e.h
"

49 
	#SFS_FS_NBLOCKS
(
sfs
Ë((sfs)->
sfs_sb
.
sb_nblocks
)

	)

50 
	#SFS_FS_FREEMAPBITS
(
sfs
Ë
	`SFS_FREEMAPBITS
(
	`SFS_FS_NBLOCKS
(sfs))

	)

51 
	#SFS_FS_FREEMAPBLOCKS
(
sfs
Ë
	`SFS_FREEMAPBLOCKS
(
	`SFS_FS_NBLOCKS
(sfs))

	)

72 
	$sfs_‰ìm≠io
(
sfs_fs
 *
sfs
, 
uio_rw
 
rw
)

74 
uöt32_t
 
j
, 
‰ìm≠blocks
;

75 *
‰ìm≠d©a
;

76 
ªsu…
;

79 
‰ìm≠blocks
 = 
	`SFS_FS_FREEMAPBLOCKS
(
sfs
);

82 
‰ìm≠d©a
 = 
	`bôm≠_gëd©a
(
sfs
->
sfs_‰ìm≠
);

85 
j
=0; j<
‰ìm≠blocks
; j++) {

88 *
±r
 = 
‰ìm≠d©a
 + 
j
*
SFS_BLOCKSIZE
;

91 i‡(
rw
 =
UIO_READ
) {

92 
ªsu…
 = 
	`sfs_ªadblock
(
sfs
, 
SFS_FREEMAP_START
+
j
, 
±r
,

93 
SFS_BLOCKSIZE
);

96 
ªsu…
 = 
	`sfs_wrôeblock
(
sfs
, 
SFS_FREEMAP_START
+
j
, 
±r
,

97 
SFS_BLOCKSIZE
);

101 i‡(
ªsu…
) {

102  
ªsu…
;

106 
	}
}

113 
	$sfs_sync_vnodes
(
sfs_fs
 *
sfs
)

115 
i
, 
num
;

118 
num
 = 
	`vnodóºay_num
(
sfs
->
sfs_vnodes
);

119 
i
=0; i<
num
; i++) {

120 
vnode
 *
v
 = 
	`vnodóºay_gë
(
sfs
->
sfs_vnodes
, 
i
);

121 
	`VOP_FSYNC
(
v
);

124 
	}
}

131 
	$sfs_sync_‰ìm≠
(
sfs_fs
 *
sfs
)

133 
ªsu…
;

135 i‡(
sfs
->
sfs_‰ìm≠dúty
) {

136 
ªsu…
 = 
	`sfs_‰ìm≠io
(
sfs
, 
UIO_WRITE
);

137 i‡(
ªsu…
) {

138  
ªsu…
;

140 
sfs
->
sfs_‰ìm≠dúty
 = 
Ál£
;

144 
	}
}

151 
	$sfs_sync_su≥rblock
(
sfs_fs
 *
sfs
)

153 
ªsu…
;

155 i‡(
sfs
->
sfs_su≥rdúty
) {

156 
ªsu…
 = 
	`sfs_wrôeblock
(
sfs
, 
SFS_SUPER_BLOCK
, &sfs->
sfs_sb
,

157 (
sfs
->
sfs_sb
));

158 i‡(
ªsu…
) {

159  
ªsu…
;

161 
sfs
->
sfs_su≥rdúty
 = 
Ál£
;

164 
	}
}

172 
	$sfs_sync
(
fs
 *fs)

174 
sfs_fs
 *
sfs
;

175 
ªsu…
;

177 
	`vfs_biglock_acquúe
();

209 
sfs
 = 
fs
->
fs_d©a
;

212 
ªsu…
 = 
	`sfs_sync_vnodes
(
sfs
);

213 i‡(
ªsu…
) {

214 
	`vfs_biglock_ªÀa£
();

215  
ªsu…
;

219 
ªsu…
 = 
	`sfs_sync_‰ìm≠
(
sfs
);

220 i‡(
ªsu…
) {

221 
	`vfs_biglock_ªÀa£
();

222  
ªsu…
;

226 
ªsu…
 = 
	`sfs_sync_su≥rblock
(
sfs
);

227 i‡(
ªsu…
) {

228 
	`vfs_biglock_ªÀa£
();

229  
ªsu…
;

232 
	`vfs_biglock_ªÀa£
();

234 
	}
}

243 
	$sfs_gëvﬁ«me
(
fs
 *fs)

245 
sfs_fs
 *
sfs
 = 
fs
->
fs_d©a
;

246 c⁄° *
ªt
;

248 
	`vfs_biglock_acquúe
();

249 
ªt
 = 
sfs
->
sfs_sb
.
sb_vﬁ«me
;

250 
	`vfs_biglock_ªÀa£
();

252  
ªt
;

253 
	}
}

260 
	$sfs_fs_de°roy
(
sfs_fs
 *
sfs
)

262 i‡(
sfs
->
sfs_‰ìm≠
 !
NULL
) {

263 
	`bôm≠_de°roy
(
sfs
->
sfs_‰ìm≠
);

265 
	`vnodóºay_de°roy
(
sfs
->
sfs_vnodes
);

266 
	`KASSERT
(
sfs
->
sfs_devi˚
 =
NULL
);

267 
	`k‰ì
(
sfs
);

268 
	}
}

277 
	$sfs_unmou¡
(
fs
 *fs)

279 
sfs_fs
 *
sfs
 = 
fs
->
fs_d©a
;

281 
	`vfs_biglock_acquúe
();

284 i‡(
	`vnodóºay_num
(
sfs
->
sfs_vnodes
) > 0) {

285 
	`vfs_biglock_ªÀa£
();

286  
EBUSY
;

290 
	`KASSERT
(
sfs
->
sfs_su≥rdúty
 =
Ál£
);

291 
	`KASSERT
(
sfs
->
sfs_‰ìm≠dúty
 =
Ál£
);

294 
sfs
->
sfs_devi˚
 = 
NULL
;

297 
	`sfs_fs_de°roy
(
sfs
);

300 
	`vfs_biglock_ªÀa£
();

302 
	}
}

307 c⁄° 
fs_›s
 
	gsfs_fs›s
 = {

308 .
fs›_sync
 = 
sfs_sync
,

309 .
	gfs›_gëvﬁ«me
 = 
sfs_gëvﬁ«me
,

310 .
	gfs›_gëroŸ
 = 
sfs_gëroŸ
,

311 .
	gfs›_unmou¡
 = 
sfs_unmou¡
,

320 
sfs_fs
 *

321 
	$sfs_fs_¸óã
()

323 
sfs_fs
 *
sfs
;

328 
	`COMPILE_ASSERT
((
sfs_su≥rblock
)==
SFS_BLOCKSIZE
);

329 
	`COMPILE_ASSERT
((
sfs_döode
)==
SFS_BLOCKSIZE
);

330 
	`COMPILE_ASSERT
(
SFS_BLOCKSIZE
 % (
sfs_dúíåy
) == 0);

333 
sfs
 = 
	`kmÆloc
((
sfs_fs
));

334 i‡(
sfs
==
NULL
) {

335 
Áû
;

343 
sfs
->
sfs_absfs
.
fs_d©a
 = sfs;

344 
sfs
->
sfs_absfs
.
fs_›s
 = &
sfs_fs›s
;

348 
sfs
->
sfs_su≥rdúty
 = 
Ál£
;

351 
sfs
->
sfs_devi˚
 = 
NULL
;

354 
sfs
->
sfs_vnodes
 = 
	`vnodóºay_¸óã
();

355 i‡(
sfs
->
sfs_vnodes
 =
NULL
) {

356 
˛ónup_obje˘
;

360 
sfs
->
sfs_‰ìm≠
 = 
NULL
;

361 
sfs
->
sfs_‰ìm≠dúty
 = 
Ál£
;

363  
sfs
;

365 
˛ónup_obje˘
:

366 
	`k‰ì
(
sfs
);

367 
Áû
:

368  
NULL
;

369 
	}
}

386 
	$sfs_domou¡
(*
›ti⁄s
, 
devi˚
 *
dev
, 
fs
 **
ªt
)

388 
ªsu…
;

389 
sfs_fs
 *
sfs
;

391 
	`vfs_biglock_acquúe
();

394 ()
›ti⁄s
;

404 i‡(
dev
->
d_blocksize
 !
SFS_BLOCKSIZE
) {

405 
	`vfs_biglock_ªÀa£
();

406 
	`k¥ötf
("sfs: Cannot mount on device with blocksize %zu\n",

407 
dev
->
d_blocksize
);

408  
ENXIO
;

411 
sfs
 = 
	`sfs_fs_¸óã
();

412 i‡(
sfs
 =
NULL
) {

413 
	`vfs_biglock_ªÀa£
();

414  
ENOMEM
;

418 
sfs
->
sfs_devi˚
 = 
dev
;

421 
ªsu…
 = 
	`sfs_ªadblock
(
sfs
, 
SFS_SUPER_BLOCK
, &sfs->
sfs_sb
,

422 (
sfs
->
sfs_sb
));

423 i‡(
ªsu…
) {

424 
sfs
->
sfs_devi˚
 = 
NULL
;

425 
	`sfs_fs_de°roy
(
sfs
);

426 
	`vfs_biglock_ªÀa£
();

427  
ªsu…
;

432 i‡(
sfs
->
sfs_sb
.
sb_magic
 !
SFS_MAGIC
) {

433 
	`k¥ötf
("sfs: Wrong magicÇumber in superblock "

435 
sfs
->
sfs_sb
.
sb_magic
,

436 
SFS_MAGIC
);

437 
sfs
->
sfs_devi˚
 = 
NULL
;

438 
	`sfs_fs_de°roy
(
sfs
);

439 
	`vfs_biglock_ªÀa£
();

440  
EINVAL
;

443 i‡(
sfs
->
sfs_sb
.
sb_nblocks
 > 
dev
->
d_blocks
) {

444 
	`k¥ötf
("sfs: warning - fs has %u blocks, device has %u\n",

445 
sfs
->
sfs_sb
.
sb_nblocks
, 
dev
->
d_blocks
);

449 
sfs
->
sfs_sb
.
sb_vﬁ«me
[(sfs->sfs_sb.sb_volname)-1] = 0;

452 
sfs
->
sfs_‰ìm≠
 = 
	`bôm≠_¸óã
(
	`SFS_FS_FREEMAPBITS
(sfs));

453 i‡(
sfs
->
sfs_‰ìm≠
 =
NULL
) {

454 
sfs
->
sfs_devi˚
 = 
NULL
;

455 
	`sfs_fs_de°roy
(
sfs
);

456 
	`vfs_biglock_ªÀa£
();

457  
ENOMEM
;

459 
ªsu…
 = 
	`sfs_‰ìm≠io
(
sfs
, 
UIO_READ
);

460 i‡(
ªsu…
) {

461 
sfs
->
sfs_devi˚
 = 
NULL
;

462 
	`sfs_fs_de°roy
(
sfs
);

463 
	`vfs_biglock_ªÀa£
();

464  
ªsu…
;

468 *
ªt
 = &
sfs
->
sfs_absfs
;

470 
	`vfs_biglock_ªÀa£
();

472 
	}
}

478 
	$sfs_mou¡
(c⁄° *
devi˚
)

480  
	`vfs_mou¡
(
devi˚
, 
NULL
, 
sfs_domou¡
);

481 
	}
}

	@/home/trinity/src/kern/fs/sfs/sfs_inode.c

35 
	~<ty≥s.h
>

36 
	~<kîn/î∫o.h
>

37 
	~<lib.h
>

38 
	~<vfs.h
>

39 
	~<sfs.h
>

40 
	~"sf•riv©e.h
"

47 
	$sfs_sync_öode
(
sfs_vnode
 *
sv
)

49 
sfs_fs
 *
sfs
 = 
sv
->
sv_absvn
.
vn_fs
->
fs_d©a
;

50 
ªsu…
;

52 i‡(
sv
->
sv_dúty
) {

53 
ªsu…
 = 
	`sfs_wrôeblock
(
sfs
, 
sv
->
sv_öo
, &sv->
sv_i
,

54 (
sv
->
sv_i
));

55 i‡(
ªsu…
) {

56  
ªsu…
;

58 
sv
->
sv_dúty
 = 
Ál£
;

61 
	}
}

69 
	$sfs_ª˛aim
(
vnode
 *
v
)

71 
sfs_vnode
 *
sv
 = 
v
->
vn_d©a
;

72 
sfs_fs
 *
sfs
 = 
v
->
vn_fs
->
fs_d©a
;

73 
ix
, 
i
, 
num
;

74 
ªsu…
;

76 
	`vfs_biglock_acquúe
();

83 
	`•ölock_acquúe
(&
v
->
vn_cou¡lock
);

84 i‡(
v
->
vn_ªfcou¡
 != 1) {

87 
	`KASSERT
(
v
->
vn_ªfcou¡
>1);

88 
v
->
vn_ªfcou¡
--;

90 
	`•ölock_ªÀa£
(&
v
->
vn_cou¡lock
);

91 
	`vfs_biglock_ªÀa£
();

92  
EBUSY
;

94 
	`•ölock_ªÀa£
(&
v
->
vn_cou¡lock
);

97 i‡(
sv
->
sv_i
.
sfi_lökcou¡
 == 0) {

98 
ªsu…
 = 
	`sfs_ôrunc
(
sv
, 0);

99 i‡(
ªsu…
) {

100 
	`vfs_biglock_ªÀa£
();

101  
ªsu…
;

106 
ªsu…
 = 
	`sfs_sync_öode
(
sv
);

107 i‡(
ªsu…
) {

108 
	`vfs_biglock_ªÀa£
();

109  
ªsu…
;

113 i‡(
sv
->
sv_i
.
sfi_lökcou¡
==0) {

114 
	`sfs_b‰ì
(
sfs
, 
sv
->
sv_öo
);

118 
num
 = 
	`vnodóºay_num
(
sfs
->
sfs_vnodes
);

119 
ix
 = 
num
;

120 
i
=0; i<
num
; i++) {

121 
vnode
 *
v2
 = 
	`vnodóºay_gë
(
sfs
->
sfs_vnodes
, 
i
);

122 
sfs_vnode
 *
sv2
 = 
v2
->
vn_d©a
;

123 i‡(
sv2
 =
sv
) {

124 
ix
 = 
i
;

128 i‡(
ix
 =
num
) {

129 
	`∑nic
("sfs: %s:Ñeclaim vnode %uÇot in vnodeÖool\n",

130 
sfs
->
sfs_sb
.
sb_vﬁ«me
, 
sv
->
sv_öo
);

132 
	`vnodóºay_ªmove
(
sfs
->
sfs_vnodes
, 
ix
);

134 
	`vnode_˛ónup
(&
sv
->
sv_absvn
);

136 
	`vfs_biglock_ªÀa£
();

139 
	`k‰ì
(
sv
);

143 
	}
}

150 
	$sfs_lﬂdvnode
(
sfs_fs
 *
sfs
, 
uöt32_t
 
öo
, 
f‹˚ty≥
,

151 
sfs_vnode
 **
ªt
)

153 
vnode
 *
v
;

154 
sfs_vnode
 *
sv
;

155 c⁄° 
vnode_›s
 *
›s
;

156 
i
, 
num
;

157 
ªsu…
;

160 
num
 = 
	`vnodóºay_num
(
sfs
->
sfs_vnodes
);

163 
i
=0; i<
num
; i++) {

164 
v
 = 
	`vnodóºay_gë
(
sfs
->
sfs_vnodes
, 
i
);

165 
sv
 = 
v
->
vn_d©a
;

168 i‡(!
	`sfs_bu£d
(
sfs
, 
sv
->
sv_öo
)) {

169 
	`∑nic
("sfs: %s: Found inode %u in unallocated block\n",

170 
sfs
->
sfs_sb
.
sb_vﬁ«me
, 
sv
->
sv_öo
);

173 i‡(
sv
->
sv_öo
==
öo
) {

177 
	`KASSERT
(
f‹˚ty≥
==
SFS_TYPE_INVAL
);

179 
	`VOP_INCREF
(&
sv
->
sv_absvn
);

180 *
ªt
 = 
sv
;

187 
sv
 = 
	`kmÆloc
((
sfs_vnode
));

188 i‡(
sv
==
NULL
) {

189  
ENOMEM
;

193 i‡(!
	`sfs_bu£d
(
sfs
, 
öo
)) {

194 
	`∑nic
("sfs: %s: TriedÅoÜoad inode %u from "

195 "u«Œoˇãd block\n", 
sfs
->
sfs_sb
.
sb_vﬁ«me
, 
öo
);

199 
ªsu…
 = 
	`sfs_ªadblock
(
sfs
, 
öo
, &
sv
->
sv_i
, (sv->sv_i));

200 i‡(
ªsu…
) {

201 
	`k‰ì
(
sv
);

202  
ªsu…
;

206 
sv
->
sv_dúty
 = 
Ál£
;

213 i‡(
f‹˚ty≥
 !
SFS_TYPE_INVAL
) {

214 
	`KASSERT
(
sv
->
sv_i
.
sfi_ty≥
 =
SFS_TYPE_INVAL
);

215 
sv
->
sv_i
.
sfi_ty≥
 = 
f‹˚ty≥
;

216 
sv
->
sv_dúty
 = 
åue
;

222 
sv
->
sv_i
.
sfi_ty≥
) {

223 
SFS_TYPE_FILE
:

224 
›s
 = &
sfs_fûe›s
;

226 
SFS_TYPE_DIR
:

227 
›s
 = &
sfs_dú›s
;

230 
	`∑nic
("sfs: %s:Üoadvnode: Invalid inodeÅype "

231 "(öodê%u,Åy≥ %u)\n", 
sfs
->
sfs_sb
.
sb_vﬁ«me
,

232 
öo
, 
sv
->
sv_i
.
sfi_ty≥
);

236 
ªsu…
 = 
	`vnode_öô
(&
sv
->
sv_absvn
, 
›s
, &
sfs
->
sfs_absfs
, sv);

237 i‡(
ªsu…
) {

238 
	`k‰ì
(
sv
);

239  
ªsu…
;

243 
sv
->
sv_öo
 = 
öo
;

246 
ªsu…
 = 
	`vnodóºay_add
(
sfs
->
sfs_vnodes
, &
sv
->
sv_absvn
, 
NULL
);

247 i‡(
ªsu…
) {

248 
	`vnode_˛ónup
(&
sv
->
sv_absvn
);

249 
	`k‰ì
(
sv
);

250  
ªsu…
;

254 *
ªt
 = 
sv
;

256 
	}
}

262 
	$sfs_makeobj
(
sfs_fs
 *
sfs
, 
ty≥
, 
sfs_vnode
 **
ªt
)

264 
uöt32_t
 
öo
;

265 
ªsu…
;

272 
ªsu…
 = 
	`sfs_bÆloc
(
sfs
, &
öo
);

273 i‡(
ªsu…
) {

274  
ªsu…
;

281 
ªsu…
 = 
	`sfs_lﬂdvnode
(
sfs
, 
öo
, 
ty≥
, 
ªt
);

282 i‡(
ªsu…
) {

283 
	`sfs_b‰ì
(
sfs
, 
öo
);

285  
ªsu…
;

286 
	}
}

293 
	$sfs_gëroŸ
(
fs
 *fs, 
vnode
 **
ªt
)

295 
sfs_fs
 *
sfs
 = 
fs
->
fs_d©a
;

296 
sfs_vnode
 *
sv
;

297 
ªsu…
;

299 
	`vfs_biglock_acquúe
();

301 
ªsu…
 = 
	`sfs_lﬂdvnode
(
sfs
, 
SFS_ROOTDIR_INO
, 
SFS_TYPE_INVAL
, &
sv
);

302 i‡(
ªsu…
) {

303 
	`k¥ötf
("sfs: %s: getroot: CannotÜoadÑoot vnode\n",

304 
sfs
->
sfs_sb
.
sb_vﬁ«me
);

305 
	`vfs_biglock_ªÀa£
();

306  
ªsu…
;

309 i‡(
sv
->
sv_i
.
sfi_ty≥
 !
SFS_TYPE_DIR
) {

310 
	`k¥ötf
("sfs: %s: getroot:Çot directory (type %u)\n",

311 
sfs
->
sfs_sb
.
sb_vﬁ«me
, 
sv
->
sv_i
.
sfi_ty≥
);

312 
	`vfs_biglock_ªÀa£
();

313  
EINVAL
;

316 
	`vfs_biglock_ªÀa£
();

318 *
ªt
 = &
sv
->
sv_absvn
;

320 
	}
}

	@/home/trinity/src/kern/fs/sfs/sfs_io.c

35 
	~<ty≥s.h
>

36 
	~<kîn/î∫o.h
>

37 
	~<lib.h
>

38 
	~<uio.h
>

39 
	~<vfs.h
>

40 
	~<devi˚.h
>

41 
	~<sfs.h
>

42 
	~"sf•riv©e.h
"

60 
	$sfs_rwblock
(
sfs_fs
 *
sfs
, 
uio
 *uio)

62 
ªsu…
;

63 
åõs
=0;

65 
	`KASSERT
(
	`vfs_biglock_do_i_hﬁd
());

67 
	`DEBUG
(
DB_SFS
, "sfs: %s %llu\n",

68 
uio
->
uio_rw
 =
UIO_READ
 ? "read" : "write",

69 
uio
->
uio_off£t
 / 
SFS_BLOCKSIZE
);

71 
ªåy
:

72 
ªsu…
 = 
	`DEVOP_IO
(
sfs
->
sfs_devi˚
, 
uio
);

73 i‡(
ªsu…
 =
EINVAL
) {

79 
	`∑nic
("sfs: %s: DEVOP_IOÑeturned EINVAL\n",

80 
sfs
->
sfs_sb
.
sb_vﬁ«me
);

82 i‡(
ªsu…
 =
EIO
) {

83 i‡(
åõs
 == 0) {

84 
åõs
++;

85 
	`k¥ötf
("sfs: %s: block %llu I/OÉrror,Ñetrying\n",

86 
sfs
->
sfs_sb
.
sb_vﬁ«me
,

87 
uio
->
uio_off£t
 / 
SFS_BLOCKSIZE
);

88 
ªåy
;

90 i‡(
åõs
 < 10) {

91 
åõs
++;

92 
ªåy
;

95 
	`k¥ötf
("sfs: %s: block %llu I/OÉrror, giving up "

97 
sfs
->
sfs_sb
.
sb_vﬁ«me
,

98 
uio
->
uio_off£t
 / 
SFS_BLOCKSIZE
, 
åõs
);

101  
ªsu…
;

102 
	}
}

108 
	$sfs_ªadblock
(
sfs_fs
 *
sfs
, 
daddr_t
 
block
, *
d©a
, 
size_t
 
Àn
)

110 
iovec
 
iov
;

111 
uio
 
ku
;

113 
	`KASSERT
(
Àn
 =
SFS_BLOCKSIZE
);

115 
	`SFSUIO
(&
iov
, &
ku
, 
d©a
, 
block
, 
UIO_READ
);

116  
	`sfs_rwblock
(
sfs
, &
ku
);

117 
	}
}

123 
	$sfs_wrôeblock
(
sfs_fs
 *
sfs
, 
daddr_t
 
block
, *
d©a
, 
size_t
 
Àn
)

125 
iovec
 
iov
;

126 
uio
 
ku
;

128 
	`KASSERT
(
Àn
 =
SFS_BLOCKSIZE
);

130 
	`SFSUIO
(&
iov
, &
ku
, 
d©a
, 
block
, 
UIO_WRITE
);

131  
	`sfs_rwblock
(
sfs
, &
ku
);

132 
	}
}

150 
	$sfs_∑πülio
(
sfs_vnode
 *
sv
, 
uio
 *uio,

151 
uöt32_t
 
skù°¨t
, uöt32_à
Àn
)

160 
iobuf
[
SFS_BLOCKSIZE
];

162 
sfs_fs
 *
sfs
 = 
sv
->
sv_absvn
.
vn_fs
->
fs_d©a
;

163 
daddr_t
 
diskblock
;

164 
uöt32_t
 
fûeblock
;

165 
ªsu…
;

168 
boﬁ
 
dﬂŒoc
 = (
uio
->
uio_rw
==
UIO_WRITE
);

170 
	`KASSERT
(
skù°¨t
 + 
Àn
 <
SFS_BLOCKSIZE
);

173 
	`KASSERT
(
	`vfs_biglock_do_i_hﬁd
());

176 
fûeblock
 = 
uio
->
uio_off£t
 / 
SFS_BLOCKSIZE
;

179 
ªsu…
 = 
	`sfs_bm≠
(
sv
, 
fûeblock
, 
dﬂŒoc
, &
diskblock
);

180 i‡(
ªsu…
) {

181  
ªsu…
;

184 i‡(
diskblock
 == 0) {

189 
	`KASSERT
(
uio
->
uio_rw
 =
UIO_READ
);

190 
	`bzîo
(
iobuf
, (iobuf));

196 
ªsu…
 = 
	`sfs_ªadblock
(
sfs
, 
diskblock
, 
iobuf
, (iobuf));

197 i‡(
ªsu…
) {

198  
ªsu…
;

205 
ªsu…
 = 
	`uiomove
(
iobuf
+
skù°¨t
, 
Àn
, 
uio
);

206 i‡(
ªsu…
) {

207  
ªsu…
;

213 i‡(
uio
->
uio_rw
 =
UIO_WRITE
) {

214 
ªsu…
 = 
	`sfs_wrôeblock
(
sfs
, 
diskblock
, 
iobuf
, (iobuf));

215 i‡(
ªsu…
) {

216  
ªsu…
;

221 
	}
}

228 
	$sfs_blockio
(
sfs_vnode
 *
sv
, 
uio
 *uio)

230 
sfs_fs
 *
sfs
 = 
sv
->
sv_absvn
.
vn_fs
->
fs_d©a
;

231 
daddr_t
 
diskblock
;

232 
uöt32_t
 
fûeblock
;

233 
ªsu…
;

234 
boﬁ
 
dﬂŒoc
 = (
uio
->
uio_rw
==
UIO_WRITE
);

235 
off_t
 
ßveoff
;

236 
off_t
 
diskoff
;

237 
off_t
 
ßvîes
;

238 
off_t
 
diskªs
;

241 
fûeblock
 = 
uio
->
uio_off£t
 / 
SFS_BLOCKSIZE
;

244 
ªsu…
 = 
	`sfs_bm≠
(
sv
, 
fûeblock
, 
dﬂŒoc
, &
diskblock
);

245 i‡(
ªsu…
) {

246  
ªsu…
;

249 i‡(
diskblock
 == 0) {

256 
	`KASSERT
(
uio
->
uio_rw
 =
UIO_READ
);

257  
	`uiomovezîos
(
SFS_BLOCKSIZE
, 
uio
);

264 
ßveoff
 = 
uio
->
uio_off£t
;

265 
diskoff
 = 
diskblock
 * 
SFS_BLOCKSIZE
;

266 
uio
->
uio_off£t
 = 
diskoff
;

271 
	`KASSERT
(
uio
->
uio_ªsid
 >
SFS_BLOCKSIZE
);

272 
ßvîes
 = 
uio
->
uio_ªsid
;

273 
diskªs
 = 
SFS_BLOCKSIZE
;

274 
uio
->
uio_ªsid
 = 
diskªs
;

276 
ªsu…
 = 
	`sfs_rwblock
(
sfs
, 
uio
);

282 
uio
->
uio_off£t
 = (uio->uio_off£à- 
diskoff
Ë+ 
ßveoff
;

283 
uio
->
uio_ªsid
 = (uio->uio_ªsid - 
diskªs
Ë+ 
ßvîes
;

285  
ªsu…
;

286 
	}
}

292 
	$sfs_io
(
sfs_vnode
 *
sv
, 
uio
 *uio)

294 
uöt32_t
 
blkoff
;

295 
uöt32_t
 
nblocks
, 
i
;

296 
ªsu…
 = 0;

297 
uöt32_t
 
‹igªsid
, 
exå¨esid
 = 0;

299 
‹igªsid
 = 
uio
->
uio_ªsid
;

306 i‡(
uio
->
uio_rw
 =
UIO_READ
) {

307 
off_t
 
size
 = 
sv
->
sv_i
.
sfi_size
;

308 
off_t
 
ídpos
 = 
uio
->
uio_off£t
 + uio->
uio_ªsid
;

310 i‡(
uio
->
uio_off£t
 >
size
) {

315 i‡(
ídpos
 > 
size
) {

316 
exå¨esid
 = 
ídpos
 - 
size
;

317 
	`KASSERT
(
uio
->
uio_ªsid
 > 
exå¨esid
);

318 
uio
->
uio_ªsid
 -
exå¨esid
;

325 
blkoff
 = 
uio
->
uio_off£t
 % 
SFS_BLOCKSIZE
;

326 i‡(
blkoff
 != 0) {

328 
uöt32_t
 
skù
 = 
blkoff
;

331 
uöt32_t
 
Àn
 = 
SFS_BLOCKSIZE
 - 
blkoff
;

334 i‡(
Àn
 > 
uio
->
uio_ªsid
) {

335 
Àn
 = 
uio
->
uio_ªsid
;

339 
ªsu…
 = 
	`sfs_∑πülio
(
sv
, 
uio
, 
skù
, 
Àn
);

340 i‡(
ªsu…
) {

341 
out
;

346 i‡(
uio
->
uio_ªsid
==0) {

347 
out
;

353 
	`KASSERT
(
uio
->
uio_off£t
 % 
SFS_BLOCKSIZE
 == 0);

354 
nblocks
 = 
uio
->
uio_ªsid
 / 
SFS_BLOCKSIZE
;

355 
i
=0; i<
nblocks
; i++) {

356 
ªsu…
 = 
	`sfs_blockio
(
sv
, 
uio
);

357 i‡(
ªsu…
) {

358 
out
;

365 
	`KASSERT
(
uio
->
uio_ªsid
 < 
SFS_BLOCKSIZE
);

367 i‡(
uio
->
uio_ªsid
 > 0) {

368 
ªsu…
 = 
	`sfs_∑πülio
(
sv
, 
uio
, 0, uio->
uio_ªsid
);

369 i‡(
ªsu…
) {

370 
out
;

374 
out
:

377 i‡(
uio
->
uio_ªsid
 !
‹igªsid
 &&

378 
uio
->
uio_rw
 =
UIO_WRITE
 &&

379 
uio
->
uio_off£t
 > (
off_t
)
sv
->
sv_i
.
sfi_size
) {

380 
sv
->
sv_i
.
sfi_size
 = 
uio
->
uio_off£t
;

381 
sv
->
sv_dúty
 = 
åue
;

385 
uio
->
uio_ªsid
 +
exå¨esid
;

388  
ªsu…
;

389 
	}
}

406 
	$sfs_mëaio
(
sfs_vnode
 *
sv
, 
off_t
 
a˘uÆpos
, *
d©a
, 
size_t
 
Àn
,

407 
uio_rw
 
rw
)

409 
sfs_fs
 *
sfs
 = 
sv
->
sv_absvn
.
vn_fs
->
fs_d©a
;

410 
off_t
 
ídpos
;

411 
uöt32_t
 
vnblock
;

412 
uöt32_t
 
blockoff£t
;

413 
daddr_t
 
diskblock
;

414 
boﬁ
 
dﬂŒoc
;

415 
ªsu…
;

424 
mëaiobuf
[
SFS_BLOCKSIZE
];

427 
	`KASSERT
(
	`vfs_biglock_do_i_hﬁd
());

430 
vnblock
 = 
a˘uÆpos
 / 
SFS_BLOCKSIZE
;

431 
blockoff£t
 = 
a˘uÆpos
 % 
SFS_BLOCKSIZE
;

434 
dﬂŒoc
 = (
rw
 =
UIO_WRITE
);

435 
ªsu…
 = 
	`sfs_bm≠
(
sv
, 
vnblock
, 
dﬂŒoc
, &
diskblock
);

436 i‡(
ªsu…
) {

437  
ªsu…
;

440 i‡(
diskblock
 == 0) {

442 
	`KASSERT
(
rw
 =
UIO_READ
);

445 
	`bzîo
(
d©a
, 
Àn
);

450 
ªsu…
 = 
	`sfs_ªadblock
(
sfs
, 
diskblock
, 
mëaiobuf
, (metaiobuf));

451 i‡(
ªsu…
) {

452  
ªsu…
;

455 i‡(
rw
 =
UIO_READ
) {

457 
	`mem˝y
(
d©a
, 
mëaiobuf
 + 
blockoff£t
, 
Àn
);

461 
	`mem˝y
(
mëaiobuf
 + 
blockoff£t
, 
d©a
, 
Àn
);

464 
ªsu…
 = 
	`sfs_wrôeblock
(
sfs
, 
diskblock
,

465 
mëaiobuf
, (metaiobuf));

466 i‡(
ªsu…
) {

467  
ªsu…
;

471 
ídpos
 = 
a˘uÆpos
 + 
Àn
;

472 i‡(
ídpos
 > (
off_t
)
sv
->
sv_i
.
sfi_size
) {

473 
sv
->
sv_i
.
sfi_size
 = 
ídpos
;

474 
sv
->
sv_dúty
 = 
åue
;

480 
	}
}

	@/home/trinity/src/kern/fs/sfs/sfs_vnops.c

35 
	~<ty≥s.h
>

36 
	~<kîn/î∫o.h
>

37 
	~<kîn/f˙é.h
>

38 
	~<°©.h
>

39 
	~<lib.h
>

40 
	~<uio.h
>

41 
	~<vfs.h
>

42 
	~<sfs.h
>

43 
	~"sf•riv©e.h
"

53 
	$sfs_óch›í
(
vnode
 *
v
, 
›íÊags
)

63 ()
v
;

64 ()
›íÊags
;

67 
	}
}

75 
	$sfs_óch›ídú
(
vnode
 *
v
, 
›íÊags
)

77 
›íÊags
 & 
O_ACCMODE
) {

78 
O_RDONLY
:

80 
O_WRONLY
:

81 
O_RDWR
:

83  
EISDIR
;

85 i‡(
›íÊags
 & 
O_APPEND
) {

86  
EISDIR
;

89 ()
v
;

91 
	}
}

98 
	$sfs_ªad
(
vnode
 *
v
, 
uio
 *uio)

100 
sfs_vnode
 *
sv
 = 
v
->
vn_d©a
;

101 
ªsu…
;

103 
	`KASSERT
(
uio
->
uio_rw
==
UIO_READ
);

105 
	`vfs_biglock_acquúe
();

106 
ªsu…
 = 
	`sfs_io
(
sv
, 
uio
);

107 
	`vfs_biglock_ªÀa£
();

109  
ªsu…
;

110 
	}
}

117 
	$sfs_wrôe
(
vnode
 *
v
, 
uio
 *uio)

119 
sfs_vnode
 *
sv
 = 
v
->
vn_d©a
;

120 
ªsu…
;

122 
	`KASSERT
(
uio
->
uio_rw
==
UIO_WRITE
);

124 
	`vfs_biglock_acquúe
();

125 
ªsu…
 = 
	`sfs_io
(
sv
, 
uio
);

126 
	`vfs_biglock_ªÀa£
();

128  
ªsu…
;

129 
	}
}

136 
	$sfs_io˘l
(
vnode
 *
v
, 
›
, 
u£Ωå_t
 
d©a
)

142 ()
v
;

143 ()
›
;

144 ()
d©a
;

146  
EINVAL
;

147 
	}
}

154 
	$sfs_°©
(
vnode
 *
v
, 
°©
 *
°©buf
)

156 
sfs_vnode
 *
sv
 = 
v
->
vn_d©a
;

157 
ªsu…
;

160 
	`bzîo
(
°©buf
, (
°©
));

162 
ªsu…
 = 
	`VOP_GETTYPE
(
v
, &
°©buf
->
°_mode
);

163 i‡(
ªsu…
) {

164  
ªsu…
;

167 
°©buf
->
°_size
 = 
sv
->
sv_i
.
sfi_size
;

168 
°©buf
->
°_∆ök
 = 
sv
->
sv_i
.
sfi_lökcou¡
;

171 
°©buf
->
°_blocks
 = 0;

176 
	}
}

183 
	$sfs_gëty≥
(
vnode
 *
v
, 
uöt32_t
 *
ªt
)

185 
sfs_vnode
 *
sv
 = 
v
->
vn_d©a
;

186 
sfs_fs
 *
sfs
 = 
v
->
vn_fs
->
fs_d©a
;

188 
	`vfs_biglock_acquúe
();

190 
sv
->
sv_i
.
sfi_ty≥
) {

191 
SFS_TYPE_FILE
:

192 *
ªt
 = 
S_IFREG
;

193 
	`vfs_biglock_ªÀa£
();

195 
SFS_TYPE_DIR
:

196 *
ªt
 = 
S_IFDIR
;

197 
	`vfs_biglock_ªÀa£
();

200 
	`∑nic
("sfs: %s: gettype: Invalid inodeÅype (inode %u,Åype %u)\n",

201 
sfs
->
sfs_sb
.
sb_vﬁ«me
, 
sv
->
sv_öo
, sv->
sv_i
.
sfi_ty≥
);

202  
EINVAL
;

203 
	}
}

209 
boﬁ


210 
	$sfs_is£ekabÀ
(
vnode
 *
v
)

212 ()
v
;

213  
åue
;

214 
	}
}

222 
	$sfs_fsync
(
vnode
 *
v
)

224 
sfs_vnode
 *
sv
 = 
v
->
vn_d©a
;

225 
ªsu…
;

227 
	`vfs_biglock_acquúe
();

228 
ªsu…
 = 
	`sfs_sync_öode
(
sv
);

229 
	`vfs_biglock_ªÀa£
();

231  
ªsu…
;

232 
	}
}

239 
	$sfs_mm≠
(
vnode
 *
v
 )

241 ()
v
;

242  
ENOSYS
;

243 
	}
}

250 
	$sfs_åunˇã
(
vnode
 *
v
, 
off_t
 
Àn
)

252 
sfs_vnode
 *
sv
 = 
v
->
vn_d©a
;

254  
	`sfs_ôrunc
(
sv
, 
Àn
);

255 
	}
}

265 
	$sfs_«mefûe
(
vnode
 *
vv
, 
uio
 *uio)

267 
sfs_vnode
 *
sv
 = 
vv
->
vn_d©a
;

268 
	`KASSERT
(
sv
->
sv_öo
 =
SFS_ROOTDIR_INO
);

272 ()
uio
;

275 
	}
}

283 
	$sfs_¸ót
(
vnode
 *
v
, c⁄° *
«me
, 
boﬁ
 
ex˛
, 
mode_t
 
mode
,

284 
vnode
 **
ªt
)

286 
sfs_fs
 *
sfs
 = 
v
->
vn_fs
->
fs_d©a
;

287 
sfs_vnode
 *
sv
 = 
v
->
vn_d©a
;

288 
sfs_vnode
 *
√wguy
;

289 
uöt32_t
 
öo
;

290 
ªsu…
;

292 
	`vfs_biglock_acquúe
();

295 
ªsu…
 = 
	`sfs_dú_föd«me
(
sv
, 
«me
, &
öo
, 
NULL
, NULL);

296 i‡(
ªsu…
!=0 &&Ñesu…!=
ENOENT
) {

297 
	`vfs_biglock_ªÀa£
();

298  
ªsu…
;

302 i‡(
ªsu…
==0 && 
ex˛
) {

303 
	`vfs_biglock_ªÀa£
();

304  
EEXIST
;

307 i‡(
ªsu…
==0) {

309 
ªsu…
 = 
	`sfs_lﬂdvnode
(
sfs
, 
öo
, 
SFS_TYPE_INVAL
, &
√wguy
);

310 i‡(
ªsu…
) {

311 
	`vfs_biglock_ªÀa£
();

312  
ªsu…
;

314 *
ªt
 = &
√wguy
->
sv_absvn
;

315 
	`vfs_biglock_ªÀa£
();

320 
ªsu…
 = 
	`sfs_makeobj
(
sfs
, 
SFS_TYPE_FILE
, &
√wguy
);

321 i‡(
ªsu…
) {

322 
	`vfs_biglock_ªÀa£
();

323  
ªsu…
;

327 ()
mode
;

330 
ªsu…
 = 
	`sfs_dú_lök
(
sv
, 
«me
, 
√wguy
->
sv_öo
, 
NULL
);

331 i‡(
ªsu…
) {

332 
	`VOP_DECREF
(&
√wguy
->
sv_absvn
);

333 
	`vfs_biglock_ªÀa£
();

334  
ªsu…
;

338 
√wguy
->
sv_i
.
sfi_lökcou¡
++;

341 
√wguy
->
sv_dúty
 = 
åue
;

343 *
ªt
 = &
√wguy
->
sv_absvn
;

345 
	`vfs_biglock_ªÀa£
();

347 
	}
}

356 
	$sfs_lök
(
vnode
 *
dú
, c⁄° *
«me
, vnodê*
fûe
)

358 
sfs_vnode
 *
sv
 = 
dú
->
vn_d©a
;

359 
sfs_vnode
 *
f
 = 
fûe
->
vn_d©a
;

360 
ªsu…
;

362 
	`KASSERT
(
fûe
->
vn_fs
 =
dú
->vn_fs);

364 
	`vfs_biglock_acquúe
();

367 i‡(
f
->
sv_i
.
sfi_ty≥
 =
SFS_TYPE_DIR
) {

368 
	`vfs_biglock_ªÀa£
();

369  
EINVAL
;

373 
ªsu…
 = 
	`sfs_dú_lök
(
sv
, 
«me
, 
f
->
sv_öo
, 
NULL
);

374 i‡(
ªsu…
) {

375 
	`vfs_biglock_ªÀa£
();

376  
ªsu…
;

380 
f
->
sv_i
.
sfi_lökcou¡
++;

381 
f
->
sv_dúty
 = 
åue
;

383 
	`vfs_biglock_ªÀa£
();

385 
	}
}

392 
	$sfs_ªmove
(
vnode
 *
dú
, c⁄° *
«me
)

394 
sfs_vnode
 *
sv
 = 
dú
->
vn_d©a
;

395 
sfs_vnode
 *
vi˘im
;

396 
¶Ÿ
;

397 
ªsu…
;

399 
	`vfs_biglock_acquúe
();

402 
ªsu…
 = 
	`sfs_look⁄˚
(
sv
, 
«me
, &
vi˘im
, &
¶Ÿ
);

403 i‡(
ªsu…
) {

404 
	`vfs_biglock_ªÀa£
();

405  
ªsu…
;

409 
ªsu…
 = 
	`sfs_dú_u∆ök
(
sv
, 
¶Ÿ
);

410 i‡(
ªsu…
==0) {

412 
	`KASSERT
(
vi˘im
->
sv_i
.
sfi_lökcou¡
 > 0);

413 
vi˘im
->
sv_i
.
sfi_lökcou¡
--;

414 
vi˘im
->
sv_dúty
 = 
åue
;

418 
	`VOP_DECREF
(&
vi˘im
->
sv_absvn
);

420 
	`vfs_biglock_ªÀa£
();

421  
ªsu…
;

422 
	}
}

432 
	$sfs_ª«me
(
vnode
 *
d1
, c⁄° *
n1
,

433 
vnode
 *
d2
, c⁄° *
n2
)

435 
sfs_vnode
 *
sv
 = 
d1
->
vn_d©a
;

436 
sfs_fs
 *
sfs
 = 
sv
->
sv_absvn
.
vn_fs
->
fs_d©a
;

437 
sfs_vnode
 *
g1
;

438 
¶Ÿ1
, 
¶Ÿ2
;

439 
ªsu…
, 
ªsu…2
;

441 
	`vfs_biglock_acquúe
();

443 
	`KASSERT
(
d1
==
d2
);

444 
	`KASSERT
(
sv
->
sv_öo
 =
SFS_ROOTDIR_INO
);

447 
ªsu…
 = 
	`sfs_look⁄˚
(
sv
, 
n1
, &
g1
, &
¶Ÿ1
);

448 i‡(
ªsu…
) {

449 
	`vfs_biglock_ªÀa£
();

450  
ªsu…
;

454 
	`KASSERT
(
g1
->
sv_i
.
sfi_ty≥
 =
SFS_TYPE_FILE
);

464 
ªsu…
 = 
	`sfs_dú_lök
(
sv
, 
n2
, 
g1
->
sv_öo
, &
¶Ÿ2
);

465 i‡(
ªsu…
) {

466 
puke
;

470 
g1
->
sv_i
.
sfi_lökcou¡
++;

471 
g1
->
sv_dúty
 = 
åue
;

474 
ªsu…
 = 
	`sfs_dú_u∆ök
(
sv
, 
¶Ÿ1
);

475 i‡(
ªsu…
) {

476 
puke_h¨dî
;

483 
	`KASSERT
(
g1
->
sv_i
.
sfi_lökcou¡
>0);

484 
g1
->
sv_i
.
sfi_lökcou¡
--;

485 
g1
->
sv_dúty
 = 
åue
;

488 
	`VOP_DECREF
(&
g1
->
sv_absvn
);

490 
	`vfs_biglock_ªÀa£
();

493 
puke_h¨dî
:

497 
ªsu…2
 = 
	`sfs_dú_u∆ök
(
sv
, 
¶Ÿ2
);

498 i‡(
ªsu…2
) {

499 
	`k¥ötf
("sfs: %s:Ñename: %s\n",

500 
sfs
->
sfs_sb
.
sb_vﬁ«me
, 
	`°ªº‹
(
ªsu…
));

501 
	`k¥ötf
("sfs: %s:Ñename: while cleaning up: %s\n",

502 
sfs
->
sfs_sb
.
sb_vﬁ«me
, 
	`°ªº‹
(
ªsu…2
));

503 
	`∑nic
("sfs: %s:Ñename: CannotÑecover\n",

504 
sfs
->
sfs_sb
.
sb_vﬁ«me
);

506 
g1
->
sv_i
.
sfi_lökcou¡
--;

507 
puke
:

509 
	`VOP_DECREF
(&
g1
->
sv_absvn
);

510 
	`vfs_biglock_ªÀa£
();

511  
ªsu…
;

512 
	}
}

523 
	$sfs_look∑ª¡
(
vnode
 *
v
, *
∑th
, vnodê**
ªt
,

524 *
buf
, 
size_t
 
buÊí
)

526 
sfs_vnode
 *
sv
 = 
v
->
vn_d©a
;

528 
	`vfs_biglock_acquúe
();

530 i‡(
sv
->
sv_i
.
sfi_ty≥
 !
SFS_TYPE_DIR
) {

531 
	`vfs_biglock_ªÀa£
();

532  
ENOTDIR
;

535 i‡(
	`°æí
(
∑th
)+1 > 
buÊí
) {

536 
	`vfs_biglock_ªÀa£
();

537  
ENAMETOOLONG
;

539 
	`°r˝y
(
buf
, 
∑th
);

541 
	`VOP_INCREF
(&
sv
->
sv_absvn
);

542 *
ªt
 = &
sv
->
sv_absvn
;

544 
	`vfs_biglock_ªÀa£
();

546 
	}
}

556 
	$sfs_lookup
(
vnode
 *
v
, *
∑th
, vnodê**
ªt
)

558 
sfs_vnode
 *
sv
 = 
v
->
vn_d©a
;

559 
sfs_vnode
 *
föÆ
;

560 
ªsu…
;

562 
	`vfs_biglock_acquúe
();

564 i‡(
sv
->
sv_i
.
sfi_ty≥
 !
SFS_TYPE_DIR
) {

565 
	`vfs_biglock_ªÀa£
();

566  
ENOTDIR
;

569 
ªsu…
 = 
	`sfs_look⁄˚
(
sv
, 
∑th
, &
föÆ
, 
NULL
);

570 i‡(
ªsu…
) {

571 
	`vfs_biglock_ªÀa£
();

572  
ªsu…
;

575 *
ªt
 = &
föÆ
->
sv_absvn
;

577 
	`vfs_biglock_ªÀa£
();

579 
	}
}

587 c⁄° 
vnode_›s
 
	gsfs_fûe›s
 = {

588 .
v›_magic
 = 
VOP_MAGIC
,

590 .
	gv›_óch›í
 = 
sfs_óch›í
,

591 .
	gv›_ª˛aim
 = 
sfs_ª˛aim
,

593 .
	gv›_ªad
 = 
sfs_ªad
,

594 .
	gv›_ªadlök
 = 
v›Áû_uio_nŸdú
,

595 .
	gv›_gëdúíåy
 = 
v›Áû_uio_nŸdú
,

596 .
	gv›_wrôe
 = 
sfs_wrôe
,

597 .
	gv›_io˘l
 = 
sfs_io˘l
,

598 .
	gv›_°©
 = 
sfs_°©
,

599 .
	gv›_gëty≥
 = 
sfs_gëty≥
,

600 .
	gv›_is£ekabÀ
 = 
sfs_is£ekabÀ
,

601 .
	gv›_fsync
 = 
sfs_fsync
,

602 .
	gv›_mm≠
 = 
sfs_mm≠
,

603 .
	gv›_åunˇã
 = 
sfs_åunˇã
,

604 .
	gv›_«mefûe
 = 
v›Áû_uio_nŸdú
,

606 .
	gv›_¸ót
 = 
v›Áû_¸ót_nŸdú
,

607 .
	gv›_symlök
 = 
v›Áû_symlök_nŸdú
,

608 .
	gv›_mkdú
 = 
v›Áû_mkdú_nŸdú
,

609 .
	gv›_lök
 = 
v›Áû_lök_nŸdú
,

610 .
	gv›_ªmove
 = 
v›Áû_°rög_nŸdú
,

611 .
	gv›_rmdú
 = 
v›Áû_°rög_nŸdú
,

612 .
	gv›_ª«me
 = 
v›Áû_ª«me_nŸdú
,

614 .
	gv›_lookup
 = 
v›Áû_lookup_nŸdú
,

615 .
	gv›_look∑ª¡
 = 
v›Áû_look∑ª¡_nŸdú
,

621 c⁄° 
vnode_›s
 
	gsfs_dú›s
 = {

622 .
v›_magic
 = 
VOP_MAGIC
,

624 .
	gv›_óch›í
 = 
sfs_óch›ídú
,

625 .
	gv›_ª˛aim
 = 
sfs_ª˛aim
,

627 .
	gv›_ªad
 = 
v›Áû_uio_isdú
,

628 .
	gv›_ªadlök
 = 
v›Áû_uio_övÆ
,

629 .
	gv›_gëdúíåy
 = 
v›Áû_uio_nosys
,

630 .
	gv›_wrôe
 = 
v›Áû_uio_isdú
,

631 .
	gv›_io˘l
 = 
sfs_io˘l
,

632 .
	gv›_°©
 = 
sfs_°©
,

633 .
	gv›_gëty≥
 = 
sfs_gëty≥
,

634 .
	gv›_is£ekabÀ
 = 
sfs_is£ekabÀ
,

635 .
	gv›_fsync
 = 
sfs_fsync
,

636 .
	gv›_mm≠
 = 
v›Áû_mm≠_isdú
,

637 .
	gv›_åunˇã
 = 
v›Áû_åunˇã_isdú
,

638 .
	gv›_«mefûe
 = 
sfs_«mefûe
,

640 .
	gv›_¸ót
 = 
sfs_¸ót
,

641 .
	gv›_symlök
 = 
v›Áû_symlök_nosys
,

642 .
	gv›_mkdú
 = 
v›Áû_mkdú_nosys
,

643 .
	gv›_lök
 = 
sfs_lök
,

644 .
	gv›_ªmove
 = 
sfs_ªmove
,

645 .
	gv›_rmdú
 = 
v›Áû_°rög_nosys
,

646 .
	gv›_ª«me
 = 
sfs_ª«me
,

648 .
	gv›_lookup
 = 
sfs_lookup
,

649 .
	gv›_look∑ª¡
 = 
sfs_look∑ª¡
,

	@/home/trinity/src/kern/fs/sfs/sfsprivate.h

30 #i‚de‡
_SFSPRIVATE_H_


31 
	#_SFSPRIVATE_H_


	)

33 
	~<uio.h
>

37 c⁄° 
vnode_›s
 
sfs_fûe›s
;

38 c⁄° 
vnode_›s
 
sfs_dú›s
;

41 
	#SFSUIO
(
iov
, 
uio
, 
±r
, 
block
, 
rw
) \

42 
	`uio_köô
(
iov
, 
uio
, 
±r
, 
SFS_BLOCKSIZE
, ((
off_t
)(
block
))*SFS_BLOCKSIZE, 
rw
)

	)

46 
sfs_bÆloc
(
sfs_fs
 *
sfs
, 
daddr_t
 *
diskblock
);

47 
sfs_b‰ì
(
sfs_fs
 *
sfs
, 
daddr_t
 
diskblock
);

48 
sfs_bu£d
(
sfs_fs
 *
sfs
, 
daddr_t
 
diskblock
);

51 
sfs_bm≠
(
sfs_vnode
 *
sv
, 
uöt32_t
 
fûeblock
, 
boﬁ
 
dﬂŒoc
,

52 
daddr_t
 *
diskblock
);

53 
sfs_ôrunc
(
sfs_vnode
 *
sv
, 
off_t
 
Àn
);

56 
sfs_dú_föd«me
(
sfs_vnode
 *
sv
, c⁄° *
«me
,

57 
uöt32_t
 *
öo
, *
¶Ÿ
, *
em±y¶Ÿ
);

58 
sfs_dú_lök
(
sfs_vnode
 *
sv
, c⁄° *
«me
, 
uöt32_t
 
öo
,

59 *
¶Ÿ
);

60 
sfs_dú_u∆ök
(
sfs_vnode
 *
sv
, 
¶Ÿ
);

61 
sfs_look⁄˚
(
sfs_vnode
 *
sv
, c⁄° *
«me
,

62 
sfs_vnode
 **
ªt
,

63 *
¶Ÿ
);

66 
sfs_sync_öode
(
sfs_vnode
 *
sv
);

67 
sfs_ª˛aim
(
vnode
 *
v
);

68 
sfs_lﬂdvnode
(
sfs_fs
 *
sfs
, 
uöt32_t
 
öo
, 
f‹˚ty≥
,

69 
sfs_vnode
 **
ªt
);

70 
sfs_makeobj
(
sfs_fs
 *
sfs
, 
ty≥
, 
sfs_vnode
 **
ªt
);

71 
sfs_gëroŸ
(
fs
 *fs, 
vnode
 **
ªt
);

74 
sfs_ªadblock
(
sfs_fs
 *
sfs
, 
daddr_t
 
block
, *
d©a
, 
size_t
 
Àn
);

75 
sfs_wrôeblock
(
sfs_fs
 *
sfs
, 
daddr_t
 
block
, *
d©a
, 
size_t
 
Àn
);

76 
sfs_io
(
sfs_vnode
 *
sv
, 
uio
 *uio);

77 
sfs_mëaio
(
sfs_vnode
 *
sv
, 
off_t
 
pos
, *
d©a
, 
size_t
 
Àn
,

78 
uio_rw
 
rw
);

	@/home/trinity/src/kern/include/addrspace.h

30 #i‚de‡
_ADDRSPACE_H_


31 
	#_ADDRSPACE_H_


	)

38 
	~<vm.h
>

39 
	~"›t-dumbvm.h
"

41 
	gvnode
;

51 
	saddr•a˚
 {

52 #i‡
OPT_DUMBVM


53 
vaddr_t
 
	mas_vba£1
;

54 
∑ddr_t
 
	mas_pba£1
;

55 
size_t
 
	mas_≈ages1
;

56 
vaddr_t
 
	mas_vba£2
;

57 
∑ddr_t
 
	mas_pba£2
;

58 
size_t
 
	mas_≈ages2
;

59 
∑ddr_t
 
	mas_°ackpba£
;

106 
addr•a˚
 *
as_¸óã
();

107 
as_c›y
(
addr•a˚
 *
§c
, addr•a˚ **
ªt
);

108 
as_a˘iv©e
();

109 
as_dó˘iv©e
();

110 
as_de°roy
(
addr•a˚
 *);

112 
as_deföe_ªgi⁄
(
addr•a˚
 *
as
,

113 
vaddr_t
 
vaddr
, 
size_t
 
sz
,

114 
ªadabÀ
,

115 
wrôóbÀ
,

116 
execuèbÀ
);

117 
as_¥ï¨e_lﬂd
(
addr•a˚
 *
as
);

118 
as_com∂ëe_lﬂd
(
addr•a˚
 *
as
);

119 
as_deföe_°ack
(
addr•a˚
 *
as
, 
vaddr_t
 *
öô°ack±r
);

129 
lﬂd_ñf
(
vnode
 *
v
, 
vaddr_t
 *
íåypoöt
);

	@/home/trinity/src/kern/include/array.h

30 #i‚de‡
_ARRAY_H_


31 
	#_ARRAY_H_


	)

33 
	~<cdefs.h
>

34 
	~<lib.h
>

36 
	#ARRAYS_CHECKED


	)

38 #ifde‡
ARRAYS_CHECKED


39 
	#ARRAYASSERT
 
KASSERT


	)

41 
	#ARRAYASSERT
(
x
Ë(()(x))

	)

44 #i‚de‡
ARRAYINLINE


45 
	#ARRAYINLINE
 
INLINE


	)

70 
	s¨øy
 {

71 **
	mv
;

72 
	mnum
, 
	mmax
;

75 
¨øy
 *
¨øy_¸óã
();

76 
¨øy_de°roy
(
¨øy
 *);

77 
¨øy_öô
(
¨øy
 *);

78 
¨øy_˛ónup
(
¨øy
 *);

79 
ARRAYINLINE
 
¨øy_num
(c⁄° 
¨øy
 *);

80 
ARRAYINLINE
 *
¨øy_gë
(c⁄° 
¨øy
 *, 
ödex
);

81 
ARRAYINLINE
 
¨øy_£t
(c⁄° 
¨øy
 *, 
ödex
, *
vÆ
);

82 
¨øy_¥óŒoˇã
(
¨øy
 *, 
num
);

83 
¨øy_£tsize
(
¨øy
 *, 
num
);

84 
ARRAYINLINE
 
¨øy_add
(
¨øy
 *, *
vÆ
, *
ödex_ªt
);

85 
¨øy_ªmove
(
¨øy
 *, 
ödex
);

91 
ARRAYINLINE
 

92 
	$¨øy_num
(c⁄° 
¨øy
 *
a
)

94  
a
->
num
;

95 
	}
}

97 
ARRAYINLINE
 *

98 
	$¨øy_gë
(c⁄° 
¨øy
 *
a
, 
ödex
)

100 
	`ARRAYASSERT
(
ödex
 < 
a
->
num
);

101  
a
->
v
[
ödex
];

102 
	}
}

104 
ARRAYINLINE
 

105 
	$¨øy_£t
(c⁄° 
¨øy
 *
a
, 
ödex
, *
vÆ
)

107 
	`ARRAYASSERT
(
ödex
 < 
a
->
num
);

108 
a
->
v
[
ödex
] = 
vÆ
;

109 
	}
}

111 
ARRAYINLINE
 

112 
	$¨øy_add
(
¨øy
 *
a
, *
vÆ
, *
ödex_ªt
)

114 
ödex
;

115 
ªt
;

117 
ödex
 = 
a
->
num
;

118 
ªt
 = 
	`¨øy_£tsize
(
a
, 
ödex
+1);

119 i‡(
ªt
) {

120  
ªt
;

122 
a
->
v
[
ödex
] = 
vÆ
;

123 i‡(
ödex_ªt
 !
NULL
) {

124 *
ödex_ªt
 = 
ödex
;

127 
	}
}

168 
	#DECLARRAY_BYTYPE
(
ARRAY
, 
T
, 
INLINE
) \

169 
	sARRAY
 { \

170 
¨øy
 
¨r
; \

173 
INLINE
 
ARRAY
 *ARRAY##
	`_¸óã
(); \

174 
INLINE
 
ARRAY
##
	`_de°roy
(ARRAY *
a
); \

175 
INLINE
 
ARRAY
##
	`_öô
(ARRAY *
a
); \

176 
INLINE
 
ARRAY
##
	`_˛ónup
(ARRAY *
a
); \

177 
INLINE
 
ARRAY
##
	`_num
(c⁄° ARRAY *
a
); \

178 
INLINE
 
T
 *
ARRAY
##
	`_gë
(c⁄° ARRAY *
a
, 
ödex
); \

179 
INLINE
 
ARRAY
##
	`_£t
(ARRAY *
a
, 
ödex
, 
T
 *
vÆ
); \

180 
INLINE
 
ARRAY
##
	`_¥óŒoˇã
(ARRAY *
a
, 
num
); \

181 
INLINE
 
ARRAY
##
	`_£tsize
(ARRAY *
a
, 
num
); \

182 
INLINE
 
ARRAY
##
	`_add
(ARRAY *
a
, 
T
 *
vÆ
, *
ödex_ªt
); \

183 
INLINE
 
ARRAY
##
	`_ªmove
(ARRAY *
a
, 
ödex
)

	)

185 
	#DEFARRAY_BYTYPE
(
ARRAY
, 
T
, 
INLINE
) \

186 
INLINE
 
ARRAY
 * \

187 
ARRAY
##
	`_¸óã
() \

189 
ARRAY
 *
a
 = 
	`kmÆloc
((*a)); \

190 i‡(
a
 =
NULL
) { \

191  
NULL
; \

193 
	`¨øy_öô
(&
a
->
¨r
); \

194  
a
; \

197 
INLINE
 \

198 
ARRAY
##
	`_de°roy
(ARRAY *
a
) \

200 
	`¨øy_˛ónup
(&
a
->
¨r
); \

201 
	`k‰ì
(
a
); \

204 
INLINE
 \

205 
ARRAY
##
	`_öô
(ARRAY *
a
) \

207 
	`¨øy_öô
(&
a
->
¨r
); \

210 
INLINE
 \

211 
ARRAY
##
	`_˛ónup
(ARRAY *
a
) \

213 
	`¨øy_˛ónup
(&
a
->
¨r
); \

216 
INLINE
 \

217 
ARRAY
##
	`_num
(c⁄° ARRAY *
a
) \

219  
	`¨øy_num
(&
a
->
¨r
); \

222 
INLINE
 
T
 * \

223 
ARRAY
##
	`_gë
(c⁄° ARRAY *
a
, 
ödex
) \

225  (
T
 *)
	`¨øy_gë
(&
a
->
¨r
, 
ödex
); \

228 
INLINE
 \

229 
ARRAY
##
	`_£t
(ARRAY *
a
, 
ödex
, 
T
 *
vÆ
) \

231 
	`¨øy_£t
(&
a
->
¨r
, 
ödex
, (*)
vÆ
); \

234 
INLINE
 \

235 
ARRAY
##
	`_¥óŒoˇã
(ARRAY *
a
, 
num
) \

237  
	`¨øy_¥óŒoˇã
(&
a
->
¨r
, 
num
); \

240 
INLINE
 \

241 
ARRAY
##
	`_£tsize
(ARRAY *
a
, 
num
) \

243  
	`¨øy_£tsize
(&
a
->
¨r
, 
num
); \

246 
INLINE
 \

247 
ARRAY
##
	`_add
(ARRAY *
a
, 
T
 *
vÆ
, *
ödex_ªt
) \

249  
	`¨øy_add
(&
a
->
¨r
, (*)
vÆ
, 
ödex_ªt
); \

252 
INLINE
 \

253 
ARRAY
##
	`_ªmove
(ARRAY *
a
, 
ödex
) \

255 
	`¨øy_ªmove
(&
a
->
¨r
, 
ödex
); \

256 }

	)

258 
	#DECLARRAY
(
T
, 
INLINE
Ë
	`DECLARRAY_BYTYPE
(T##
¨øy
, T, INLINE)

	)

259 
	#DEFARRAY
(
T
, 
INLINE
Ë
	`DEFARRAY_BYTYPE
(T##
¨øy
, T, INLINE)

	)

265 
DECLARRAY_BYTYPE
(
°rög¨øy
, , 
ARRAYINLINE
);

266 
DEFARRAY_BYTYPE
(
°rög¨øy
, , 
ARRAYINLINE
);

	@/home/trinity/src/kern/include/bitmap.h

30 #i‚de‡
_BITMAP_H_


31 
	#_BITMAP_H_


	)

48 
	gbôm≠
;

50 
bôm≠
 *
bôm≠_¸óã
(
nbôs
);

51 *
bôm≠_gëd©a
(
bôm≠
 *);

52 
bôm≠_Æloc
(
bôm≠
 *, *
ödex
);

53 
bôm≠_m¨k
(
bôm≠
 *, 
ödex
);

54 
bôm≠_unm¨k
(
bôm≠
 *, 
ödex
);

55 
bôm≠_is£t
(
bôm≠
 *, 
ödex
);

56 
bôm≠_de°roy
(
bôm≠
 *);

	@/home/trinity/src/kern/include/cdefs.h

30 #i‚de‡
_CDEFS_H_


31 
	#_CDEFS_H_


	)

42 
	#COMPILE_ASSERT
(
x
Ë(()(°ru˘ { : ((x)?1:-1); }))

	)

48 
	#ARRAYCOUNT
(
¨r
Ë(◊ºË/ (◊º)[0]))

	)

56 #ifde‡
__GNUC__


57 
	#__PF
(
a
,
b
Ë
	`__©åibuã__
((
	`__f‹m©__
(
__¥ötf__
,á, b)))

	)

58 
	#__DEAD
 
	`__©åibuã__
((
__n‹ëu∫__
))

	)

59 
	#__UNUSED
 
	`__©åibuã__
((
__unu£d__
))

	)

61 
	#__PF
(
a
,
b
)

	)

62 
	#__DEAD


	)

63 
	#__UNUSED


	)

127 #i‡
deföed
(
__GNUC__
Ë&& !deföed(
__GNUC_STDC_INLINE__
)

129 
	#INLINE
 
ölöe


	)

131 #ñi‡
deföed
(
__STDC__
Ë&& 
__STDC_VERSION__
 >= 199901L

133 
	#INLINE
 
ölöe


	)

137 
	#INLINE
 
__UNUSED
 
ölöe


	)

	@/home/trinity/src/kern/include/clock.h

30 #i‚de‡
_CLOCK_H_


31 
	#_CLOCK_H_


	)

37 
	~<kîn/time.h
>

46 
	#HZ
 100

	)

48 
h¨d˛ock_boŸ°øp
();

49 
h¨d˛ock
();

55 
timî˛ock
();

60 
gëtime
(
time•ec
 *
ªt
);

69 
time•ec_add
(c⁄° 
time•ec
 *
t1
,

70 c⁄° 
time•ec
 *
t2
,

71 
time•ec
 *
ªt
);

72 
time•ec_sub
(c⁄° 
time•ec
 *
t1
,

73 c⁄° 
time•ec
 *
t2
,

74 
time•ec
 *
ªt
);

80 
˛ock¶ìp
(
£c⁄ds
);

	@/home/trinity/src/kern/include/copyinout.h

30 #i‚de‡
_COPYINOUT_H_


31 
	#_COPYINOUT_H_


	)

67 
c›yö
(
c⁄°_u£Ωå_t
 
u£r§c
, *
de°
, 
size_t
 
Àn
);

68 
c›yout
(c⁄° *
§c
, 
u£Ωå_t
 
u£rde°
, 
size_t
 
Àn
);

69 
c›yö°r
(
c⁄°_u£Ωå_t
 
u£r§c
, *
de°
, 
size_t
 
Àn
, size_à*
gŸ
);

70 
c›yout°r
(c⁄° *
§c
, 
u£Ωå_t
 
u£rde°
, 
size_t
 
Àn
, size_à*
gŸ
);

	@/home/trinity/src/kern/include/cpu.h

30 #i‚de‡
_CPU_H_


31 
	#_CPU_H_


	)

34 
	~<•ölock.h
>

35 
	~<thªadli°.h
>

36 
	~<machöe/vm.h
>

38 
num_˝us
;

50 
	s˝u
 {

54 
˝u
 *
	mc_£lf
;

55 
	mc_numbî
;

56 
	mc_h¨dw¨e_numbî
;

61 
thªad
 *
	mc_cuπhªad
;

62 
thªadli°
 
	mc_zombõs
;

63 
	mc_h¨d˛ocks
;

64 
	mc_•ölocks
;

70 
boﬁ
 
	mc_isidÀ
;

71 
thªadli°
 
	mc_runqueue
;

72 
•ölock
 
	mc_runqueue_lock
;

87 
uöt32_t
 
	mc_ùi_≥ndög
;

88 
ébshoŸdown
 
	mc_shoŸdown
[
TLBSHOOTDOWN_MAX
];

89 
	mc_numshoŸdown
;

90 
•ölock
 
	mc_ùi_lock
;

95 
HANGMAN_ACTOR
(
c_h™gm™
);

111 
˝u
 *
˝u_¸óã
(
h¨dw¨e_numbî
);

112 
˝u_machdï_öô
(
˝u
 *);

113  
˝u_°¨t_£c⁄d¨y
();

114 
˝u_h©ch
(
so·w¨e_numbî
);

119 
˝u_idítify
(*
buf
, 
size_t
 
max
);

126 
˝u_úqoff
();

127 
˝u_úq⁄
();

143 
˝u_idÀ
();

144 
˝u_hÆt
();

165 
	#IPI_PANIC
 0

	)

166 
	#IPI_OFFLINE
 1

	)

167 
	#IPI_UNIDLE
 2

	)

168 
	#IPI_TLBSHOOTDOWN
 3

	)

170 
ùi_£nd
(
˝u
 *
èrgë
, 
code
);

171 
ùi_brﬂdˇ°
(
code
);

172 
ùi_ébshoŸdown
(
˝u
 *
èrgë
, c⁄° 
ébshoŸdown
 *
m≠pög
);

174 
öãΩro˚ss‹_öãºu±
();

	@/home/trinity/src/kern/include/current.h

30 #i‚de‡
_CURRENT_H_


31 
	#_CURRENT_H_


	)

66 
	~<machöe/cuºít.h
>

68 #i‡
deföed
(
__NEED_CURTHREAD
)

70 
	~<˝u.h
>

71 
	#cuπhªad
 
cur˝u
->
c_cuπhªad


	)

72 
	#CURCPU_EXISTS
(Ë(
cur˝u
 !
NULL
)

	)

76 #i‡
deföed
(
__NEED_CURCPU
)

78 
	~<thªad.h
>

79 
	#cur˝u
 
cuπhªad
->
t_˝u


	)

80 
	#CURCPU_EXISTS
(Ë(
cuπhªad
 !
NULL
)

	)

90 
	#cuΩroc
 (
cuπhªad
->
t_¥oc
)

	)

	@/home/trinity/src/kern/include/device.h

30 #i‚de‡
_DEVICE_H_


31 
	#_DEVICE_H_


	)

38 
	guio
;

43 
	sdevi˚
 {

44 c⁄° 
devi˚_›s
 *
	md_›s
;

46 
blk˙t_t
 
	md_blocks
;

47 
blksize_t
 
	md_blocksize
;

49 
dev_t
 
	md_devnumbî
;

51 *
	md_d©a
;

60 
	sdevi˚_›s
 {

61 (*
	mdev›_óch›í
)(
	mdevi˚
 *, 
	mÊags_‰om_›í
);

62 (*
	mdev›_io
)(
	mdevi˚
 *, 
	muio
 *);

63 (*
	mdev›_io˘l
)(
	mdevi˚
 *, 
	m›
, 
u£Ωå_t
 
	md©a
);

69 
	#DEVOP_EACHOPEN
(
d
, 
f
Ë((d)->
d_›s
->
	`dev›_óch›í
(d, f))

	)

70 
	#DEVOP_IO
(
d
, 
u
Ë((d)->
d_›s
->
	`dev›_io
(d, u))

	)

71 
	#DEVOP_IOCTL
(
d
, 
›
, 
p
Ë((d)->
d_›s
->
	`dev›_io˘l
(d, op,Ö))

	)

75 
vnode
 *
dev_¸óã_vnode
(
devi˚
 *
dev
);

78 
dev_un¸óã_vnode
(
vnode
 *
vn
);

81 
devnuŒ_¸óã
();

84 
dev_boŸ°øp
();

	@/home/trinity/src/kern/include/elf.h

30 #i‚de‡
_ELF_H_


31 
	#_ELF_H_


	)

44 
	~<machöe/ñf.h
>

50 
	#ELF_NIDENT
 16

	)

52 
	me_idít
[
ELF_NIDENT
];

53 
uöt16_t
 
	me_ty≥
;

54 
uöt16_t
 
	me_machöe
;

55 
uöt32_t
 
	me_vîsi⁄
;

56 
uöt32_t
 
	me_íåy
;

57 
uöt32_t
 
	me_phoff
;

58 
uöt32_t
 
	me_shoff
;

59 
uöt32_t
 
	me_Êags
;

60 
uöt16_t
 
	me_ehsize
;

61 
uöt16_t
 
	me_phítsize
;

62 
uöt16_t
 
	me_phnum
;

63 
uöt16_t
 
	me_shítsize
;

64 
uöt16_t
 
	me_shnum
;

65 
uöt16_t
 
	me_sh°∫dx
;

66 } 
	tElf32_Ehdr
;

69 
	#EI_MAG0
 0

	)

70 
	#EI_MAG1
 1

	)

71 
	#EI_MAG2
 2

	)

72 
	#EI_MAG3
 3

	)

73 
	#EI_CLASS
 4

	)

74 
	#EI_DATA
 5

	)

75 
	#EI_VERSION
 6

	)

76 
	#EI_OSABI
 7

	)

77 
	#EI_ABIVERSION
 8

	)

78 
	#EI_PAD
 9

	)

83 
	#ELFMAG0
 0x7f

	)

84 
	#ELFMAG1
 'E'

	)

85 
	#ELFMAG2
 'L'

	)

86 
	#ELFMAG3
 'F'

	)

89 
	#ELFCLASSNONE
 0

	)

90 
	#ELFCLASS32
 1

	)

91 
	#ELFCLASS64
 2

	)

94 
	#ELFDATANONE
 0

	)

95 
	#ELFDATA2LSB
 1

	)

96 
	#ELFDATA2MSB
 2

	)

99 
	#EV_NONE
 0

	)

100 
	#EV_CURRENT
 1

	)

103 
	#ELFOSABI_SYSV
 0

	)

104 
	#ELFOSABI_HPUX
 1

	)

105 
	#ELFOSABI_STANDALONE
 255

	)

111 
	#ET_NONE
 0

	)

112 
	#ET_REL
 1

	)

113 
	#ET_EXEC
 2

	)

114 
	#ET_DYN
 3

	)

115 
	#ET_CORE
 4

	)

116 
	#ET_NUM
 5

	)

121 
	#EM_NONE
 0

	)

122 
	#EM_M32
 1

	)

123 
	#EM_SPARC
 2

	)

124 
	#EM_386
 3

	)

125 
	#EM_68K
 4

	)

126 
	#EM_88K
 5

	)

127 
	#EM_486
 6

	)

128 
	#EM_860
 7

	)

129 
	#EM_MIPS
 8

	)

130 
	#EM_S370
 9

	)

131 
	#EM_MIPS_RS3_LE
 10

	)

132 
	#EM_RS6000
 11

	)

133 
	#EM_PARISC
 15

	)

134 
	#EM_NCUBE
 16

	)

135 
	#EM_VPP500
 17

	)

136 
	#EM_SPARC32PLUS
 18

	)

137 
	#EM_960
 19

	)

138 
	#EM_PPC
 20

	)

139 
	#EM_V800
 36

	)

140 
	#EM_FR20
 37

	)

141 
	#EM_RH32
 38

	)

142 
	#EM_RCE
 39

	)

143 
	#EM_ARM
 40

	)

144 
	#EM_ALPHA
 41

	)

145 
	#EM_SH
 42

	)

146 
	#EM_SPARCV9
 43

	)

147 
	#EM_TRICORE
 44

	)

148 
	#EM_ARC
 45

	)

149 
	#EM_H8_300
 46

	)

150 
	#EM_H8_300H
 47

	)

151 
	#EM_H8S
 48

	)

152 
	#EM_H8_500
 49

	)

153 
	#EM_IA_64
 50

	)

154 
	#EM_MIPS_X
 51

	)

155 
	#EM_COLDFIRE
 52

	)

156 
	#EM_68HC12
 53

	)

157 
	#EM_VAX
 75

	)

158 
	#EM_ALPHA_EXP
 36902

	)

159 
	#EM_NUM
 36903

	)

169 
uöt32_t
 
	mp_ty≥
;

170 
uöt32_t
 
	mp_off£t
;

171 
uöt32_t
 
	mp_vaddr
;

172 
uöt32_t
 
	mp_∑ddr
;

173 
uöt32_t
 
	mp_fûesz
;

174 
uöt32_t
 
	mp_memsz
;

175 
uöt32_t
 
	mp_Êags
;

176 
uöt32_t
 
	mp_Æign
;

177 } 
	tElf32_Phdr
;

180 
	#PT_NULL
 0

	)

181 
	#PT_LOAD
 1

	)

182 
	#PT_DYNAMIC
 2

	)

183 
	#PT_INTERP
 3

	)

184 
	#PT_NOTE
 4

	)

185 
	#PT_SHLIB
 5

	)

186 
	#PT_PHDR
 6

	)

187 
	#PT_NUM
 7

	)

188 
	#PT_MIPS_REGINFO
 0x70000000

	)

191 
	#PF_R
 0x4

	)

192 
	#PF_W
 0x2

	)

193 
	#PF_X
 0x1

	)

196 
Elf32_Ehdr
 
	tElf_Ehdr
;

197 
Elf32_Phdr
 
	tElf_Phdr
;

	@/home/trinity/src/kern/include/emufs.h

30 #i‚de‡
_EMUFS_H_


31 
	#_EMUFS_H_


	)

37 
	~<fs.h
>

38 
	~<vnode.h
>

44 
	semufs_vnode
 {

45 
vnode
 
	mev_v
;

46 
emu_so·c
 *
	mev_emu
;

47 
uöt32_t
 
	mev_h™dÀ
;

50 
	semufs_fs
 {

51 
fs
 
	mef_fs
;

52 
emu_so·c
 *
	mef_emu
;

53 
emufs_vnode
 *
	mef_roŸ
;

54 
vnodóºay
 *
	mef_vnodes
;

	@/home/trinity/src/kern/include/endian.h

30 #i‚de‡
_ENDIAN_H_


31 
	#_ENDIAN_H_


	)

33 
	~<kîn/ídün.h
>

39 
uöt16_t
 
bsw≠16
(uint16_t);

40 
uöt32_t
 
bsw≠32
(uint32_t);

41 
uöt64_t
 
bsw≠64
(uint64_t);

43 
uöt16_t
 
¡ohs
(uint16_t);

44 
uöt16_t
 
ht⁄s
(uint16_t);

45 
uöt32_t
 
¡ohl
(uint32_t);

46 
uöt32_t
 
ht⁄l
(uint32_t);

47 
uöt64_t
 
¡ohŒ
(uint64_t);

48 
uöt64_t
 
ht⁄Œ
(uint64_t);

51 
joö32to64
(
uöt32_t
 
x1
, uöt32_à
x2
, 
uöt64_t
 *
y2
);

52 
•lô64to32
(
uöt64_t
 
x
, 
uöt32_t
 *
y1
, uöt32_à*
y2
);

	@/home/trinity/src/kern/include/fs.h

30 #i‚de‡
_FS_H_


31 
	#_FS_H_


	)

33 
	gvnode
;

42 
	sfs
 {

43 *
	mfs_d©a
;

44 c⁄° 
fs_›s
 *
	mfs_›s
;

72 
	sfs_›s
 {

73 (*
	mfs›_sync
)(
	mfs
 *);

74 c⁄° *(*
	mfs›_gëvﬁ«me
)(
	mfs
 *);

75 (*
	mfs›_gëroŸ
)(
	mfs
 *, 
	mvnode
 **);

76 (*
	mfs›_unmou¡
)(
	mfs
 *);

82 
	#FSOP_SYNC
(
fs
Ë((fs)->
fs_›s
->
	`fs›_sync
(fs))

	)

83 
	#FSOP_GETVOLNAME
(
fs
Ë((fs)->
fs_›s
->
	`fs›_gëvﬁ«me
(fs))

	)

84 
	#FSOP_GETROOT
(
fs
, 
ªt
Ë((fs)->
fs_›s
->
	`fs›_gëroŸ
(fs,Ñë))

	)

85 
	#FSOP_UNMOUNT
(
fs
Ë((fs)->
fs_›s
->
	`fs›_unmou¡
(fs))

	)

88 
£mfs_boŸ°øp
();

	@/home/trinity/src/kern/include/hangman.h

30 #i‚de‡
HANGMAN_H


31 
	#HANGMAN_H


	)

38 
	~"›t-h™gm™.h
"

40 #i‡
OPT_HANGMAN


42 
	sh™gm™_a˘‹
 {

43 c⁄° *
	ma_«me
;

44 c⁄° 
h™gm™_lockabÀ
 *
	ma_waôög
;

47 
	sh™gm™_lockabÀ
 {

48 c⁄° *
	ml_«me
;

49 c⁄° 
h™gm™_a˘‹
 *
	ml_hﬁdög
;

52 
h™gm™_waô
(
h™gm™_a˘‹
 *
a
, 
h™gm™_lockabÀ
 *
l
);

53 
h™gm™_acquúe
(
h™gm™_a˘‹
 *
a
, 
h™gm™_lockabÀ
 *
l
);

54 
h™gm™_ªÀa£
(
h™gm™_a˘‹
 *
a
, 
h™gm™_lockabÀ
 *
l
);

56 
	#HANGMAN_ACTOR
(
sym
Ë
h™gm™_a˘‹
 
	)
sym

57 
	#HANGMAN_LOCKABLE
(
sym
Ë
h™gm™_lockabÀ
 
	)
sym

59 
	#HANGMAN_ACTORINIT
(
a
, 
n
Ë(◊)->
a_«me
 = (n), (a)->
a_waôög
 = 
NULL
)

	)

60 
	#HANGMAN_LOCKABLEINIT
(
l
, 
n
Ë(÷)->
l_«me
 = (n), (l)->
l_hﬁdög
 = 
NULL
)

	)

62 
	#HANGMAN_LOCKABLE_INITIALIZER
 { "•ölock", 
NULL
 }

	)

64 
	#HANGMAN_WAIT
(
a
, 
l
Ë
	`h™gm™_waô
◊,Ü)

	)

65 
	#HANGMAN_ACQUIRE
(
a
, 
l
Ë
	`h™gm™_acquúe
◊,Ü)

	)

66 
	#HANGMAN_RELEASE
(
a
, 
l
Ë
	`h™gm™_ªÀa£
◊,Ü)

	)

70 
	#HANGMAN_ACTOR
(
sym
)

	)

71 
	#HANGMAN_LOCKABLE
(
sym
)

	)

73 
	#HANGMAN_ACTORINIT
(
a
, 
«me
)

	)

74 
	#HANGMAN_LOCKABLEINIT
(
a
, 
«me
)

	)

76 
	#HANGMAN_LOCKABLE_INITIALIZER


	)

78 
	#HANGMAN_WAIT
(
a
, 
l
)

	)

79 
	#HANGMAN_ACQUIRE
(
a
, 
l
)

	)

80 
	#HANGMAN_RELEASE
(
a
, 
l
)

	)

	@/home/trinity/src/kern/include/kern/endian.h

30 #i‚de‡
_KERN_ENDIAN_H_


31 
	#_KERN_ENDIAN_H_


	)

42 
	#_LITTLE_ENDIAN
 1234

	)

43 
	#_BIG_ENDIAN
 4321

	)

44 
	#_PDP_ENDIAN
 3412

	)

47 
	~<kîn/machöe/ídün.h
>

	@/home/trinity/src/kern/include/kern/errmsg.h

30 #i‚de‡
_KERN_ERRMSG_H_


31 
	#_KERN_ERRMSG_H_


	)

41 c⁄° *c⁄° 
	gsys_îæi°
[] = {

112 c⁄° 
	gsys_√º
 = (
sys_îæi°
)/(const *);

	@/home/trinity/src/kern/include/kern/errno.h

30 #i‚de‡
_KERN_ERRNO_H_


31 
	#_KERN_ERRNO_H_


	)

45 
	#ENOSYS
 1

	)

47 
	#ENOMEM
 3

	)

48 
	#EAGAIN
 4

	)

49 
	#EINTR
 5

	)

50 
	#EFAULT
 6

	)

51 
	#ENAMETOOLONG
 7

	)

52 
	#EINVAL
 8

	)

53 
	#EPERM
 9

	)

54 
	#EACCES
 10

	)

55 
	#EMPROC
 11

	)

56 
	#ENPROC
 12

	)

57 
	#ENOEXEC
 13

	)

58 
	#E2BIG
 14

	)

59 
	#ESRCH
 15

	)

60 
	#ECHILD
 16

	)

61 
	#ENOTDIR
 17

	)

62 
	#EISDIR
 18

	)

63 
	#ENOENT
 19

	)

64 
	#ELOOP
 20

	)

65 
	#ENOTEMPTY
 21

	)

66 
	#EEXIST
 22

	)

67 
	#EMLINK
 23

	)

68 
	#EXDEV
 24

	)

69 
	#ENODEV
 25

	)

70 
	#ENXIO
 26

	)

71 
	#EBUSY
 27

	)

72 
	#EMFILE
 28

	)

73 
	#ENFILE
 29

	)

74 
	#EBADF
 30

	)

75 
	#EIOCTL
 31

	)

76 
	#EIO
 32

	)

77 
	#ESPIPE
 33

	)

78 
	#EPIPE
 34

	)

79 
	#EROFS
 35

	)

80 
	#ENOSPC
 36

	)

81 
	#EDQUOT
 37

	)

82 
	#EFBIG
 38

	)

83 
	#EFTYPE
 39

	)

84 
	#EDOM
 40

	)

85 
	#ERANGE
 41

	)

86 
	#EILSEQ
 42

	)

87 
	#ENOTSOCK
 43

	)

88 
	#EISSOCK
 44

	)

89 
	#EISCONN
 45

	)

90 
	#ENOTCONN
 46

	)

91 
	#ESHUTDOWN
 47

	)

92 
	#EPFNOSUPPORT
 48

	)

93 
	#ESOCKTNOSUPPORT
 49

	)

94 
	#EPROTONOSUPPORT
 50

	)

95 
	#EPROTOTYPE
 51

	)

96 
	#EAFNOSUPPORT
 52

	)

97 
	#ENOPROTOOPT
 53

	)

98 
	#EADDRINUSE
 54

	)

99 
	#EADDRNOTAVAIL
 55

	)

100 
	#ENETDOWN
 56

	)

101 
	#ENETUNREACH
 57

	)

102 
	#EHOSTDOWN
 58

	)

103 
	#EHOSTUNREACH
 59

	)

104 
	#ECONNREFUSED
 60

	)

105 
	#ETIMEDOUT
 61

	)

106 
	#ECONNRESET
 62

	)

107 
	#EMSGSIZE
 63

	)

108 
	#ENOTSUP
 64

	)

	@/home/trinity/src/kern/include/kern/fcntl.h

30 #i‚de‡
_KERN_FCNTL_H_


31 
	#_KERN_FCNTL_H_


	)

43 
	#O_RDONLY
 0

	)

44 
	#O_WRONLY
 1

	)

45 
	#O_RDWR
 2

	)

47 
	#O_CREAT
 4

	)

48 
	#O_EXCL
 8

	)

49 
	#O_TRUNC
 16

	)

50 
	#O_APPEND
 32

	)

51 
	#O_NOCTTY
 64

	)

54 
	#O_ACCMODE
 3

	)

61 
	#LOCK_SH
 1

	)

62 
	#LOCK_EX
 2

	)

63 
	#LOCK_UN
 3

	)

64 
	#LOCK_NB
 4

	)

71 
	#F_DUPFD
 0

	)

72 
	#F_GETFD
 1

	)

73 
	#F_SETFD
 2

	)

74 
	#F_GETFL
 3

	)

75 
	#F_SETFL
 4

	)

76 
	#F_GETOWN
 5

	)

77 
	#F_SETOWN
 6

	)

78 
	#F_GETLK
 7

	)

79 
	#F_SETLK
 8

	)

80 
	#F_SETLKW
 9

	)

83 
	#FD_CLOEXEC
 1

	)

86 
	#F_RDLCK
 0

	)

87 
	#F_WRLCK
 1

	)

88 
	#F_UNLCK
 2

	)

91 
	sÊock
 {

92 
off_t
 
	ml_°¨t
;

93 
	ml_whí˚
;

94 
	ml_ty≥
;

95 
off_t
 
	ml_Àn
;

96 
pid_t
 
	ml_pid
;

	@/home/trinity/src/kern/include/kern/ioctl.h

30 #i‚de‡
_KERN_IOCTL_H_


31 
	#_KERN_IOCTL_H_


	)

	@/home/trinity/src/kern/include/kern/iovec.h

30 #i‚de‡
_KERN_IOVEC_H_


31 
	#_KERN_IOVEC_H_


	)

38 
	siovec
 {

57 #ifde‡
_KERNEL


59 
u£Ωå_t
 
	miov_uba£
;

60 *
	miov_kba£
;

63 *
	miov_ba£
;

65 
size_t
 
	miov_Àn
;

	@/home/trinity/src/kern/include/kern/limits.h

30 #i‚de‡
_KERN_LIMITS_H_


31 
	#_KERN_LIMITS_H_


	)

60 
	#__NAME_MAX
 255

	)

63 
	#__PATH_MAX
 1024

	)

66 
	#__ARG_MAX
 (64 * 1024)

	)

77 
	#__PID_MIN
 2

	)

80 
	#__PID_MAX
 32767

	)

83 
	#__OPEN_MAX
 128

	)

86 
	#__PIPE_BUF
 512

	)

95 
	#__NGROUPS_MAX
 32

	)

98 
	#__LOGIN_NAME_MAX
 17

	)

106 
	#__IOV_MAX
 1024

	)

	@/home/trinity/src/kern/include/kern/reboot.h

30 #i‚de‡
_KERN_REBOOT_H_


31 
	#_KERN_REBOOT_H_


	)

40 
	#RB_REBOOT
 0

	)

41 
	#RB_HALT
 1

	)

42 
	#RB_POWEROFF
 2

	)

	@/home/trinity/src/kern/include/kern/resource.h

30 #i‚de‡
_KERN_RESOURCE_H_


31 
	#_KERN_RESOURCE_H_


	)

41 
	#PRIO_MIN
 (-20)

	)

42 
	#PRIO_MAX
 20

	)

45 
	#PRIO_PROCESS
 0

	)

46 
	#PRIO_PGRP
 1

	)

47 
	#PRIO_USER
 2

	)

50 
	#RUSAGE_SELF
 0

	)

51 
	#RUSAGE_CHILDREN
 (-1)

	)

53 
	srußge
 {

54 
timevÆ
 
	mru_utime
;

55 
timevÆ
 
	mru_°ime
;

56 
__size_t
 
	mru_maxrss
;

57 
__cou¡î_t
 
	mru_ixrss
;

58 
__cou¡î_t
 
	mru_idrss
;

59 
__cou¡î_t
 
	mru_i§ss
;

60 
__cou¡î_t
 
	mru_möÊt
;

61 
__cou¡î_t
 
	mru_majÊt
;

62 
__cou¡î_t
 
	mru_nsw≠
;

63 
__cou¡î_t
 
	mru_öblock
;

64 
__cou¡î_t
 
	mru_oublock
;

65 
__cou¡î_t
 
	mru_msgrcv
;

66 
__cou¡î_t
 
	mru_msg¢d
;

67 
__cou¡î_t
 
	mru_nsig«ls
;

68 
__cou¡î_t
 
	mru_nvcsw
;

69 
__cou¡î_t
 
	mru_nivcsw
;

74 
	#RLIMIT_NPROC
 0

	)

75 
	#RLIMIT_NOFILE
 1

	)

76 
	#RLIMIT_CPU
 2

	)

77 
	#RLIMIT_DATA
 3

	)

78 
	#RLIMIT_STACK
 4

	)

79 
	#RLIMIT_MEMLOCK
 5

	)

80 
	#RLIMIT_RSS
 6

	)

81 
	#RLIMIT_CORE
 7

	)

82 
	#RLIMIT_FSIZE
 8

	)

83 
	#__RLIMIT_NUM
 9

	)

85 
	sæimô
 {

86 
__æim_t
 
	mæim_cur
;

87 
__æim_t
 
	mæim_max
;

90 
	#RLIM_INFINITY
 (~(
__æim_t
)0)

	)

	@/home/trinity/src/kern/include/kern/secret.h

37 #i‚de‡
_SECRET_H_


38 
	#_SECRET_H_


	)

47 #unde‡
SECRET_TESTING


48 
	#SECRET
 "SECRET"

	)

	@/home/trinity/src/kern/include/kern/secure.h

1 #i‚de‡
_KERN_SECURE_H_


2 
	#_KERN_SECURE_H_


	)

12 
hmac
(c⁄° *
msg
, 
size_t
 
msg_Àn
, c⁄° *
key
, size_à
key_Àn
,

13 **
hash_°r
);

15 
hmac_ß…ed
(c⁄° *
msg
, 
size_t
 
msg_Àn
, c⁄° *
key
, size_à
key_Àn
,

16 **
hash_°r
, **
ß…_°r
);

	@/home/trinity/src/kern/include/kern/seek.h

30 #i‚de‡
_KERN_SEEK_H_


31 
	#_KERN_SEEK_H_


	)

42 
	#SEEK_SET
 0

	)

43 
	#SEEK_CUR
 1

	)

44 
	#SEEK_END
 2

	)

	@/home/trinity/src/kern/include/kern/sfs.h

30 #i‚de‡
_KERN_SFS_H_


31 
	#_KERN_SFS_H_


	)

39 
	#SFS_MAGIC
 0xabadf001

	)

40 
	#SFS_BLOCKSIZE
 512

	)

41 
	#SFS_VOLNAME_SIZE
 32

	)

42 
	#SFS_NDIRECT
 15

	)

43 
	#SFS_NINDIRECT
 1

	)

44 
	#SFS_NDINDIRECT
 0

	)

45 
	#SFS_NTINDIRECT
 0

	)

46 
	#SFS_DBPERIDB
 128

	)

47 
	#SFS_NAMELEN
 60

	)

48 
	#SFS_SUPER_BLOCK
 0

	)

49 
	#SFS_FREEMAP_START
 2

	)

50 
	#SFS_NOINO
 0

	)

51 
	#SFS_ROOTDIR_INO
 1

	)

54 
	#SFS_BITSPERBLOCK
 (
SFS_BLOCKSIZE
 * 
CHAR_BIT
)

	)

57 
	#SFS_ROUNDUP
(
a
,
b
Ë(((◊)+(b)-1)/(b))*b)

	)

60 
	#SFS_FREEMAPBITS
(
nblocks
Ë
	`SFS_ROUNDUP
“blocks, 
SFS_BITSPERBLOCK
)

	)

63 
	#SFS_FREEMAPBLOCKS
(
nblocks
Ë(
	`SFS_FREEMAPBITS
“blocks)/
SFS_BITSPERBLOCK
)

	)

66 
	#SFS_TYPE_INVAL
 0

	)

67 
	#SFS_TYPE_FILE
 1

	)

68 
	#SFS_TYPE_DIR
 2

	)

73 
	ssfs_su≥rblock
 {

74 
uöt32_t
 
	msb_magic
;

75 
uöt32_t
 
	msb_nblocks
;

76 
	msb_vﬁ«me
[
SFS_VOLNAME_SIZE
];

77 
uöt32_t
 
	mª£rved
[118];

83 
	ssfs_döode
 {

84 
uöt32_t
 
	msfi_size
;

85 
uöt16_t
 
	msfi_ty≥
;

86 
uöt16_t
 
	msfi_lökcou¡
;

87 
uöt32_t
 
	msfi_dúe˘
[
SFS_NDIRECT
];

88 
uöt32_t
 
	msfi_ödúe˘
;

89 
uöt32_t
 
	msfi_wa°e
[128-3-
SFS_NDIRECT
];

95 
	ssfs_dúíåy
 {

96 
uöt32_t
 
	msfd_öo
;

97 
	msfd_«me
[
SFS_NAMELEN
];

	@/home/trinity/src/kern/include/kern/signal.h

37 #i‚de‡
_KERN_SIGNAL_H_


38 
	#_KERN_SIGNAL_H_


	)

56 
	#SIGHUP
 1

	)

57 
	#SIGINT
 2

	)

58 
	#SIGQUIT
 3

	)

59 
	#SIGILL
 4

	)

60 
	#SIGTRAP
 5

	)

61 
	#SIGABRT
 6

	)

62 
	#SIGEMT
 7

	)

63 
	#SIGFPE
 8

	)

64 
	#SIGKILL
 9

	)

65 
	#SIGBUS
 10

	)

66 
	#SIGSEGV
 11

	)

67 
	#SIGSYS
 12

	)

68 
	#SIGPIPE
 13

	)

69 
	#SIGALRM
 14

	)

70 
	#SIGTERM
 15

	)

71 
	#SIGURG
 16

	)

72 
	#SIGSTOP
 17

	)

73 
	#SIGTSTP
 18

	)

74 
	#SIGCONT
 19

	)

75 
	#SIGCHLD
 20

	)

76 
	#SIGTTIN
 21

	)

77 
	#SIGTTOU
 22

	)

78 
	#SIGIO
 23

	)

79 
	#SIGXCPU
 24

	)

80 
	#SIGXFSZ
 25

	)

81 
	#SIGVTALRM
 26

	)

82 
	#SIGPROF
 27

	)

83 
	#SIGWINCH
 28

	)

84 
	#SIGINFO
 29

	)

85 
	#SIGUSR1
 20

	)

86 
	#SIGUSR2
 31

	)

87 
	#SIGPWR
 32

	)

88 
	#_NSIG
 32

	)

92 
__u32
 
	tsig£t_t
;

95 
	#SA_ONSTACK
 1

	)

96 
	#SA_RESTART
 2

	)

97 
	#SA_RESETHAND
 4

	)

100 
	#SIG_BLOCK
 1

	)

101 
	#SIG_UNBLOCK
 2

	)

102 
	#SIG_SETMASK
 3

	)

105 (*
	t__sigfunc
)();

108 
	#SIG_DFL
 ((
__sigfunc
Ë0Ë

	)

109 
	#SIG_IGN
 ((
__sigfunc
Ë1Ë

	)

114 
	ssiga˘i⁄
 {

115 
__sigfunc
 
ß_h™dÀr
;

116 
sig£t_t
 
ß_mask
;

117 
ß_Êags
;

124 
	ssigÆt°ack
 {

125 *
ss_•
;

126 
size_t
 
ss_size
;

127 
ss_Êags
;

	@/home/trinity/src/kern/include/kern/socket.h

30 #i‚de‡
_KERN_SOCKET_H_


31 
	#_KERN_SOCKET_H_


	)

43 
	#SOCK_STREAM
 1

	)

44 
	#SOCK_DGRAM
 2

	)

45 
	#SOCK_RAW
 3

	)

48 
	#AF_UNSPEC
 0

	)

49 
	#AF_UNIX
 1

	)

50 
	#AF_INET
 2

	)

51 
	#AF_INET6
 3

	)

54 
	#PF_UNSPEC
 
AF_UNSPEC


	)

55 
	#PF_UNIX
 
AF_UNIX


	)

56 
	#PF_INET
 
AF_INET


	)

57 
	#PF_INET6
 
AF_INET6


	)

73 
	ssockaddr
 {

74 
__u8
 
	mß_Àn
;

75 
__u8
 
	mß_Ámûy
;

78 
	#_SS_SIZE
 128

	)

79 
	ssockaddr_°‹age
 {

80 
__u8
 
	mss_Àn
;

81 
__u8
 
	mss_Ámûy
;

82 
__u8
 
	m__ss_∑d1
;

83 
__u8
 
	m__ss_∑d2
;

84 
__u32
 
	m__ss_∑d3
;

85 
__u64
 
	m__ss_∑d4
;

86 
	m__ss_∑d5
[
_SS_SIZE
 - (
__u64
Ë- (
__u32
Ë- 4*(
__u8
)];

98 
	smsghdr
 {

99 *
	mmsg_«me
;

100 
sockÀn_t
 
	mmsg_«mñí
;

101 
iovec
 *
	mmsg_iov
;

102 
	mmsg_iovÀn
;

103 *
	mmsg_c⁄åﬁ
;

104 
sockÀn_t
 
	mmsg_c⁄åﬁÀn
;

105 
	mmsg_Êags
;

108 
	scmsghdr
 {

109 
sockÀn_t
 
	mcmsg_Àn
;

110 
	mcmsg_Àvñ
;

111 
	mcmsg_ty≥
;

	@/home/trinity/src/kern/include/kern/stat.h

30 #i‚de‡
_KERN_STAT_H_


31 
	#_KERN_STAT_H_


	)

42 
	s°©
 {

44 
off_t
 
	m°_size
;

45 
mode_t
 
	m°_mode
;

46 
∆ök_t
 
	m°_∆ök
;

47 
blk˙t_t
 
	m°_blocks
;

50 
dev_t
 
	m°_dev
;

51 
öo_t
 
	m°_öo
;

52 
dev_t
 
	m°_rdev
;

55 
time_t
 
	m°_©ime
;

56 
time_t
 
	m°_˘ime
;

57 
time_t
 
	m°_mtime
;

58 
__u32
 
	m°_©imí£c
;

59 
__u32
 
	m°_˘imí£c
;

60 
__u32
 
	m°_mtimí£c
;

63 
uid_t
 
	m°_uid
;

64 
gid_t
 
	m°_gid
;

67 
__u32
 
	m°_gí
;

68 
blksize_t
 
	m°_blksize
;

	@/home/trinity/src/kern/include/kern/stattypes.h

30 #i‚de‡
_KERN_STATTYPES_H_


31 
	#_KERN_STATTYPES_H_


	)

45 
	#_S_IFMT
 070000

	)

46 
	#_S_IFREG
 010000

	)

47 
	#_S_IFDIR
 020000

	)

48 
	#_S_IFLNK
 030000

	)

49 
	#_S_IFIFO
 040000

	)

50 
	#_S_IFSOCK
 050000

	)

51 
	#_S_IFCHR
 060000

	)

52 
	#_S_IFBLK
 070000

	)

	@/home/trinity/src/kern/include/kern/syscall.h

30 #i‚de‡
_KERN_SYSCALL_H_


31 
	#_KERN_SYSCALL_H_


	)

50 
	#SYS_f‹k
 0

	)

51 
	#SYS_vf‹k
 1

	)

52 
	#SYS_execv
 2

	)

53 
	#SYS__exô
 3

	)

54 
	#SYS_waôpid
 4

	)

55 
	#SYS_gëpid
 5

	)

56 
	#SYS_gëµid
 6

	)

58 
	#SYS_sbrk
 7

	)

59 
	#SYS_mm≠
 8

	)

60 
	#SYS_munm≠
 9

	)

61 
	#SYS_m¥Ÿe˘
 10

	)

69 
	#SYS_umask
 17

	)

70 
	#SYS_is£tugid
 18

	)

71 
	#SYS_gëªsuid
 19

	)

72 
	#SYS_£åesuid
 20

	)

73 
	#SYS_gëªsgid
 21

	)

74 
	#SYS_£åesgid
 22

	)

75 
	#SYS_gëgroups
 23

	)

76 
	#SYS_£tgroups
 24

	)

77 
	#SYS___gëlogö
 25

	)

78 
	#SYS___£éogö
 26

	)

80 
	#SYS_kûl
 27

	)

81 
	#SYS_siga˘i⁄
 28

	)

82 
	#SYS_sig≥ndög
 29

	)

83 
	#SYS_sig¥ocmask
 30

	)

84 
	#SYS_sigsu•íd
 31

	)

85 
	#SYS_sigªtu∫
 32

	)

105 
	#SYS_›í
 45

	)

106 
	#SYS_pùe
 46

	)

107 
	#SYS_dup
 47

	)

108 
	#SYS_dup2
 48

	)

109 
	#SYS_˛o£
 49

	)

110 
	#SYS_ªad
 50

	)

111 
	#SYS_¥ód
 51

	)

114 
	#SYS_gëdúíåy
 54

	)

115 
	#SYS_wrôe
 55

	)

116 
	#SYS_pwrôe
 56

	)

119 
	#SYS_l£ek
 59

	)

120 
	#SYS_Êock
 60

	)

121 
	#SYS_·runˇã
 61

	)

122 
	#SYS_fsync
 62

	)

123 
	#SYS_f˙é
 63

	)

124 
	#SYS_io˘l
 64

	)

125 
	#SYS_£À˘
 65

	)

126 
	#SYS_pﬁl
 66

	)

129 
	#SYS_lök
 67

	)

130 
	#SYS_ªmove
 68

	)

131 
	#SYS_mkdú
 69

	)

132 
	#SYS_rmdú
 70

	)

133 
	#SYS_mkfifo
 71

	)

134 
	#SYS_ª«me
 72

	)

135 
	#SYS_ac˚ss
 73

	)

137 
	#SYS_chdú
 74

	)

138 
	#SYS_fchdú
 75

	)

139 
	#SYS___gëcwd
 76

	)

141 
	#SYS_symlök
 77

	)

142 
	#SYS_ªadlök
 78

	)

144 
	#SYS_mou¡
 79

	)

145 
	#SYS_unmou¡
 80

	)

149 
	#SYS_°©
 81

	)

150 
	#SYS_f°©
 82

	)

151 
	#SYS_l°©
 83

	)

153 
	#SYS_utimes
 84

	)

154 
	#SYS_futimes
 85

	)

155 
	#SYS_lutimes
 86

	)

157 
	#SYS_chmod
 87

	)

158 
	#SYS_chown
 88

	)

159 
	#SYS_fchmod
 89

	)

160 
	#SYS_fchown
 90

	)

161 
	#SYS_lchmod
 91

	)

162 
	#SYS_lchown
 92

	)

172 
	#SYS_sockë
 98

	)

173 
	#SYS_böd
 99

	)

174 
	#SYS_c⁄√˘
 100

	)

175 
	#SYS_li°í
 101

	)

176 
	#SYS_ac˚±
 102

	)

178 
	#SYS_shutdown
 104

	)

179 
	#SYS_gësock«me
 105

	)

180 
	#SYS_gë≥î«me
 106

	)

181 
	#SYS_gësock›t
 107

	)

182 
	#SYS_£tsock›t
 108

	)

189 
	#SYS___time
 113

	)

190 
	#SYS___£âime
 114

	)

191 
	#SYS_«no¶ìp
 115

	)

196 
	#SYS_sync
 118

	)

197 
	#SYS_ªboŸ
 119

	)

	@/home/trinity/src/kern/include/kern/test161.h

30 #i‚de‡
_KERN_TEST161_H_


31 
	#_KERN_TEST161_H_


	)

33 
	#TEST161_SUCCESS
 0

	)

34 
	#TEST161_FAIL
 1

	)

36 
	~<kîn/£¸ë.h
>

38 #ifde‡
_KERNEL


39 
	#__TEST161_PROGRESS_N
(
ôî
, 
mod
) do { \

40 i‡(((
ôî
Ë% 
mod
) == 0) { \

41 
	`k¥ötf
("."); \

43 } 0)

	)

45 
	~<°dio.h
>

46 
	#__TEST161_PROGRESS_N
(
ôî
, 
mod
) do { \

47 i‡(((
ôî
Ë% 
mod
) == 0) { \

48 
	`¥ötf
("."); \

50 } 0)

	)

54 
	#TEST161_LPROGRESS_N
(
ôî
, 
mod
Ë
	`__TEST161_PROGRESS_N
(ôî, mod)

	)

55 
	#TEST161_LPROGRESS
(
ôî
Ë
	`__TEST161_PROGRESS_N
(ôî, 100)

	)

59 #ifde‡
SECRET_TESTING


60 
	#TEST161_TPROGRESS_N
(
ôî
, 
mod
Ë
	`__TEST161_PROGRESS_N
(ôî, mod)

	)

61 
	#TEST161_TPROGRESS
(
ôî
Ë
	`__TEST161_PROGRESS_N
(ôî, 100)

	)

63 
	#TEST161_TPROGRESS_N
(
ôî
, 
mod
)

	)

64 
	#TEST161_TPROGRESS
(
ôî
)

	)

67 
suc˚ss
(, const *, const *);

68 
£˝rötf
(c⁄° *
£¸ë
, c⁄° *
msg
, c⁄° *
«me
);

69 
¢£˝rötf
(
size_t
 
Àn
, *
buf„r
, c⁄° *
£¸ë
, c⁄° *
msg
, c⁄° *
«me
);

70 
∑πül_¸edô
(c⁄° *
£¸ë
, c⁄° *
«me
, 
sc‹ed
, 
tŸÆ
);

72 #ifde‡
_KERNEL


73 
ã°161_boŸ°øp
();

	@/home/trinity/src/kern/include/kern/time.h

30 #i‚de‡
_KERN_TIME_H_


31 
	#_KERN_TIME_H_


	)

43 
	stimevÆ
 {

44 
__time_t
 
	mtv_£c
;

45 
__i32
 
	mtv_u£c
;

48 
	stime•ec
 {

49 
__time_t
 
	mtv_£c
;

50 
__i32
 
	mtv_n£c
;

59 
	#ITIMER_REAL
 0

	)

60 
	#ITIMER_VIRTUAL
 1

	)

61 
	#ITIMER_PROF
 2

	)

64 
	sôimîvÆ
 {

65 
timevÆ
 
	mô_öãrvÆ
;

66 
timevÆ
 
	mô_vÆue
;

	@/home/trinity/src/kern/include/kern/types.h

30 #i‚de‡
_KERN_TYPES_H_


31 
	#_KERN_TYPES_H_


	)

34 
	~<kîn/machöe/ty≥s.h
>

64 
__u32
 
	t__blk˙t_t
;

65 
__u32
 
	t__blksize_t
;

66 
__u64
 
	t__cou¡î_t
;

67 
__u32
 
	t__daddr_t
;

68 
__u32
 
	t__dev_t
;

69 
__u32
 
	t__fsid_t
;

70 
__i32
 
	t__gid_t
;

71 
__u32
 
	t__ö_addr_t
;

72 
__u32
 
	t__ö_p‹t_t
;

73 
__u32
 
	t__öo_t
;

74 
__u32
 
	t__mode_t
;

75 
__u16
 
	t__∆ök_t
;

76 
__i64
 
	t__off_t
;

77 
__i32
 
	t__pid_t
;

78 
__u64
 
	t__æim_t
;

79 
__u8
 
	t__ß_Ámûy_t
;

80 
__i64
 
	t__time_t
;

81 
__i32
 
	t__uid_t
;

83 
	t__nfds_t
;

84 
	t__sockÀn_t
;

87 #ifde‡
__GNUC__


88 
__buûtö_va_li°
 
	t__va_li°
;

	@/home/trinity/src/kern/include/kern/unistd.h

30 #i‚de‡
_KERN_UNISTD_H_


31 
	#_KERN_UNISTD_H_


	)

34 
	#STDIN_FILENO
 0

	)

35 
	#STDOUT_FILENO
 1

	)

36 
	#STDERR_FILENO
 2

	)

	@/home/trinity/src/kern/include/kern/wait.h

30 #i‚de‡
_KERN_WAIT_H_


31 
	#_KERN_WAIT_H_


	)

39 
	#WNOHANG
 1

	)

40 
	#WUNTRACED
 2

	)

43 
	#WAIT_ANY
 (-1Ë

	)

44 
	#WAIT_MYPGRP
 0

	)

54 
	#_WWHAT
(
x
Ë((x)&3Ë

	)

55 
	#_WVAL
(
x
Ë((x)>>2Ë

	)

56 
	#_MKWVAL
(
x
Ë((x)<<2Ë

	)

59 
	#__WEXITED
 0

	)

60 
	#__WSIGNALED
 1

	)

61 
	#__WCORED
 2

	)

62 
	#__WSTOPPED
 3

	)

65 
	#WIFEXITED
(
x
Ë(
	`_WWHAT
(x)==
__WEXITED
)

	)

66 
	#WIFSIGNALED
(
x
Ë(
	`_WWHAT
(x)==
__WSIGNALED
 || _WWHAT(x)==
__WCORED
)

	)

67 
	#WIFSTOPPED
(
x
Ë(
	`_WWHAT
(x)==
__WSTOPPED
)

	)

68 
	#WEXITSTATUS
(
x
Ë(
	`_WVAL
(x))

	)

69 
	#WTERMSIG
(
x
Ë(
	`_WVAL
(x))

	)

70 
	#WSTOPSIG
(
x
Ë(
	`_WVAL
(x))

	)

71 
	#WCOREDUMP
(
x
Ë(
	`_WWHAT
(x)==
__WCORED
)

	)

74 
	#_MKWAIT_EXIT
(
x
Ë(
	`_MKWVAL
(x)|
__WEXITED
)

	)

75 
	#_MKWAIT_SIG
(
x
Ë(
	`_MKWVAL
(x)|
__WSIGNALED
)

	)

76 
	#_MKWAIT_CORE
(
x
Ë(
	`_MKWVAL
(x)|
__WCORED
)

	)

77 
	#_MKWAIT_STOP
(
x
Ë(
	`_MKWVAL
(x)|
__WSTOPPED
)

	)

	@/home/trinity/src/kern/include/lib.h

30 #i‚de‡
_LIB_H_


31 
	#_LIB_H_


	)

41 
	~<cdefs.h
>

60 
	~"›t-nﬂs£πs.h
"

62 #i‡
OPT_NOASSERTS


63 
	#KASSERT
(
ex¥
Ë(()”x¥))

	)

65 
	#KASSERT
(
ex¥
) \

66 ((
ex¥
Ë? ()0 : 
	`badas£π
(#ex¥, 
__FILE__
, 
__LINE__
, 
__func__
))

	)

70 
	#DEBUGASSERT
(
ex¥
Ë(()”x¥))

	)

72 
	#DEBUGASSERT
(
ex¥
) \

73 ((
ex¥
Ë? ()0 : 
	`badas£π
(#ex¥, 
__FILE__
, 
__LINE__
, 
__func__
))

	)

79 
	#DB_LOCORE
 0x0001

	)

80 
	#DB_SYSCALL
 0x0002

	)

81 
	#DB_INTERRUPT
 0x0004

	)

82 
	#DB_DEVICE
 0x0008

	)

83 
	#DB_THREADS
 0x0010

	)

84 
	#DB_VM
 0x0020

	)

85 
	#DB_EXEC
 0x0040

	)

86 
	#DB_VFS
 0x0080

	)

87 
	#DB_SEMFS
 0x0100

	)

88 
	#DB_SFS
 0x0200

	)

89 
	#DB_NET
 0x0400

	)

90 
	#DB_NETFS
 0x0800

	)

91 
	#DB_KMALLOC
 0x1000

	)

93 
uöt32_t
 
dbÊags
;

111 
	#DEBUG
(
d
, ...Ë((
dbÊags
 & (d)Ë? 
	`k¥ötf
(
__VA_ARGS__
Ë: 0)

	)

118 
	#RANDOM_MAX
 (
	`øndmax
())

	)

119 
uöt32_t
 
øndmax
();

120 
uöt32_t
 
øndom
();

129 *
kmÆloc
(
size_t
 
size
);

130 
k‰ì
(*
±r
);

131 
khóp_¥öt°©s
();

132 
khóp_¥ötu£d
();

133 
khóp_gëu£d
();

134 
khóp_√xtgíî©i⁄
();

135 
khóp_dump
();

136 
khóp_dum∑Œ
();

144 
size_t
 
°æí
(c⁄° *
°r
);

145 
°rcmp
(c⁄° *
°r1
, c⁄° *
°r2
);

146 *
°r˝y
(*
de°
, c⁄° *
§c
);

147 *
°rˇt
(*
de°
, c⁄° *
§c
);

148 *
k°rdup
(c⁄° *
°r
);

149 *
°rchr
(c⁄° *
£¨ched
, 
£¨chf‹
);

150 *
°ºchr
(c⁄° *
£¨ched
, 
£¨chf‹
);

151 *
°πok_r
(*
buf
, c⁄° *
£ps
, **
c⁄ãxt
);

153 *
mem˝y
(*
de°
, c⁄° *
§c
, 
size_t
 
Àn
);

154 *
memmove
(*
de°
, c⁄° *
§c
, 
size_t
 
Àn
);

155 *
mem£t
(*
block
, 
ch
, 
size_t
 
Àn
);

156 
bzîo
(*
±r
, 
size_t
 
Àn
);

157 
©oi
(c⁄° *
°r
);

159 
	$¢¥ötf
(*
buf
, 
size_t
 
maxÀn
, c⁄° *
fmt
, ...Ë
	`__PF
(3,4);

161 c⁄° *
	`°ªº‹
(
îrcode
);

166 
	`putch
(
ch
);

167 
	`gëch
();

168 
	`bìp
();

183 
	$k¥ötf
(c⁄° *
f‹m©
, ...Ë
	`__PF
(1,2);

184 
__DEAD
 
	$∑nic
(c⁄° *
f‹m©
, ...Ë
	`__PF
(1,2);

185 
__DEAD
 
	`badas£π
(c⁄° *
ex¥
, c⁄° *
fûe
,

186 
löe
, c⁄° *
func
);

188 
	`kgës
(*
buf
, 
size_t
 
maxbuÊí
);

190 
	`k¥ötf_boŸ°øp
();

196 
	#DIVROUNDUP
(
a
,
b
Ë((◊)+(b)-1)/(b))

	)

197 
	#ROUNDUP
(
a
,
b
Ë(
	`DIVROUNDUP
◊,b)*(b))

	)

	@/home/trinity/src/kern/include/limits.h

30 #i‚de‡
_LIMITS_H_


31 
	#_LIMITS_H_


	)

38 
	~<kîn/limôs.h
>

41 
	#NAME_MAX
 
__NAME_MAX


	)

42 
	#PATH_MAX
 
__PATH_MAX


	)

43 
	#ARG_MAX
 
__ARG_MAX


	)

44 
	#PID_MIN
 
__PID_MIN


	)

45 
	#PID_MAX
 
__PID_MAX


	)

46 
	#PIPE_BUF
 
__PIPE_BUF


	)

47 
	#NGROUPS_MAX
 
__NGROUPS_MAX


	)

48 
	#LOGIN_NAME_MAX
 
__LOGIN_NAME_MAX


	)

49 
	#OPEN_MAX
 
__OPEN_MAX


	)

50 
	#IOV_MAX
 
__IOV_MAX


	)

	@/home/trinity/src/kern/include/mainbus.h

30 #i‚de‡
_MAINBUS_H_


31 
	#_MAINBUS_H_


	)

38 
	g˝u
;

39 
	gå≠‰ame
;

43 
maöbus_boŸ°øp
();

46 
maöbus_°¨t_˝us
();

49 
maöbus_öãºu±
(
å≠‰ame
 *);

53 
size_t
 
maöbus_ømsize
();

56 
maöbus_£nd_ùi
(
˝u
 *
èrgë
);

59 
maöbus_debuggî
();

67 
maöbus_hÆt
();

68 
maöbus_powîoff
();

69 
maöbus_ªboŸ
();

70 
maöbus_∑nic
();

	@/home/trinity/src/kern/include/membar.h

30 #i‚de‡
_MEMBAR_H_


31 
	#_MEMBAR_H_


	)

80 #i‚de‡
MEMBAR_INLINE


81 
	#MEMBAR_INLINE
 
INLINE


	)

84 
MEMBAR_INLINE
 
memb¨_lﬂd_lﬂd
();

85 
MEMBAR_INLINE
 
memb¨_°‹e_°‹e
();

86 
MEMBAR_INLINE
 
memb¨_°‹e_™y
();

87 
MEMBAR_INLINE
 
memb¨_™y_°‹e
();

88 
MEMBAR_INLINE
 
memb¨_™y_™y
();

91 
	~<machöe/memb¨.h
>

	@/home/trinity/src/kern/include/proc.h

30 #i‚de‡
_PROC_H_


31 
	#_PROC_H_


	)

39 
	~<•ölock.h
>

41 
	gaddr•a˚
;

42 
	gthªad
;

43 
	gvnode
;

62 
	s¥oc
 {

63 *
	mp_«me
;

64 
•ölock
 
	mp_lock
;

65 
	mp_numthªads
;

68 
addr•a˚
 *
	mp_addr•a˚
;

71 
vnode
 *
	mp_cwd
;

77 
¥oc
 *
k¥oc
;

80 
¥oc_boŸ°øp
();

83 
¥oc
 *
¥oc_¸óã_ru≈rogøm
(c⁄° *
«me
);

86 
¥oc_de°roy
(
¥oc
 *proc);

89 
¥oc_addthªad
(
¥oc
 *¥oc, 
thªad
 *
t
);

92 
¥oc_ªmthªad
(
thªad
 *
t
);

95 
addr•a˚
 *
¥oc_gëas
();

98 
addr•a˚
 *
¥oc_£ès
(addrspace *);

	@/home/trinity/src/kern/include/prompt.h

37 #i‚de‡
_PROMPT_H_


38 
	#_PROMPT_H_


	)

45 
	#KERNEL_PROMPT
 "OS/161 kî√»[? f‹ míu]: "

	)

	@/home/trinity/src/kern/include/setjmp.h

30 #i‚de‡
_SETJMP_H_


31 
	#_SETJMP_H_


	)

38 
	~<kîn/machöe/£tjmp.h
>

40 
£tjmp
(
jmp_buf
 
jb
);

41 
l⁄gjmp
(
jmp_buf
 
jb
, 
ªtvÆ
);

	@/home/trinity/src/kern/include/sfs.h

30 #i‚de‡
_SFS_H_


31 
	#_SFS_H_


	)

42 
	~<fs.h
>

43 
	~<vnode.h
>

49 
	~<kîn/sfs.h
>

54 
	ssfs_vnode
 {

55 
vnode
 
	msv_absvn
;

56 
sfs_döode
 
	msv_i
;

57 
uöt32_t
 
	msv_öo
;

58 
boﬁ
 
	msv_dúty
;

64 
	ssfs_fs
 {

65 
fs
 
	msfs_absfs
;

66 
sfs_su≥rblock
 
	msfs_sb
;

67 
boﬁ
 
	msfs_su≥rdúty
;

68 
devi˚
 *
	msfs_devi˚
;

69 
vnodóºay
 *
	msfs_vnodes
;

70 
bôm≠
 *
	msfs_‰ìm≠
;

71 
boﬁ
 
	msfs_‰ìm≠dúty
;

77 
sfs_mou¡
(c⁄° *
devi˚
);

	@/home/trinity/src/kern/include/signal.h

30 #i‚de‡
_SIGNAL_H_


31 
	#_SIGNAL_H_


	)

35 
	~<kîn/machöe/sig«l.h
>

36 
	~<kîn/sig«l.h
>

	@/home/trinity/src/kern/include/spinlock.h

30 #i‚de‡
_SPINLOCK_H_


31 
	#_SPINLOCK_H_


	)

38 
	~<cdefs.h
>

39 
	~<h™gm™.h
>

42 #i‚de‡
SPINLOCK_INLINE


43 
	#SPINLOCK_INLINE
 
INLINE


	)

47 
	~<machöe/•ölock.h
>

58 
	s•ölock
 {

59 vﬁ©ûê
•ölock_d©a_t
 
	m•lk_lock
;

60 
˝u
 *
	m•lk_hﬁdî
;

61 
HANGMAN_LOCKABLE
(
•lk_h™gm™
);

67 #ifde‡
OPT_HANGMAN


68 
	#SPINLOCK_INITIALIZER
 { 
SPINLOCK_DATA_INITIALIZER
, 
NULL
, \

69 
HANGMAN_LOCKABLE_INITIALIZER
 }

	)

71 
	#SPINLOCK_INITIALIZER
 { 
SPINLOCK_DATA_INITIALIZER
, 
NULL
 }

	)

86 
•ölock_öô
(
•ölock
 *
lk
);

87 
•ölock_˛ónup
(
•ölock
 *
lk
);

89 
•ölock_acquúe
(
•ölock
 *
lk
);

90 
•ölock_ªÀa£
(
•ölock
 *
lk
);

92 
boﬁ
 
•ölock_do_i_hﬁd
(
•ölock
 *
lk
);

	@/home/trinity/src/kern/include/spl.h

30 #i‚de‡
_SPL_H_


31 
	#_SPL_H_


	)

33 
	~<cdefs.h
>

36 #i‚de‡
SPL_INLINE


37 
	#SPL_INLINE
 
INLINE


	)

70 
SPL_INLINE
 
•l0
();

71 
SPL_INLINE
 
•lhigh
();

72 
•lx
();

77 
	#IPL_NONE
 0

	)

78 
	#IPL_HIGH
 1

	)

89 
•Ãai£
(
ﬁdùl
, 
√wùl
);

90 
•Œowî
(
ﬁdùl
, 
√wùl
);

94 
SPL_INLINE


96 
	$•l0
()

98  
	`•lx
(
IPL_NONE
);

99 
	}
}

101 
SPL_INLINE


103 
	$•lhigh
()

105  
	`•lx
(
IPL_HIGH
);

106 
	}
}

	@/home/trinity/src/kern/include/stat.h

30 #i‚de‡
_STAT_H_


31 
	#_STAT_H_


	)

34 
	~<kîn/°©.h
>

37 
	~<kîn/°©ty≥s.h
>

40 
	#S_IFMT
 
_S_IFMT


	)

41 
	#S_IFREG
 
_S_IFREG


	)

42 
	#S_IFDIR
 
_S_IFDIR


	)

43 
	#S_IFLNK
 
_S_IFLNK


	)

44 
	#S_IFIFO
 
_S_IFIFO


	)

45 
	#S_IFSOCK
 
_S_IFSOCK


	)

46 
	#S_IFCHR
 
_S_IFCHR


	)

47 
	#S_IFBLK
 
_S_IFBLK


	)

	@/home/trinity/src/kern/include/stdarg.h

30 #i‚de‡
_STDARG_H_


31 
	#_STDARG_H_


	)

35 
	~<cdefs.h
>

45 #ifde‡
__GNUC__


46 
__va_li°
 
	tva_li°
;

48 #i‡
__GNUC__
 < 4 || (__GNUC__ =4 && 
__GNUC_MINOR__
 < 8)

49 
	#va_°¨t
(
≠
, 
fmt
Ë
	`__buûtö_°d¨g_°¨t
◊p, fmt)

	)

51 
	#va_°¨t
(
≠
, 
fmt
Ë
	`__buûtö_va_°¨t
◊p, fmt)

	)

53 
	#va_¨g
(
≠
,
t
Ë
	`__buûtö_va_¨g
◊p,Å)

	)

54 
	#va_c›y
(
≠1
, 
≠2
Ë
	`__buûtö_va_c›y
◊p1,áp2)

	)

55 
	#va_íd
(
≠
Ë
	`__buûtö_va_íd
◊p)

	)

65 
	$vk¥ötf
(c⁄° *
fmt
, 
va_li°
 
≠
Ë
	`__PF
(1,0);

66 
	$v¢¥ötf
(*
buf
, 
size_t
 
maxÀn
, c⁄° *
fmt
, 
va_li°
 
≠
Ë
	`__PF
(3,0);

75 
	$__v¥ötf
((*
func
)(*
˛õ¡d©a
, c⁄° *
°r
, 
size_t
 
Àn
),

76 *
˛õ¡d©a
, c⁄° *
f‹m©
, 
va_li°
 
≠
Ë
	`__PF
(3,0);

	@/home/trinity/src/kern/include/synch.h

30 #i‚de‡
_SYNCH_H_


31 
	#_SYNCH_H_


	)

38 
	~<•ölock.h
>

46 
	s£m≠h‹e
 {

47 *
	m£m_«me
;

48 
wch™
 *
	m£m_wch™
;

49 
•ölock
 
	m£m_lock
;

50 vﬁ©ûê
	m£m_cou¡
;

53 
£m≠h‹e
 *
£m_¸óã
(c⁄° *
«me
, 
öôül_cou¡
);

54 
£m_de°roy
(
£m≠h‹e
 *);

62 
P
(
£m≠h‹e
 *);

63 
V
(
£m≠h‹e
 *);

76 
	#MAX_NAME_LENGTH
 64

	)

77 
	slock
 {

78 *
	mlk_«me
;

79 
HANGMAN_LOCKABLE
(
lk_h™gm™
);

82 vﬁ©ûê
	mlock_cou¡
;

83 
	mthªad_«me
[
MAX_NAME_LENGTH
];

86 
lock
 *
lock_¸óã
(c⁄° *
«me
);

87 
lock_de°roy
(
lock
 *);

100 
lock_acquúe
(
lock
 *);

101 
lock_ªÀa£
(
lock
 *);

102 
boﬁ
 
lock_do_i_hﬁd
(
lock
 *);

119 
	scv
 {

120 *
	mcv_«me
;

125 
cv
 *
cv_¸óã
(c⁄° *
«me
);

126 
cv_de°roy
(
cv
 *);

141 
cv_waô
(
cv
 *cv, 
lock
 *lock);

142 
cv_sig«l
(
cv
 *cv, 
lock
 *lock);

143 
cv_brﬂdˇ°
(
cv
 *cv, 
lock
 *lock);

155 
	srwlock
 {

156 *
	mrwlock_«me
;

161 
rwlock
 * 
rwlock_¸óã
(const *);

162 
rwlock_de°roy
(
rwlock
 *);

176 
rwlock_acquúe_ªad
(
rwlock
 *);

177 
rwlock_ªÀa£_ªad
(
rwlock
 *);

178 
rwlock_acquúe_wrôe
(
rwlock
 *);

179 
rwlock_ªÀa£_wrôe
(
rwlock
 *);

	@/home/trinity/src/kern/include/syscall.h

30 #i‚de‡
_SYSCALL_H_


31 
	#_SYSCALL_H_


	)

34 
	~<cdefs.h
>

35 
	gå≠‰ame
;

41 
sysˇŒ
(
å≠‰ame
 *
tf
);

48 
íãr_f‹ked_¥o˚ss
(
å≠‰ame
 *
tf
);

51 
__DEAD
 
íãr_√w_¥o˚ss
(
¨gc
, 
u£Ωå_t
 
¨gv
, u£Ωå_à
ív
,

52 
vaddr_t
 
°ack±r
, vaddr_à
íåypoöt
);

59 
sys_ªboŸ
(
code
);

60 
sys___time
(
u£Ωå_t
 
u£r_£c⁄ds
, u£Ωå_à
u£r_«no£c⁄ds
);

	@/home/trinity/src/kern/include/test.h

30 #i‚de‡
_TEST_H_


31 
	#_TEST_H_


	)

34 
	~<cdefs.h
>

35 
	~<kîn/£¸ë.h
>

37 
	~"›t-synch¥obs.h
"

38 
	~"›t-autom©i⁄ã°.h
"

51 
¨øyã°
(, **);

52 
¨øyã°2
(, **);

53 
bôm≠ã°
(, **);

54 
thªadli°ã°
(, **);

57 
thªadã°
(, **);

58 
thªadã°2
(, **);

59 
thªadã°3
(, **);

60 
£mã°
(, **);

61 
lockã°
(, **);

62 
lockã°2
(, **);

63 
lockã°3
(, **);

64 
lockã°4
(, **);

65 
lockã°5
(, **);

66 
cvã°
(, **);

67 
cvã°2
(, **);

68 
cvã°3
(, **);

69 
cvã°4
(, **);

70 
cvã°5
(, **);

71 
rwã°
(, **);

72 
rwã°2
(, **);

73 
rwã°3
(, **);

74 
rwã°4
(, **);

75 
rwã°5
(, **);

78 
£mu1
(, **);

79 
£mu2
(, **);

80 
£mu3
(, **);

81 
£mu4
(, **);

82 
£mu5
(, **);

83 
£mu6
(, **);

84 
£mu7
(, **);

85 
£mu8
(, **);

86 
£mu9
(, **);

87 
£mu10
(, **);

88 
£mu11
(, **);

89 
£mu12
(, **);

90 
£mu13
(, **);

91 
£mu14
(, **);

92 
£mu15
(, **);

93 
£mu16
(, **);

94 
£mu17
(, **);

95 
£mu18
(, **);

96 
£mu19
(, **);

97 
£mu20
(, **);

98 
£mu21
(, **);

99 
£mu22
(, **);

102 
f°e°
(, **);

103 
ªad°ªss
(, **);

104 
wrôe°ªss
(, **);

105 
wrôe°ªss2
(, **);

106 
l⁄g°ªss
(, **);

107 
¸óã°ªss
(, **);

108 
¥ötfûe
(, **);

111 
hmacu1
(, **);

114 
kmÆlo˘e°
(, **);

115 
kmÆloc°ªss
(, **);

116 
kmÆlo˘e°3
(, **);

117 
kmÆlo˘e°4
(, **);

118 
kmÆlo˘e°5
(, **);

119 
√âe°
(, **);

122 
ru≈rogøm
(*
¥og«me
);

125 
míu
(*
¨g°r
);

128 
kmaö
(*
boŸ°rög
);

130 #i‡
OPT_SYNCHPROBS


136 
mÆe_°¨t
(
uöt32_t
);

137 
mÆe_íd
(
uöt32_t
);

138 
„mÆe_°¨t
(
uöt32_t
);

139 
„mÆe_íd
(
uöt32_t
);

140 
m©chmakî_°¨t
(
uöt32_t
);

141 
m©chmakî_íd
(
uöt32_t
);

142 
whÆem©ög
(, **);

144 
öQuadø¡
(, 
uöt32_t
);

145 
ÀaveI¡î£˘i⁄
(
uöt32_t
);

146 
°›light
(, **);

156 
whÆem©ög_öô
();

157 
whÆem©ög_˛ónup
();

158 
mÆe
(
uöt32_t
);

159 
„mÆe
(
uöt32_t
);

160 
m©chmakî
(
uöt32_t
);

166 
go°øight
(
uöt32_t
, uint32_t);

167 
tu∫À·
(
uöt32_t
, uint32_t);

168 
tu∫right
(
uöt32_t
, uint32_t);

169 
°›light_öô
();

170 
°›light_˛ónup
();

178 #i‡
OPT_AUTOMATIONTEST


179 
d…e°
(, **);

180 
Œ1ã°
(, **);

181 
Œ16ã°
(, **);

184 
øndom_yõldî
(
uöt32_t
);

185 
øndom_•ö√r
(
uöt32_t
);

191 #ifde‡
SECRET_TESTING


192 
	#k¥ötf_t
(...Ë
	`k¥ötf
(
__VA_ARGS__
)

	)

193 
	#k¥ötf_n
(...Ë
	`sûít
(
__VA_ARGS__
)

	)

195 
	#k¥ötf_t
(...Ë
	`sûít
(
__VA_ARGS__
)

	)

196 
	#k¥ötf_n
(...Ë
	`k¥ötf
(
__VA_ARGS__
)

	)

199 
ölöe
 
	$sûít
(c⁄° * 
fmt
, ...Ë{ ()fmt; 
	}
};

	@/home/trinity/src/kern/include/thread.h

30 #i‚de‡
_THREAD_H_


31 
	#_THREAD_H_


	)

39 
	~<¨øy.h
>

40 
	~<•ölock.h
>

41 
	~<thªadli°.h
>

43 
	g˝u
;

46 
	~<machöe/thªad.h
>

50 
	#STACK_SIZE
 4096

	)

51 
	#MAX_NAME_LENGTH
 64

	)

54 
	#STACK_MASK
 (~(
vaddr_t
)(
STACK_SIZE
-1))

	)

57 
	#SAME_STACK
(
p1
, 
p2
Ë((’1Ë& 
STACK_MASK
Ë=(’2Ë& STACK_MASK))

	)

62 
	mS_RUN
,

63 
	mS_READY
,

64 
	mS_SLEEP
,

65 
	mS_ZOMBIE
,

66 } 
	tthªad°©e_t
;

69 
	sthªad
 {

83 
	mt_«me
[
MAX_NAME_LENGTH
];

84 c⁄° *
	mt_wch™_«me
;

85 
thªad°©e_t
 
	mt_°©e
;

90 
thªad_machdï
 
	mt_machdï
;

91 
thªadli°node
 
	mt_li°node
;

92 *
	mt_°ack
;

93 
swôch‰ame
 *
	mt_c⁄ãxt
;

94 
˝u
 *
	mt_˝u
;

95 
¥oc
 *
	mt_¥oc
;

96 
HANGMAN_ACTOR
(
t_h™gm™
);

111 
boﬁ
 
	mt_ö_öãºu±
;

112 
	mt_cur•l
;

113 
	mt_ùlhigh_cou¡
;

125 #i‚de‡
THREADINLINE


126 
	#THREADINLINE
 
INLINE


	)

129 
DECLARRAY
(
thªad
, 
THREADINLINE
);

130 
DEFARRAY
(
thªad
, 
THREADINLINE
);

133 
thªad_boŸ°øp
();

136 
thªad_°¨t_˝us
();

139 
thªad_∑nic
();

142 
thªad_shutdown
();

154 
thªad_f‹k
(c⁄° *
«me
, 
¥oc
 *proc,

155 (*
func
)(*, ),

156 *
d©a1
, 
d©a2
);

162 
__DEAD
 
	`thªad_exô
();

169 
	`thªad_yõld
();

174 
	`scheduÀ
();

180 
	`thªad_c⁄sidî_migøti⁄
();

182 
thªad_cou¡
;

183 
	`thªad_waô_f‹_cou¡
();

	@/home/trinity/src/kern/include/threadlist.h

30 #i‚de‡
_THREADLIST_H_


31 
	#_THREADLIST_H_


	)

34 
	gthªad
;

57 
	sthªadli°node
 {

58 
thªadli°node
 *
	mén_¥ev
;

59 
thªadli°node
 *
	mén_√xt
;

60 
thªad
 *
	mén_£lf
;

63 
	sthªadli°
 {

64 
thªadli°node
 
	mé_hód
;

65 
thªadli°node
 
	mé_èû
;

66 
	mé_cou¡
;

70 
thªadli°node_öô
(
thªadli°node
 *
én
, 
thªad
 *
£lf
);

71 
thªadli°node_˛ónup
(
thªadli°node
 *
én
);

74 
thªadli°_öô
(
thªadli°
 *
é
);

75 
thªadli°_˛ónup
(
thªadli°
 *
é
);

78 
boﬁ
 
thªadli°_i£m±y
(
thªadli°
 *
é
);

81 
thªadli°_addhód
(
thªadli°
 *
é
, 
thªad
 *
t
);

82 
thªadli°_addèû
(
thªadli°
 *
é
, 
thªad
 *
t
);

83 
thªad
 *
thªadli°_ªmhód
(
thªadli°
 *
é
);

84 
thªad
 *
thªadli°_ªmèû
(
thªadli°
 *
é
);

87 
thªadli°_ö£πa·î
(
thªadli°
 *
é
,

88 
thªad
 *
⁄li°
, thªad *
addì
);

89 
thªadli°_ö£πbef‹e
(
thªadli°
 *
é
,

90 
thªad
 *
addì
, thªad *
⁄li°
);

91 
thªadli°_ªmove
(
thªadli°
 *
é
, 
thªad
 *
t
);

94 
	#THREADLIST_FORALL
(
ôîv¨
, 
é
) \

95 (
ôîv¨
Ë(
é
).
é_hód
.
én_√xt
->
én_£lf
; \

96 (
ôîv¨
Ë!
NULL
; \

97 (
ôîv¨
Ë(ôîv¨)->
t_li°node
.
én_√xt
->
én_£lf
)

	)

99 
	#THREADLIST_FORALL_REV
(
ôîv¨
, 
é
) \

100 (
ôîv¨
Ë(
é
).
é_èû
.
én_¥ev
->
én_£lf
; \

101 (
ôîv¨
Ë!
NULL
; \

102 (
ôîv¨
Ë(ôîv¨)->
t_li°node
.
én_¥ev
->
én_£lf
)

	)

	@/home/trinity/src/kern/include/threadprivate.h

30 #i‚de‡
_THREADPRIVATE_H_


31 
	#_THREADPRIVATE_H_


	)

33 
	gthªad
;

34 
	gthªad_machdï
;

35 
	gswôch‰ame
;

55 
thªad_°¨tup
((*
íåypoöt
)(*
d©a1
, 
d©a2
),

56 *
d©a1
, 
d©a2
);

59 
	`thªad_machdï_öô
(
thªad_machdï
 *
tm
);

60 
	`thªad_machdï_˛ónup
(
thªad_machdï
 *
tm
);

70 
	`swôch‰ame_swôch
(
swôch‰ame
 **
¥ev
, swôch‰amê**
√xt
);

73 
	`swôch‰ame_öô
(
thªad
 *,

74 (*
íåypoöt
)(*
d©a1
, 
d©a2
),

75 *
d©a1
, 
d©a2
);

	@/home/trinity/src/kern/include/types.h

30 #i‚de‡
_TYPES_H_


31 
	#_TYPES_H_


	)

80 
	~<kîn/ty≥s.h
>

83 
	~<machöe/ty≥s.h
>

90 
	s__u£Ωå
 { 
	m_dummy
; };

91 
__u£Ωå
 *
	tu£Ωå_t
;

92 c⁄° 
	t__u£Ωå
 *
	tc⁄°_u£Ωå_t
;

100 
__i8
 
	töt8_t
;

101 
__i16
 
	töt16_t
;

102 
__i32
 
	töt32_t
;

103 
__i64
 
	töt64_t
;

104 
__u8
 
	tuöt8_t
;

105 
__u16
 
	tuöt16_t
;

106 
__u32
 
	tuöt32_t
;

107 
__u64
 
	tuöt64_t
;

108 
__size_t
 
	tsize_t
;

109 
__ssize_t
 
	tssize_t
;

110 
__öçå_t
 
	töçå_t
;

111 
__uöçå_t
 
	tuöçå_t
;

112 
__±rdiff_t
 
	t±rdiff_t
;

115 
__blk˙t_t
 
	tblk˙t_t
;

116 
__blksize_t
 
	tblksize_t
;

117 
__daddr_t
 
	tdaddr_t
;

118 
__dev_t
 
	tdev_t
;

119 
__fsid_t
 
	tfsid_t
;

120 
__gid_t
 
	tgid_t
;

121 
__ö_addr_t
 
	tö_addr_t
;

122 
__ö_p‹t_t
 
	tö_p‹t_t
;

123 
__öo_t
 
	töo_t
;

124 
__mode_t
 
	tmode_t
;

125 
__∆ök_t
 
	t∆ök_t
;

126 
__off_t
 
	toff_t
;

127 
__pid_t
 
	tpid_t
;

128 
__æim_t
 
	tæim_t
;

129 
__ß_Ámûy_t
 
	tß_Ámûy_t
;

130 
__time_t
 
	ttime_t
;

131 
__uid_t
 
	tuid_t
;

133 
__nfds_t
 
	tnfds_t
;

134 
__sockÀn_t
 
	tsockÀn_t
;

140 
	#CHAR_BIT
 
__CHAR_BIT


	)

146 
	#NULL
 ((*)0)

	)

151 
_Boﬁ
 
	tboﬁ
;

152 
	#åue
 1

	)

153 
	#Ál£
 0

	)

	@/home/trinity/src/kern/include/uio.h

30 #i‚de‡
_UIO_H_


31 
	#_UIO_H_


	)

58 
	~<kîn/iovec.h
>

61 
	euio_rw
 {

62 
	mUIO_READ
,

63 
	mUIO_WRITE
,

67 
	euio_£g
 {

68 
	mUIO_USERISPACE
,

69 
	mUIO_USERSPACE
,

70 
	mUIO_SYSSPACE
,

73 
	suio
 {

74 
iovec
 *
	muio_iov
;

75 
	muio_iov˙t
;

76 
off_t
 
	muio_off£t
;

77 
size_t
 
	muio_ªsid
;

78 
uio_£g
 
	muio_£gÊg
;

79 
uio_rw
 
	muio_rw
;

80 
addr•a˚
 *
	muio_•a˚
;

119 
uiomove
(*
kbuf„r
, 
size_t
 
Àn
, 
uio
 *uio);

124 
uiomovezîos
(
size_t
 
Àn
, 
uio
 *uio);

138 
uio_köô
(
iovec
 *, 
uio
 *,

139 *
kbuf
, 
size_t
 
Àn
, 
off_t
 
pos
, 
uio_rw
 
rw
);

	@/home/trinity/src/kern/include/version.h

30 #i‚de‡
_VERSION_H_


31 
	#_VERSION_H_


	)

37 
	#BASE_VERSION
 "2.0.3"

	)

42 
	#GROUP_VERSION
 "0"

	)

	@/home/trinity/src/kern/include/vfs.h

30 #i‚de‡
_VFS_H_


31 
	#_VFS_H_


	)

34 
	~<¨øy.h
>

44 
	guio
;

45 
	gdevi˚
;

46 
	gfs
;

47 
	gvnode
;

62 
vfs_£tcurdú
(
vnode
 *
dú
);

63 
vfs_˛órcurdú
();

64 
vfs_gëcurdú
(
vnode
 **
ªtdú
);

65 
vfs_sync
();

66 
vfs_gëroŸ
(c⁄° *
dev«me
, 
vnode
 **
ªsu…
);

67 c⁄° *
vfs_gëdev«me
(
fs
 *fs);

80 
vfs_lookup
(*
∑th
, 
vnode
 **
ªsu…
);

81 
vfs_look∑ª¡
(*
∑th
, 
vnode
 **
ªsu…
,

82 *
buf
, 
size_t
 
buÊí
);

104 
vfs_›í
(*
∑th
, 
›íÊags
, 
mode_t
 
mode
, 
vnode
 **
ªt
);

105 
vfs_˛o£
(
vnode
 *
vn
);

106 
vfs_ªadlök
(*
∑th
, 
uio
 *
d©a
);

107 
vfs_symlök
(c⁄° *
c⁄ã¡s
, *
∑th
);

108 
vfs_mkdú
(*
∑th
, 
mode_t
 
mode
);

109 
vfs_lök
(*
ﬁd∑th
, *
√w∑th
);

110 
vfs_ªmove
(*
∑th
);

111 
vfs_rmdú
(*
∑th
);

112 
vfs_ª«me
(*
ﬁd∑th
, *
√w∑th
);

114 
vfs_chdú
(*
∑th
);

115 
vfs_gëcwd
(
uio
 *
buf
);

169 
vfs_boŸ°øp
();

171 
vfs_£tboŸfs
(c⁄° *
f¢ame
);

172 
vfs_˛órboŸfs
();

174 
vfs_adddev
(c⁄° *
dev«me
, 
devi˚
 *
dev
, 
mou¡abÀ
);

175 
vfs_addfs
(c⁄° *
dev«me
, 
fs
 *fs);

177 
vfs_mou¡
(c⁄° *
dev«me
, *
d©a
,

178 (*
mou¡func
)(*
d©a
,

179 
devi˚
 *
dev
,

180 
fs
 **
ªsu…
));

181 
	`vfs_unmou¡
(c⁄° *
dev«me
);

182 
	`vfs_sw≠⁄
(c⁄° *
dev«me
, 
vnode
 **
ªsu…
);

183 
	`vfs_sw≠off
(c⁄° *
dev«me
);

184 
	`vfs_unmou¡Æl
();

189 #i‚de‡
VFSINLINE


190 
	#VFSINLINE
 
INLINE


	)

193 
	`DECLARRAY
(
vnode
, 
VFSINLINE
);

194 
	`DEFARRAY
(
vnode
, 
VFSINLINE
);

200 
	`vfs_biglock_acquúe
();

201 
	`vfs_biglock_ªÀa£
();

202 
boﬁ
 
	`vfs_biglock_do_i_hﬁd
();

	@/home/trinity/src/kern/include/vm.h

30 #i‚de‡
_VM_H_


31 
	#_VM_H_


	)

40 
	~<machöe/vm.h
>

43 
	#VM_FAULT_READ
 0

	)

44 
	#VM_FAULT_WRITE
 1

	)

45 
	#VM_FAULT_READONLY
 2

	)

49 
vm_boŸ°øp
();

52 
vm_Áu…
(
Áu…ty≥
, 
vaddr_t
 
Áu…addªss
);

55 
vaddr_t
 
Æloc_k∑ges
(
≈ages
);

56 
‰ì_k∑ges
(
vaddr_t
 
addr
);

63 
c‹em≠_u£d_byãs
();

66 
vm_ébshoŸdown
(c⁄° 
ébshoŸdown
 *);

	@/home/trinity/src/kern/include/vnode.h

30 #i‚de‡
_VNODE_H_


31 
	#_VNODE_H_


	)

33 
	~<•ölock.h
>

34 
	guio
;

35 
	g°©
;

51 
	svnode
 {

52 
	mvn_ªfcou¡
;

53 
•ölock
 
	mvn_cou¡lock
;

55 
fs
 *
	mvn_fs
;

57 *
	mvn_d©a
;

59 c⁄° 
vnode_›s
 *
	mvn_›s
;

178 
	#VOP_MAGIC
 0xa2b3c4d5

	)

180 
	svnode_›s
 {

181 
	mv›_magic
;

183 (*
	mv›_óch›í
)(
vnode
 *
	mobje˘
, 
	mÊags_‰om_›í
);

184 (*
	mv›_ª˛aim
)(
vnode
 *
	mvnode
);

187 (*
	mv›_ªad
)(
vnode
 *
	mfûe
, 
uio
 *
	muio
);

188 (*
	mv›_ªadlök
)(
vnode
 *
	mlök
, 
uio
 *
	muio
);

189 (*
	mv›_gëdúíåy
)(
vnode
 *
	mdú
, 
uio
 *
	muio
);

190 (*
	mv›_wrôe
)(
vnode
 *
	mfûe
, 
uio
 *
	muio
);

191 (*
	mv›_io˘l
)(
vnode
 *
	mobje˘
, 
	m›
, 
u£Ωå_t
 
	md©a
);

192 (*
	mv›_°©
)(
vnode
 *
	mobje˘
, 
°©
 *
	m°©buf
);

193 (*
	mv›_gëty≥
)(
vnode
 *
	mobje˘
, 
mode_t
 *
	mªsu…
);

194 
boﬁ
 (*
v›_is£ekabÀ
)(
vnode
 *
	mobje˘
);

195 (*
	mv›_fsync
)(
vnode
 *
	mobje˘
);

196 (*
	mv›_mm≠
)(
vnode
 *
	mfûe
 );

197 (*
	mv›_åunˇã
)(
vnode
 *
	mfûe
, 
off_t
 
	mÀn
);

198 (*
	mv›_«mefûe
)(
vnode
 *
	mfûe
, 
uio
 *
	muio
);

201 (*
	mv›_¸ót
)(
vnode
 *
	mdú
,

202 c⁄° *
	m«me
, 
boﬁ
 
	mex˛
, 
mode_t
 
	mmode
,

203 
vnode
 **
	mªsu…
);

204 (*
	mv›_symlök
)(
vnode
 *
	mdú
,

205 c⁄° *
	mc⁄ã¡s
, c⁄° *
	m«me
);

206 (*
	mv›_mkdú
)(
vnode
 *
	m∑ª¡dú
,

207 c⁄° *
	m«me
, 
mode_t
 
	mmode
);

208 (*
	mv›_lök
)(
vnode
 *
	mdú
,

209 c⁄° *
	m«me
, 
vnode
 *
	mfûe
);

210 (*
	mv›_ªmove
)(
vnode
 *
	mdú
,

211 c⁄° *
	m«me
);

212 (*
	mv›_rmdú
)(
vnode
 *
	mdú
,

213 c⁄° *
	m«me
);

215 (*
	mv›_ª«me
)(
vnode
 *
	mvn1
, c⁄° *
	m«me1
,

216 
vnode
 *
	mvn2
, c⁄° *
	m«me2
);

219 (*
	mv›_lookup
)(
vnode
 *
	mdú
,

220 *
	m∑th«me
, 
vnode
 **
	mªsu…
);

221 (*
	mv›_look∑ª¡
)(
vnode
 *
	mdú
,

222 *
	m∑th«me
, 
vnode
 **
	mªsu…
,

223 *
	mbuf
, 
size_t
 
	mÀn
);

226 
	#__VOP
(
vn
, 
sym
Ë(
	`vnode_check
(vn, #sym), (vn)->
vn_›s
->
v›_
##sym)

	)

228 
	#VOP_EACHOPEN
(
vn
, 
Êags
Ë(
	`__VOP
(vn, 
óch›í
)(vn, fœgs))

	)

229 
	#VOP_RECLAIM
(
vn
Ë(
	`__VOP
(vn, 
ª˛aim
)(vn))

	)

231 
	#VOP_READ
(
vn
, 
uio
Ë(
	`__VOP
(vn, 
ªad
)(vn, uio))

	)

232 
	#VOP_READLINK
(
vn
, 
uio
Ë(
	`__VOP
(vn, 
ªadlök
)(vn, uio))

	)

233 
	#VOP_GETDIRENTRY
(
vn
, 
uio
Ë(
	`__VOP
(vn,
gëdúíåy
)(vn, uio))

	)

234 
	#VOP_WRITE
(
vn
, 
uio
Ë(
	`__VOP
(vn, 
wrôe
)(vn, uio))

	)

235 
	#VOP_IOCTL
(
vn
, 
code
, 
buf
Ë(
	`__VOP
(vn, 
io˘l
)(vn,code,buf))

	)

236 
	#VOP_STAT
(
vn
, 
±r
Ë(
	`__VOP
(vn, 
°©
)(vn,Öå))

	)

237 
	#VOP_GETTYPE
(
vn
, 
ªsu…
Ë(
	`__VOP
(vn, 
gëty≥
)(vn,Ñesu…))

	)

238 
	#VOP_ISSEEKABLE
(
vn
Ë(
	`__VOP
(vn, 
is£ekabÀ
)(vn))

	)

239 
	#VOP_FSYNC
(
vn
Ë(
	`__VOP
(vn, 
fsync
)(vn))

	)

240 
	#VOP_MMAP
(
vn
 ) (
	`__VOP
(vn, 
mm≠
)(v¿ ))

	)

241 
	#VOP_TRUNCATE
(
vn
, 
pos
Ë(
	`__VOP
(vn, 
åunˇã
)(vn,Öos))

	)

242 
	#VOP_NAMEFILE
(
vn
, 
uio
Ë(
	`__VOP
(vn, 
«mefûe
)(vn, uio))

	)

244 
	#VOP_CREAT
(
vn
,
nm
,
ex˛
,
mode
,
ªs
Ë(
	`__VOP
(vn, 
¸ót
)(vn,nm,ex˛,mode,ªs))

	)

245 
	#VOP_SYMLINK
(
vn
, 
«me
, 
c⁄ã¡
Ë(
	`__VOP
(vn, 
symlök
)(vn,Çame, c⁄ã¡))

	)

246 
	#VOP_MKDIR
(
vn
, 
«me
, 
mode
Ë(
	`__VOP
(vn, 
mkdú
)(vn,Çame, mode))

	)

247 
	#VOP_LINK
(
vn
, 
«me
, 
vn2
Ë(
	`__VOP
(vn, 
lök
)(vn,Çame, vn2))

	)

248 
	#VOP_REMOVE
(
vn
, 
«me
Ë(
	`__VOP
(vn, 
ªmove
)(vn,Çame))

	)

249 
	#VOP_RMDIR
(
vn
, 
«me
Ë(
	`__VOP
(vn, 
rmdú
)(vn,Çame))

	)

250 
	#VOP_RENAME
(
vn1
,
«me1
,
vn2
,
«me2
)(
	`__VOP
(vn1,
ª«me
)(vn1,«me1,vn2,«me2))

	)

252 
	#VOP_LOOKUP
(
vn
, 
«me
, 
ªs
Ë(
	`__VOP
(vn, 
lookup
)(vn,Çame,Ñes))

	)

253 
	#VOP_LOOKPARENT
(
vn
,
nm
,
ªs
,
bf
,
 
Ë(
	`__VOP
(vn,
look∑ª¡
)(vn,nm,ªs,bf, ))

	)

258 
vnode_check
(
vnode
 *, c⁄° *
›
);

263 
vnode_ö¸ef
(
vnode
 *);

264 
vnode_de¸ef
(
vnode
 *);

266 
	#VOP_INCREF
(
vn
Ë
	`vnode_ö¸ef
(vn)

	)

267 
	#VOP_DECREF
(
vn
Ë
	`vnode_de¸ef
(vn)

	)

273 
vnode_öô
(
vnode
 *, c⁄° 
vnode_›s
 *
›s
,

274 
fs
 *fs, *
fsd©a
);

280 
vnode_˛ónup
(
vnode
 *);

285 
v›Áû_uio_nŸdú
(
vnode
 *
vn
, 
uio
 *uio);

286 
v›Áû_uio_isdú
(
vnode
 *
vn
, 
uio
 *uio);

287 
v›Áû_uio_övÆ
(
vnode
 *
vn
, 
uio
 *uio);

288 
v›Áû_uio_nosys
(
vnode
 *
vn
, 
uio
 *uio);

289 
v›Áû_mm≠_isdú
(
vnode
 *
vn
 );

290 
v›Áû_mm≠_≥rm
(
vnode
 *
vn
 );

291 
v›Áû_mm≠_nosys
(
vnode
 *
vn
 );

292 
v›Áû_åunˇã_isdú
(
vnode
 *
vn
, 
off_t
 
pos
);

293 
v›Áû_¸ót_nŸdú
(
vnode
 *
vn
, c⁄° *
«me
, 
boﬁ
 
ex˛
,

294 
mode_t
 
mode
, 
vnode
 **
ªsu…
);

295 
v›Áû_symlök_nŸdú
(
vnode
 *
vn
, c⁄° *
c⁄ã¡s
,

296 c⁄° *
«me
);

297 
v›Áû_symlök_nosys
(
vnode
 *
vn
, c⁄° *
c⁄ã¡s
,

298 c⁄° *
«me
);

299 
v›Áû_mkdú_nŸdú
(
vnode
 *
vn
, c⁄° *
«me
, 
mode_t
 
mode
);

300 
v›Áû_mkdú_nosys
(
vnode
 *
vn
, c⁄° *
«me
, 
mode_t
 
mode
);

301 
v›Áû_lök_nŸdú
(
vnode
 *
dú
, c⁄° *
«me
,

302 
vnode
 *
fûe
);

303 
v›Áû_lök_nosys
(
vnode
 *
dú
, c⁄° *
«me
,

304 
vnode
 *
fûe
);

305 
v›Áû_°rög_nŸdú
(
vnode
 *
vn
, c⁄° *
«me
);

306 
v›Áû_°rög_nosys
(
vnode
 *
vn
, c⁄° *
«me
);

307 
v›Áû_ª«me_nŸdú
(
vnode
 *
‰omdú
, c⁄° *
‰om«me
,

308 
vnode
 *
todú
, c⁄° *
t⁄ame
);

309 
v›Áû_ª«me_nosys
(
vnode
 *
‰omdú
, c⁄° *
‰om«me
,

310 
vnode
 *
todú
, c⁄° *
t⁄ame
);

311 
v›Áû_lookup_nŸdú
(
vnode
 *
vn
, *
∑th
, vnodê**
ªsu…
);

312 
v›Áû_look∑ª¡_nŸdú
(
vnode
 *
vn
, *
∑th
,

313 
vnode
 **
ªsu…
, *
buf
, 
size_t
 
Àn
);

	@/home/trinity/src/kern/include/wchan.h

30 #i‚de‡
_WCHAN_H_


31 
	#_WCHAN_H_


	)

38 
	g•ölock
;

39 
	gwch™
;

46 
wch™
 *
wch™_¸óã
(c⁄° *
«me
);

51 
wch™_de°roy
(
wch™
 *
wc
);

57 
boﬁ
 
wch™_i£m±y
(
wch™
 *
wc
, 
•ölock
 *
lk
);

67 
wch™_¶ìp
(
wch™
 *
wc
, 
•ölock
 *
lk
);

76 
wch™_wake⁄e
(
wch™
 *
wc
, 
•ölock
 *
lk
);

77 
wch™_wakóŒ
(
wch™
 *
wc
, 
•ölock
 *
lk
);

	@/home/trinity/src/kern/lib/array.c

30 
	#ARRAYINLINE


	)

32 
	~<ty≥s.h
>

33 
	~<kîn/î∫o.h
>

34 
	~<lib.h
>

35 
	~<¨øy.h
>

37 
¨øy
 *

38 
	$¨øy_¸óã
()

40 
¨øy
 *
a
;

42 
a
 = 
	`kmÆloc
((*a));

43 i‡(
a
 !
NULL
) {

44 
	`¨øy_öô
(
a
);

46  
a
;

47 
	}
}

50 
	$¨øy_de°roy
(
¨øy
 *
a
)

52 
	`¨øy_˛ónup
(
a
);

53 
	`k‰ì
(
a
);

54 
	}
}

57 
	$¨øy_öô
(
¨øy
 *
a
)

59 
a
->
num
 =á->
max
 = 0;

60 
a
->
v
 = 
NULL
;

61 
	}
}

64 
	$¨øy_˛ónup
(
¨øy
 *
a
)

71 
	`ARRAYASSERT
(
a
->
num
 == 0);

72 
	`k‰ì
(
a
->
v
);

73 #ifde‡
ARRAYS_CHECKED


74 
a
->
v
 = 
NULL
;

76 
	}
}

79 
	$¨øy_¥óŒoˇã
(
¨øy
 *
a
, 
num
)

81 **
√w±r
;

82 
√wmax
;

84 i‡(
num
 > 
a
->
max
) {

86 
√wmax
 = 
a
->
max
;

87 
num
 > 
√wmax
) {

88 
√wmax
 =Çewmax ?Çewmax*2 : 4;

98 
√w±r
 = 
	`kmÆloc
(
√wmax
*(*
a
->
v
));

99 i‡(
√w±r
 =
NULL
) {

100  
ENOMEM
;

102 
	`mem˝y
(
√w±r
, 
a
->
v
,á->
num
*(*a->v));

103 
	`k‰ì
(
a
->
v
);

104 
a
->
v
 = 
√w±r
;

105 
a
->
max
 = 
√wmax
;

108 
	}
}

111 
	$¨øy_£tsize
(
¨øy
 *
a
, 
num
)

113 
ªsu…
;

115 
ªsu…
 = 
	`¨øy_¥óŒoˇã
(
a
, 
num
);

116 i‡(
ªsu…
) {

117  
ªsu…
;

119 
a
->
num
 =Çum;

122 
	}
}

125 
	$¨øy_ªmove
(
¨øy
 *
a
, 
ödex
)

127 
num_to_move
;

129 
	`ARRAYASSERT
(
a
->
num
 <a->
max
);

130 
	`ARRAYASSERT
(
ödex
 < 
a
->
num
);

132 
num_to_move
 = 
a
->
num
 - (
ödex
 + 1);

133 
	`memmove
(
a
->
v
 + 
ödex
,á->v + index+1, 
num_to_move
*(*));

134 
a
->
num
--;

135 
	}
}

	@/home/trinity/src/kern/lib/bitmap.c

34 
	~<ty≥s.h
>

35 
	~<kîn/î∫o.h
>

36 
	~<lib.h
>

37 
	~<bôm≠.h
>

46 
	#BITS_PER_WORD
 (
CHAR_BIT
)

	)

47 
	#WORD_TYPE
 

	)

48 
	#WORD_ALLBITS
 (0xff)

	)

50 
	sbôm≠
 {

51 
	mnbôs
;

52 
WORD_TYPE
 *
	mv
;

56 
bôm≠
 *

57 
	$bôm≠_¸óã
(
nbôs
)

59 
bôm≠
 *
b
;

60 
w‹ds
;

62 
w‹ds
 = 
	`DIVROUNDUP
(
nbôs
, 
BITS_PER_WORD
);

63 
b
 = 
	`kmÆloc
((
bôm≠
));

64 i‡(
b
 =
NULL
) {

65  
NULL
;

67 
b
->
v
 = 
	`kmÆloc
(
w‹ds
*(
WORD_TYPE
));

68 i‡(
b
->
v
 =
NULL
) {

69 
	`k‰ì
(
b
);

70  
NULL
;

73 
	`bzîo
(
b
->
v
, 
w‹ds
*(
WORD_TYPE
));

74 
b
->
nbôs
 =Çbits;

77 i‡(
w‹ds
 > 
nbôs
 / 
BITS_PER_WORD
) {

78 
j
, 
ix
 = 
w‹ds
-1;

79 
ovîbôs
 = 
nbôs
 - 
ix
*
BITS_PER_WORD
;

81 
	`KASSERT
(
nbôs
 / 
BITS_PER_WORD
 =
w‹ds
-1);

82 
	`KASSERT
(
ovîbôs
 > 0 && ovîbô†< 
BITS_PER_WORD
);

84 
j
=
ovîbôs
; j<
BITS_PER_WORD
; j++) {

85 
b
->
v
[
ix
] |((
WORD_TYPE
)1 << 
j
);

89  
b
;

90 
	}
}

93 
	$bôm≠_gëd©a
(
bôm≠
 *
b
)

95  
b
->
v
;

96 
	}
}

99 
	$bôm≠_Æloc
(
bôm≠
 *
b
, *
ödex
)

101 
ix
;

102 
maxix
 = 
	`DIVROUNDUP
(
b
->
nbôs
, 
BITS_PER_WORD
);

103 
off£t
;

105 
ix
=0; ix<
maxix
; ix++) {

106 i‡(
b
->
v
[
ix
]!=
WORD_ALLBITS
) {

107 
off£t
 = 0; off£à< 
BITS_PER_WORD
; offset++) {

108 
WORD_TYPE
 
mask
 = ((WORD_TYPE)1Ë<< 
off£t
;

110 i‡((
b
->
v
[
ix
] & 
mask
)==0) {

111 
b
->
v
[
ix
] |
mask
;

112 *
ödex
 = (
ix
*
BITS_PER_WORD
)+
off£t
;

113 
	`KASSERT
(*
ödex
 < 
b
->
nbôs
);

117 
	`KASSERT
(0);

120  
ENOSPC
;

121 
	}
}

124 
ölöe


126 
	$bôm≠_å™¶©e
(
bôno
, *
ix
, 
WORD_TYPE
 *
mask
)

128 
off£t
;

129 *
ix
 = 
bôno
 / 
BITS_PER_WORD
;

130 
off£t
 = 
bôno
 % 
BITS_PER_WORD
;

131 *
mask
 = ((
WORD_TYPE
)1Ë<< 
off£t
;

132 
	}
}

135 
	$bôm≠_m¨k
(
bôm≠
 *
b
, 
ödex
)

137 
ix
;

138 
WORD_TYPE
 
mask
;

140 
	`KASSERT
(
ödex
 < 
b
->
nbôs
);

141 
	`bôm≠_å™¶©e
(
ödex
, &
ix
, &
mask
);

143 
	`KASSERT
((
b
->
v
[
ix
] & 
mask
)==0);

144 
b
->
v
[
ix
] |
mask
;

145 
	}
}

148 
	$bôm≠_unm¨k
(
bôm≠
 *
b
, 
ödex
)

150 
ix
;

151 
WORD_TYPE
 
mask
;

153 
	`KASSERT
(
ödex
 < 
b
->
nbôs
);

154 
	`bôm≠_å™¶©e
(
ödex
, &
ix
, &
mask
);

156 
	`KASSERT
((
b
->
v
[
ix
] & 
mask
)!=0);

157 
b
->
v
[
ix
] &~
mask
;

158 
	}
}

162 
	$bôm≠_is£t
(
bôm≠
 *
b
, 
ödex
)

164 
ix
;

165 
WORD_TYPE
 
mask
;

167 
	`bôm≠_å™¶©e
(
ödex
, &
ix
, &
mask
);

168  (
b
->
v
[
ix
] & 
mask
);

169 
	}
}

172 
	$bôm≠_de°roy
(
bôm≠
 *
b
)

174 
	`k‰ì
(
b
->
v
);

175 
	`k‰ì
(
b
);

176 
	}
}

	@/home/trinity/src/kern/lib/bswap.c

30 
	~<ty≥s.h
>

31 
	~<ídün.h
>

46 
uöt16_t


47 
	$bsw≠16
(
uöt16_t
 
vÆ
)

49  ((
vÆ
 & 0x00ff) << 8)

50 | ((
vÆ
 & 0xff00) >> 8);

51 
	}
}

53 
uöt32_t


54 
	$bsw≠32
(
uöt32_t
 
vÆ
)

56  ((
vÆ
 & 0x000000ff) << 24)

57 | ((
vÆ
 & 0x0000ff00) << 8)

58 | ((
vÆ
 & 0x00ff0000) >> 8)

59 | ((
vÆ
 & 0xff000000) >> 24);

60 
	}
}

62 
uöt64_t


63 
	$bsw≠64
(
uöt64_t
 
vÆ
)

65  ((
vÆ
 & 0x00000000000000ff) << 56)

66 | ((
vÆ
 & 0x000000000000ff00) << 40)

67 | ((
vÆ
 & 0x0000000000ff0000) << 24)

68 | ((
vÆ
 & 0x00000000ff000000) << 8)

69 | ((
vÆ
 & 0x000000ff00000000) << 8)

70 | ((
vÆ
 & 0x0000ff0000000000) << 24)

71 | ((
vÆ
 & 0x00ff000000000000) >> 40)

72 | ((
vÆ
 & 0xff00000000000000) >> 56);

73 
	}
}

94 #i‡
_BYTE_ORDER
 =
_LITTLE_ENDIAN


95 
	#TO
(
èg
, 
bôs
, 
ty≥
) \

96 
ty≥
 
¡oh
##
	`èg
—y≥ 
vÆ
Ë{  
bsw≠
##
	`bôs
(val); } \

97 
ty≥
 
ht⁄
##
	`èg
—y≥ 
vÆ
Ë{  
bsw≠
##
	`bôs
(vÆ); }

	)

105 #i‡
_BYTE_ORDER
 =
_BIG_ENDIAN


106 
	#TO
(
èg
, 
bôs
, 
ty≥
) \

107 
ty≥
 
¡oh
##
	`èg
—y≥ 
vÆ
) {  val; } \

108 
ty≥
 
ht⁄
##
	`èg
—y≥ 
vÆ
Ë{  vÆ; }

	)

111 #i‡
_BYTE_ORDER
 =
_PDP_ENDIAN


115 #i‚de‡
TO


119 
	$TO
(
s
, 16, 
uöt16_t
)

120 
	$TO
(
l
, 32, 
uöt32_t
)

121 
	$TO
(
Œ
, 64, 
uöt64_t
)

138 
	$joö32to64
(
uöt32_t
 
x1
, uöt32_à
x2
, 
uöt64_t
 *
y2
)

140 #i‡
_BYTE_ORDER
 =
_BIG_ENDIAN


141 *
y2
 = ((
uöt64_t
)
x1
 << 32Ë| (uöt64_t)
x2
;

142 #ñi‡
_BYTE_ORDER
 =
_LITTLE_ENDIAN


143 *
y2
 = (
uöt64_t
)
x1
 | ((uöt64_t)
x2
 << 32);

147 
	}
}

150 
	$•lô64to32
(
uöt64_t
 
x
, 
uöt32_t
 *
y1
, uöt32_à*
y2
)

152 #i‡
_BYTE_ORDER
 =
_BIG_ENDIAN


153 *
y1
 = 
x
 >> 32;

154 *
y2
 = 
x
 & 0xffffffff;

155 #ñi‡
_BYTE_ORDER
 =
_LITTLE_ENDIAN


156 *
y1
 = 
x
 & 0xffffffff;

157 *
y2
 = 
x
 >> 32;

161 
	}
}

	@/home/trinity/src/kern/lib/kgets.c

31 
	~<ty≥s.h
>

32 
	~<lib.h
>

41 
	$back•
()

43 
	`putch
('\b');

44 
	`putch
(' ');

45 
	`putch
('\b');

46 
	}
}

54 
	$kgës
(*
buf
, 
size_t
 
maxÀn
)

56 
size_t
 
pos
 = 0;

57 
ch
;

60 
ch
 = 
	`gëch
();

61 i‡(
ch
=='\n' || ch=='\r') {

62 
	`putch
('\n');

67 i‡(
ch
>=32 && ch<127 && 
pos
 < 
maxÀn
-1) {

68 
	`putch
(
ch
);

69 
buf
[
pos
++] = 
ch
;

71 i‡((
ch
=='\b' || ch==127Ë&& 
pos
>0) {

73 
	`back•
();

74 
pos
--;

76 i‡(
ch
==3) {

78 
	`putch
('^');

79 
	`putch
('C');

80 
	`putch
('\n');

81 
pos
 = 0;

84 i‡(
ch
==18) {

86 
buf
[
pos
] = 0;

87 
	`k¥ötf
("^R\n%s", 
buf
);

89 i‡(
ch
==21) {

91 
pos
 > 0) {

92 
	`back•
();

93 
pos
--;

96 i‡(
ch
==23) {

98 
pos
 > 0 && 
buf
[pos-1]==' ') {

99 
	`back•
();

100 
pos
--;

102 
pos
 > 0 && 
buf
[pos-1]!=' ') {

103 
	`back•
();

104 
pos
--;

108 
	`bìp
();

112 
buf
[
pos
] = 0;

113 
	}
}

	@/home/trinity/src/kern/lib/kprintf.c

30 
	~<ty≥s.h
>

31 
	~<kîn/uni°d.h
>

32 
	~<°d¨g.h
>

33 
	~<lib.h
>

34 
	~<•l.h
>

35 
	~<˝u.h
>

36 
	~<thªad.h
>

37 
	~<cuºít.h
>

38 
	~<synch.h
>

39 
	~<maöbus.h
>

40 
	~<vfs.h
>

41 
	~<œmebus/…ø˚.h
>

42 
	~<kîn/£¸ë.h
>

43 
	~<ã°.h
>

47 
uöt32_t
 
	gdbÊags
 = 0;

50 
lock
 *
	gk¥ötf_lock
;

53 
•ölock
 
	gk¥ötf_•ölock
;

67 
	$k¥ötf_boŸ°øp
()

69 
	`KASSERT
(
k¥ötf_lock
 =
NULL
);

71 
k¥ötf_lock
 = 
	`lock_¸óã
("kprintf_lock");

72 i‡(
k¥ötf_lock
 =
NULL
) {

73 
	`∑nic
("CouldÇot create kprintf_lock\n");

75 
	`•ölock_öô
(&
k¥ötf_•ölock
);

76 
	}
}

83 
	$c⁄sﬁe_£nd
(*
junk
, c⁄° *
d©a
, 
size_t
 
Àn
)

85 
size_t
 
i
;

87 ()
junk
;

89 
i
=0; i<
Àn
; i++) {

90 
	`putch
(
d©a
[
i
]);

92 
	}
}

98 
ölöe


100 
	$__k¥ötf
(c⁄° *
fmt
, 
va_li°
 
≠
)

102 
ch¨s
;

103 
boﬁ
 
dﬁock
;

105 
dﬁock
 = 
k¥ötf_lock
 !
NULL


106 && 
cuπhªad
->
t_ö_öãºu±
 =
Ál£


107 && 
cuπhªad
->
t_cur•l
 == 0

108 && 
cur˝u
->
c_•ölocks
 == 0;

110 i‡(
dﬁock
) {

111 
	`lock_acquúe
(
k¥ötf_lock
);

114 
	`•ölock_acquúe
(&
k¥ötf_•ölock
);

117 
ch¨s
 = 
	`__v¥ötf
(
c⁄sﬁe_£nd
, 
NULL
, 
fmt
, 
≠
);

119 i‡(
dﬁock
) {

120 
	`lock_ªÀa£
(
k¥ötf_lock
);

123 
	`•ölock_ªÀa£
(&
k¥ötf_•ölock
);

126  
ch¨s
;

127 
	}
}

133 
	$k¥ötf
(c⁄° *
fmt
, ...)

135 
ch¨s
;

136 
va_li°
 
≠
;

138 
	`va_°¨t
(
≠
, 
fmt
);

139 
ch¨s
 = 
	`__k¥ötf
(
fmt
, 
≠
);

140 
	`va_íd
(
≠
);

142  
ch¨s
;

143 
	}
}

151 
	$∑nic
(c⁄° *
fmt
, ...)

153 
va_li°
 
≠
;

166 vﬁ©ûê
evû
;

168 i‡(
evû
 == 0) {

169 
evû
 = 1;

177 
	`•lhigh
();

180 i‡(
evû
 == 1) {

181 
evû
 = 2;

184 
	`thªad_∑nic
();

187 i‡(
evû
 == 2) {

188 
evû
 = 3;

191 
	`k¥ötf
("panic: ");

192 
	`va_°¨t
(
≠
, 
fmt
);

193 
	`__v¥ötf
(
c⁄sﬁe_£nd
, 
NULL
, 
fmt
, 
≠
);

194 
	`va_íd
(
≠
);

197 i‡(
evû
 == 3) {

198 
evû
 = 4;

201 
	`…ø˚_°›
(0);

204 i‡(
evû
 == 4) {

205 
evû
 = 5;

208 
	`vfs_sync
();

211 i‡(
evû
 == 5) {

212 
evû
 = 6;

215 
	`maöbus_∑nic
();

223 
	}
}

229 
	$badas£π
(c⁄° *
ex¥
, c⁄° *
fûe
, 
löe
, c⁄° *
func
)

231 
	`∑nic
("Assertion failed: %s,át %s:%d (%s)\n",

232 
ex¥
, 
fûe
, 
löe
, 
func
);

233 
	}
}

	@/home/trinity/src/kern/lib/misc.c

30 
	~<ty≥s.h
>

31 
	~<kîn/îrmsg.h
>

32 
	~<lib.h
>

38 
	$k°rdup
(c⁄° *
s
)

40 *
z
;

42 
z
 = 
	`kmÆloc
(
	`°æí
(
s
)+1);

43 i‡(
z
 =
NULL
) {

44  
NULL
;

46 
	`°r˝y
(
z
, 
s
);

47  
z
;

48 
	}
}

55 
	$°ªº‹
(
îrcode
)

57 i‡(
îrcode
>=0 &&Éºcodê< 
sys_√º
) {

58  
sys_îæi°
[
îrcode
];

60 
	`∑nic
("InvÆidÉº‹ codê%d\n", 
îrcode
);

61  
NULL
;

62 
	}
}

	@/home/trinity/src/kern/lib/time.c

30 
	~<ty≥s.h
>

31 
	~<˛ock.h
>

37 
	$time•ec_add
(c⁄° 
time•ec
 *
ts1
,

38 c⁄° 
time•ec
 *
ts2
,

39 
time•ec
 *
ªt
)

41 
ªt
->
tv_n£c
 = 
ts1
->tv_n£¯+ 
ts2
->tv_nsec;

42 
ªt
->
tv_£c
 = 
ts1
->tv_£¯+ 
ts2
->tv_sec;

43 i‡(
ªt
->
tv_n£c
 >= 1000000000) {

44 
ªt
->
tv_n£c
 -= 1000000000;

45 
ªt
->
tv_£c
 += 1;

47 
	}
}

53 
	$time•ec_sub
(c⁄° 
time•ec
 *
ts1
,

54 c⁄° 
time•ec
 *
ts2
,

55 
time•ec
 *
ªt
)

58 
time•ec
 
r
;

60 
r
 = *
ts1
;

61 i‡(
r
.
tv_n£c
 < 
ts2
->tv_nsec) {

62 
r
.
tv_n£c
 += 1000000000;

63 
r
.
tv_£c
--;

66 
r
.
tv_n£c
 -
ts2
->tv_nsec;

67 
r
.
tv_£c
 -
ts2
->tv_sec;

68 *
ªt
 = 
r
;

69 
	}
}

	@/home/trinity/src/kern/lib/uio.c

30 
	~<ty≥s.h
>

31 
	~<lib.h
>

32 
	~<uio.h
>

33 
	~<¥oc.h
>

34 
	~<cuºít.h
>

35 
	~<c›yöout.h
>

42 
	$uiomove
(*
±r
, 
size_t
 
n
, 
uio
 *uio)

44 
iovec
 *
iov
;

45 
size_t
 
size
;

46 
ªsu…
;

48 i‡(
uio
->
uio_rw
 !
UIO_READ
 && uio->uio_rw !
UIO_WRITE
) {

49 
	`∑nic
("uiomove: InvÆid uio_rw %d\n", (Ë
uio
->
uio_rw
);

51 i‡(
uio
->
uio_£gÊg
==
UIO_SYSSPACE
) {

52 
	`KASSERT
(
uio
->
uio_•a˚
 =
NULL
);

55 
	`KASSERT
(
uio
->
uio_•a˚
 =
	`¥oc_gëas
());

58 
n
 > 0 && 
uio
->
uio_ªsid
 > 0) {

60 
iov
 = 
uio
->
uio_iov
;

61 
size
 = 
iov
->
iov_Àn
;

63 i‡(
size
 > 
n
) {

64 
size
 = 
n
;

67 i‡(
size
 == 0) {

69 
uio
->
uio_iov
++;

70 
uio
->
uio_iov˙t
--;

71 i‡(
uio
->
uio_iov˙t
 == 0) {

78 
	`∑nic
("uiomove:Ñan out of buffers\n");

83 
uio
->
uio_£gÊg
) {

84 
UIO_SYSSPACE
:

85 i‡(
uio
->
uio_rw
 =
UIO_READ
) {

86 
	`memmove
(
iov
->
iov_kba£
, 
±r
, 
size
);

89 
	`memmove
(
±r
, 
iov
->
iov_kba£
, 
size
);

91 
iov
->
iov_kba£
 = ((*)iov->iov_kba£+
size
);

93 
UIO_USERSPACE
:

94 
UIO_USERISPACE
:

95 i‡(
uio
->
uio_rw
 =
UIO_READ
) {

96 
ªsu…
 = 
	`c›yout
(
±r
, 
iov
->
iov_uba£
,
size
);

99 
ªsu…
 = 
	`c›yö
(
iov
->
iov_uba£
, 
±r
, 
size
);

101 i‡(
ªsu…
) {

102  
ªsu…
;

104 
iov
->
iov_uba£
 +
size
;

107 
	`∑nic
("uiomove: Invalid uio_segflg %d\n",

108 ()
uio
->
uio_£gÊg
);

111 
iov
->
iov_Àn
 -
size
;

112 
uio
->
uio_ªsid
 -
size
;

113 
uio
->
uio_off£t
 +
size
;

114 
±r
 = ((*Ìå + 
size
);

115 
n
 -
size
;

119 
	}
}

122 
	$uiomovezîos
(
size_t
 
n
, 
uio
 *uio)

125 
zîos
[16];

126 
size_t
 
amt
;

127 
ªsu…
;

130 
	`KASSERT
(
uio
->
uio_rw
 =
UIO_READ
);

132 
n
 > 0) {

133 
amt
 = (
zîos
);

134 i‡(
amt
 > 
n
) {

135 
amt
 = 
n
;

137 
ªsu…
 = 
	`uiomove
(
zîos
, 
amt
, 
uio
);

138 i‡(
ªsu…
) {

139  
ªsu…
;

141 
n
 -
amt
;

145 
	}
}

152 
	$uio_köô
(
iovec
 *
iov
, 
uio
 *
u
,

153 *
kbuf
, 
size_t
 
Àn
, 
off_t
 
pos
, 
uio_rw
 
rw
)

155 
iov
->
iov_kba£
 = 
kbuf
;

156 
iov
->
iov_Àn
 = 
Àn
;

157 
u
->
uio_iov
 = 
iov
;

158 
u
->
uio_iov˙t
 = 1;

159 
u
->
uio_off£t
 = 
pos
;

160 
u
->
uio_ªsid
 = 
Àn
;

161 
u
->
uio_£gÊg
 = 
UIO_SYSSPACE
;

162 
u
->
uio_rw
 = 
rw
;

163 
u
->
uio_•a˚
 = 
NULL
;

164 
	}
}

	@/home/trinity/src/kern/main/main.c

34 
	~<ty≥s.h
>

35 
	~<kîn/î∫o.h
>

36 
	~<kîn/ªboŸ.h
>

37 
	~<kîn/uni°d.h
>

38 
	~<lib.h
>

39 
	~<•l.h
>

40 
	~<˛ock.h
>

41 
	~<thªad.h
>

42 
	~<¥oc.h
>

43 
	~<cuºít.h
>

44 
	~<synch.h
>

45 
	~<vm.h
>

46 
	~<maöbus.h
>

47 
	~<vfs.h
>

48 
	~<devi˚.h
>

49 
	~<sysˇŒ.h
>

50 
	~<ã°.h
>

51 
	~<kîn/ã°161.h
>

52 
	~<vîsi⁄.h
>

53 
	~"autoc⁄f.h
"

65 c⁄° 
buûdvîsi⁄
;

66 c⁄° 
buûdc⁄fig
[];

71 c⁄° 
	gh¨v¨d_c›yright
[] =

81 
	$boŸ
()

100 
	`k¥ötf
("\n");

101 
	`k¥ötf
("OS/161 ba£ sy°em vîsi⁄ %s\n", 
BASE_VERSION
);

102 
	`k¥ötf
("%s", 
h¨v¨d_c›yright
);

103 
	`k¥ötf
("\n");

105 
	`k¥ötf
("RajeshD -x-x-x- Put-your-group-name-here's system version %s (%s #%d)\n",

106 
GROUP_VERSION
, 
buûdc⁄fig
, 
buûdvîsi⁄
);

107 
	`k¥ötf
("\n");

110 
	`øm_boŸ°øp
();

111 
	`¥oc_boŸ°øp
();

112 
	`thªad_boŸ°øp
();

113 
	`h¨d˛ock_boŸ°øp
();

114 
	`vfs_boŸ°øp
();

115 
	`khóp_√xtgíî©i⁄
();

118 
	`k¥ötf
("DeviceÖrobe...\n");

119 
	`KASSERT
(
cuπhªad
->
t_cur•l
 > 0);

120 
	`maöbus_boŸ°øp
();

121 
	`KASSERT
(
cuπhªad
->
t_cur•l
 == 0);

123 
	`p£udoc⁄fig
();

124 
	`k¥ötf
("\n");

125 
	`khóp_√xtgíî©i⁄
();

128 
	`vm_boŸ°øp
();

129 
	`k¥ötf_boŸ°øp
();

130 
	`thªad_°¨t_˝us
();

131 
	`ã°161_boŸ°øp
();

134 
	`vfs_£tboŸfs
("emu0");

136 
	`khóp_√xtgíî©i⁄
();

141 
	`COMPILE_ASSERT
((
u£Ωå_t
) == (*));

142 
	`COMPILE_ASSERT
((*(
u£Ωå_t
)0) == ());

143 
	}
}

150 
	$shutdown
()

153 
	`k¥ötf
("Shutting down.\n");

155 
	`vfs_˛órboŸfs
();

156 
	`vfs_˛órcurdú
();

157 
	`vfs_unmou¡Æl
();

159 
	`thªad_shutdown
();

161 
	`•lhigh
();

162 
	}
}

174 
	$sys_ªboŸ
(
code
)

176 
code
) {

177 
RB_REBOOT
:

178 
RB_HALT
:

179 
RB_POWEROFF
:

182  
EINVAL
;

185 
	`shutdown
();

187 
code
) {

188 
RB_HALT
:

189 
	`k¥ötf
("The system is halted.\n");

190 
	`maöbus_hÆt
();

192 
RB_REBOOT
:

193 
	`k¥ötf
("Rebooting...\n");

194 
	`maöbus_ªboŸ
();

196 
RB_POWEROFF
:

197 
	`k¥ötf
("The system is halted.\n");

198 
	`maöbus_powîoff
();

202 
	`∑nic
("reboot operation failed\n");

204 
	}
}

211 
	$kmaö
(*
¨gumíts
)

213 
	`boŸ
();

215 
	`míu
(
¨gumíts
);

218 
	}
}

	@/home/trinity/src/kern/main/menu.c

30 
	~<ty≥s.h
>

31 
	~<kîn/î∫o.h
>

32 
	~<kîn/ªboŸ.h
>

33 
	~<kîn/uni°d.h
>

34 
	~<limôs.h
>

35 
	~<lib.h
>

36 
	~<uio.h
>

37 
	~<˛ock.h
>

38 
	~<maöbus.h
>

39 
	~<synch.h
>

40 
	~<thªad.h
>

41 
	~<¥oc.h
>

42 
	~<vfs.h
>

43 
	~<sfs.h
>

44 
	~<sysˇŒ.h
>

45 
	~<ã°.h
>

46 
	~<¥om±.h
>

47 
	~"›t-sfs.h
"

48 
	~"›t-√t.h
"

49 
	~"›t-synch¥obs.h
"

50 
	~"›t-autom©i⁄ã°.h
"

56 
	#_PATH_SHELL
 "/bö/sh"

	)

58 
	#MAXMENUARGS
 16

	)

77 
	$cmd_¥ogthªad
(*
±r
, 
«rgs
)

79 **
¨gs
 = 
±r
;

80 
¥og«me
[128];

81 
ªsu…
;

83 
	`KASSERT
(
«rgs
 >= 1);

85 i‡(
«rgs
 > 2) {

86 
	`k¥ötf
("Warning:árgumentÖassing from menuÇot supported\n");

90 
	`KASSERT
(
	`°æí
(
¨gs
[0]Ë< (
¥og«me
));

92 
	`°r˝y
(
¥og«me
, 
¨gs
[0]);

94 
ªsu…
 = 
	`ru≈rogøm
(
¥og«me
);

95 i‡(
ªsu…
) {

96 
	`k¥ötf
("Ru¬ögÖrogøm %†Áûed: %s\n", 
¨gs
[0],

97 
	`°ªº‹
(
ªsu…
));

102 
	}
}

118 
	$comm⁄_¥og
(
«rgs
, **
¨gs
)

120 
¥oc
 *proc;

121 
ªsu…
;

122 
tc
;

125 
¥oc
 = 
	`¥oc_¸óã_ru≈rogøm
(
¨gs
[0] );

126 i‡(
¥oc
 =
NULL
) {

127  
ENOMEM
;

130 
tc
 = 
thªad_cou¡
;

132 
ªsu…
 = 
	`thªad_f‹k
(
¨gs
[0] ,

133 
¥oc
 ,

134 
cmd_¥ogthªad
 ,

135 
¨gs
 , 
«rgs
 );

136 i‡(
ªsu…
) {

137 
	`k¥ötf
("thªad_f‹k faûed: %s\n", 
	`°ªº‹
(
ªsu…
));

138 
	`¥oc_de°roy
(
¥oc
);

139  
ªsu…
;

149 
	`thªad_waô_f‹_cou¡
(
tc
);

152 
	}
}

159 
	$cmd_¥og
(
«rgs
, **
¨gs
)

161 i‡(
«rgs
 < 2) {

162 
	`k¥ötf
("Usage:ÖÖrogram [arguments]\n");

163  
EINVAL
;

167 
¨gs
++;

168 
«rgs
--;

170  
	`comm⁄_¥og
(
«rgs
, 
¨gs
);

171 
	}
}

178 
	$cmd_shñl
(
«rgs
, **
¨gs
)

180 ()
¨gs
;

181 i‡(
«rgs
 != 1) {

182 
	`k¥ötf
("Usage: s\n");

183  
EINVAL
;

186 
¨gs
[0] = (*)
_PATH_SHELL
;

188  
	`comm⁄_¥og
(
«rgs
, 
¨gs
);

189 
	}
}

196 
	$cmd_chdú
(
«rgs
, **
¨gs
)

198 i‡(
«rgs
 != 2) {

199 
	`k¥ötf
("Usage: cd directory\n");

200  
EINVAL
;

203  
	`vfs_chdú
(
¨gs
[1]);

204 
	}
}

211 
	$cmd_pwd
(
«rgs
, **
¨gs
)

213 
buf
[
PATH_MAX
+1];

214 
ªsu…
;

215 
iovec
 
iov
;

216 
uio
 
ku
;

218 ()
«rgs
;

219 ()
¨gs
;

221 
	`uio_köô
(&
iov
, &
ku
, 
buf
, (buf)-1, 0, 
UIO_READ
);

222 
ªsu…
 = 
	`vfs_gëcwd
(&
ku
);

223 i‡(
ªsu…
) {

224 
	`k¥ötf
("vfs_gëcwd faûed (%s)\n", 
	`°ªº‹
(
ªsu…
));

225  
ªsu…
;

229 
buf
[(buf)-1-
ku
.
uio_ªsid
] = 0;

232 
	`k¥ötf
("%s\n", 
buf
);

235 
	}
}

242 
	$cmd_sync
(
«rgs
, **
¨gs
)

244 ()
«rgs
;

245 ()
¨gs
;

247 
	`vfs_sync
();

250 
	}
}

257 
	$cmd_debug
(
«rgs
, **
¨gs
)

259 ()
«rgs
;

260 ()
¨gs
;

262 
	`maöbus_debuggî
();

265 
	}
}

272 
	$cmd_∑nic
(
«rgs
, **
¨gs
)

274 ()
«rgs
;

275 ()
¨gs
;

277 
	`∑nic
("UserÑequestedÖanic\n");

279 
	}
}

284 
	sdódlock
 {

285 
lock
 *
	mlock1
;

286 
lock
 *
	mlock2
;

291 
	$cmd_dódlockthªad
(*
±r
, 
num
)

293 
dódlock
 *
dl
 = 
±r
;

295 ()
num
;

299 
	`lock_acquúe
(
dl
->
lock2
);

300 
	`lock_acquúe
(
dl
->
lock1
);

301 
	`k¥ötf
("+");

302 
	`lock_ªÀa£
(
dl
->
lock1
);

303 
	`lock_ªÀa£
(
dl
->
lock2
);

305 
	}
}

312 
	$cmd_dódlock
(
«rgs
, **
¨gs
)

314 
dódlock
 
dl
;

315 
ªsu…
;

317 ()
«rgs
;

318 ()
¨gs
;

320 
dl
.
lock1
 = 
	`lock_¸óã
("deadlock1");

321 i‡(
dl
.
lock1
 =
NULL
) {

322 
	`k¥ötf
("lock_create failed\n");

323  
ENOMEM
;

325 
dl
.
lock2
 = 
	`lock_¸óã
("deadlock2");

326 i‡(
dl
.
lock2
 =
NULL
) {

327 
	`lock_de°roy
(
dl
.
lock1
);

328 
	`k¥ötf
("lock_create failed\n");

329  
ENOMEM
;

332 
ªsu…
 = 
	`thªad_f‹k
(
¨gs
[0] ,

333 
NULL
 ,

334 
cmd_dódlockthªad
 ,

335 &
dl
 , 0 );

336 i‡(
ªsu…
) {

337 
	`k¥ötf
("thªad_f‹k faûed: %s\n", 
	`°ªº‹
(
ªsu…
));

338 
	`lock_ªÀa£
(
dl
.
lock1
);

339 
	`lock_de°roy
(
dl
.
lock2
);

340 
	`lock_de°roy
(
dl
.
lock1
);

341  
ªsu…
;

346 
	`lock_acquúe
(
dl
.
lock1
);

347 
	`lock_acquúe
(
dl
.
lock2
);

348 
	`k¥ötf
(".");

349 
	`lock_ªÀa£
(
dl
.
lock2
);

350 
	`lock_ªÀa£
(
dl
.
lock1
);

354 
	}
}

361 
	$cmd_quô
(
«rgs
, **
¨gs
)

363 ()
«rgs
;

364 ()
¨gs
;

366 
	`vfs_sync
();

367 
	`sys_ªboŸ
(
RB_POWEROFF
);

368 
	`thªad_exô
();

370 
	}
}

378 c⁄° *
	m«me
;

379 (*
	mfunc
)(c⁄° *
	mdevi˚
);

380 } 
	gmou¡èbÀ
[] = {

381 #i‡
OPT_SFS


382 { "sfs", 
sfs_mou¡
 },

388 
	$cmd_mou¡
(
«rgs
, **
¨gs
)

390 *
f°y≥
;

391 *
devi˚
;

392 
i
;

394 i‡(
«rgs
 != 3) {

395 
	`k¥ötf
("Usage: mount fstype device:\n");

396  
EINVAL
;

399 
f°y≥
 = 
¨gs
[1];

400 
devi˚
 = 
¨gs
[2];

403 i‡(
devi˚
[
	`°æí
(device)-1]==':') {

404 
devi˚
[
	`°æí
(device)-1] = 0;

407 
i
=0; i<
	`ARRAYCOUNT
(
mou¡èbÀ
); i++) {

408 i‡(!
	`°rcmp
(
mou¡èbÀ
[
i
].
«me
, 
f°y≥
)) {

409  
mou¡èbÀ
[
i
].
	`func
(
devi˚
);

412 
	`k¥ötf
("Unknow¿fûesy°emÅy≥ %s\n", 
f°y≥
);

413  
EINVAL
;

414 
	}
}

418 
	$cmd_unmou¡
(
«rgs
, **
¨gs
)

420 *
devi˚
;

422 i‡(
«rgs
 != 2) {

423 
	`k¥ötf
("Usage: unmount device:\n");

424  
EINVAL
;

427 
devi˚
 = 
¨gs
[1];

430 i‡(
devi˚
[
	`°æí
(device)-1]==':') {

431 
devi˚
[
	`°æí
(device)-1] = 0;

434  
	`vfs_unmou¡
(
devi˚
);

435 
	}
}

447 
	$cmd_boŸfs
(
«rgs
, **
¨gs
)

449 *
devi˚
;

451 i‡(
«rgs
 != 2) {

452 
	`k¥ötf
("Usage: bootfs device\n");

453  
EINVAL
;

456 
devi˚
 = 
¨gs
[1];

459 i‡(
devi˚
[
	`°æí
(device)-1]==':') {

460 
devi˚
[
	`°æí
(device)-1] = 0;

463  
	`vfs_£tboŸfs
(
devi˚
);

464 
	}
}

468 
	$cmd_khóp°©s
(
«rgs
, **
¨gs
)

470 ()
«rgs
;

471 ()
¨gs
;

473 
	`khóp_¥öt°©s
();

476 
	}
}

480 
	$cmd_khópu£d
(
«rgs
, **
¨gs
)

482 ()
«rgs
;

483 ()
¨gs
;

485 
	`khóp_¥ötu£d
();

488 
	}
}

492 
	$cmd_khópgíî©i⁄
(
«rgs
, **
¨gs
)

494 ()
«rgs
;

495 ()
¨gs
;

497 
	`khóp_√xtgíî©i⁄
();

500 
	}
}

504 
	$cmd_khópdump
(
«rgs
, **
¨gs
)

506 i‡(
«rgs
 == 1) {

507 
	`khóp_dump
();

509 i‡(
«rgs
 =2 && !
	`°rcmp
(
¨gs
[1], "all")) {

510 
	`khóp_dum∑Œ
();

513 
	`k¥ötf
("Usage: khdump [all]\n");

517 
	}
}

525 
	$showmíu
(c⁄° *
«me
, c⁄° *
x
[])

527 
˘
, 
hÆf
, 
i
;

529 
	`k¥ötf
("\n");

530 
	`k¥ötf
("%s\n", 
«me
);

532 
i
=
˘
=0; 
x
[i]; i++) {

533 
˘
++;

535 
hÆf
 = (
˘
+1)/2;

537 
i
=0; i<
hÆf
; i++) {

538 
	`k¥ötf
(" %-36s", 
x
[
i
]);

539 i‡(
i
+
hÆf
 < 
˘
) {

540 
	`k¥ötf
("%s", 
x
[
i
+
hÆf
]);

542 
	`k¥ötf
("\n");

545 
	`k¥ötf
("\n");

546 
	}
}

548 c⁄° *
	g›smíu
[] = {

562 
NULL


567 
	$cmd_›smíu
(
n
, **
a
)

569 ()
n
;

570 ()
a
;

572 
	`showmíu
("OS/161 o≥øti⁄†míu", 
›smíu
);

574 
	}
}

576 c⁄° *
	gã°míu
[] = {

589 #i‡
OPT_NET


608 #i‡
OPT_SYNCHPROBS


620 
NULL


625 
	$cmd_ã°míu
(
n
, **
a
)

627 ()
n
;

628 ()
a
;

630 
	`showmíu
("OS/161Åe°†míu", 
ã°míu
);

631 
	`k¥ötf
(" (1) TheseÅests will fail until you finishÅhe "

633 
	`k¥ötf
(" (*) TheseÅests willÖanic on success.\n");

634 
	`k¥ötf
(" (?) TheseÅestsáreÜeftÅo youÅo implement.\n");

635 
	`k¥ötf
("\n");

638 
	}
}

640 #i‡
OPT_AUTOMATIONTEST


641 c⁄° *
	gautom©i⁄míu
[] = {

645 
NULL


650 
	$cmd_autom©i⁄míu
(
n
, **
a
)

652 ()
n
;

653 ()
a
;

655 
	`showmíu
("OS/161áutom©i⁄Åe°†míu", 
autom©i⁄míu
);

656 
	`k¥ötf
(" (*) TheseÅestsÑequireÜocks.\n");

657 
	`k¥ötf
("\n");

660 
	}
}

663 c⁄° *
	gmaömíu
[] = {

671 
NULL


676 
	$cmd_maömíu
(
n
, **
a
)

678 ()
n
;

679 ()
a
;

681 
	`showmíu
("OS/161 kî√»míu", 
maömíu
);

683 
	}
}

690 c⁄° *
	m«me
;

691 (*
	mfunc
)(
	m«rgs
, **
	m¨gs
);

692 } 
	gcmdèbÀ
[] = {

694 { "?", 
cmd_maömíu
 },

695 { "h", 
cmd_maömíu
 },

696 { "hñp", 
cmd_maömíu
 },

697 { "?o", 
cmd_›smíu
 },

698 { "?t", 
cmd_ã°míu
 },

699 #i‡
OPT_AUTOMATIONTEST


700 { "?a", 
cmd_autom©i⁄míu
 },

704 { "s", 
cmd_shñl
 },

705 { "p", 
cmd_¥og
 },

706 { "mou¡", 
cmd_mou¡
 },

707 { "unmou¡", 
cmd_unmou¡
 },

708 { "boŸfs", 
cmd_boŸfs
 },

709 { "pf", 
¥ötfûe
 },

710 { "cd", 
cmd_chdú
 },

711 { "pwd", 
cmd_pwd
 },

712 { "sync", 
cmd_sync
 },

713 { "debug", 
cmd_debug
 },

714 { "∑nic", 
cmd_∑nic
 },

715 { "dódlock", 
cmd_dódlock
 },

716 { "q", 
cmd_quô
 },

717 { "exô", 
cmd_quô
 },

718 { "hÆt", 
cmd_quô
 },

721 { "kh", 
cmd_khóp°©s
 },

722 { "khu", 
cmd_khópu£d
 },

723 { "khgí", 
cmd_khópgíî©i⁄
 },

724 { "khdump", 
cmd_khópdump
 },

727 { "©", 
¨øyã°
 },

728 { "©2", 
¨øyã°2
 },

729 { "bt", 
bôm≠ã°
 },

730 { "ét", 
thªadli°ã°
 },

731 { "km1", 
kmÆlo˘e°
 },

732 { "km2", 
kmÆloc°ªss
 },

733 { "km3", 
kmÆlo˘e°3
 },

734 { "km4", 
kmÆlo˘e°4
 },

735 { "km5", 
kmÆlo˘e°5
 },

736 #i‡
OPT_NET


737 { "√t", 
√âe°
 },

739 { "â1", 
thªadã°
 },

740 { "â2", 
thªadã°2
 },

741 { "â3", 
thªadã°3
 },

744 { "£m1", 
£mã°
 },

745 { "…1", 
lockã°
 },

746 { "…2", 
lockã°2
 },

747 { "…3", 
lockã°3
 },

748 { "…4", 
lockã°4
 },

749 { "…5", 
lockã°5
 },

750 { "cvt1", 
cvã°
 },

751 { "cvt2", 
cvã°2
 },

752 { "cvt3", 
cvã°3
 },

753 { "cvt4", 
cvã°4
 },

754 { "cvt5", 
cvã°5
 },

755 { "rwt1", 
rwã°
 },

756 { "rwt2", 
rwã°2
 },

757 { "rwt3", 
rwã°3
 },

758 { "rwt4", 
rwã°4
 },

759 { "rwt5", 
rwã°5
 },

760 #i‡
OPT_SYNCHPROBS


761 { "•1", 
whÆem©ög
 },

762 { "•2", 
°›light
 },

766 { "£mu1", 
£mu1
 },

767 { "£mu2", 
£mu2
 },

768 { "£mu3", 
£mu3
 },

769 { "£mu4", 
£mu4
 },

770 { "£mu5", 
£mu5
 },

771 { "£mu6", 
£mu6
 },

772 { "£mu7", 
£mu7
 },

773 { "£mu8", 
£mu8
 },

774 { "£mu9", 
£mu9
 },

775 { "£mu10", 
£mu10
 },

776 { "£mu11", 
£mu11
 },

777 { "£mu12", 
£mu12
 },

778 { "£mu13", 
£mu13
 },

779 { "£mu14", 
£mu14
 },

780 { "£mu15", 
£mu15
 },

781 { "£mu16", 
£mu16
 },

782 { "£mu17", 
£mu17
 },

783 { "£mu18", 
£mu18
 },

784 { "£mu19", 
£mu19
 },

785 { "£mu20", 
£mu20
 },

786 { "£mu21", 
£mu21
 },

787 { "£mu22", 
£mu22
 },

790 { "fs1", 
f°e°
 },

791 { "fs2", 
ªad°ªss
 },

792 { "fs3", 
wrôe°ªss
 },

793 { "fs4", 
wrôe°ªss2
 },

794 { "fs5", 
l⁄g°ªss
 },

795 { "fs6", 
¸óã°ªss
 },

798 { "hm1", 
hmacu1
 },

800 #i‡
OPT_AUTOMATIONTEST


802 { "dl", 
d…e°
 },

803 { "Œ1", 
Œ1ã°
 },

804 { "Œ16", 
Œ16ã°
 },

807 { 
NULL
, NULL }

815 
	$cmd_di•©ch
(*
cmd
)

817 
time•ec
 
bef‹e
, 
a·î
, 
duøti⁄
;

818 *
¨gs
[
MAXMENUARGS
];

819 
«rgs
=0;

820 *
w‹d
;

821 *
c⁄ãxt
;

822 
i
, 
ªsu…
;

824 
w‹d
 = 
	`°πok_r
(
cmd
, " \t", &
c⁄ãxt
);

825 
w‹d
 !
NULL
;

826 
w‹d
 = 
	`°πok_r
(
NULL
, " \t", &
c⁄ãxt
)) {

828 i‡(
«rgs
 >
MAXMENUARGS
) {

829 
	`k¥ötf
("CommandÜine hasÅoo many words\n");

830  
E2BIG
;

832 
¨gs
[
«rgs
++] = 
w‹d
;

835 i‡(
«rgs
==0) {

839 
i
=0; 
cmdèbÀ
[i].
«me
; i++) {

840 i‡(*
cmdèbÀ
[
i
].
«me
 && !
	`°rcmp
(
¨gs
[0], cmdtable[i].name)) {

841 
	`KASSERT
(
cmdèbÀ
[
i
].
func
!=
NULL
);

843 
	`gëtime
(&
bef‹e
);

845 
ªsu…
 = 
cmdèbÀ
[
i
].
	`func
(
«rgs
, 
¨gs
);

847 
	`gëtime
(&
a·î
);

848 
	`time•ec_sub
(&
a·î
, &
bef‹e
, &
duøti⁄
);

850 
	`k¥ötf
("OperationÅook %llu.%09lu seconds\n",

851 (Ë
duøti⁄
.
tv_£c
,

852 (Ë
duøti⁄
.
tv_n£c
);

854  
ªsu…
;

858 
	`k¥ötf
("%s: Comm™dÇŸ found\n", 
¨gs
[0]);

859  
EINVAL
;

860 
	}
}

871 
	$míu_execuã
(*
löe
, 
ißrgs
)

873 *
comm™d
;

874 *
c⁄ãxt
;

875 
ªsu…
;

877 
comm™d
 = 
	`°πok_r
(
löe
, ";", &
c⁄ãxt
);

878 
comm™d
 !
NULL
;

879 
comm™d
 = 
	`°πok_r
(
NULL
, ";", &
c⁄ãxt
)) {

881 i‡(
ißrgs
) {

882 
	`k¥ötf
("OS/161 kî√l: %s\n", 
comm™d
);

885 
ªsu…
 = 
	`cmd_di•©ch
(
comm™d
);

886 i‡(
ªsu…
) {

887 
	`k¥ötf
("Míu comm™d faûed: %s\n", 
	`°ªº‹
(
ªsu…
));

888 i‡(
ißrgs
) {

889 
	`∑nic
("FailureÖrocessing kernelárguments\n");

893 
	}
}

913 
	$míu
(*
¨gs
)

915 
buf
[64];

917 
	`míu_execuã
(
¨gs
, 1);

924 
	`k¥ötf
(
KERNEL_PROMPT
);

925 
	`kgës
(
buf
, (buf));

926 
	`míu_execuã
(
buf
, 0);

928 
	}
}

	@/home/trinity/src/kern/proc/proc.c

45 
	~<ty≥s.h
>

46 
	~<•l.h
>

47 
	~<¥oc.h
>

48 
	~<cuºít.h
>

49 
	~<addr•a˚.h
>

50 
	~<vnode.h
>

55 
¥oc
 *
	gk¥oc
;

61 
¥oc
 *

62 
	$¥oc_¸óã
(c⁄° *
«me
)

64 
¥oc
 *proc;

66 
¥oc
 = 
	`kmÆloc
((*proc));

67 i‡(
¥oc
 =
NULL
) {

68  
NULL
;

70 
¥oc
->
p_«me
 = 
	`k°rdup
(
«me
);

71 i‡(
¥oc
->
p_«me
 =
NULL
) {

72 
	`k‰ì
(
¥oc
);

73  
NULL
;

76 
¥oc
->
p_numthªads
 = 0;

77 
	`•ölock_öô
(&
¥oc
->
p_lock
);

80 
¥oc
->
p_addr•a˚
 = 
NULL
;

83 
¥oc
->
p_cwd
 = 
NULL
;

85  
¥oc
;

86 
	}
}

95 
	$¥oc_de°roy
(
¥oc
 *proc)

105 
	`KASSERT
(
¥oc
 !
NULL
);

106 
	`KASSERT
(
¥oc
 !
k¥oc
);

115 i‡(
¥oc
->
p_cwd
) {

116 
	`VOP_DECREF
(
¥oc
->
p_cwd
);

117 
¥oc
->
p_cwd
 = 
NULL
;

121 i‡(
¥oc
->
p_addr•a˚
) {

155 
addr•a˚
 *
as
;

157 i‡(
¥oc
 =
cuΩroc
) {

158 
as
 = 
	`¥oc_£ès
(
NULL
);

159 
	`as_dó˘iv©e
();

162 
as
 = 
¥oc
->
p_addr•a˚
;

163 
¥oc
->
p_addr•a˚
 = 
NULL
;

165 
	`as_de°roy
(
as
);

168 
	`KASSERT
(
¥oc
->
p_numthªads
 == 0);

169 
	`•ölock_˛ónup
(&
¥oc
->
p_lock
);

171 
	`k‰ì
(
¥oc
->
p_«me
);

172 
	`k‰ì
(
¥oc
);

173 
	}
}

179 
	$¥oc_boŸ°øp
()

181 
k¥oc
 = 
	`¥oc_¸óã
("[kernel]");

182 i‡(
k¥oc
 =
NULL
) {

183 
	`∑nic
("proc_create for kproc failed\n");

185 
	}
}

193 
¥oc
 *

194 
	$¥oc_¸óã_ru≈rogøm
(c⁄° *
«me
)

196 
¥oc
 *
√w¥oc
;

198 
√w¥oc
 = 
	`¥oc_¸óã
(
«me
);

199 i‡(
√w¥oc
 =
NULL
) {

200  
NULL
;

205 
√w¥oc
->
p_addr•a˚
 = 
NULL
;

214 
	`•ölock_acquúe
(&
cuΩroc
->
p_lock
);

215 i‡(
cuΩroc
->
p_cwd
 !
NULL
) {

216 
	`VOP_INCREF
(
cuΩroc
->
p_cwd
);

217 
√w¥oc
->
p_cwd
 = 
cuΩroc
->p_cwd;

219 
	`•ölock_ªÀa£
(&
cuΩroc
->
p_lock
);

221  
√w¥oc
;

222 
	}
}

234 
	$¥oc_addthªad
(
¥oc
 *¥oc, 
thªad
 *
t
)

236 
•l
;

238 
	`KASSERT
(
t
->
t_¥oc
 =
NULL
);

240 
	`•ölock_acquúe
(&
¥oc
->
p_lock
);

241 
¥oc
->
p_numthªads
++;

242 
	`•ölock_ªÀa£
(&
¥oc
->
p_lock
);

244 
•l
 = 
	`•lhigh
();

245 
t
->
t_¥oc
 = 
¥oc
;

246 
	`•lx
(
•l
);

249 
	}
}

261 
	$¥oc_ªmthªad
(
thªad
 *
t
)

263 
¥oc
 *proc;

264 
•l
;

266 
¥oc
 = 
t
->
t_¥oc
;

267 
	`KASSERT
(
¥oc
 !
NULL
);

269 
	`•ölock_acquúe
(&
¥oc
->
p_lock
);

270 
	`KASSERT
(
¥oc
->
p_numthªads
 > 0);

271 
¥oc
->
p_numthªads
--;

272 
	`•ölock_ªÀa£
(&
¥oc
->
p_lock
);

274 
•l
 = 
	`•lhigh
();

275 
t
->
t_¥oc
 = 
NULL
;

276 
	`•lx
(
•l
);

277 
	}
}

287 
addr•a˚
 *

288 
	$¥oc_gëas
()

290 
addr•a˚
 *
as
;

291 
¥oc
 *¥o¯
cuΩroc
;

293 i‡(
¥oc
 =
NULL
) {

294  
NULL
;

297 
	`•ölock_acquúe
(&
¥oc
->
p_lock
);

298 
as
 = 
¥oc
->
p_addr•a˚
;

299 
	`•ölock_ªÀa£
(&
¥oc
->
p_lock
);

300  
as
;

301 
	}
}

307 
addr•a˚
 *

308 
	$¥oc_£ès
(
addr•a˚
 *
√was
)

310 
addr•a˚
 *
ﬁdas
;

311 
¥oc
 *¥o¯
cuΩroc
;

313 
	`KASSERT
(
¥oc
 !
NULL
);

315 
	`•ölock_acquúe
(&
¥oc
->
p_lock
);

316 
ﬁdas
 = 
¥oc
->
p_addr•a˚
;

317 
¥oc
->
p_addr•a˚
 = 
√was
;

318 
	`•ölock_ªÀa£
(&
¥oc
->
p_lock
);

319  
ﬁdas
;

320 
	}
}

	@/home/trinity/src/kern/synchprobs/stoplight.c

66 
	~<ty≥s.h
>

67 
	~<lib.h
>

68 
	~<thªad.h
>

69 
	~<ã°.h
>

70 
	~<synch.h
>

77 
	$°›light_öô
() {

79 
	}
}

85 
	$°›light_˛ónup
() {

87 
	}
}

90 
	$tu∫right
(
uöt32_t
 
dúe˘i⁄
, uöt32_à
ödex
)

92 ()
dúe˘i⁄
;

93 ()
ödex
;

98 
	}
}

100 
	$go°øight
(
uöt32_t
 
dúe˘i⁄
, uöt32_à
ödex
)

102 ()
dúe˘i⁄
;

103 ()
ödex
;

108 
	}
}

110 
	$tu∫À·
(
uöt32_t
 
dúe˘i⁄
, uöt32_à
ödex
)

112 ()
dúe˘i⁄
;

113 ()
ödex
;

118 
	}
}

	@/home/trinity/src/kern/synchprobs/whalemating.c

37 
	~<ty≥s.h
>

38 
	~<lib.h
>

39 
	~<thªad.h
>

40 
	~<ã°.h
>

41 
	~<synch.h
>

47 
	$whÆem©ög_öô
() {

49 
	}
}

56 
	$whÆem©ög_˛ónup
() {

58 
	}
}

61 
	$mÆe
(
uöt32_t
 
ödex
)

63 ()
ödex
;

69 
	}
}

72 
	$„mÆe
(
uöt32_t
 
ödex
)

74 ()
ödex
;

80 
	}
}

83 
	$m©chmakî
(
uöt32_t
 
ödex
)

85 ()
ödex
;

91 
	}
}

	@/home/trinity/src/kern/syscall/loadelf.c

53 
	~<ty≥s.h
>

54 
	~<kîn/î∫o.h
>

55 
	~<lib.h
>

56 
	~<uio.h
>

57 
	~<¥oc.h
>

58 
	~<cuºít.h
>

59 
	~<addr•a˚.h
>

60 
	~<vnode.h
>

61 
	~<ñf.h
>

79 
	$lﬂd_£gmít
(
addr•a˚
 *
as
, 
vnode
 *
v
,

80 
off_t
 
off£t
, 
vaddr_t
 
vaddr
,

81 
size_t
 
memsize
, size_à
fûesize
,

82 
is_execuèbÀ
)

84 
iovec
 
iov
;

85 
uio
 
u
;

86 
ªsu…
;

88 i‡(
fûesize
 > 
memsize
) {

89 
	`k¥ötf
("ELF: warning: segment filesize > segment memsize\n");

90 
fûesize
 = 
memsize
;

93 
	`DEBUG
(
DB_EXEC
, "ELF: Loading %lu bytesÅo 0x%lx\n",

94 (Ë
fûesize
, (Ë
vaddr
);

96 
iov
.
iov_uba£
 = (
u£Ωå_t
)
vaddr
;

97 
iov
.
iov_Àn
 = 
memsize
;

98 
u
.
uio_iov
 = &
iov
;

99 
u
.
uio_iov˙t
 = 1;

100 
u
.
uio_ªsid
 = 
fûesize
;

101 
u
.
uio_off£t
 = 
off£t
;

102 
u
.
uio_£gÊg
 = 
is_execuèbÀ
 ? 
UIO_USERISPACE
 : 
UIO_USERSPACE
;

103 
u
.
uio_rw
 = 
UIO_READ
;

104 
u
.
uio_•a˚
 = 
as
;

106 
ªsu…
 = 
	`VOP_READ
(
v
, &
u
);

107 i‡(
ªsu…
) {

108  
ªsu…
;

111 i‡(
u
.
uio_ªsid
 != 0) {

113 
	`k¥ötf
("ELF: shortÑead on segment - fileÅruncated?\n");

114  
ENOEXEC
;

133 
size_t
 
fûœmt
;

135 
fûœmt
 = 
memsize
 - 
fûesize
;

136 i‡(
fûœmt
 > 0) {

137 
	`DEBUG
(
DB_EXEC
, "ELF: Zero-filling %lu more bytes\n",

138 (Ë
fûœmt
);

139 
u
.
uio_ªsid
 +
fûœmt
;

140 
ªsu…
 = 
	`uiomovezîos
(
fûœmt
, &
u
);

145  
ªsu…
;

146 
	}
}

154 
	$lﬂd_ñf
(
vnode
 *
v
, 
vaddr_t
 *
íåypoöt
)

156 
Elf_Ehdr
 
eh
;

157 
Elf_Phdr
 
ph
;

158 
ªsu…
, 
i
;

159 
iovec
 
iov
;

160 
uio
 
ku
;

161 
addr•a˚
 *
as
;

163 
as
 = 
	`¥oc_gëas
();

169 
	`uio_köô
(&
iov
, &
ku
, &
eh
, ”h), 0, 
UIO_READ
);

170 
ªsu…
 = 
	`VOP_READ
(
v
, &
ku
);

171 i‡(
ªsu…
) {

172  
ªsu…
;

175 i‡(
ku
.
uio_ªsid
 != 0) {

177 
	`k¥ötf
("ELF: shortÑead on header - fileÅruncated?\n");

178  
ENOEXEC
;

192 i‡(
eh
.
e_idít
[
EI_MAG0
] !
ELFMAG0
 ||

193 
eh
.
e_idít
[
EI_MAG1
] !
ELFMAG1
 ||

194 
eh
.
e_idít
[
EI_MAG2
] !
ELFMAG2
 ||

195 
eh
.
e_idít
[
EI_MAG3
] !
ELFMAG3
 ||

196 
eh
.
e_idít
[
EI_CLASS
] !
ELFCLASS32
 ||

197 
eh
.
e_idít
[
EI_DATA
] !
ELFDATA2MSB
 ||

198 
eh
.
e_idít
[
EI_VERSION
] !
EV_CURRENT
 ||

199 
eh
.
e_vîsi⁄
 !
EV_CURRENT
 ||

200 
eh
.
e_ty≥
!=
ET_EXEC
 ||

201 
eh
.
e_machöe
!=
EM_MACHINE
) {

202  
ENOEXEC
;

220 
i
=0; i<
eh
.
e_phnum
; i++) {

221 
off_t
 
off£t
 = 
eh
.
e_phoff
 + 
i
*eh.
e_phítsize
;

222 
	`uio_köô
(&
iov
, &
ku
, &
ph
, ’h), 
off£t
, 
UIO_READ
);

224 
ªsu…
 = 
	`VOP_READ
(
v
, &
ku
);

225 i‡(
ªsu…
) {

226  
ªsu…
;

229 i‡(
ku
.
uio_ªsid
 != 0) {

231 
	`k¥ötf
("ELF: shortÑead onÖhdr - fileÅruncated?\n");

232  
ENOEXEC
;

235 
ph
.
p_ty≥
) {

236 
PT_NULL
: ;

237 
PT_PHDR
: ;

238 
PT_MIPS_REGINFO
: ;

239 
PT_LOAD
: ;

241 
	`k¥ötf
("loadelf: unknown segmentÅype %d\n",

242 
ph
.
p_ty≥
);

243  
ENOEXEC
;

246 
ªsu…
 = 
	`as_deföe_ªgi⁄
(
as
,

247 
ph
.
p_vaddr
,Öh.
p_memsz
,

248 
ph
.
p_Êags
 & 
PF_R
,

249 
ph
.
p_Êags
 & 
PF_W
,

250 
ph
.
p_Êags
 & 
PF_X
);

251 i‡(
ªsu…
) {

252  
ªsu…
;

256 
ªsu…
 = 
	`as_¥ï¨e_lﬂd
(
as
);

257 i‡(
ªsu…
) {

258  
ªsu…
;

265 
i
=0; i<
eh
.
e_phnum
; i++) {

266 
off_t
 
off£t
 = 
eh
.
e_phoff
 + 
i
*eh.
e_phítsize
;

267 
	`uio_köô
(&
iov
, &
ku
, &
ph
, ’h), 
off£t
, 
UIO_READ
);

269 
ªsu…
 = 
	`VOP_READ
(
v
, &
ku
);

270 i‡(
ªsu…
) {

271  
ªsu…
;

274 i‡(
ku
.
uio_ªsid
 != 0) {

276 
	`k¥ötf
("ELF: shortÑead onÖhdr - fileÅruncated?\n");

277  
ENOEXEC
;

280 
ph
.
p_ty≥
) {

281 
PT_NULL
: ;

282 
PT_PHDR
: ;

283 
PT_MIPS_REGINFO
: ;

284 
PT_LOAD
: ;

286 
	`k¥ötf
("loadelf: unknown segmentÅype %d\n",

287 
ph
.
p_ty≥
);

288  
ENOEXEC
;

291 
ªsu…
 = 
	`lﬂd_£gmít
(
as
, 
v
, 
ph
.
p_off£t
,Öh.
p_vaddr
,

292 
ph
.
p_memsz
,Öh.
p_fûesz
,

293 
ph
.
p_Êags
 & 
PF_X
);

294 i‡(
ªsu…
) {

295  
ªsu…
;

299 
ªsu…
 = 
	`as_com∂ëe_lﬂd
(
as
);

300 i‡(
ªsu…
) {

301  
ªsu…
;

304 *
íåypoöt
 = 
eh
.
e_íåy
;

307 
	}
}

	@/home/trinity/src/kern/syscall/runprogram.c

36 
	~<ty≥s.h
>

37 
	~<kîn/î∫o.h
>

38 
	~<kîn/f˙é.h
>

39 
	~<lib.h
>

40 
	~<¥oc.h
>

41 
	~<cuºít.h
>

42 
	~<addr•a˚.h
>

43 
	~<vm.h
>

44 
	~<vfs.h
>

45 
	~<sysˇŒ.h
>

46 
	~<ã°.h
>

55 
	$ru≈rogøm
(*
¥og«me
)

57 
addr•a˚
 *
as
;

58 
vnode
 *
v
;

59 
vaddr_t
 
íåypoöt
, 
°ack±r
;

60 
ªsu…
;

63 
ªsu…
 = 
	`vfs_›í
(
¥og«me
, 
O_RDONLY
, 0, &
v
);

64 i‡(
ªsu…
) {

65  
ªsu…
;

69 
	`KASSERT
(
	`¥oc_gëas
(Ë=
NULL
);

72 
as
 = 
	`as_¸óã
();

73 i‡(
as
 =
NULL
) {

74 
	`vfs_˛o£
(
v
);

75  
ENOMEM
;

79 
	`¥oc_£ès
(
as
);

80 
	`as_a˘iv©e
();

83 
ªsu…
 = 
	`lﬂd_ñf
(
v
, &
íåypoöt
);

84 i‡(
ªsu…
) {

86 
	`vfs_˛o£
(
v
);

87  
ªsu…
;

91 
	`vfs_˛o£
(
v
);

94 
ªsu…
 = 
	`as_deföe_°ack
(
as
, &
°ack±r
);

95 i‡(
ªsu…
) {

97  
ªsu…
;

101 
	`íãr_√w_¥o˚ss
(0 , 
NULL
 ,

102 
NULL
 ,

103 
°ack±r
, 
íåypoöt
);

106 
	`∑nic
("enter_new_processÑeturned\n");

107  
EINVAL
;

108 
	}
}

	@/home/trinity/src/kern/syscall/time_syscalls.c

30 
	~<ty≥s.h
>

31 
	~<˛ock.h
>

32 
	~<c›yöout.h
>

33 
	~<sysˇŒ.h
>

39 
	$sys___time
(
u£Ωå_t
 
u£r_£c⁄ds_±r
, u£Ωå_à
u£r_«no£c⁄ds_±r
)

41 
time•ec
 
ts
;

42 
ªsu…
;

44 
	`gëtime
(&
ts
);

46 
ªsu…
 = 
	`c›yout
(&
ts
.
tv_£c
, 
u£r_£c⁄ds_±r
, (ts.tv_sec));

47 i‡(
ªsu…
) {

48  
ªsu…
;

51 
ªsu…
 = 
	`c›yout
(&
ts
.
tv_n£c
, 
u£r_«no£c⁄ds_±r
,

52 (
ts
.
tv_n£c
));

53 i‡(
ªsu…
) {

54  
ªsu…
;

58 
	}
}

	@/home/trinity/src/kern/test/arraytest.c

30 
	~<ty≥s.h
>

31 
	~<lib.h
>

32 
	~<¨øy.h
>

33 
	~<ã°.h
>

35 
	#TESTSIZE
 73

	)

36 
	#BIGTESTSIZE
 3000

	)

37 
	#NTH
(
i
Ë((*)(0xb007 + 3*(i)))

	)

41 
	$ã°a
(
¨øy
 *
a
)

43 
ã°¨øy
[
TESTSIZE
];

44 
i
, 
j
, 
n
, 
r
, *
p
;

46 
i
=0; i<
TESTSIZE
; i++) {

47 
ã°¨øy
[
i
]=i;

50 
n
 = 
	`¨øy_num
(
a
);

51 
	`KASSERT
(
n
==0);

53 
i
=0; i<
TESTSIZE
; i++) {

54 
r
 = 
	`¨øy_add
(
a
, &
ã°¨øy
[
i
], 
NULL
);

55 
	`KASSERT
(
r
==0);

56 
n
 = 
	`¨øy_num
(
a
);

57 
	`KASSERT
(
n
==
i
+1);

59 
n
 = 
	`¨øy_num
(
a
);

60 
	`KASSERT
(
n
==
TESTSIZE
);

62 
i
=0; i<
TESTSIZE
; i++) {

63 
p
 = 
	`¨øy_gë
(
a
, 
i
);

64 
	`KASSERT
(*
p
 =
i
);

66 
n
 = 
	`¨øy_num
(
a
);

67 
	`KASSERT
(
n
==
TESTSIZE
);

69 
j
=0; j<
TESTSIZE
*4; j++) {

70 
i
 = 
	`øndom
()%
TESTSIZE
;

71 
p
 = 
	`¨øy_gë
(
a
, 
i
);

72 
	`KASSERT
(*
p
 =
i
);

74 
n
 = 
	`¨øy_num
(
a
);

75 
	`KASSERT
(
n
==
TESTSIZE
);

77 
i
=0; i<
TESTSIZE
; i++) {

78 
	`¨øy_£t
(
a
, 
i
, &
ã°¨øy
[
TESTSIZE
-i-1]);

81 
i
=0; i<
TESTSIZE
; i++) {

82 
p
 = 
	`¨øy_gë
(
a
, 
i
);

83 
	`KASSERT
(*
p
 =
TESTSIZE
-
i
-1);

86 
r
 = 
	`¨øy_£tsize
(
a
, 
TESTSIZE
/2);

87 
	`KASSERT
(
r
==0);

89 
i
=0; i<
TESTSIZE
/2; i++) {

90 
p
 = 
	`¨øy_gë
(
a
, 
i
);

91 
	`KASSERT
(*
p
 =
TESTSIZE
-
i
-1);

94 
	`¨øy_ªmove
(
a
, 1);

96 
i
=1; i<
TESTSIZE
/2 - 1; i++) {

97 
p
 = 
	`¨øy_gë
(
a
, 
i
);

98 
	`KASSERT
(*
p
 =
TESTSIZE
-
i
-2);

100 
p
 = 
	`¨øy_gë
(
a
, 0);

101 
	`KASSERT
(*
p
 =
TESTSIZE
-1);

103 
	`¨øy_£tsize
(
a
, 2);

104 
p
 = 
	`¨øy_gë
(
a
, 0);

105 
	`KASSERT
(*
p
 =
TESTSIZE
-1);

106 
p
 = 
	`¨øy_gë
(
a
, 1);

107 
	`KASSERT
(*
p
 =
TESTSIZE
-3);

109 
	`¨øy_£t
(
a
, 1, 
NULL
);

110 
	`¨øy_£tsize
(
a
, 2);

111 
p
 = 
	`¨øy_gë
(
a
, 0);

112 
	`KASSERT
(*
p
 =
TESTSIZE
-1);

113 
p
 = 
	`¨øy_gë
(
a
, 1);

114 
	`KASSERT
(
p
==
NULL
);

116 
	`¨øy_£tsize
(
a
, 
TESTSIZE
*10);

117 
p
 = 
	`¨øy_gë
(
a
, 0);

118 
	`KASSERT
(*
p
 =
TESTSIZE
-1);

119 
p
 = 
	`¨øy_gë
(
a
, 1);

120 
	`KASSERT
(
p
==
NULL
);

121 
	}
}

124 
	$¨øyã°
(
«rgs
, **
¨gs
)

126 
¨øy
 *
a
;

128 ()
«rgs
;

129 ()
¨gs
;

131 
	`k¥ötf
("BeginningárrayÅest...\n");

132 
a
 = 
	`¨øy_¸óã
();

133 
	`KASSERT
(
a
 !
NULL
);

135 
	`ã°a
(
a
);

137 
	`¨øy_£tsize
(
a
, 0);

139 
	`ã°a
(
a
);

141 
	`¨øy_£tsize
(
a
, 0);

142 
	`¨øy_de°roy
(
a
);

144 
	`k¥ötf
("ArrayÅest complete\n");

146 
	}
}

149 
	$¨øyã°2
(
«rgs
, **
¨gs
)

151 
¨øy
 *
a
;

152 *
p
;

153 
i
, 
x
;

154 
ªsu…
;

156 ()
«rgs
;

157 ()
¨gs
;

160 
x
 = 0;

162 
	`k¥ötf
("BeginningÜargeárrayÅest...\n");

163 
a
 = 
	`¨øy_¸óã
();

164 
	`KASSERT
(
a
 !
NULL
);

167 
p
 = (*)0xc0ffee;

168 
i
=0; i<
BIGTESTSIZE
; i++) {

169 
ªsu…
 = 
	`¨øy_add
(
a
, 
p
, &
x
);

170 
	`KASSERT
(
ªsu…
 == 0);

171 
	`KASSERT
(
x
 =
i
);

173 
	`KASSERT
(
	`¨øy_num
(
a
Ë=
BIGTESTSIZE
);

176 
i
=0; i<
BIGTESTSIZE
; i++) {

177 
	`KASSERT
(
	`¨øy_gë
(
a
, 
i
Ë=
p
);

181 
ªsu…
 = 
	`¨øy_£tsize
(
a
, 0);

182 
	`KASSERT
(
ªsu…
 == 0);

185 
ªsu…
 = 
	`¨øy_£tsize
(
a
, 
BIGTESTSIZE
);

186 
	`KASSERT
(
ªsu…
 == 0);

187 
i
=0; i<
BIGTESTSIZE
; i++) {

188 
	`¨øy_£t
(
a
, 
i
, 
	`NTH
(i));

192 
i
=0; i<
BIGTESTSIZE
; i++) {

193 
	`KASSERT
(
	`¨øy_gë
(
a
, 
i
Ë=
	`NTH
(i));

197 
	`¨øy_ªmove
(
a
, 1);

198 
	`KASSERT
(
	`¨øy_gë
(
a
, 0Ë=
	`NTH
(0));

199 
	`KASSERT
(
	`¨øy_num
(
a
Ë=
BIGTESTSIZE
-1);

200 
i
=1; i<
BIGTESTSIZE
-1; i++) {

201 
	`KASSERT
(
	`¨øy_gë
(
a
, 
i
Ë=
	`NTH
(i+1));

205 
ªsu…
 = 
	`¨øy_£tsize
(
a
, 
BIGTESTSIZE
*2);

206 
	`KASSERT
(
ªsu…
 == 0);

207 
	`KASSERT
(
	`¨øy_gë
(
a
, 0Ë=
	`NTH
(0));

208 
i
=1; i<
BIGTESTSIZE
-1; i++) {

209 
	`KASSERT
(
	`¨øy_gë
(
a
, 
i
Ë=
	`NTH
(i+1));

213 
ªsu…
 = 
	`¨øy_£tsize
(
a
, 0);

214 
	`KASSERT
(
ªsu…
 == 0);

215 
	`¨øy_de°roy
(
a
);

217 
	`k¥ötf
("Done.\n");

220 
	}
}

	@/home/trinity/src/kern/test/automationtest.c

34 
	~<ty≥s.h
>

35 
	~<kîn/waô.h
>

36 
	~<lib.h
>

37 
	~<˛ock.h
>

38 
	~<thªad.h
>

39 
	~<synch.h
>

40 
	~<ã°.h
>

41 
	~<kîn/£¸ë.h
>

42 
	~<•ölock.h
>

44 
	#MAX_SPINNERS
 16

	)

46 
lock
 *
	gdódlock_locks
[2];

47 
£m≠h‹e
 *
	gdódlock_£m
;

49 
•ölock
 
	g•ö√rs_lock
[
MAX_SPINNERS
];

53 
	$öôôems
()

55 
i
;

57 
i
 = 0; i < 2; i++) {

58 
dódlock_locks
[
i
] = 
	`lock_¸óã
("deadlockÜock");

59 i‡(
dódlock_locks
[
i
] =
NULL
) {

60 
	`∑nic
("automationtest:Üock_create failed\n");

63 
dódlock_£m
 = 
	`£m_¸óã
("deadlock sem", 0);

64 i‡(
dódlock_£m
 =
NULL
) {

65 
	`∑nic
("automationtest: sem_create failed\n");

68 
i
 = 0; i < 
MAX_SPINNERS
; i++) {

69 
	`•ölock_öô
(&(
•ö√rs_lock
[
i
]));

71 
	}
}

75 
	$d…e°thªad
(*
junk1
, 
junk2
)

77 ()
junk1
;

78 ()
junk2
;

80 
	`lock_acquúe
(
dódlock_locks
[1]);

81 
	`V
(
dódlock_£m
);

82 
	`lock_acquúe
(
dódlock_locks
[0]);

83 
	}
}

86 
	$d…e°
(
«rgs
, **
¨gs
)

88 
ªsu…
;

90 ()
«rgs
;

91 ()
¨gs
;

93 
	`öôôems
();

95 
	`lock_acquúe
(
dódlock_locks
[0]);

97 
ªsu…
 = 
	`thªad_f‹k
("d…e°", 
NULL
, 
d…e°thªad
, NULL, ()0);

98 i‡(
ªsu…
) {

99 
	`∑nic
("d…e°:Åhªad_f‹k faûed: %s\n", 
	`°ªº‹
(
ªsu…
));

102 
	`P
(
dódlock_£m
);

103 
	`lock_acquúe
(
dódlock_locks
[1]);

105 
	`∑nic
("dltest: didn't create deadlock (locksÖrobably don't work)\n");

109 
	}
}

111 
ölöe


114 
	$öföôe_•ö√r
(
i
)

116 ()
i
;

117 vﬁ©ûê
j
;

119 
j
=0; j<10000000; j++);

121 
	`•ölock_acquúe
(&(
•ö√rs_lock
[
i
]));

123 
j
=0; j<=1000; j++) {

124 i‡(
j
 == 1000) {

125 
j
 = 0;

128 
	`∑nic
("ll1test: infinite spinÜoop completed\n");

129 
	}
}

132 
	$Œ1ã°
(
«rgs
, **
¨gs
)

134 ()
«rgs
;

135 ()
¨gs
;

137 
	`öôôems
();

139 
	`öföôe_•ö√r
(() 0);

143 
	}
}

148 
	$Œ16ã°thªad
(*
junk1
, 
i
)

150 ()
junk1
;

152 
	`öföôe_•ö√r
(
i
);

153 
	}
}

156 
	$Œ16ã°
(
«rgs
, **
¨gs
)

158 
i
, 
ªsu…
;

160 
	`öôôems
();

162 ()
«rgs
;

163 ()
¨gs
;

165 
i
=1; i<16; i++) {

166 
ªsu…
 = 
	`thªad_f‹k
("Œ16ã°thªad", 
NULL
, 
Œ16ã°thªad
, NULL, ()
i
);

167 i‡(
ªsu…
) {

168 
	`∑nic
("Œ16ã°:Åhªad_f‹k faûed: %s\n", 
	`°ªº‹
(
ªsu…
));

171 
	`öföôe_•ö√r
(0);

175 
	}
}

	@/home/trinity/src/kern/test/bitmaptest.c

30 
	~<ty≥s.h
>

31 
	~<lib.h
>

32 
	~<bôm≠.h
>

33 
	~<ã°.h
>

35 
	#TESTSIZE
 533

	)

38 
	$bôm≠ã°
(
«rgs
, **
¨gs
)

40 
bôm≠
 *
b
;

41 
d©a
[
TESTSIZE
];

42 
uöt32_t
 
x
;

43 
i
;

45 ()
«rgs
;

46 ()
¨gs
;

48 
	`k¥ötf
("Starting bitmapÅest...\n");

50 
i
=0; i<
TESTSIZE
; i++) {

51 
d©a
[
i
] = 
	`øndom
()%2;

54 
b
 = 
	`bôm≠_¸óã
(
TESTSIZE
);

55 
	`KASSERT
(
b
 !
NULL
);

57 
i
=0; i<
TESTSIZE
; i++) {

58 
	`KASSERT
(
	`bôm≠_is£t
(
b
, 
i
)==0);

61 
i
=0; i<
TESTSIZE
; i++) {

62 i‡(
d©a
[
i
]) {

63 
	`bôm≠_m¨k
(
b
, 
i
);

66 
i
=0; i<
TESTSIZE
; i++) {

67 i‡(
d©a
[
i
]) {

68 
	`KASSERT
(
	`bôm≠_is£t
(
b
, 
i
));

71 
	`KASSERT
(
	`bôm≠_is£t
(
b
, 
i
)==0);

75 
i
=0; i<
TESTSIZE
; i++) {

76 i‡(
d©a
[
i
]) {

77 
	`bôm≠_unm¨k
(
b
, 
i
);

80 
	`bôm≠_m¨k
(
b
, 
i
);

83 
i
=0; i<
TESTSIZE
; i++) {

84 i‡(
d©a
[
i
]) {

85 
	`KASSERT
(
	`bôm≠_is£t
(
b
, 
i
)==0);

88 
	`KASSERT
(
	`bôm≠_is£t
(
b
, 
i
));

92 
	`bôm≠_Æloc
(
b
, &
x
)==0) {

93 
	`KASSERT
(
x
 < 
TESTSIZE
);

94 
	`KASSERT
(
	`bôm≠_is£t
(
b
, 
x
));

95 
	`KASSERT
(
d©a
[
x
]==1);

96 
d©a
[
x
] = 0;

99 
i
=0; i<
TESTSIZE
; i++) {

100 
	`KASSERT
(
	`bôm≠_is£t
(
b
, 
i
));

101 
	`KASSERT
(
d©a
[
i
]==0);

104 
	`k¥ötf
("BitmapÅest complete\n");

106 
	}
}

	@/home/trinity/src/kern/test/fstest.c

41 
	~<ty≥s.h
>

42 
	~<kîn/î∫o.h
>

43 
	~<kîn/f˙é.h
>

44 
	~<lib.h
>

45 
	~<uio.h
>

46 
	~<thªad.h
>

47 
	~<synch.h
>

48 
	~<vfs.h
>

49 
	~<fs.h
>

50 
	~<vnode.h
>

51 
	~<ã°.h
>

53 
	#SLOGAN
 "HODIE MIHI - CRAS TIBI\n"

	)

54 
	#FILENAME
 "f°e°.tmp"

	)

55 
	#NCHUNKS
 720

	)

56 
	#NTHREADS
 12

	)

57 
	#NLONG
 32

	)

58 
	#NCREATE
 24

	)

60 
£m≠h‹e
 *
	gthªad£m
 = 
NULL
;

64 
	$öô_thªad£m
()

66 i‡(
thªad£m
==
NULL
) {

67 
thªad£m
 = 
	`£m_¸óã
("fstestsem", 0);

68 i‡(
thªad£m
 =
NULL
) {

69 
	`∑nic
("fstest: sem_create failed\n");

72 
	}
}

80 
	$rŸ©e
(*
°r
, 
amt
)

82 
i
, 
ch
;

84 
amt
 = (amt+2600)%26;

85 
	`KASSERT
(
amt
>=0);

87 
i
=0; 
°r
[i]; i++) {

88 
ch
 = 
°r
[
i
];

89 i‡(
ch
>='A' && ch<='Z') {

90 
ch
 = ch - 'A';

91 
ch
 +
amt
;

92 
ch
 %= 26;

93 
ch
 = ch + 'A';

94 
	`KASSERT
(
ch
>='A' && ch<='Z');

96 
°r
[
i
] = 
ch
;

98 
	}
}

104 
	$f°e°_makíame
(*
buf
, 
size_t
 
buÊí
,

105 c⁄° *
fs
, c⁄° *
«mesuffix
)

107 
	`¢¥ötf
(
buf
, 
buÊí
, "%s:%s%s", 
fs
, 
FILENAME
, 
«mesuffix
);

108 
	`KASSERT
(
	`°æí
(
buf
Ë< 
buÊí
);

109 
	}
}

111 
	#MAKENAME
(Ë
	`f°e°_makíame
(
«me
, “ame), 
fs
, 
«mesuffix
)

	)

115 
	$f°e°_ªmove
(c⁄° *
fs
, c⁄° *
«mesuffix
)

117 
«me
[32];

118 
buf
[32];

119 
îr
;

121 
	`MAKENAME
();

123 
	`°r˝y
(
buf
, 
«me
);

124 
îr
 = 
	`vfs_ªmove
(
buf
);

125 i‡(
îr
) {

126 
	`k¥ötf
("CouldÇŸÑemovê%s: %s\n", 
«me
, 
	`°ªº‹
(
îr
));

131 
	}
}

135 
	$f°e°_wrôe
(c⁄° *
fs
, c⁄° *
«mesuffix
,

136 
°ridesize
, 
°ridïos
)

138 
vnode
 *
vn
;

139 
îr
;

140 
i
;

141 
size_t
 
shouldbyãs
=0;

142 
size_t
 
byãs
=0;

143 
off_t
 
pos
=0;

144 
«me
[32];

145 
buf
[32];

146 
iovec
 
iov
;

147 
uio
 
ku
;

148 
Êags
;

150 
	`KASSERT
((
buf
Ë> 
	`°æí
(
SLOGAN
));

152 
	`MAKENAME
();

154 
Êags
 = 
O_WRONLY
|
O_CREAT
;

155 i‡(
°ridesize
 == 1) {

156 
Êags
 |
O_TRUNC
;

160 
	`°r˝y
(
buf
, 
«me
);

161 
îr
 = 
	`vfs_›í
(
buf
, 
Êags
, 0664, &
vn
);

162 i‡(
îr
) {

163 
	`k¥ötf
("CouldÇot open %s for write: %s\n",

164 
«me
, 
	`°ªº‹
(
îr
));

168 
i
=0; i<
NCHUNKS
; i++) {

169 i‡(
i
 % 
°ridesize
 !
°ridïos
) {

170 
pos
 +
	`°æí
(
SLOGAN
);

173 
	`°r˝y
(
buf
, 
SLOGAN
);

174 
	`rŸ©e
(
buf
, 
i
);

175 
	`uio_köô
(&
iov
, &
ku
, 
buf
, 
	`°æí
(
SLOGAN
), 
pos
, 
UIO_WRITE
);

176 
îr
 = 
	`VOP_WRITE
(
vn
, &
ku
);

177 i‡(
îr
) {

178 
	`k¥ötf
("%s: Wrôêîr‹: %s\n", 
«me
, 
	`°ªº‹
(
îr
));

179 
	`vfs_˛o£
(
vn
);

180 
	`vfs_ªmove
(
«me
);

184 i‡(
ku
.
uio_ªsid
 > 0) {

185 
	`k¥ötf
("%s: Short write: %lu bytesÜeft over\n",

186 
«me
, (Ë
ku
.
uio_ªsid
);

187 
	`vfs_˛o£
(
vn
);

188 
	`vfs_ªmove
(
«me
);

192 
byãs
 +(
ku
.
uio_off£t
 - 
pos
);

193 
shouldbyãs
 +
	`°æí
(
SLOGAN
);

194 
pos
 = 
ku
.
uio_off£t
;

197 
	`vfs_˛o£
(
vn
);

199 i‡(
byãs
 !
shouldbyãs
) {

200 
	`k¥ötf
("%s: %lu bytes written, should have been %lu!\n",

201 
«me
, (Ë
byãs
,

202 (Ë(
NCHUNKS
*
	`°æí
(
SLOGAN
)));

203 
	`vfs_ªmove
(
«me
);

206 
	`k¥ötf
("%s: %lu byã†wrôãn\n", 
«me
, (Ë
byãs
);

209 
	}
}

213 
	$f°e°_ªad
(c⁄° *
fs
, c⁄° *
«mesuffix
)

215 
vnode
 *
vn
;

216 
îr
;

217 
i
;

218 
size_t
 
byãs
=0;

219 
«me
[32];

220 
buf
[32];

221 
iovec
 
iov
;

222 
uio
 
ku
;

224 
	`MAKENAME
();

227 
	`°r˝y
(
buf
, 
«me
);

228 
îr
 = 
	`vfs_›í
(
buf
, 
O_RDONLY
, 0664, &
vn
);

229 i‡(
îr
) {

230 
	`k¥ötf
("CouldÇot openÅest file forÑead: %s\n",

231 
	`°ªº‹
(
îr
));

235 
i
=0; i<
NCHUNKS
; i++) {

236 
	`uio_köô
(&
iov
, &
ku
, 
buf
, 
	`°æí
(
SLOGAN
), 
byãs
, 
UIO_READ
);

237 
îr
 = 
	`VOP_READ
(
vn
, &
ku
);

238 i‡(
îr
) {

239 
	`k¥ötf
("%s: RódÉº‹: %s\n", 
«me
, 
	`°ªº‹
(
îr
));

240 
	`vfs_˛o£
(
vn
);

244 i‡(
ku
.
uio_ªsid
 > 0) {

245 
	`k¥ötf
("%s: Sh‹àªad: %lu byã†À· ovî\n", 
«me
,

246 (Ë
ku
.
uio_ªsid
);

247 
	`vfs_˛o£
(
vn
);

250 
buf
[
	`°æí
(
SLOGAN
)] = 0;

251 
	`rŸ©e
(
buf
, -
i
);

252 i‡(
	`°rcmp
(
buf
, 
SLOGAN
)) {

253 
	`k¥ötf
("%s: Test failed:Üine %d mismatched: %s\n",

254 
«me
, 
i
+1, 
buf
);

255 
	`vfs_˛o£
(
vn
);

259 
byãs
 = 
ku
.
uio_off£t
;

262 
	`vfs_˛o£
(
vn
);

264 i‡(
byãs
 !
NCHUNKS
*
	`°æí
(
SLOGAN
)) {

265 
	`k¥ötf
("%s: %lu bytesÑead, should have been %lu!\n",

266 
«me
, (Ë
byãs
,

267 (Ë(
NCHUNKS
*
	`°æí
(
SLOGAN
)));

270 
	`k¥ötf
("%s: %lu byã†ªad\n", 
«me
, (Ë
byãs
);

272 
	}
}

278 
	$dof°e°
(c⁄° *
fûesys
)

280 
	`k¥ötf
("*** Sèπög fûesy°emÅe° o¿%s:\n", 
fûesys
);

282 i‡(
	`f°e°_wrôe
(
fûesys
, "", 1, 0)) {

283 
	`k¥ötf
("*** Test failed\n");

287 i‡(
	`f°e°_ªad
(
fûesys
, "")) {

288 
	`k¥ötf
("*** Test failed\n");

292 i‡(
	`f°e°_ªmove
(
fûesys
, "")) {

293 
	`k¥ötf
("*** Test failed\n");

297 
	`k¥ötf
("*** FilesystemÅest done\n");

298 
	}
}

304 
	$ªad°ªss_thªad
(*
fs
, 
num
)

306 c⁄° *
fûesys
 = 
fs
;

307 i‡(
	`f°e°_ªad
(
fûesys
, "")) {

308 
	`k¥ötf
("*** Thªad %lu: faûed\n", 
num
);

310 
	`V
(
thªad£m
);

311 
	}
}

315 
	$d‹ód°ªss
(c⁄° *
fûesys
)

317 
i
, 
îr
;

319 
	`öô_thªad£m
();

321 
	`k¥ötf
("*** Sèπög f†ªad såes†ã° o¿%s:\n", 
fûesys
);

323 i‡(
	`f°e°_wrôe
(
fûesys
, "", 1, 0)) {

324 
	`k¥ötf
("*** Test failed\n");

328 
i
=0; i<
NTHREADS
; i++) {

329 
îr
 = 
	`thªad_f‹k
("ªad°ªss", 
NULL
,

330 
ªad°ªss_thªad
, (*)
fûesys
, 
i
);

331 i‡(
îr
) {

332 
	`∑nic
("readstress:Åhread_fork failed: %s\n",

333 
	`°ªº‹
(
îr
));

337 
i
=0; i<
NTHREADS
; i++) {

338 
	`P
(
thªad£m
);

341 i‡(
	`f°e°_ªmove
(
fûesys
, "")) {

342 
	`k¥ötf
("*** Test failed\n");

346 
	`k¥ötf
("*** fsÑead stressÅest done\n");

347 
	}
}

353 
	$wrôe°ªss_thªad
(*
fs
, 
num
)

355 c⁄° *
fûesys
 = 
fs
;

356 
num°r
[8];

357 
	`¢¥ötf
(
num°r
, “um°r), "%lu", 
num
);

359 i‡(
	`f°e°_wrôe
(
fûesys
, 
num°r
, 1, 0)) {

360 
	`k¥ötf
("*** Thªad %lu: faûed\n", 
num
);

361 
	`V
(
thªad£m
);

365 i‡(
	`f°e°_ªad
(
fûesys
, 
num°r
)) {

366 
	`k¥ötf
("*** Thªad %lu: faûed\n", 
num
);

367 
	`V
(
thªad£m
);

371 i‡(
	`f°e°_ªmove
(
fûesys
, 
num°r
)) {

372 
	`k¥ötf
("*** Thªad %lu: faûed\n", 
num
);

375 
	`k¥ötf
("*** Thªad %lu: d⁄e\n", 
num
);

377 
	`V
(
thªad£m
);

378 
	}
}

382 
	$dowrôe°ªss
(c⁄° *
fûesys
)

384 
i
, 
îr
;

386 
	`öô_thªad£m
();

388 
	`k¥ötf
("*** Sèπög f†wrôê°ªs†ã° o¿%s:\n", 
fûesys
);

390 
i
=0; i<
NTHREADS
; i++) {

391 
îr
 = 
	`thªad_f‹k
("wrôe°ªss", 
NULL
,

392 
wrôe°ªss_thªad
, (*)
fûesys
, 
i
);

393 i‡(
îr
) {

394 
	`∑nic
("thªad_f‹k faûed %s\n", 
	`°ªº‹
(
îr
));

398 
i
=0; i<
NTHREADS
; i++) {

399 
	`P
(
thªad£m
);

402 
	`k¥ötf
("*** fs write stressÅest done\n");

403 
	}
}

409 
	$wrôe°ªss2_thªad
(*
fs
, 
num
)

411 c⁄° *
fûesys
 = 
fs
;

413 i‡(
	`f°e°_wrôe
(
fûesys
, "", 
NTHREADS
, 
num
)) {

414 
	`k¥ötf
("*** Thªad %lu: faûed\n", 
num
);

415 
	`V
(
thªad£m
);

419 
	`V
(
thªad£m
);

420 
	}
}

424 
	$dowrôe°ªss2
(c⁄° *
fûesys
)

426 
i
, 
îr
;

427 
«me
[32];

428 
vnode
 *
vn
;

430 
	`öô_thªad£m
();

432 
	`k¥ötf
("*** Sèπög f†wrôê°ªs†ã° 2 o¿%s:\n", 
fûesys
);

435 
	`f°e°_makíame
(
«me
, “ame), 
fûesys
, "");

436 
îr
 = 
	`vfs_›í
(
«me
, 
O_WRONLY
|
O_CREAT
|
O_TRUNC
, 0664, &
vn
);

437 i‡(
îr
) {

438 
	`k¥ötf
("CouldÇŸ cª©êã° fûe: %s\n", 
	`°ªº‹
(
îr
));

439 
	`k¥ötf
("*** Test failed\n");

442 
	`vfs_˛o£
(
vn
);

444 
i
=0; i<
NTHREADS
; i++) {

445 
îr
 = 
	`thªad_f‹k
("wrôe°ªss2", 
NULL
,

446 
wrôe°ªss2_thªad
, (*)
fûesys
, 
i
);

447 i‡(
îr
) {

448 
	`∑nic
("writestress2:Åhread_fork failed: %s\n",

449 
	`°ªº‹
(
îr
));

453 
i
=0; i<
NTHREADS
; i++) {

454 
	`P
(
thªad£m
);

457 i‡(
	`f°e°_ªad
(
fûesys
, "")) {

458 
	`k¥ötf
("*** Test failed\n");

462 i‡(
	`f°e°_ªmove
(
fûesys
, "")) {

463 
	`k¥ötf
("*** Test failed\n");

467 
	`k¥ötf
("*** fs write stressÅest 2 done\n");

468 
	}
}

474 
	$l⁄g°ªss_thªad
(*
fs
, 
num
)

476 c⁄° *
fûesys
 = 
fs
;

477 
i
;

478 
num°r
[16];

480 
i
=0; i<
NLONG
; i++) {

482 
	`¢¥ötf
(
num°r
, “um°r), "%lu-%d", 
num
, 
i
);

484 i‡(
	`f°e°_wrôe
(
fûesys
, 
num°r
, 1, 0)) {

485 
	`k¥ötf
("*** Thªad %lu: fûê%d: faûed\n", 
num
, 
i
);

486 
	`V
(
thªad£m
);

490 i‡(
	`f°e°_ªad
(
fûesys
, 
num°r
)) {

491 
	`k¥ötf
("*** Thªad %lu: fûê%d: faûed\n", 
num
, 
i
);

492 
	`V
(
thªad£m
);

496 i‡(
	`f°e°_ªmove
(
fûesys
, 
num°r
)) {

497 
	`k¥ötf
("*** Thªad %lu: fûê%d: faûed\n", 
num
, 
i
);

498 
	`V
(
thªad£m
);

504 
	`V
(
thªad£m
);

505 
	}
}

509 
	$dﬁ⁄g°ªss
(c⁄° *
fûesys
)

511 
i
, 
îr
;

513 
	`öô_thªad£m
();

515 
	`k¥ötf
("*** Sèπög f†l⁄g såes†ã° o¿%s:\n", 
fûesys
);

517 
i
=0; i<
NTHREADS
; i++) {

518 
îr
 = 
	`thªad_f‹k
("l⁄g°ªss", 
NULL
,

519 
l⁄g°ªss_thªad
, (*)
fûesys
, 
i
);

520 i‡(
îr
) {

521 
	`∑nic
("longstress:Åhread_fork failed %s\n",

522 
	`°ªº‹
(
îr
));

526 
i
=0; i<
NTHREADS
; i++) {

527 
	`P
(
thªad£m
);

530 
	`k¥ötf
("*** fsÜong stressÅest done\n");

531 
	}
}

537 
	$¸óã°ªss_thªad
(*
fs
, 
num
)

539 c⁄° *
fûesys
 = 
fs
;

540 
i
, 
îr
;

541 
«mesuffix
[16];

542 
«me
[32];

543 
buf
[32];

544 
vnode
 *
vn
;

545 
iovec
 
iov
;

546 
uio
 
ku
;

547 
size_t
 
byãs
;

548 
numwrôãn
 = 0, 
numªad
 = 0, 
numªmoved
 = 0;

550 
i
=0; i<
NCREATE
; i++) {

551 
	`¢¥ötf
(
«mesuffix
, “amesuffix), "%lu-%d", 
num
, 
i
);

552 
	`MAKENAME
();

555 
	`°r˝y
(
buf
, 
«me
);

556 
îr
 = 
	`vfs_›í
(
buf
, 
O_WRONLY
|
O_CREAT
|
O_TRUNC
, 0664, &
vn
);

557 i‡(
îr
) {

558 
	`k¥ötf
("CouldÇot open %s for write: %s\n",

559 
«me
, 
	`°ªº‹
(
îr
));

563 
	`°r˝y
(
buf
, 
SLOGAN
);

564 
	`rŸ©e
(
buf
, 
i
);

566 
	`uio_köô
(&
iov
, &
ku
, 
buf
, 
	`°æí
(
SLOGAN
), 0, 
UIO_WRITE
);

567 
îr
 = 
	`VOP_WRITE
(
vn
, &
ku
);

568 
	`vfs_˛o£
(
vn
);

569 i‡(
îr
) {

570 
	`k¥ötf
("%s: Wrôêîr‹: %s\n", 
«me
, 
	`°ªº‹
(
îr
));

573 i‡(
ku
.
uio_ªsid
 > 0) {

574 
	`k¥ötf
("%s: Short write: %lu bytesÜeft over\n",

575 
«me
, (Ë
ku
.
uio_ªsid
);

579 
byãs
 = 
ku
.
uio_off£t
;

580 i‡(
byãs
 !
	`°æí
(
SLOGAN
)) {

581 
	`k¥ötf
("%s: %lu bytes written,Éxpected %lu!\n",

582 
«me
, (Ë
byãs
,

583 (Ë
	`°æí
(
SLOGAN
));

586 
numwrôãn
++;

588 
	`k¥ötf
("Thªad %lu: %u fûe†wrôãn\n", 
num
, 
numwrôãn
);

590 
i
=0; i<
NCREATE
; i++) {

591 
	`¢¥ötf
(
«mesuffix
, “amesuffix), "%lu-%d", 
num
, 
i
);

592 
	`MAKENAME
();

595 
	`°r˝y
(
buf
, 
«me
);

596 
îr
 = 
	`vfs_›í
(
buf
, 
O_RDONLY
, 0664, &
vn
);

597 i‡(
îr
) {

598 
	`k¥ötf
("CouldÇot open %s forÑead: %s\n",

599 
«me
, 
	`°ªº‹
(
îr
));

603 
	`uio_köô
(&
iov
, &
ku
, 
buf
, 
	`°æí
(
SLOGAN
), 0, 
UIO_READ
);

604 
îr
 = 
	`VOP_READ
(
vn
, &
ku
);

605 
	`vfs_˛o£
(
vn
);

606 i‡(
îr
) {

607 
	`k¥ötf
("%s: RódÉº‹: %s\n", 
«me
, 
	`°ªº‹
(
îr
));

610 i‡(
ku
.
uio_ªsid
 > 0) {

611 
	`k¥ötf
("%s: ShortÑead: %lu bytesÜeft over\n",

612 
«me
, (Ë
ku
.
uio_ªsid
);

616 
buf
[
	`°æí
(
SLOGAN
)] = 0;

617 
	`rŸ©e
(
buf
, -
i
);

619 i‡(
	`°rcmp
(
buf
, 
SLOGAN
)) {

620 
	`k¥ötf
("%s: Test failed: file mismatched: %s\n",

621 
«me
, 
buf
);

625 
byãs
 = 
ku
.
uio_off£t
;

626 i‡(
byãs
 !
	`°æí
(
SLOGAN
)) {

627 
	`k¥ötf
("%s: %lu bytesÑead,Éxpected %lu!\n",

628 
«me
, (Ë
byãs
,

629 (Ë
	`°æí
(
SLOGAN
));

633 
numªad
++;

635 
	`k¥ötf
("Thªad %lu: %u fûe†ªad\n", 
num
, 
numªad
);

637 
i
=0; i<
NCREATE
; i++) {

638 
	`¢¥ötf
(
«mesuffix
, “amesuffix), "%lu-%d", 
num
, 
i
);

639 i‡(
	`f°e°_ªmove
(
fûesys
, 
«mesuffix
)) {

642 
numªmoved
++;

644 
	`k¥ötf
("Thªad %lu: %u fûe†ªmoved\n", 
num
, 
numªmoved
);

646 
	`V
(
thªad£m
);

647 
	}
}

651 
	$do¸óã°ªss
(c⁄° *
fûesys
)

653 
i
, 
îr
;

655 
	`öô_thªad£m
();

657 
	`k¥ötf
("*** Sèπög f†¸óã såes†ã° o¿%s:\n", 
fûesys
);

659 
i
=0; i<
NTHREADS
; i++) {

660 
îr
 = 
	`thªad_f‹k
("¸óã°ªss", 
NULL
,

661 
¸óã°ªss_thªad
, (*)
fûesys
, 
i
);

662 i‡(
îr
) {

663 
	`∑nic
("createstress:Åhread_fork failed %s\n",

664 
	`°ªº‹
(
îr
));

668 
i
=0; i<
NTHREADS
; i++) {

669 
	`P
(
thªad£m
);

672 
	`k¥ötf
("*** fs create stressÅest done\n");

673 
	}
}

679 
	$checkfûesy°em
(
«rgs
, **
¨gs
)

681 *
devi˚
;

683 i‡(
«rgs
 != 2) {

684 
	`k¥ötf
("Usage: fs[123456] filesystem:\n");

685  
EINVAL
;

688 
devi˚
 = 
¨gs
[1];

691 i‡(
devi˚
[
	`°æí
(device)-1]==':') {

692 
devi˚
[
	`°æí
(device)-1] = 0;

696 
	}
}

698 
	#DEFTEST
(
ã°«me
) \

700 
	`ã°«me
(
«rgs
, **
¨gs
) \

702 
ªsu…
; \

703 
ªsu…
 = 
	`checkfûesy°em
(
«rgs
, 
¨gs
); \

704 i‡(
ªsu…
) { \

705  
ªsu…
; \

707 do##
	`ã°«me
(
¨gs
[1]); \

709 }

	)

711 
DEFTEST
(
f°e°
);

712 
DEFTEST
(
ªad°ªss
);

713 
DEFTEST
(
wrôe°ªss
);

714 
DEFTEST
(
wrôe°ªss2
);

715 
DEFTEST
(
l⁄g°ªss
);

716 
DEFTEST
(
¸óã°ªss
);

721 
	$¥ötfûe
(
«rgs
, **
¨gs
)

723 
vnode
 *
rv
, *
wv
;

724 
iovec
 
iov
;

725 
uio
 
ku
;

726 
off_t
 
Ωos
=0, 
wpos
=0;

727 
buf
[128];

728 
outfûe
[16];

729 
ªsu…
;

730 
d⁄e
=0;

732 i‡(
«rgs
 != 2) {

733 
	`k¥ötf
("Usage:Öf filename\n");

734  
EINVAL
;

738 
	`°r˝y
(
outfûe
, "con:");

740 
ªsu…
 = 
	`vfs_›í
(
¨gs
[1], 
O_RDONLY
, 0664, &
rv
);

741 i‡(
ªsu…
) {

742 
	`k¥ötf
("¥ötfûe: %s\n", 
	`°ªº‹
(
ªsu…
));

743  
ªsu…
;

746 
ªsu…
 = 
	`vfs_›í
(
outfûe
, 
O_WRONLY
, 0664, &
wv
);

747 i‡(
ªsu…
) {

748 
	`k¥ötf
("¥ötfûe: ouçut: %s\n", 
	`°ªº‹
(
ªsu…
));

749 
	`vfs_˛o£
(
rv
);

750  
ªsu…
;

753 !
d⁄e
) {

754 
	`uio_köô
(&
iov
, &
ku
, 
buf
, (buf), 
Ωos
, 
UIO_READ
);

755 
ªsu…
 = 
	`VOP_READ
(
rv
, &
ku
);

756 i‡(
ªsu…
) {

757 
	`k¥ötf
("RódÉº‹: %s\n", 
	`°ªº‹
(
ªsu…
));

760 
Ωos
 = 
ku
.
uio_off£t
;

762 i‡(
ku
.
uio_ªsid
 > 0) {

763 
d⁄e
 = 1;

766 
	`uio_köô
(&
iov
, &
ku
, 
buf
, (buf)-ku.
uio_ªsid
, 
wpos
,

767 
UIO_WRITE
);

768 
ªsu…
 = 
	`VOP_WRITE
(
wv
, &
ku
);

769 i‡(
ªsu…
) {

770 
	`k¥ötf
("Wrôêîr‹: %s\n", 
	`°ªº‹
(
ªsu…
));

773 
wpos
 = 
ku
.
uio_off£t
;

775 i‡(
ku
.
uio_ªsid
 > 0) {

776 
	`k¥ötf
("Warning: short write\n");

780 
	`vfs_˛o£
(
wv
);

781 
	`vfs_˛o£
(
rv
);

784 
	}
}

	@/home/trinity/src/kern/test/hmacunit.c

30 
	~<ty≥s.h
>

31 
	~<lib.h
>

32 
	~<•ölock.h
>

33 
	~<synch.h
>

34 
	~<thªad.h
>

35 
	~<cuºít.h
>

36 
	~<˛ock.h
>

37 
	~<ã°.h
>

38 
	~<kîn/£cuª.h
>

49 
	$ok
()

51 
	`k¥ötf
("TestÖassed.\n");

52 
	}
}

60 c⁄° *
	g∂aöãxt1
[] = {

66 c⁄° *
	gkeys1
[] = {

72 c⁄° *
	ghashes1
[] = {

78 
	#N_TESTS_1
 3

	)

81 
	$hmacu1
(
«rgs
, **
¨gs
)

83 *
hash
;

84 
ªs
;

86 ()
«rgs
; ()
¨gs
;

87 
i
;

88 
i
 = 0; i < 
N_TESTS_1
; i++)

90 
ªs
 = 
	`hmac
(
∂aöãxt1
[
i
], 
	`°æí
’œöãxt1[i]), 
keys1
[i], såÀn(keys1[i]), &
hash
);

91 
	`KASSERT
(!
ªs
);

92 
	`KASSERT
(
	`°rcmp
(
hash
, 
hashes1
[
i
]) == 0);

93 
	`k‰ì
(
hash
);

96 
	`ok
();

99 
	}
}

	@/home/trinity/src/kern/test/kmalloctest.c

33 
	~<ty≥s.h
>

34 
	~<kîn/î∫o.h
>

35 
	~<lib.h
>

36 
	~<˝u.h
>

37 
	~<thªad.h
>

38 
	~<synch.h
>

39 
	~<vm.h
>

40 
	~<ã°.h
>

41 
	~<kîn/ã°161.h
>

42 
	~<maöbus.h
>

44 
	~"›t-dumbvm.h
"

47 
vaddr_t
 
fú°‰ì
;

63 
	#NTRIES
 1200

	)

64 
	#ITEMSIZE
 997

	)

65 
	#NTHREADS
 8

	)

67 
	#PROGRESS
(
ôî
) do { \

68 i‡((
ôî
 % 100) == 0) { \

69 
	`k¥ötf
("."); \

71 } 0)

	)

75 
	$kmÆlo˘hªad
(*
sm
, 
num
)

77 
£m≠h‹e
 *
£m
 = 
sm
;

78 *
±r
;

79 *
ﬁd±r
=
NULL
;

80 *
ﬁd±r2
=
NULL
;

81 
i
;

83 
i
=0; i<
NTRIES
; i++) {

84 
	`PROGRESS
(
i
);

85 
±r
 = 
	`kmÆloc
(
ITEMSIZE
);

86 i‡(
±r
==
NULL
) {

87 i‡(
£m
) {

88 
	`k¥ötf
("thread %lu: kmallocÑeturned NULL\n",

89 
num
);

90 
	`∑nic
("kmallocÅest failed");

92 
	`k¥ötf
("kmallocÑeturnedÇull;Åest failed.\n");

93 
	`∑nic
("kmallocÅest failed");

95 i‡(
ﬁd±r2
) {

96 
	`k‰ì
(
ﬁd±r2
);

98 
ﬁd±r2
 = 
ﬁd±r
;

99 
ﬁd±r
 = 
±r
;

102 i‡(
ﬁd±r2
) {

103 
	`k‰ì
(
ﬁd±r2
);

105 i‡(
ﬁd±r
) {

106 
	`k‰ì
(
ﬁd±r
);

108 i‡(
£m
) {

109 
	`V
(
£m
);

111 
	}
}

114 
	$kmÆlo˘e°
(
«rgs
, **
¨gs
)

116 ()
«rgs
;

117 ()
¨gs
;

119 
	`k¥ötf
("Starting kmallocÅest...\n");

120 
	`kmÆlo˘hªad
(
NULL
, 0);

121 
	`k¥ötf
("\n");

122 
	`suc˚ss
(
TEST161_SUCCESS
, 
SECRET
, "km1");

125 
	}
}

128 
	$kmÆloc°ªss
(
«rgs
, **
¨gs
)

130 
£m≠h‹e
 *
£m
;

131 
i
, 
ªsu…
;

133 ()
«rgs
;

134 ()
¨gs
;

136 
£m
 = 
	`£m_¸óã
("kmallocstress", 0);

137 i‡(
£m
 =
NULL
) {

138 
	`∑nic
("kmallocstress: sem_create failed\n");

141 
	`k¥ötf
("Starting kmalloc stressÅest...\n");

143 
i
=0; i<
NTHREADS
; i++) {

144 
ªsu…
 = 
	`thªad_f‹k
("kmÆloc°ªss", 
NULL
,

145 
kmÆlo˘hªad
, 
£m
, 
i
);

146 i‡(
ªsu…
) {

147 
	`∑nic
("kmallocstress:Åhread_fork failed: %s\n",

148 
	`°ªº‹
(
ªsu…
));

152 
i
=0; i<
NTHREADS
; i++) {

153 
	`P
(
£m
);

156 
	`£m_de°roy
(
£m
);

157 
	`k¥ötf
("\n");

158 
	`suc˚ss
(
TEST161_SUCCESS
, 
SECRET
, "km2");

161 
	}
}

188 
	$kmÆlo˘e°3
(
«rgs
, **
¨gs
)

190 
	#NUM_KM3_SIZES
 5

	)

191 c⁄° 
sizes
[
NUM_KM3_SIZES
] = { 32, 41, 109, 86, 9 };

192 
num±rs
;

193 
size_t
 
±r•a˚
;

194 
size_t
 
blocksize
;

195 
num±rblocks
;

196 ***
±rblocks
;

197 
curblock
, 
cuΩos
, 
cursizeödex
, 
cursize
;

198 
size_t
 
tŸÆsize
;

199 
i
, 
j
;

200 *
±r
;

202 i‡(
«rgs
 != 2) {

203 
	`k¥ötf
("kmalloctest3: usage: km3Çumobjects\n");

204  
EINVAL
;

208 
num±rs
 = 
	`©oi
(
¨gs
[1]);

209 
±r•a˚
 = 
num±rs
 * (*);

212 
blocksize
 = 
PAGE_SIZE
 / 4;

213 
num±rblocks
 = 
	`DIVROUNDUP
(
±r•a˚
, 
blocksize
);

215 
	`k¥ötf
("kmalloctest3: %u objects, %uÖointer blocks\n",

216 
num±rs
, 
num±rblocks
);

219 
±rblocks
 = 
	`kmÆloc
(
num±rblocks
 * (ptrblocks[0]));

220 i‡(
±rblocks
 =
NULL
) {

221 
	`∑nic
("kmalloctest3: failed onÖointer blockárray\n");

224 
i
=0; i<
num±rblocks
; i++) {

225 
±rblocks
[
i
] = 
	`kmÆloc
(
blocksize
);

226 i‡(
±rblocks
[
i
] =
NULL
) {

227 
	`∑nic
("kmÆlo˘e°3: faûed o¿poöã∏block %u\n", 
i
);

232 
curblock
 = 0;

233 
cuΩos
 = 0;

234 
cursizeödex
 = 0;

235 
tŸÆsize
 = 0;

236 
i
=0; i<
num±rs
; i++) {

237 
cursize
 = 
sizes
[
cursizeödex
];

238 
±r
 = 
	`kmÆloc
(
cursize
);

239 i‡(
±r
 =
NULL
) {

240 
	`k¥ötf
("kmalloctest3: failed on object %u size %u\n",

241 
i
, 
cursize
);

242 
	`k¥ötf
("kmalloctest3:Öos %u inÖointer block %u\n",

243 
cuΩos
, 
curblock
);

244 
	`k¥ötf
("kmÆlo˘e°3:ÅŸÆ sÿÁ∏%zu\n", 
tŸÆsize
);

245 
	`∑nic
("kmalloctest3: failed.\n");

248 
j
=0; j<
cursize
; j++) {

249 
±r
[
j
] = (Ë
i
;

252 
±rblocks
[
curblock
][
cuΩos
] = 
±r
;

253 
cuΩos
++;

254 i‡(
cuΩos
 >
blocksize
 / (*)) {

255 
curblock
++;

256 
cuΩos
 = 0;

259 
tŸÆsize
 +
cursize
;

260 
cursizeödex
 = (cursizeödex + 1Ë% 
NUM_KM3_SIZES
;

263 
	`k¥ötf
("kmÆlo˘e°3: %zu byã†Æloˇãd\n", 
tŸÆsize
);

266 
curblock
 = 0;

267 
cuΩos
 = 0;

268 
cursizeödex
 = 0;

269 
i
=0; i<
num±rs
; i++) {

270 
	`PROGRESS
(
i
);

271 
cursize
 = 
sizes
[
cursizeödex
];

272 
±r
 = 
±rblocks
[
curblock
][
cuΩos
];

273 
	`KASSERT
(
±r
 !
NULL
);

274 
j
=0; j<
cursize
; j++) {

275 i‡(
±r
[
j
] =(Ë
i
) {

278 
	`k¥ötf
("kmalloctest3: failed on object %u size %u\n",

279 
i
, 
cursize
);

280 
	`k¥ötf
("kmalloctest3:Öos %u inÖointer block %u\n",

281 
cuΩos
, 
curblock
);

282 
	`k¥ötf
("kmÆlo˘e°3:áàobje˘ off£à%u\n", 
j
);

283 
	`k¥ötf
("kmalloctest3:Éxpected 0x%x, found 0x%x\n",

284 
±r
[
j
], (Ë
i
);

285 
	`∑nic
("kmalloctest3: failed.\n");

287 
	`k‰ì
(
±r
);

288 
cuΩos
++;

289 i‡(
cuΩos
 >
blocksize
 / (*)) {

290 
curblock
++;

291 
cuΩos
 = 0;

293 
	`KASSERT
(
tŸÆsize
 > 0);

294 
tŸÆsize
 -
cursize
;

295 
cursizeödex
 = (cursizeödex + 1Ë% 
NUM_KM3_SIZES
;

297 
	`KASSERT
(
tŸÆsize
 == 0);

300 
i
=0; i<
num±rblocks
; i++) {

301 
	`PROGRESS
(
i
);

302 
	`KASSERT
(
±rblocks
[
i
] !
NULL
);

303 
	`k‰ì
(
±rblocks
[
i
]);

306 
	`k‰ì
(
±rblocks
);

308 
	`k¥ötf
("\n");

309 
	`suc˚ss
(
TEST161_SUCCESS
, 
SECRET
, "km3");

311 
	}
}

318 
	$kmÆlo˘e°4thªad
(*
sm
, 
num
)

320 
	#NUM_KM4_SIZES
 5

	)

321 
	#ITERATIONS
 50

	)

322 c⁄° 
sizes
[
NUM_KM4_SIZES
] = { 1, 3, 5, 2, 4 };

324 
£m≠h‹e
 *
£m
 = 
sm
;

325 *
±rs
[
NUM_KM4_SIZES
];

326 
p
, 
q
;

327 
i
, 
j
, 
k
;

328 
uöt32_t
 
magic
;

330 
i
=0; i<
NUM_KM4_SIZES
; i++) {

331 
±rs
[
i
] = 
NULL
;

333 
p
 = 0;

334 
q
 = 
NUM_KM4_SIZES
 / 2;

335 
magic
 = 
	`øndom
();

337 
i
=0; i<
NTRIES
; i++) {

338 
	`PROGRESS
(
i
);

339 i‡(
±rs
[
q
] !
NULL
) {

340 
	`k‰ì
(
±rs
[
q
]);

341 
±rs
[
q
] = 
NULL
;

343 
±rs
[
p
] = 
	`kmÆloc
(
sizes
[p] * 
PAGE_SIZE
);

344 i‡(
±rs
[
p
] =
NULL
) {

345 
	`∑nic
("kmalloctest4:Åhread %lu: "

347 
num
, 
sizes
[
p
]);

352 
k
 = 0; k < 
sizes
[
p
]; k++) {

353 *((
uöt32_t
 *)
±rs
[
p
] + 
k
*
PAGE_SIZE
/(uöt32_t)Ë
magic
;

356 
j
 = 0; j < 
ITERATIONS
; j++) {

357 
	`øndom_yõldî
(4);

358 
k
 = 0; k < 
sizes
[
p
]; k++) {

359 
uöt32_t
 
a˘uÆ
 = *((uöt32_à*)
±rs
[
p
] + 
k
*
PAGE_SIZE
/(uint32_t));

360 i‡(
a˘uÆ
 !
magic
) {

361 
	`∑nic
("km4:Éxpected %u got %u. Your VM is broken!",

362 
magic
, 
a˘uÆ
);

366 
magic
++;

367 
p
 = (∞+ 1Ë% 
NUM_KM4_SIZES
;

368 
q
 = (q + 1Ë% 
NUM_KM4_SIZES
;

371 
i
=0; i<
NUM_KM4_SIZES
; i++) {

372 i‡(
±rs
[
i
] !
NULL
) {

373 
	`k‰ì
(
±rs
[
i
]);

377 
	`V
(
£m
);

378 
	}
}

381 
	$kmÆlo˘e°4
(
«rgs
, **
¨gs
)

383 
£m≠h‹e
 *
£m
;

384 
¡hªads
;

385 
i
;

386 
ªsu…
;

388 ()
«rgs
;

389 ()
¨gs
;

391 
	`k¥ötf
("Starting multipage kmallocÅest...\n");

392 #i‡
OPT_DUMBVM


393 
	`k¥ötf
("(ThisÅest willÇot work with dumbvm)\n");

396 
£m
 = 
	`£m_¸óã
("kmalloctest4", 0);

397 i‡(
£m
 =
NULL
) {

398 
	`∑nic
("kmalloctest4: sem_create failed\n");

402 
¡hªads
 = (3*
NTHREADS
)/4;

404 
i
=0; i<
¡hªads
; i++) {

405 
ªsu…
 = 
	`thªad_f‹k
("kmÆlo˘e°4", 
NULL
,

406 
kmÆlo˘e°4thªad
, 
£m
, 
i
);

407 i‡(
ªsu…
) {

408 
	`∑nic
("kmallocstress:Åhread_fork failed: %s\n",

409 
	`°ªº‹
(
ªsu…
));

413 
i
=0; i<
¡hªads
; i++) {

414 
	`P
(
£m
);

417 
	`£m_de°roy
(
£m
);

419 
	`k¥ötf
("\n");

420 
	`suc˚ss
(
TEST161_SUCCESS
, 
SECRET
, "km4");

422 
	}
}

424 
ölöe


426 
	$km5_ußge
()

428 
	`k¥ötf
("usage: km5 [--avail <num_pages>] [--kernel <num_pages>]\n");

429 
	}
}

437 
	$kmÆlo˘e°5
(
«rgs
, **
¨gs
)

439 
	#KM5_ITERATIONS
 5

	)

442 i‡(
«rgs
 > 5 || (nargs % 2) == 0) {

443 
	`km5_ußge
();

447 
avaû_∑ge_¶ack
 = 0, 
kî√l_∑ge_limô
 = 0;

448 
¨g
 = 1;

450 
¨g
 < 
«rgs
) {

451 i‡(
	`°rcmp
(
¨gs
[
¨g
], "--avail") == 0) {

452 
¨g
++;

453 
avaû_∑ge_¶ack
 = 
	`©oi
(
¨gs
[
¨g
++]);

454 } i‡(
	`°rcmp
(
¨gs
[
¨g
], "--kernel") == 0) {

455 
¨g
++;

456 
kî√l_∑ge_limô
 = 
	`©oi
(
¨gs
[
¨g
++]);

458 
	`km5_ußge
();

463 #i‡
OPT_DUMBVM


464 
	`k¥ötf
("(ThisÅest willÇot work with dumbvm)\n");

473 
‹ig_u£d
, 
±rs_≥r_∑ge
, 
num_±r_blocks
, 
max_∑ges
;

474 
tŸÆ_øm
, 
avaû_øm
, 
magic
, 
‹ig_magic
, 
known_∑ges
;

476 
±rs_≥r_∑ge
 = 
PAGE_SIZE
 / (*);

477 
tŸÆ_øm
 = 
	`maöbus_ømsize
();

478 
avaû_øm
 = 
tŸÆ_øm
 - (
uöt32_t
)(
fú°‰ì
 - 
MIPS_KSEG0
);

479 
max_∑ges
 = (
avaû_øm
 + 
PAGE_SIZE
-1) / PAGE_SIZE;

480 
num_±r_blocks
 = (
max_∑ges
 + 
±rs_≥r_∑ge
-1) /Ötrs_per_page;

484 **
±rs
[
num_±r_blocks
];

486 
i
 = 0; i < 
num_±r_blocks
; i++) {

487 
±rs
[
i
] = 
	`kmÆloc
(
PAGE_SIZE
);

488 i‡(
±rs
[
i
] =
NULL
) {

489 
	`∑nic
("Can'tállocateÖtrÖage!");

491 
	`bzîo
(
±rs
[
i
], 
PAGE_SIZE
);

494 
	`k¥ötf
("km5 -->Öhy†øm: %ukávaûÑam: %uk (%uÖagesË±∏blocks: %u\n", 
tŸÆ_øm
/1024,

495 
avaû_øm
/1024, 
max_∑ges
, 
num_±r_blocks
);

500 
‹ig_u£d
 = 
	`c‹em≠_u£d_byãs
();

501 
known_∑ges
 = 
num_˝us
 + 
num_±r_blocks
 + 1;

502 i‡(
‹ig_u£d
 < 
known_∑ges
 * 
PAGE_SIZE
) {

503 
	`∑nic
 ("NotÉnoughÖages initiallyállocated");

505 i‡((
‹ig_u£d
 % 
PAGE_SIZE
) != 0) {

506 
	`∑nic
("Coremap used bytes should beá multiple of PAGE_SIZE");

510 i‡(
kî√l_∑ge_limô
 > 0) {

511 
uöt32_t
 
k∑ges
 = (
tŸÆ_øm
 - 
avaû_øm
 + 
PAGE_SIZE
) / PAGE_SIZE;

512 i‡(
k∑ges
 > 
kî√l_∑ge_limô
) {

513 
	`∑nic
("You're kernel is bloated! MaxállowedÖages: %d, usedÖages: %d",

514 
kî√l_∑ge_limô
, 
k∑ges
);

518 
‹ig_magic
 = 
magic
 = 
	`øndom
();

520 
i
 = 0; i < 
KM5_ITERATIONS
; i++) {

522 
block
, 
pos
, 
oom
, 
∑ges
, 
u£d
, 
¥ev
;

523 *
∑ge
;

525 
block
 = 
pos
 = 
oom
 = 
∑ges
 = 
u£d
 = 0;

526 
¥ev
 = 
‹ig_u£d
;

528 
∑ges
 < 
max_∑ges
+1) {

529 
	`PROGRESS
(
∑ges
);

530 
∑ge
 = 
	`kmÆloc
(
PAGE_SIZE
);

531 i‡(
∑ge
 =
NULL
) {

532 
oom
 = 1;

537 *(
uöt32_t
 *)
∑ge
 = 
magic
++;

540 
u£d
 = 
	`c‹em≠_u£d_byãs
();

541 i‡(
u£d
 !
¥ev
 + 
PAGE_SIZE
) {

542 
	`∑nic
("AŒoˇti⁄ÇŸÉquÆÅÿPAGE_SIZE.Öªv: %u u£d: %u", 
¥ev
, 
u£d
);

544 
¥ev
 = 
u£d
;

546 
±rs
[
block
][
pos
] = 
∑ge
;

547 
pos
++;

548 i‡(
pos
 >
±rs_≥r_∑ge
) {

549 
pos
 = 0;

550 
block
++;

552 
∑ges
++;

556 
ex≥˘ed
;

557 i‡(
avaû_∑ge_¶ack
 > 0 ) {

559 
ex≥˘ed
 = 
max_∑ges
 - (
known_∑ges
 + 
avaû_∑ge_¶ack
);

562 
ex≥˘ed
 = 3;

565 i‡(
∑ges
 < 
ex≥˘ed
) {

566 
	`∑nic
("ExpectedÅoállocateátÜeast %dÖages, onlyállocated %d",

567 
ex≥˘ed
, 
∑ges
);

573 i‡(!
oom
) {

574 
	`∑nic
("Allocated moreÖagesÅhanÖhysical memory. Are you swapping kernelÖages?");

578 
block
 = 0; block < 
num_±r_blocks
; block++) {

579 
pos
 = 0;Öo†< 
±rs_≥r_∑ge
;Öos++) {

580 i‡(
±rs
[
block
][
pos
] !
NULL
) {

582 i‡((*(
uöt32_t
 *)
±rs
[
block
][
pos
]Ë!
‹ig_magic
++) {

583 
	`∑nic
("km5:Éxpected %u got %u - your VM is broken!",

584 
‹ig_magic
-1, (*(
uöt32_t
 *)
±rs
[
block
][
pos
]));

586 
	`k‰ì
(
±rs
[
block
][
pos
]);

592 
u£d
 = 
	`c‹em≠_u£d_byãs
();

593 i‡(
u£d
 !
‹ig_u£d
) {

594 
	`∑nic
("‹ig (%uË!u£d (%u)", 
‹ig_u£d
, 
u£d
);

599 
i
 = 0; i < 
num_±r_blocks
; i++) {

600 
	`k‰ì
(
±rs
[
i
]);

603 
	`k¥ötf
("\n");

604 
	`suc˚ss
(
TEST161_SUCCESS
, 
SECRET
, "km5");

607 
	}
}

	@/home/trinity/src/kern/test/lib.c

1 
	~<ty≥s.h
>

2 
	~<thªad.h
>

3 
	~<ã°.h
>

4 
	~<lib.h
>

12 
	$øndom_yõldî
(
uöt32_t
 
max_yõld_cou¡
)

14 
uöt32_t
 
i
;

15 
i
 = 0; i < 
	`øndom
(Ë% 
max_yõld_cou¡
; i++) {

16 
	`thªad_yõld
();

18 
	}
}

21 
	$øndom_•ö√r
(
uöt32_t
 
max_•ö_cou¡
)

23 
uöt32_t
 
i
;

24 vﬁ©ûê
•ö
;

25 
i
 = 0; i < 
	`øndom
(Ë% 
max_•ö_cou¡
; i++) {

26 
•ö
 +
i
;

28 
	}
}

	@/home/trinity/src/kern/test/nettest.c

33 
	~<ty≥s.h
>

34 
	~<lib.h
>

35 
	~<ã°.h
>

38 
	$√âe°
(
«rgs
, **
¨gs
)

40 ()
«rgs
;

41 ()
¨gs
;

42 
	`k¥ötf
("NoÇetwork supportávailable\n");

44 
	}
}

	@/home/trinity/src/kern/test/rwtest.c

6 
	~<ty≥s.h
>

7 
	~<lib.h
>

8 
	~<˛ock.h
>

9 
	~<thªad.h
>

10 
	~<synch.h
>

11 
	~<ã°.h
>

12 
	~<kîn/ã°161.h
>

13 
	~<•ölock.h
>

19 
	$rwã°
(
«rgs
, **
¨gs
) {

20 ()
«rgs
;

21 ()
¨gs
;

23 
	`k¥ötf_n
("rwt1 unimplemented\n");

24 
	`suc˚ss
(
TEST161_FAIL
, 
SECRET
, "rwt1");

27 
	}
}

29 
	$rwã°2
(
«rgs
, **
¨gs
) {

30 ()
«rgs
;

31 ()
¨gs
;

33 
	`k¥ötf_n
("rwt2 unimplemented\n");

34 
	`suc˚ss
(
TEST161_FAIL
, 
SECRET
, "rwt2");

37 
	}
}

39 
	$rwã°3
(
«rgs
, **
¨gs
) {

40 ()
«rgs
;

41 ()
¨gs
;

43 
	`k¥ötf_n
("rwt3 unimplemented\n");

44 
	`suc˚ss
(
TEST161_FAIL
, 
SECRET
, "rwt3");

47 
	}
}

49 
	$rwã°4
(
«rgs
, **
¨gs
) {

50 ()
«rgs
;

51 ()
¨gs
;

53 
	`k¥ötf_n
("rwt4 unimplemented\n");

54 
	`suc˚ss
(
TEST161_FAIL
, 
SECRET
, "rwt4");

57 
	}
}

59 
	$rwã°5
(
«rgs
, **
¨gs
) {

60 ()
«rgs
;

61 ()
¨gs
;

63 
	`k¥ötf_n
("rwt5 unimplemented\n");

64 
	`suc˚ss
(
TEST161_FAIL
, 
SECRET
, "rwt5");

67 
	}
}

	@/home/trinity/src/kern/test/semunit.c

30 
	~<ty≥s.h
>

31 
	~<lib.h
>

32 
	~<•ölock.h
>

33 
	~<synch.h
>

34 
	~<thªad.h
>

35 
	~<cuºít.h
>

36 
	~<˛ock.h
>

37 
	~<ã°.h
>

56 
	#NAMESTRING
 "some-sûly-«me"

	)

61 
	gwaôîs_ru¬ög
 = 0;

62 
•ölock
 
	gwaôîs_lock
 = 
SPINLOCK_INITIALIZER
;

66 
	$ok
()

68 
	`k¥ötf
("TestÖassed;Çow cleaning up.\n");

69 
	}
}

75 
£m≠h‹e
 *

76 
	$make£m
(
cou¡
)

78 
£m≠h‹e
 *
£m
;

80 
£m
 = 
	`£m_¸óã
(
NAMESTRING
, 
cou¡
);

81 i‡(
£m
 =
NULL
) {

82 
	`∑nic
("semunit: whoops: sem_create failed\n");

84  
£m
;

85 
	}
}

92 
	$waôî
(*
v£m
, 
junk
)

94 
£m≠h‹e
 *
£m
 = 
v£m
;

95 ()
junk
;

97 
	`P
(
£m
);

99 
	`•ölock_acquúe
(&
waôîs_lock
);

100 
	`KASSERT
(
waôîs_ru¬ög
 > 0);

101 
waôîs_ru¬ög
--;

102 
	`•ölock_ªÀa£
(&
waôîs_lock
);

103 
	}
}

110 
	$makewaôî
(
£m≠h‹e
 *
£m
)

112 
ªsu…
;

114 
	`•ölock_acquúe
(&
waôîs_lock
);

115 
waôîs_ru¬ög
++;

116 
	`•ölock_ªÀa£
(&
waôîs_lock
);

118 
ªsu…
 = 
	`thªad_f‹k
("£munô waôî", 
NULL
, 
waôî
, 
£m
, 0);

119 i‡(
ªsu…
) {

120 
	`∑nic
("semunit:Åhread_fork failed\n");

122 
	`k¥ötf
("Sleeping for waiterÅoÑun\n");

123 
	`˛ock¶ìp
(1);

124 
	}
}

137 
boﬁ


138 
	$•ölock_nŸ_hñd
(
•ölock
 *
•lk
)

140  
•lk
->
•lk_hﬁdî
 =
NULL
;

141 
	}
}

155 
	$£mu1
(
«rgs
, **
¨gs
)

157 
£m≠h‹e
 *
£m
;

158 c⁄° *
«me
 = 
NAMESTRING
;

160 ()
«rgs
; ()
¨gs
;

162 
£m
 = 
	`£m_¸óã
(
«me
, 56);

163 i‡(
£m
 =
NULL
) {

164 
	`∑nic
("semu1: whoops: sem_create failed\n");

166 
	`KASSERT
(!
	`°rcmp
(
£m
->
£m_«me
, 
«me
));

167 
	`KASSERT
(
£m
->
£m_«me
 !
«me
);

168 
	`KASSERT
(
£m
->
£m_wch™
 !
NULL
);

169 
	`KASSERT
(
	`•ölock_nŸ_hñd
(&
£m
->
£m_lock
));

170 
	`KASSERT
(
£m
->
£m_cou¡
 == 56);

172 
	`ok
();

174 
	`£m_de°roy
(
£m
);

176 
	}
}

182 
	$£mu2
(
«rgs
, **
¨gs
)

184 
£m≠h‹e
 *
£m
;

186 ()
«rgs
; ()
¨gs
;

188 
	`k¥ötf
("This should crash withá kernelÇull dereference\n");

189 
£m
 = 
	`£m_¸óã
(
NULL
, 44);

190 ()
£m
;

191 
	`∑nic
("semu2: sem_createácceptedáÇullÇame\n");

193 
	}
}

199 
	$£mu3
(
«rgs
, **
¨gs
)

201 ()
«rgs
; ()
¨gs
;

203 
	`k¥ötf
("This shouldássertÅhat sem != NULL\n");

204 
	`£m_de°roy
(
NULL
);

205 
	`∑nic
("semu3: sem_destroyácceptedáÇull semaphore\n");

206 
	}
}

213 
	$£mu4
(
«rgs
, **
¨gs
)

215 
£m≠h‹e
 *
£m
;

217 ()
«rgs
; ()
¨gs
;

220 
£m
 = 
	`make£m
(0);

222 
£m
->
£m_cou¡
--;

224 
	`KASSERT
(
£m
->
£m_cou¡
 > 0);

227 
	`ok
();

228 
	`£m_de°roy
(
£m
);

230 
	}
}

237 
	$£mu5
(
«rgs
, **
¨gs
)

239 
£m≠h‹e
 *
£m
;

241 ()
«rgs
; ()
¨gs
;

243 
£m
 = 
	`£m_¸óã
(
NAMESTRING
, 0xf0000000U);

244 i‡(
£m
 =
NULL
) {

246 
	`∑nic
("semu5: sem_create failed\n");

248 
	`KASSERT
(
£m
->
£m_cou¡
 == 0xf0000000U);

251 
	`ok
();

252 
	`£m_de°roy
(
£m
);

254 
	}
}

261 
	$£mu6
(
«rgs
, **
¨gs
)

263 
£m≠h‹e
 *
£m
;

265 ()
«rgs
; ()
¨gs
;

267 
£m
 = 
	`make£m
(0);

268 
	`makewaôî
(
£m
);

269 
	`k¥ötf
("This shouldássertÅhatÅhe wchan'sÅhreadlist isÉmpty\n");

270 
	`£m_de°roy
(
£m
);

271 
	`∑nic
("semu6: wchan_destroy with waiters succeeded\n");

273 
	}
}

280 
	$£mu7
(
«rgs
, **
¨gs
)

282 
£m≠h‹e
 *
£m
;

283 
•ölock
 
lk
;

285 ()
«rgs
; ()
¨gs
;

287 
£m
 = 
	`make£m
(0);

293 
	`•ölock_öô
(&
lk
);

294 
	`•ölock_acquúe
(&
lk
);

297 
	`V
(
£m
);

298 
	`V
(
£m
);

299 
	`V
(
£m
);

302 
	`ok
();

303 
	`•ölock_ªÀa£
(&
lk
);

304 
	`•ölock_˛ónup
(&
lk
);

305 
	`£m_de°roy
(
£m
);

307 
	}
}

320 
	$do_£mu89
(
boﬁ
 
öãºu±h™dÀr
)

322 
£m≠h‹e
 *
£m
;

323 
wch™
 *wchan;

324 c⁄° *
«me
;

326 
£m
 = 
	`make£m
(0);

329 
«me
 = 
£m
->
£m_«me
;

330 
wch™
 = 
£m
->
£m_wch™
;

331 
	`KASSERT
(!
	`°rcmp
(
«me
, 
NAMESTRING
));

332 
	`KASSERT
(
	`•ölock_nŸ_hñd
(&
£m
->
£m_lock
));

342 i‡(
öãºu±h™dÀr
) {

343 
	`KASSERT
(
cuπhªad
->
t_ö_öãºu±
 =
Ál£
);

344 
cuπhªad
->
t_ö_öãºu±
 = 
åue
;

347 
	`V
(
£m
);

349 i‡(
öãºu±h™dÀr
) {

350 
	`KASSERT
(
cuπhªad
->
t_ö_öãºu±
 =
åue
);

351 
cuπhªad
->
t_ö_öãºu±
 = 
Ál£
;

355 
	`KASSERT
(
«me
 =
£m
->
£m_«me
);

356 
	`KASSERT
(!
	`°rcmp
(
«me
, 
NAMESTRING
));

357 
	`KASSERT
(
wch™
 =
£m
->
£m_wch™
);

358 
	`KASSERT
(
	`•ölock_nŸ_hñd
(&
£m
->
£m_lock
));

359 
	`KASSERT
(
£m
->
£m_cou¡
 == 1);

362 
	`ok
();

363 
	`£m_de°roy
(
£m
);

364 
	}
}

367 
	$£mu8
(
«rgs
, **
¨gs
)

369 ()
«rgs
; ()
¨gs
;

371 
	`do_£mu89
(
Ál£
 );

373 
	}
}

376 
	$£mu9
(
«rgs
, **
¨gs
)

378 ()
«rgs
; ()
¨gs
;

380 
	`do_£mu89
(
åue
 );

382 
	}
}

397 
	$do_£mu1011
(
boﬁ
 
öãºu±h™dÀr
)

399 
£m≠h‹e
 *
£m
;

400 
wch™
 *wchan;

401 c⁄° *
«me
;

403 
£m
 = 
	`make£m
(0);

404 
	`makewaôî
(
£m
);

407 
«me
 = 
£m
->
£m_«me
;

408 
wch™
 = 
£m
->
£m_wch™
;

409 
	`KASSERT
(!
	`°rcmp
(
«me
, 
NAMESTRING
));

410 
	`KASSERT
(
	`•ölock_nŸ_hñd
(&
£m
->
£m_lock
));

411 
	`•ölock_acquúe
(&
waôîs_lock
);

412 
	`KASSERT
(
waôîs_ru¬ög
 == 1);

413 
	`•ölock_ªÀa£
(&
waôîs_lock
);

416 i‡(
öãºu±h™dÀr
) {

417 
	`KASSERT
(
cuπhªad
->
t_ö_öãºu±
 =
Ál£
);

418 
cuπhªad
->
t_ö_öãºu±
 = 
åue
;

421 
	`V
(
£m
);

423 i‡(
öãºu±h™dÀr
) {

424 
	`KASSERT
(
cuπhªad
->
t_ö_öãºu±
 =
åue
);

425 
cuπhªad
->
t_ö_öãºu±
 = 
Ál£
;

429 
	`˛ock¶ìp
(1);

432 
	`KASSERT
(
«me
 =
£m
->
£m_«me
);

433 
	`KASSERT
(!
	`°rcmp
(
«me
, 
NAMESTRING
));

434 
	`KASSERT
(
wch™
 =
£m
->
£m_wch™
);

435 
	`KASSERT
(
	`•ölock_nŸ_hñd
(&
£m
->
£m_lock
));

436 
	`KASSERT
(
£m
->
£m_cou¡
 == 0);

437 
	`•ölock_acquúe
(&
waôîs_lock
);

438 
	`KASSERT
(
waôîs_ru¬ög
 == 0);

439 
	`•ölock_ªÀa£
(&
waôîs_lock
);

442 
	`ok
();

443 
	`£m_de°roy
(
£m
);

446 
	}
}

449 
	$£mu10
(
«rgs
, **
¨gs
)

451 ()
«rgs
; ()
¨gs
;

453 
	`do_£mu1011
(
Ál£
 );

455 
	}
}

458 
	$£mu11
(
«rgs
, **
¨gs
)

460 ()
«rgs
; ()
¨gs
;

462 
	`do_£mu1011
(
åue
 );

464 
	}
}

479 
	$£mu1213
(
boﬁ
 
öãºu±h™dÀr
)

481 
£m≠h‹e
 *
£m
;

482 
wch™
 *wchan;

483 c⁄° *
«me
;

485 
£m
 = 
	`make£m
(0);

486 
	`makewaôî
(
£m
);

487 
	`makewaôî
(
£m
);

490 
«me
 = 
£m
->
£m_«me
;

491 
wch™
 = 
£m
->
£m_wch™
;

492 
	`KASSERT
(!
	`°rcmp
(
«me
, 
NAMESTRING
));

493 
wch™
 = 
£m
->
£m_wch™
;

494 
	`KASSERT
(
	`•ölock_nŸ_hñd
(&
£m
->
£m_lock
));

495 
	`•ölock_acquúe
(&
waôîs_lock
);

496 
	`KASSERT
(
waôîs_ru¬ög
 == 2);

497 
	`•ölock_ªÀa£
(&
waôîs_lock
);

500 i‡(
öãºu±h™dÀr
) {

501 
	`KASSERT
(
cuπhªad
->
t_ö_öãºu±
 =
Ál£
);

502 
cuπhªad
->
t_ö_öãºu±
 = 
åue
;

505 
	`V
(
£m
);

507 i‡(
öãºu±h™dÀr
) {

508 
	`KASSERT
(
cuπhªad
->
t_ö_öãºu±
 =
åue
);

509 
cuπhªad
->
t_ö_öãºu±
 = 
Ál£
;

513 
	`˛ock¶ìp
(1);

516 
	`KASSERT
(
«me
 =
£m
->
£m_«me
);

517 
	`KASSERT
(!
	`°rcmp
(
«me
, 
NAMESTRING
));

518 
	`KASSERT
(
wch™
 =
£m
->
£m_wch™
);

519 
	`KASSERT
(
	`•ölock_nŸ_hñd
(&
£m
->
£m_lock
));

520 
	`KASSERT
(
£m
->
£m_cou¡
 == 0);

521 
	`•ölock_acquúe
(&
waôîs_lock
);

522 
	`KASSERT
(
waôîs_ru¬ög
 == 1);

523 
	`•ölock_ªÀa£
(&
waôîs_lock
);

526 
	`ok
();

527 
	`V
(
£m
);

528 
	`˛ock¶ìp
(1);

529 
	`•ölock_acquúe
(&
waôîs_lock
);

530 
	`KASSERT
(
waôîs_ru¬ög
 == 0);

531 
	`•ölock_ªÀa£
(&
waôîs_lock
);

532 
	`£m_de°roy
(
£m
);

533 
	}
}

536 
	$£mu12
(
«rgs
, **
¨gs
)

538 ()
«rgs
; ()
¨gs
;

540 
	`£mu1213
(
Ál£
 );

542 
	}
}

545 
	$£mu13
(
«rgs
, **
¨gs
)

547 ()
«rgs
; ()
¨gs
;

549 
	`£mu1213
(
åue
 );

551 
	}
}

558 
	$£mu14
(
«rgs
, **
¨gs
)

560 
£m≠h‹e
 *
£m
;

562 ()
«rgs
; ()
¨gs
;

564 
	`k¥ötf
("This shouldássertÅhat sem_count is > 0.\n");

565 
£m
 = 
	`make£m
(0);

571 
£m
->
£m_cou¡
--;

572 
	`V
(
£m
);

573 
	`KASSERT
(
£m
->
£m_cou¡
 == 0);

574 
	`∑nic
("semu14: VÅolerated count wraparound\n");

576 
	}
}

582 
	$£mu15
(
«rgs
, **
¨gs
)

584 ()
«rgs
; ()
¨gs
;

586 
	`k¥ötf
("This shouldássertÅhatÅhe semaphore isn'tÇull.\n");

587 
	`V
(
NULL
);

588 
	`∑nic
("semu15: VÅoleratedÇull semaphore\n");

590 
	}
}

596 
	$£mu16
(
«rgs
, **
¨gs
)

598 
£m≠h‹e
 *
£m
;

599 
•ölock
 
lk
;

601 ()
«rgs
; ()
¨gs
;

603 
£m
 = 
	`make£m
(1);

606 
	`•ölock_öô
(&
lk
);

607 
	`•ölock_acquúe
(&
lk
);

609 
	`P
(
£m
);

611 
	`ok
();

612 
	`•ölock_ªÀa£
(&
lk
);

613 
	`•ölock_˛ónup
(&
lk
);

614 
	`£m_de°roy
(
£m
);

616 
	}
}

622 
thªad
 *
	g£mu17_thªad
;

626 
	$£mu17_sub
(*
£mv
, 
junk
)

628 
£m≠h‹e
 *
£m
 = 
£mv
;

630 ()
junk
;

632 
£mu17_thªad
 = 
cuπhªad
;

635 
	`KASSERT
(
£m
->
£m_cou¡
 == 0);

637 
	`P
(
£m
);

638 
	}
}

641 
	$£mu17
(
«rgs
, **
¨gs
)

643 
£m≠h‹e
 *
£m
;

644 
ªsu…
;

646 ()
«rgs
; ()
¨gs
;

648 
£mu17_thªad
 = 
NULL
;

650 
£m
 = 
	`make£m
(0);

651 
ªsu…
 = 
	`thªad_f‹k
("£mu17_sub", 
NULL
, 
£mu17_sub
, 
£m
, 0);

652 i‡(
ªsu…
) {

653 
	`∑nic
("semu17: whoops:Åhread_fork failed\n");

655 
	`k¥ötf
("Waiting for subthread...\n");

656 
	`˛ock¶ìp
(1);

659 
	`KASSERT
(
£mu17_thªad
 !
NULL
);

660 
	`KASSERT
(
£mu17_thªad
->
t_°©e
 =
S_SLEEP
);

663 
	`ok
();

664 
	`V
(
£m
);

665 
	`˛ock¶ìp
(1);

666 
	`£m_de°roy
(
£m
);

667 
£mu17_thªad
 = 
NULL
;

669 
	}
}

679 
	$£mu18
(
«rgs
, **
¨gs
)

681 
£m≠h‹e
 *
£m
;

682 
wch™
 *wchan;

683 c⁄° *
«me
;

685 ()
«rgs
; ()
¨gs
;

687 
£m
 = 
	`make£m
(1);

690 
«me
 = 
£m
->
£m_«me
;

691 
	`KASSERT
(!
	`°rcmp
(
«me
, 
NAMESTRING
));

692 
wch™
 = 
£m
->
£m_wch™
;

693 
	`KASSERT
(
	`•ölock_nŸ_hñd
(&
£m
->
£m_lock
));

694 
	`KASSERT
(
£m
->
£m_cou¡
 == 1);

696 
	`P
(
£m
);

699 
	`KASSERT
(
«me
 =
£m
->
£m_«me
);

700 
	`KASSERT
(!
	`°rcmp
(
«me
, 
NAMESTRING
));

701 
	`KASSERT
(
wch™
 =
£m
->
£m_wch™
);

702 
	`KASSERT
(
	`•ölock_nŸ_hñd
(&
£m
->
£m_lock
));

703 
	`KASSERT
(
£m
->
£m_cou¡
 == 0);

706 
	}
}

719 
	$£mu19_sub
(*
£mv
, 
junk
)

721 
£m≠h‹e
 *
£m
 = 
£mv
;

723 ()
junk
;

725 
	`k¥ötf
("semu19: waiting forÖarentÅo sleep\n");

726 
	`˛ock¶ìp
(1);

732 
	`V
(
£m
);

733 
	}
}

736 
	$£mu19
(
«rgs
, **
¨gs
)

738 
£m≠h‹e
 *
£m
;

739 
wch™
 *wchan;

740 c⁄° *
«me
;

741 
ªsu…
;

743 ()
«rgs
; ()
¨gs
;

745 
£m
 = 
	`make£m
(0);

746 
ªsu…
 = 
	`thªad_f‹k
("£mu19_sub", 
NULL
, 
£mu19_sub
, 
£m
, 0);

747 i‡(
ªsu…
) {

748 
	`∑nic
("semu19: whoops:Åhread_fork failed\n");

752 
«me
 = 
£m
->
£m_«me
;

753 
	`KASSERT
(!
	`°rcmp
(
«me
, 
NAMESTRING
));

754 
wch™
 = 
£m
->
£m_wch™
;

755 
	`KASSERT
(
	`•ölock_nŸ_hñd
(&
£m
->
£m_lock
));

756 
	`KASSERT
(
£m
->
£m_cou¡
 == 0);

758 
	`P
(
£m
);

761 
	`KASSERT
(
«me
 =
£m
->
£m_«me
);

762 
	`KASSERT
(!
	`°rcmp
(
«me
, 
NAMESTRING
));

763 
	`KASSERT
(
wch™
 =
£m
->
£m_wch™
);

764 
	`KASSERT
(
	`•ölock_nŸ_hñd
(&
£m
->
£m_lock
));

765 
	`KASSERT
(
£m
->
£m_cou¡
 == 0);

768 
	}
}

775 
	$£mu20
(
«rgs
, **
¨gs
)

777 
£m≠h‹e
 *
£m
;

779 ()
«rgs
; ()
¨gs
;

781 
	`k¥ötf
("This shouldássertÅhat weáren't inán interrupt\n");

783 
£m
 = 
	`make£m
(0);

785 
cuπhªad
->
t_ö_öãºu±
 = 
åue
;

786 
	`P
(
£m
);

787 
	`∑nic
("semu20: PÅolerated being inán interrupt handler\n");

789 
	}
}

792 
	$£mu21
(
«rgs
, **
¨gs
)

794 
£m≠h‹e
 *
£m
;

796 ()
«rgs
; ()
¨gs
;

798 
	`k¥ötf
("This shouldássertÅhat weáren't inán interrupt\n");

800 
£m
 = 
	`make£m
(1);

802 
cuπhªad
->
t_ö_öãºu±
 = 
åue
;

803 
	`P
(
£m
);

804 
	`∑nic
("semu21: PÅolerated being inán interrupt handler\n");

806 
	}
}

812 
	$£mu22
(
«rgs
, **
¨gs
)

814 ()
«rgs
; ()
¨gs
;

816 
	`k¥ötf
("This shouldássertÅhatÅhe semaphore isn'tÇull.\n");

817 
	`P
(
NULL
);

818 
	`∑nic
("semu22: PÅoleratedÇull semaphore\n");

820 
	}
}

	@/home/trinity/src/kern/test/synchprobs.c

6 
	~<ty≥s.h
>

7 
	~<lib.h
>

8 
	~<thªad.h
>

9 
	~<ã°.h
>

10 
	~<cuºít.h
>

11 
	~<synch.h
>

12 
	~<kîn/ã°161.h
>

13 
	~<•ölock.h
>

15 
	#PROBLEMS_MAX_YIELDER
 16

	)

16 
	#PROBLEMS_MAX_SPINNER
 8192

	)

18 
	#TEST161_SUCCESS
 0

	)

19 
	#TEST161_FAIL
 1

	)

25 
uöt32_t
 
	g°¨tcou¡
;

26 
lock
 *
	gã°lock
;

27 
cv
 *
	g°¨tcv
;

28 
£m≠h‹e
 *
	g°¨t£m
;

29 
£m≠h‹e
 *
	gíd£m
;

31 
•ölock
 
	g°©us_lock
;

32 
boﬁ
 
	gã°_°©us
 = 
TEST161_FAIL
;

33 c⁄° *
	gã°_mesßge
;

36 
boﬁ


37 
	$Áûif
(
boﬁ
 
c⁄dôi⁄
, c⁄° *
mesßge
) {

38 i‡(
c⁄dôi⁄
) {

39 
	`•ölock_acquúe
(&
°©us_lock
);

40 
ã°_°©us
 = 
TEST161_FAIL
;

41 
ã°_mesßge
 = 
mesßge
;

42 
	`•ölock_ªÀa£
(&
°©us_lock
);

44  
c⁄dôi⁄
;

45 
	}
}

52 
	$öôülize_thªad
(vﬁ©ûê* 
thªads
[], 
uöt32_t
 
ödex
) {

53 
	`Áûif
((
thªads
[
ödex
] !
NULL
), "failed: incorrectÅhreadÅype");

54 
thªads
[
ödex
] = 
cuπhªad
->
t_°ack
;

55 
	}
}

62 
	$check_thªad
(vﬁ©ûê* 
thªads
[], 
uöt32_t
 
ödex
) {

63 
	`Áûif
((
thªads
[
ödex
] !
cuπhªad
->
t_°ack
), "failed: incorrectÅhreadÅype");

64 
	}
}

70 
	#NMATING
 10

	)

71 
	#MALE
 0

	)

72 
	#FEMALE
 1

	)

73 
	#MATCHMAKER
 2

	)

74 
	#CHECK_TIMES
 32

	)

76 vﬁ©ûê
	gmÆe_°¨t_cou¡
;

77 vﬁ©ûê
	gmÆe_íd_cou¡
;

78 vﬁ©ûê
	g„mÆe_°¨t_cou¡
;

79 vﬁ©ûê
	g„mÆe_íd_cou¡
;

80 vﬁ©ûê
	gm©chmakî_°¨t_cou¡
;

81 vﬁ©ûê
	gm©chmakî_íd_cou¡
;

82 vﬁ©ûê
	gm©ch_cou¡
;

83 vﬁ©ûê
	gc⁄cuºít_m©chmakîs
;

84 vﬁ©ûê
	gmax_c⁄cuºít_m©chmakîs
;

86 vﬁ©ûê* 
	gwhÆe_thªads
[3 * 
NMATING
];

87 vﬁ©ûê
	gwhÆe_rﬁes
[3 * 
NMATING
];

88 
£m≠h‹e
 *
	gm©chî_£m
;

96 
	$check_rﬁe
(
uöt32_t
 
ödex
, 
rﬁe
) {

97 
	`Áûif
((
whÆe_rﬁes
[
ödex
] !
rﬁe
), "failed: incorrectÑole");

98 
	}
}

102 
	$mÆe_wøµî
(* 
unu£d1
, 
ödex
) {

103 ()
unu£d1
;

105 
	`øndom_yõldî
(4);

106 
	`lock_acquúe
(
ã°lock
);

107 
	`öôülize_thªad
(
whÆe_thªads
, (
uöt32_t
)
ödex
);

108 
whÆe_rﬁes
[
ödex
] = 
MALE
;

109 
	`lock_ªÀa£
(
ã°lock
);

110 
	`mÆe
((
uöt32_t
)
ödex
);

113 
	}
}

115 
	$mÆe_°¨t
(
uöt32_t
 
ödex
) {

116 ()
ödex
;

117 
	`lock_acquúe
(
ã°lock
);

118 
	`check_thªad
(
whÆe_thªads
, 
ödex
);

119 
	`check_rﬁe
(
ödex
, 
MALE
);

120 
mÆe_°¨t_cou¡
++;

121 
	`k¥ötf_n
("%†°¨tög\n", 
cuπhªad
->
t_«me
);

122 
	`k¥ötf_t
(".");

123 
	`lock_ªÀa£
(
ã°lock
);

124 
	`øndom_yõldî
(
PROBLEMS_MAX_YIELDER
);

125 
	`øndom_•ö√r
(
PROBLEMS_MAX_SPINNER
);

126 
	`V
(
°¨t£m
);

127 
	}
}

129 
	$mÆe_íd
(
uöt32_t
 
ödex
) {

130 ()
ödex
;

131 
	`lock_acquúe
(
ã°lock
);

132 
	`check_thªad
(
whÆe_thªads
, 
ödex
);

133 
	`check_rﬁe
(
ödex
, 
MALE
);

134 
mÆe_íd_cou¡
++;

135 
	`k¥ötf_n
("%†ídög\n", 
cuπhªad
->
t_«me
);

136 
	`k¥ötf_t
(".");

137 
	`lock_ªÀa£
(
ã°lock
);

138 
	`øndom_yõldî
(
PROBLEMS_MAX_YIELDER
);

139 
	`øndom_•ö√r
(
PROBLEMS_MAX_SPINNER
);

140 
	`V
(
íd£m
);

141 
	}
}

145 
	$„mÆe_wøµî
(* 
unu£d1
, 
ödex
) {

146 ()
unu£d1
;

148 
	`øndom_yõldî
(4);

149 
	`lock_acquúe
(
ã°lock
);

150 
	`öôülize_thªad
(
whÆe_thªads
, (
uöt32_t
)
ödex
);

151 
whÆe_rﬁes
[
ödex
] = 
FEMALE
;

152 
	`lock_ªÀa£
(
ã°lock
);

153 
	`„mÆe
((
uöt32_t
)
ödex
);

156 
	}
}

158 
	$„mÆe_°¨t
(
uöt32_t
 
ödex
) {

159 (Ë
ödex
;

160 
	`lock_acquúe
(
ã°lock
);

161 
	`check_thªad
(
whÆe_thªads
, 
ödex
);

162 
	`check_rﬁe
(
ödex
, 
FEMALE
);

163 
„mÆe_°¨t_cou¡
++;

164 
	`k¥ötf_n
("%†°¨tög\n", 
cuπhªad
->
t_«me
);

165 
	`k¥ötf_t
(".");

166 
	`lock_ªÀa£
(
ã°lock
);

167 
	`øndom_yõldî
(
PROBLEMS_MAX_YIELDER
);

168 
	`øndom_•ö√r
(
PROBLEMS_MAX_SPINNER
);

169 
	`V
(
°¨t£m
);

170 
	}
}

172 
	$„mÆe_íd
(
uöt32_t
 
ödex
) {

173 (Ë
ödex
;

174 
	`lock_acquúe
(
ã°lock
);

175 
	`check_thªad
(
whÆe_thªads
, 
ödex
);

176 
	`check_rﬁe
(
ödex
, 
FEMALE
);

177 
„mÆe_íd_cou¡
++;

178 
	`k¥ötf_n
("%†ídög\n", 
cuπhªad
->
t_«me
);

179 
	`k¥ötf_t
(".");

180 
	`lock_ªÀa£
(
ã°lock
);

181 
	`øndom_yõldî
(
PROBLEMS_MAX_YIELDER
);

182 
	`øndom_•ö√r
(
PROBLEMS_MAX_SPINNER
);

183 
	`V
(
íd£m
);

184 
	}
}

188 
	$m©chmakî_wøµî
(* 
unu£d1
, 
ödex
) {

189 ()
unu£d1
;

191 
	`øndom_yõldî
(4);

192 
	`lock_acquúe
(
ã°lock
);

193 
	`öôülize_thªad
(
whÆe_thªads
, (
uöt32_t
)
ödex
);

194 
whÆe_rﬁes
[
ödex
] = 
MATCHMAKER
;

195 
	`lock_ªÀa£
(
ã°lock
);

196 
	`m©chmakî
((
uöt32_t
)
ödex
);

199 
	}
}

201 
	$m©chmakî_°¨t
(
uöt32_t
 
ödex
) {

202 ()
ödex
;

203 
	`P
(
m©chî_£m
);

204 
	`lock_acquúe
(
ã°lock
);

205 
	`check_thªad
(
whÆe_thªads
, 
ödex
);

206 
	`check_rﬁe
(
ödex
, 
MATCHMAKER
);

207 
m©chmakî_°¨t_cou¡
++;

208 
c⁄cuºít_m©chmakîs
++;

209 i‡(
c⁄cuºít_m©chmakîs
 > 
max_c⁄cuºít_m©chmakîs
) {

210 
max_c⁄cuºít_m©chmakîs
 = 
c⁄cuºít_m©chmakîs
;

212 
	`k¥ötf_n
("%†°¨tög\n", 
cuπhªad
->
t_«me
);

213 
	`k¥ötf_t
(".");

214 
	`lock_ªÀa£
(
ã°lock
);

215 
	`øndom_yõldî
(
PROBLEMS_MAX_YIELDER
);

216 
	`øndom_•ö√r
(
PROBLEMS_MAX_SPINNER
);

217 
	`V
(
°¨t£m
);

218 
	}
}

220 
	$m©chmakî_íd
(
uöt32_t
 
ödex
) {

221 ()
ödex
;

222 
	`lock_acquúe
(
ã°lock
);

223 
	`check_thªad
(
whÆe_thªads
, 
ödex
);

224 
	`check_rﬁe
(
ödex
, 
MATCHMAKER
);

225 
m©ch_cou¡
++;

226 
m©chmakî_íd_cou¡
++;

227 
c⁄cuºít_m©chmakîs
--;

228 
	`k¥ötf_n
("%†ídög\n", 
cuπhªad
->
t_«me
);

229 
	`k¥ötf_t
(".");

230 
	`lock_ªÀa£
(
ã°lock
);

231 
	`øndom_yõldî
(
PROBLEMS_MAX_YIELDER
);

232 
	`øndom_•ö√r
(
PROBLEMS_MAX_SPINNER
);

233 
	`V
(
íd£m
);

234 
	}
}

237 
	$whÆem©ög
(
«rgs
, **
¨gs
) {

238 (Ë
«rgs
;

239 (Ë
¨gs
;

241 
i
, 
j
, 
îr
 = 0;

242 
«me
[32];

243 
boﬁ
 
lo›_°©us
;

244 
tŸÆ_cou¡
 = 0;

246 
mÆe_°¨t_cou¡
 = 0 ;

247 
mÆe_íd_cou¡
 = 0 ;

248 
„mÆe_°¨t_cou¡
 = 0 ;

249 
„mÆe_íd_cou¡
 = 0 ;

250 
m©chmakî_°¨t_cou¡
 = 0;

251 
m©chmakî_íd_cou¡
 = 0;

252 
m©ch_cou¡
 = 0;

253 
c⁄cuºít_m©chmakîs
 = 0;

254 
max_c⁄cuºít_m©chmakîs
 = 0;

256 
	`k¥ötf_n
("Starting sp1...\n");

257 
	`k¥ötf_n
("IfÅhisÅests hangs, your solution is incorrect.\n");

259 
ã°lock
 = 
	`lock_¸óã
("testlock");

260 i‡(
ã°lock
 =
NULL
) {

261 
	`∑nic
("sp1:Üock_create failed\n");

263 
°¨t£m
 = 
	`£m_¸óã
("startsem", 0);

264 i‡(
°¨t£m
 =
NULL
) {

265 
	`∑nic
("sp1: sem_create failed\n");

267 
íd£m
 = 
	`£m_¸óã
("endsem", 0);

268 i‡(
íd£m
 =
NULL
) {

269 
	`∑nic
("sp1: sem_create failed\n");

271 
m©chî_£m
 = 
	`£m_¸óã
("matcher_sem", 0);

272 i‡(
m©chî_£m
 =
NULL
) {

273 
	`∑nic
("sp1: sem_create failed\n");

275 
	`•ölock_öô
(&
°©us_lock
);

276 
ã°_°©us
 = 
TEST161_SUCCESS
;

277 
ã°_mesßge
 = "";

279 
	`whÆem©ög_öô
();

282 
i
 = 0; i < 2; i++) {

283 
j
 = 0; j < 
NMATING
; j++) {

284 
	`k¥ötf_t
(".");

285 
ödex
 = (
i
 * 
NMATING
Ë+ 
j
;

286 
whÆe_thªads
[
ödex
] = 
NULL
;

287 
i
) {

289 
	`¢¥ötf
(
«me
, “ame), "MÆêWhÆêThªad %d", 
ödex
);

290 
îr
 = 
	`thªad_f‹k
(
«me
, 
NULL
, 
mÆe_wøµî
, NULL, 
ödex
);

293 
	`¢¥ötf
(
«me
, “ame), "FemÆêWhÆêThªad %d", 
ödex
);

294 
îr
 = 
	`thªad_f‹k
(
«me
, 
NULL
, 
„mÆe_wøµî
, NULL, 
ödex
);

297 
tŸÆ_cou¡
 += 1;

298 i‡(
îr
) {

299 
	`∑nic
("•1:Åhªad_f‹k faûed: (%s)\n", 
	`°ªº‹
(
îr
));

305 
i
 = 0; i < 
NMATING
 * 2; i++) {

306 
	`k¥ötf_t
(".");

307 
	`P
(
°¨t£m
);

311 
lo›_°©us
 = 
TEST161_SUCCESS
;

312 
i
 = 0; i < 
CHECK_TIMES
 && 
lo›_°©us
 =
TEST161_SUCCESS
; i++) {

313 
	`k¥ötf_t
(".");

314 
	`øndom_•ö√r
(
PROBLEMS_MAX_SPINNER
);

315 
	`lock_acquúe
(
ã°lock
);

316 i‡((
mÆe_°¨t_cou¡
 !
NMATING
Ë|| (
„mÆe_°¨t_cou¡
 != NMATING) ||

317 (
m©chmakî_°¨t_cou¡
 + 
mÆe_íd_cou¡
 + 
„mÆe_íd_cou¡
 + 
m©chmakî_íd_cou¡
 != 0)) {

318 
lo›_°©us
 = 
TEST161_FAIL
;

320 
	`lock_ªÀa£
(
ã°lock
);

322 i‡(
	`Áûif
((
lo›_°©us
 =
TEST161_FAIL
), "failed: uncoordinated matchmaking is occurring")) {

323 
d⁄e
;

327 
j
 = 0; j < 
NMATING
; j++) {

328 
	`k¥ötf_t
(".");

329 
ödex
 = (2 * 
NMATING
Ë+ 
j
;

330 
whÆe_thªads
[
ödex
] = 
NULL
;

331 
	`¢¥ötf
(
«me
, “ame), "M©chmakî WhÆêThªad %d", 
ödex
);

332 
îr
 = 
	`thªad_f‹k
(
«me
, 
NULL
, 
m©chmakî_wøµî
, NULL, 
ödex
);

333 i‡(
îr
) {

334 
	`∑nic
("•1:Åhªad_f‹k faûed: (%s)\n", 
	`°ªº‹
(
îr
));

336 
tŸÆ_cou¡
++;

343 
pivŸ
 = (
	`øndom
(Ë% (
NMATING
 - 2)) + 1;

344 
i
 = 0; i < 
pivŸ
; i++) {

345 
	`k¥ötf_t
(".");

346 
	`V
(
m©chî_£m
);

348 
i
 = 0; i < 3 * 
pivŸ
; i++) {

349 
	`k¥ötf_t
(".");

350 
	`P
(
íd£m
);

351 
tŸÆ_cou¡
--;

355 
lo›_°©us
 = 
TEST161_SUCCESS
;

356 
i
 = 0; i < 
CHECK_TIMES
 && 
lo›_°©us
 =
TEST161_SUCCESS
; i++) {

357 
	`k¥ötf_t
(".");

358 
	`øndom_•ö√r
(
PROBLEMS_MAX_SPINNER
);

359 
	`lock_acquúe
(
ã°lock
);

360 i‡((
mÆe_°¨t_cou¡
 !
NMATING
Ë|| (
„mÆe_°¨t_cou¡
 != NMATING) ||

361 (
m©chmakî_°¨t_cou¡
 !
pivŸ
Ë|| (
mÆe_íd_cou¡
 !=Öivot) ||

362 (
„mÆe_íd_cou¡
 !
pivŸ
Ë|| (
m©chmakî_íd_cou¡
 !=Öivot)) {

363 
lo›_°©us
 = 
TEST161_FAIL
;

365 
	`lock_ªÀa£
(
ã°lock
);

367 i‡(
	`Áûif
((
lo›_°©us
 =
TEST161_FAIL
), "failed: uncoordinated matchmaking is occurring")) {

368 
d⁄e
;

375 
i
 = 
pivŸ
; i < 
NMATING
; i++) {

376 
	`k¥ötf_t
(".");

377 
	`V
(
m©chî_£m
);

379 
i
 = 0; i < 3; i++) {

380 
j
 = 
pivŸ
; j < 
NMATING
; j++) {

381 
	`k¥ötf_t
(".");

382 
	`P
(
íd£m
);

383 
tŸÆ_cou¡
--;

387 
	`Áûif
((
max_c⁄cuºít_m©chmakîs
 == 1), "failed:Ço matchmaker concurrency");

389 
	`whÆem©ög_˛ónup
();

391 
d⁄e
:

392 
i
 = 0; i < 
tŸÆ_cou¡
; i++) {

393 
	`P
(
íd£m
);

396 
	`lock_de°roy
(
ã°lock
);

397 
	`£m_de°roy
(
°¨t£m
);

398 
	`£m_de°roy
(
íd£m
);

399 
	`£m_de°roy
(
m©chî_£m
);

401 
	`k¥ötf_t
("\n");

402 i‡(
ã°_°©us
 !
TEST161_SUCCESS
) {

403 
	`£˝rötf
(
SECRET
, 
ã°_mesßge
, "sp1");

405 
	`suc˚ss
(
ã°_°©us
, 
SECRET
, "sp1");

408 
	}
}

414 
	#NCARS
 64

	)

415 
	#NUM_QUADRANTS
 4

	)

416 
	#UNKNOWN_CAR
 -1

	)

417 
	#PASSED_CAR
 -2

	)

419 
	#GO_STRAIGHT
 0

	)

420 
	#TURN_LEFT
 1

	)

421 
	#TURN_RIGHT
 2

	)

423 vﬁ©ûê
	gquadø¡_¨øy
[
NUM_QUADRANTS
];

424 vﬁ©ûê
	gmax_ˇr_cou¡
;

425 vﬁ©ûê
	gÆl_quadø¡
;

426 vﬁ©ûê
	gˇr_loˇti⁄s
[
NCARS
];

427 vﬁ©ûê
	gˇr_dúe˘i⁄s
[
NCARS
];

428 vﬁ©ûê
	gˇr_tu∫s
[
NCARS
];

429 vﬁ©ûê
	gˇr_tu∫_times
[
NCARS
];

430 vﬁ©ûê* 
	gˇr_thªads
[
NCARS
];

434 
	$öôülize_ˇr_thªad
(
uöt32_t
 
ödex
, uöt32_à
dúe˘i⁄
, uöt32_à
tu∫
) {

435 
	`öôülize_thªad
(
ˇr_thªads
, 
ödex
);

436 
ˇr_dúe˘i⁄s
[
ödex
] = 
dúe˘i⁄
;

437 
ˇr_tu∫s
[
ödex
] = 
tu∫
;

438 
ˇr_tu∫_times
[
ödex
] = 0;

439 
	}
}

443 
	$check_öãr£˘i⁄
() {

444 
n
 = 0;

445 
i
 = 0; i < 
NUM_QUADRANTS
; i++) {

446 
	`Áûif
((
quadø¡_¨øy
[
i
] > 1), "failed: collision");

447 
n
 +
quadø¡_¨øy
[
i
];

449 
max_ˇr_cou¡
 = 
n
 > max_car_count ?Ç : max_car_count;

450 
	}
}

460 
	$move
(
uöt32_t
 
ödex
) {

461 
	`check_thªad
(
ˇr_thªads
, 
ödex
);

462 
	`check_öãr£˘i⁄
();

463 
¥e_loˇti⁄
 = 
ˇr_loˇti⁄s
[
ödex
];

464 i‡(
¥e_loˇti⁄
 !
UNKNOWN_CAR
 &&Öª_loˇti⁄ !
PASSED_CAR
) {

465 
quadø¡_¨øy
[
¥e_loˇti⁄
]--;

467  
¥e_loˇti⁄
;

468 
	}
}

472 
	$tu∫right_wøµî
(*
ödex
, 
dúe˘i⁄
)

474 
	`øndom_yõldî
(4);

475 
	`lock_acquúe
(
ã°lock
);

476 
	`öôülize_ˇr_thªad
((
uöt32_t
)
ödex
, (uöt32_t)
dúe˘i⁄
, 
TURN_RIGHT
);

477 
°¨tcou¡
--;

478 i‡(
°¨tcou¡
 == 0) {

479 
	`cv_brﬂdˇ°
(
°¨tcv
, 
ã°lock
);

481 
	`cv_waô
(
°¨tcv
, 
ã°lock
);

483 
	`lock_ªÀa£
(
ã°lock
);

484 
	`tu∫right
((
uöt32_t
)
dúe˘i⁄
, (uöt32_t)
ödex
);

485 
	`V
(
íd£m
);

488 
	}
}

491 
	$go°øight_wøµî
(*
ödex
, 
dúe˘i⁄
)

493 
	`øndom_yõldî
(4);

494 
	`lock_acquúe
(
ã°lock
);

495 
	`öôülize_ˇr_thªad
((
uöt32_t
)
ödex
, (uöt32_t)
dúe˘i⁄
, 
GO_STRAIGHT
);

496 
°¨tcou¡
--;

497 i‡(
°¨tcou¡
 == 0) {

498 
	`cv_brﬂdˇ°
(
°¨tcv
, 
ã°lock
);

500 
	`cv_waô
(
°¨tcv
, 
ã°lock
);

502 
	`lock_ªÀa£
(
ã°lock
);

503 
	`go°øight
((
uöt32_t
)
dúe˘i⁄
, (uöt32_t)
ödex
);

504 
	`V
(
íd£m
);

507 
	}
}

510 
	$tu∫À·_wøµî
(*
ödex
, 
dúe˘i⁄
)

512 
	`øndom_yõldî
(4);

513 
	`lock_acquúe
(
ã°lock
);

514 
	`öôülize_ˇr_thªad
((
uöt32_t
)
ödex
, (uöt32_t)
dúe˘i⁄
, 
TURN_LEFT
);

515 
°¨tcou¡
--;

516 i‡(
°¨tcou¡
 == 0) {

517 
	`cv_brﬂdˇ°
(
°¨tcv
, 
ã°lock
);

519 
	`cv_waô
(
°¨tcv
, 
ã°lock
);

521 
	`lock_ªÀa£
(
ã°lock
);

522 
	`tu∫À·
((
uöt32_t
)
dúe˘i⁄
, (uöt32_t)
ödex
);

523 
	`V
(
íd£m
);

526 
	}
}

529 
	$öQuadø¡
(
quadø¡
, 
uöt32_t
 
ödex
) {

530 
	`øndom_yõldî
(
PROBLEMS_MAX_YIELDER
);

531 
	`øndom_•ö√r
(
PROBLEMS_MAX_SPINNER
);

532 
	`lock_acquúe
(
ã°lock
);

533 
¥e_quadø¡
 = 
	`move
(
ödex
);

535 
èrgë_quadø¡
 = 
ˇr_dúe˘i⁄s
[
ödex
];

536 
ˇr_tu∫_times
[
ödex
]) {

538 
	`Áûif
((
¥e_quadø¡
 !
UNKNOWN_CAR
), "failed: invalidÅurn");

541 
	`Áûif
((
¥e_quadø¡
 !
èrgë_quadø¡
), "failed: invalidÅurn");

542 
èrgë_quadø¡
 = (èrgë_quadø¡ + 
NUM_QUADRANTS
 - 1) % NUM_QUADRANTS;

545 
èrgë_quadø¡
 = (èrgë_quadø¡ + 
NUM_QUADRANTS
 - 1) % NUM_QUADRANTS;

546 
	`Áûif
((
¥e_quadø¡
 !
èrgë_quadø¡
), "failed: invalidÅurn");

547 
èrgë_quadø¡
 = (èrgë_quadø¡ + 
NUM_QUADRANTS
 - 1) % NUM_QUADRANTS;

550 
	`Áûif
(
åue
, "failed: invalidÅurn");

553 
	`Áûif
((
quadø¡
 !
èrgë_quadø¡
), "failed: invalidÅurn");

554 
ˇr_tu∫_times
[
ödex
]++;

556 
	`Áûif
((
quadø¡_¨øy
[
quadø¡
] > 0), "failed: collision");

558 
quadø¡_¨øy
[
quadø¡
]++;

559 
ˇr_loˇti⁄s
[
ödex
] = 
quadø¡
;

560 
Æl_quadø¡
++;

562 
	`lock_ªÀa£
(
ã°lock
);

563 
	`k¥ötf_n
("%†ö quadø¡ %d\n", 
cuπhªad
->
t_«me
, 
quadø¡
);

564 
	}
}

567 
	$ÀaveI¡î£˘i⁄
(
uöt32_t
 
ödex
) {

568 
	`øndom_yõldî
(
PROBLEMS_MAX_YIELDER
);

569 
	`øndom_•ö√r
(
PROBLEMS_MAX_SPINNER
);

570 
	`lock_acquúe
(
ã°lock
);

571 
	`move
(
ödex
);

573 
ˇr_tu∫s
[
ödex
]) {

574 
GO_STRAIGHT
:

575 
	`Áûif
((
ˇr_tu∫_times
[
ödex
] != 2), "failed: incorrectÅurn");

577 
TURN_LEFT
:

578 
	`Áûif
((
ˇr_tu∫_times
[
ödex
] != 3), "failed: incorrectÅurn");

580 
TURN_RIGHT
:

581 
	`Áûif
((
ˇr_tu∫_times
[
ödex
] != 1), "failed: incorrectÅurn");

584 
	`Áûif
(
åue
, "failed: incorrectÅurn");

588 
ˇr_loˇti⁄s
[
ödex
] = 
PASSED_CAR
;

589 
	`lock_ªÀa£
(
ã°lock
);

590 
	`k¥ötf_n
("%†À·Åhêöãr£˘i⁄\n", 
cuπhªad
->
t_«me
);

591 
	}
}

593 
	$°›light
(
«rgs
, **
¨gs
) {

594 (Ë
«rgs
;

595 (Ë
¨gs
;

596 
i
, 
dúe˘i⁄
, 
tu∫
, 
îr
 = 0;

597 
«me
[32];

598 
ªquúed_quadø¡
 = 0;

599 
∑s£d
 = 0;

601 
max_ˇr_cou¡
 = 0;

602 
Æl_quadø¡
 = 0;

604 
	`k¥ötf_n
("Starting sp2...\n");

605 
	`k¥ötf_n
("IfÅhisÅests hangs, your solution is incorrect.\n");

607 
i
 = 0; i < 
NUM_QUADRANTS
; i++) {

608 
quadø¡_¨øy
[
i
] = 0;

611 
i
 = 0; i < 
NCARS
; i++) {

612 
ˇr_loˇti⁄s
[
i
] = 
UNKNOWN_CAR
;

613 
ˇr_thªads
[
i
] = 
NULL
;

614 
ˇr_dúe˘i⁄s
[
i
] = -1;

617 
°¨tcou¡
 = 
NCARS
;

618 
ã°lock
 = 
	`lock_¸óã
("testlock");

619 i‡(
ã°lock
 =
NULL
) {

620 
	`∑nic
("sp2:Üock_create failed\n");

622 
°¨tcv
 = 
	`cv_¸óã
("startcv");

623 i‡(
°¨tcv
 =
NULL
) {

624 
	`∑nic
("sp2: cv_create failed\n");

626 
íd£m
 = 
	`£m_¸óã
("endsem", 0);

627 i‡(
íd£m
 =
NULL
) {

628 
	`∑nic
("sp2: sem_create failed\n");

630 
	`•ölock_öô
(&
°©us_lock
);

631 
ã°_°©us
 = 
TEST161_SUCCESS
;

633 
	`°›light_öô
();

635 
i
 = 0; i < 
NCARS
; i++) {

636 
	`k¥ötf_t
(".");

638 
dúe˘i⁄
 = 
	`øndom
() % 4;

639 
tu∫
 = 
	`øndom
() % 3;

641 
	`¢¥ötf
(
«me
, “ame), "C¨ Thªad %d", 
i
);

643 
tu∫
) {

644 
GO_STRAIGHT
:

645 
îr
 = 
	`thªad_f‹k
(
«me
, 
NULL
, 
go°øight_wøµî
, (*)
i
, 
dúe˘i⁄
);

646 
ªquúed_quadø¡
 += 2;

648 
TURN_LEFT
:

649 
îr
 = 
	`thªad_f‹k
(
«me
, 
NULL
, 
tu∫À·_wøµî
, (*)
i
, 
dúe˘i⁄
);

650 
ªquúed_quadø¡
 += 3;

652 
TURN_RIGHT
:

653 
îr
 = 
	`thªad_f‹k
(
«me
, 
NULL
, 
tu∫right_wøµî
, (*)
i
, 
dúe˘i⁄
);

654 
ªquúed_quadø¡
 += 1;

657 i‡(
îr
) {

658 
	`∑nic
("•2:Åhªad_f‹k faûed: (%s)\n", 
	`°ªº‹
(
îr
));

662 
i
 = 0; i < 
NCARS
; i++) {

663 
	`k¥ötf_t
(".");

664 
	`P
(
íd£m
);

667 
	`°›light_˛ónup
();

669 
i
 = 0; i < 
NCARS
; i++) {

670 
∑s£d
 +
ˇr_loˇti⁄s
[
i
] =
PASSED_CAR
 ? 1 : 0;

672 i‡((
ã°_°©us
 =
TEST161_SUCCESS
) &&

673 (!(
	`Áûif
((
∑s£d
 !
NCARS
), "failed:ÇotÉnough cars"))) &&

674 (!(
	`Áûif
((
Æl_quadø¡
 !
ªquúed_quadø¡
), "failed: didn't doÅheÑightÅurns"))) &&

675 (!(
	`Áûif
((
max_ˇr_cou¡
 <= 1), "failed:Ço concurrencyáchieved")))) {};

677 
	`lock_de°roy
(
ã°lock
);

678 
	`cv_de°roy
(
°¨tcv
);

679 
	`£m_de°roy
(
íd£m
);

681 
	`k¥ötf_t
("\n");

682 i‡(
ã°_°©us
 !
TEST161_SUCCESS
) {

683 
	`£˝rötf
(
SECRET
, 
ã°_mesßge
, "sp2");

685 
	`suc˚ss
(
ã°_°©us
, 
SECRET
, "sp2");

688 
	}
}

	@/home/trinity/src/kern/test/synchtest.c

37 
	~<ty≥s.h
>

38 
	~<lib.h
>

39 
	~<˛ock.h
>

40 
	~<thªad.h
>

41 
	~<synch.h
>

42 
	~<ã°.h
>

43 
	~<kîn/ã°161.h
>

44 
	~<•ölock.h
>

46 
	#CREATELOOPS
 8

	)

47 
	#NSEMLOOPS
 63

	)

48 
	#NLOCKLOOPS
 120

	)

49 
	#NCVLOOPS
 5

	)

50 
	#NTHREADS
 32

	)

51 
	#SYNCHTEST_YIELDER_MAX
 16

	)

53 vﬁ©ûê
	gã°vÆ1
;

54 vﬁ©ûê
	gã°vÆ2
;

55 vﬁ©ûê
	gã°vÆ3
;

56 vﬁ©ûê
öt32_t
 
	gã°vÆ4
;

58 
£m≠h‹e
 *
	gã°£m
 = 
NULL
;

59 
£m≠h‹e
 *
	gã°£m2
 = 
NULL
;

60 
lock
 *
	gã°lock
 = 
NULL
;

61 
lock
 *
	gã°lock2
 = 
NULL
;

62 
cv
 *
	gã°cv
 = 
NULL
;

63 
£m≠h‹e
 *
	gd⁄e£m
 = 
NULL
;

65 
•ölock
 
	g°©us_lock
;

66 
boﬁ
 
	gã°_°©us
 = 
TEST161_FAIL
;

68 
	g£mã°_cuºít
;

71 
boﬁ


72 
	$Áûif
(
boﬁ
 
c⁄dôi⁄
) {

73 i‡(
c⁄dôi⁄
) {

74 
	`•ölock_acquúe
(&
°©us_lock
);

75 
ã°_°©us
 = 
TEST161_FAIL
;

76 
	`•ölock_ªÀa£
(&
°©us_lock
);

78  
c⁄dôi⁄
;

79 
	}
}

83 
	$£mã°thªad
(*
junk
, 
num
)

85 ()
junk
;

87 
i
;

89 
	`øndom_yõldî
(4);

94 
	`P
(
ã°£m
);

95 
£mã°_cuºít
 = 
num
;

97 
	`k¥ötf_n
("Thªad %2lu: ", 
num
);

98 
i
=0; i<
NSEMLOOPS
; i++) {

99 
	`k¥ötf_t
(".");

100 
	`k¥ötf_n
("%2lu", 
num
);

101 
	`øndom_yõldî
(4);

102 
	`Áûif
((
£mã°_cuºít
 !
num
));

104 
	`k¥ötf_n
("\n");

106 
	`V
(
d⁄e£m
);

107 
	}
}

110 
	$£mã°
(
«rgs
, **
¨gs
)

112 ()
«rgs
;

113 ()
¨gs
;

115 
i
, 
ªsu…
;

117 
	`k¥ötf_n
("Starting sem1...\n");

118 
i
=0; i<
CREATELOOPS
; i++) {

119 
	`k¥ötf_t
(".");

120 
ã°£m
 = 
	`£m_¸óã
("testsem", 2);

121 i‡(
ã°£m
 =
NULL
) {

122 
	`∑nic
("sem1: sem_create failed\n");

124 
d⁄e£m
 = 
	`£m_¸óã
("donesem", 0);

125 i‡(
d⁄e£m
 =
NULL
) {

126 
	`∑nic
("sem1: sem_create failed\n");

128 i‡(
i
 !
CREATELOOPS
 - 1) {

129 
	`£m_de°roy
(
ã°£m
);

130 
	`£m_de°roy
(
d⁄e£m
);

133 
	`•ölock_öô
(&
°©us_lock
);

134 
ã°_°©us
 = 
TEST161_SUCCESS
;

136 
	`k¥ötf_n
("IfÅhis hangs, it's broken: ");

137 
	`P
(
ã°£m
);

138 
	`P
(
ã°£m
);

139 
	`k¥ötf_n
("OK\n");

140 
	`k¥ötf_t
(".");

142 
i
=0; i<
NTHREADS
; i++) {

143 
	`k¥ötf_t
(".");

144 
ªsu…
 = 
	`thªad_f‹k
("£mã°", 
NULL
, 
£mã°thªad
, NULL, 
i
);

145 i‡(
ªsu…
) {

146 
	`∑nic
("sem1:Åhread_fork failed: %s\n",

147 
	`°ªº‹
(
ªsu…
));

150 
i
=0; i<
NTHREADS
; i++) {

151 
	`k¥ötf_t
(".");

152 
	`V
(
ã°£m
);

153 
	`P
(
d⁄e£m
);

156 
	`£m_de°roy
(
ã°£m
);

157 
	`£m_de°roy
(
d⁄e£m
);

158 
ã°£m
 = 
d⁄e£m
 = 
NULL
;

160 
	`k¥ötf_t
("\n");

161 
	`suc˚ss
(
ã°_°©us
, 
SECRET
, "sem1");

164 
	}
}

168 
	$lockã°thªad
(*
junk
, 
num
)

170 ()
junk
;

172 
i
;

174 
i
=0; i<
NLOCKLOOPS
; i++) {

175 
	`k¥ötf_t
(".");

176 
	`KASSERT
(!(
	`lock_do_i_hﬁd
(
ã°lock
)));

177 
	`lock_acquúe
(
ã°lock
);

178 
	`KASSERT
(
	`lock_do_i_hﬁd
(
ã°lock
));

179 
	`øndom_yõldî
(4);

181 
ã°vÆ1
 = 
num
;

182 
ã°vÆ2
 = 
num
*num;

183 
ã°vÆ3
 = 
num
%3;

185 i‡(
ã°vÆ2
 !
ã°vÆ1
*testval1) {

186 
Áû
;

188 
	`øndom_yõldî
(4);

189 
	`KASSERT
(
	`lock_do_i_hﬁd
(
ã°lock
));

191 i‡(
ã°vÆ2
%3 !(
ã°vÆ3
*testval3)%3) {

192 
Áû
;

194 
	`øndom_yõldî
(4);

195 
	`KASSERT
(
	`lock_do_i_hﬁd
(
ã°lock
));

197 i‡(
ã°vÆ3
 !
ã°vÆ1
%3) {

198 
Áû
;

200 
	`øndom_yõldî
(4);

201 
	`KASSERT
(
	`lock_do_i_hﬁd
(
ã°lock
));

203 i‡(
ã°vÆ1
 !
num
) {

204 
Áû
;

206 
	`øndom_yõldî
(4);

207 
	`KASSERT
(
	`lock_do_i_hﬁd
(
ã°lock
));

209 i‡(
ã°vÆ2
 !
num
*num) {

210 
Áû
;

212 
	`øndom_yõldî
(4);

213 
	`KASSERT
(
	`lock_do_i_hﬁd
(
ã°lock
));

215 i‡(
ã°vÆ3
 !
num
%3) {

216 
Áû
;

218 
	`øndom_yõldî
(4);

219 
	`KASSERT
(
	`lock_do_i_hﬁd
(
ã°lock
));

221 i‡(!(
	`lock_do_i_hﬁd
(
ã°lock
))) {

222 
Áû
;

224 
	`øndom_yõldî
(4);

225 
	`KASSERT
(
	`lock_do_i_hﬁd
(
ã°lock
));

227 
	`lock_ªÀa£
(
ã°lock
);

228 
	`KASSERT
(!(
	`lock_do_i_hﬁd
(
ã°lock
)));

233 
i
=0; i<
NLOCKLOOPS
; i++) {

234 
	`k¥ötf_t
(".");

235 i‡(
	`lock_do_i_hﬁd
(
ã°lock
)) {

236 
Áû2
;

240 
	`V
(
d⁄e£m
);

243 
Áû
:

244 
	`lock_ªÀa£
(
ã°lock
);

245 
Áû2
:

246 
	`Áûif
(
åue
);

247 
	`V
(
d⁄e£m
);

249 
	}
}

252 
	$lockã°
(
«rgs
, **
¨gs
)

254 ()
«rgs
;

255 ()
¨gs
;

257 
i
, 
ªsu…
;

259 
	`k¥ötf_n
("StartingÜt1...\n");

260 
i
=0; i<
CREATELOOPS
; i++) {

261 
	`k¥ötf_t
(".");

262 
ã°lock
 = 
	`lock_¸óã
("testlock");

263 i‡(
ã°lock
 =
NULL
) {

264 
	`∑nic
("lt1:Üock_create failed\n");

266 
d⁄e£m
 = 
	`£m_¸óã
("donesem", 0);

267 i‡(
d⁄e£m
 =
NULL
) {

268 
	`∑nic
("lt1: sem_create failed\n");

270 i‡(
i
 !
CREATELOOPS
 - 1) {

271 
	`lock_de°roy
(
ã°lock
);

272 
	`£m_de°roy
(
d⁄e£m
);

275 
	`•ölock_öô
(&
°©us_lock
);

276 
ã°_°©us
 = 
TEST161_SUCCESS
;

278 
i
=0; i<
NTHREADS
; i++) {

279 
	`k¥ötf_t
(".");

280 
ªsu…
 = 
	`thªad_f‹k
("synchã°", 
NULL
, 
lockã°thªad
, NULL, 
i
);

281 i‡(
ªsu…
) {

282 
	`∑nic
("…1:Åhªad_f‹k faûed: %s\n", 
	`°ªº‹
(
ªsu…
));

285 
i
=0; i<
NTHREADS
; i++) {

286 
	`k¥ötf_t
(".");

287 
	`P
(
d⁄e£m
);

290 
	`lock_de°roy
(
ã°lock
);

291 
	`£m_de°roy
(
d⁄e£m
);

292 
ã°lock
 = 
NULL
;

293 
d⁄e£m
 = 
NULL
;

295 
	`k¥ötf_t
("\n");

296 
	`suc˚ss
(
ã°_°©us
, 
SECRET
, "lt1");

299 
	}
}

309 
	$lockã°2
(
«rgs
, **
¨gs
) {

310 ()
«rgs
;

311 ()
¨gs
;

313 
	`k¥ötf_n
("StartingÜt2...\n");

314 
	`k¥ötf_n
("(ThisÅestÖanics on success!)\n");

316 
ã°lock
 = 
	`lock_¸óã
("testlock");

317 i‡(
ã°lock
 =
NULL
) {

318 
	`∑nic
("lt2:Üock_create failed\n");

321 
	`£˝rötf
(
SECRET
, "ShouldÖanic...", "lt2");

322 
	`lock_ªÀa£
(
ã°lock
);

326 
	`suc˚ss
(
TEST161_FAIL
, 
SECRET
, "lt2");

330 
ã°lock
 = 
NULL
;

332 
	}
}

335 
	$lockã°3
(
«rgs
, **
¨gs
) {

336 ()
«rgs
;

337 ()
¨gs
;

339 
	`k¥ötf_n
("StartingÜt3...\n");

340 
	`k¥ötf_n
("(ThisÅestÖanics on success!)\n");

342 
ã°lock
 = 
	`lock_¸óã
("testlock");

343 i‡(
ã°lock
 =
NULL
) {

344 
	`∑nic
("lt3:Üock_create failed\n");

347 
	`£˝rötf
(
SECRET
, "ShouldÖanic...", "lt3");

348 
	`lock_acquúe
(
ã°lock
);

349 
	`lock_de°roy
(
ã°lock
);

353 
	`suc˚ss
(
TEST161_FAIL
, 
SECRET
, "lt3");

357 
ã°lock
 = 
NULL
;

359 
	}
}

369 
	$lockã°acquúî
(* 
junk
, 
num
)

371 ()
junk
;

372 ()
num
;

374 
	`lock_acquúe
(
ã°lock
);

375 
	`V
(
d⁄e£m
);

378 
	}
}

382 
	$lockã°4
(
«rgs
, **
¨gs
) {

383 (Ë
«rgs
;

384 (Ë
¨gs
;

386 
ªsu…
;

388 
	`k¥ötf_n
("StartingÜt4...\n");

389 
	`k¥ötf_n
("(ThisÅestÖanics on success!)\n");

391 
ã°lock
 = 
	`lock_¸óã
("testlock");

392 i‡(
ã°lock
 =
NULL
) {

393 
	`∑nic
("lt4:Üock_create failed\n");

396 
d⁄e£m
 = 
	`£m_¸óã
("donesem", 0);

397 i‡(
d⁄e£m
 =
NULL
) {

398 
	`lock_de°roy
(
ã°lock
);

399 
	`∑nic
("lt4: sem_create failed\n");

402 
ªsu…
 = 
	`thªad_f‹k
("…4", 
NULL
, 
lockã°acquúî
, NULL, 0);

403 i‡(
ªsu…
) {

404 
	`∑nic
("…4:Åhªad_f‹k faûed: %s\n", 
	`°ªº‹
(
ªsu…
));

407 
	`P
(
d⁄e£m
);

408 
	`£˝rötf
(
SECRET
, "ShouldÖanic...", "lt4");

409 
	`lock_ªÀa£
(
ã°lock
);

413 
	`suc˚ss
(
TEST161_FAIL
, 
SECRET
, "lt4");

417 
ã°lock
 = 
NULL
;

418 
d⁄e£m
 = 
NULL
;

420 
	}
}

423 
	$lockã°5
(
«rgs
, **
¨gs
) {

424 (Ë
«rgs
;

425 (Ë
¨gs
;

427 
ªsu…
;

429 
	`k¥ötf_n
("StartingÜt5...\n");

430 
	`k¥ötf_n
("(ThisÅestÖanics on success!)\n");

432 
ã°lock
 = 
	`lock_¸óã
("testlock");

433 i‡(
ã°lock
 =
NULL
) {

434 
	`∑nic
("lt5:Üock_create failed\n");

437 
d⁄e£m
 = 
	`£m_¸óã
("donesem", 0);

438 i‡(
d⁄e£m
 =
NULL
) {

439 
	`lock_de°roy
(
ã°lock
);

440 
	`∑nic
("lt5: sem_create failed\n");

443 
ªsu…
 = 
	`thªad_f‹k
("…5", 
NULL
, 
lockã°acquúî
, NULL, 0);

444 i‡(
ªsu…
) {

445 
	`∑nic
("…5:Åhªad_f‹k faûed: %s\n", 
	`°ªº‹
(
ªsu…
));

448 
	`P
(
d⁄e£m
);

449 
	`£˝rötf
(
SECRET
, "ShouldÖanic...", "lt5");

450 
	`KASSERT
(
	`lock_do_i_hﬁd
(
ã°lock
));

454 
	`suc˚ss
(
TEST161_FAIL
, 
SECRET
, "lt5");

458 
ã°lock
 = 
NULL
;

459 
d⁄e£m
 = 
NULL
;

461 
	}
}

465 
	$cvã°thªad
(*
junk
, 
num
)

467 ()
junk
;

469 
i
;

470 vﬁ©ûê
j
;

471 
time•ec
 
ts1
, 
ts2
;

473 
i
=0; i<
NCVLOOPS
; i++) {

474 
	`k¥ötf_t
(".");

475 
	`lock_acquúe
(
ã°lock
);

476 
ã°vÆ1
 !
num
) {

477 
ã°vÆ2
 = 0;

478 
	`øndom_yõldî
(4);

479 
	`gëtime
(&
ts1
);

480 
	`cv_waô
(
ã°cv
, 
ã°lock
);

481 
	`gëtime
(&
ts2
);

482 
	`øndom_yõldî
(4);

485 
	`time•ec_sub
(&
ts2
, &
ts1
, &ts2);

488 i‡(
ts2
.
tv_£c
 =0 &&Ås2.
tv_n£c
 < 40*2000) {

489 
	`k¥ötf_n
("cv_waôÅook o∆y %uÇs\n", 
ts2
.
tv_n£c
);

490 
	`k¥ötf_n
("That'sÅoo fast... you must be busy-looping\n");

491 
	`Áûif
(
åue
);

492 
	`V
(
d⁄e£m
);

493 
	`thªad_exô
();

496 
ã°vÆ2
 = 0xFFFFFFFF;

498 
ã°vÆ2
 = 
num
;

504 
j
=0; j<3000; j++);

506 
	`øndom_yõldî
(4);

507 
	`cv_brﬂdˇ°
(
ã°cv
, 
ã°lock
);

508 
	`øndom_yõldî
(4);

509 
	`Áûif
((
ã°vÆ1
 !
ã°vÆ2
));

511 
	`k¥ötf_n
("Thªad %lu\n", 
ã°vÆ2
);

512 
ã°vÆ1
 = (ã°vÆ1 + 
NTHREADS
 - 1) % NTHREADS;

513 
	`lock_ªÀa£
(
ã°lock
);

515 
	`V
(
d⁄e£m
);

516 
	}
}

519 
	$cvã°
(
«rgs
, **
¨gs
)

521 ()
«rgs
;

522 ()
¨gs
;

524 
i
, 
ªsu…
;

526 
	`k¥ötf_n
("Starting cvt1...\n");

527 
i
=0; i<
CREATELOOPS
; i++) {

528 
	`k¥ötf_t
(".");

529 
ã°lock
 = 
	`lock_¸óã
("testlock");

530 i‡(
ã°lock
 =
NULL
) {

531 
	`∑nic
("cvt1:Üock_create failed\n");

533 
ã°cv
 = 
	`cv_¸óã
("testcv");

534 i‡(
ã°cv
 =
NULL
) {

535 
	`∑nic
("cvt1: cv_create failed\n");

537 
d⁄e£m
 = 
	`£m_¸óã
("donesem", 0);

538 i‡(
d⁄e£m
 =
NULL
) {

539 
	`∑nic
("cvt1: sem_create failed\n");

541 i‡(
i
 !
CREATELOOPS
 - 1) {

542 
	`lock_de°roy
(
ã°lock
);

543 
	`cv_de°roy
(
ã°cv
);

544 
	`£m_de°roy
(
d⁄e£m
);

547 
	`•ölock_öô
(&
°©us_lock
);

548 
ã°_°©us
 = 
TEST161_SUCCESS
;

550 
ã°vÆ1
 = 
NTHREADS
-1;

551 
i
=0; i<
NTHREADS
; i++) {

552 
	`k¥ötf_t
(".");

553 
ªsu…
 = 
	`thªad_f‹k
("cvt1", 
NULL
, 
cvã°thªad
, NULL, (Ë
i
);

554 i‡(
ªsu…
) {

555 
	`∑nic
("cvt1:Åhªad_f‹k faûed: %s\n", 
	`°ªº‹
(
ªsu…
));

558 
i
=0; i<
NTHREADS
; i++) {

559 
	`k¥ötf_t
(".");

560 
	`P
(
d⁄e£m
);

563 
	`lock_de°roy
(
ã°lock
);

564 
	`cv_de°roy
(
ã°cv
);

565 
	`£m_de°roy
(
d⁄e£m
);

566 
ã°lock
 = 
NULL
;

567 
ã°cv
 = 
NULL
;

568 
d⁄e£m
 = 
NULL
;

570 
	`k¥ötf_t
("\n");

571 
	`suc˚ss
(
ã°_°©us
, 
SECRET
, "cvt1");

574 
	}
}

586 
	#NCVS
 250

	)

587 
	#NLOOPS
 40

	)

588 
cv
 *
	gã°cvs
[
NCVS
];

589 
lock
 *
	gã°locks
[
NCVS
];

590 
£m≠h‹e
 *
	gg©e£m
;

591 
£m≠h‹e
 *
	gexô£m
;

595 
	$¶ì±hªad
(*
junk1
, 
junk2
)

597 ()
junk1
;

598 ()
junk2
;

600 
i
, 
j
;

602 
	`øndom_yõldî
(4);

604 
j
=0; j<
NLOOPS
; j++) {

605 
	`k¥ötf_t
(".");

606 
i
=0; i<
NCVS
; i++) {

607 
	`lock_acquúe
(
ã°locks
[
i
]);

608 
	`øndom_yõldî
(4);

609 
	`V
(
g©e£m
);

610 
	`øndom_yõldî
(4);

611 
	`•ölock_acquúe
(&
°©us_lock
);

612 
ã°vÆ4
++;

613 
	`•ölock_ªÀa£
(&
°©us_lock
);

614 
	`cv_waô
(
ã°cvs
[
i
], 
ã°locks
[i]);

615 
	`øndom_yõldî
(4);

616 
	`lock_ªÀa£
(
ã°locks
[
i
]);

618 
	`k¥ötf_n
("¶ì±hªad: %u\n", 
j
);

620 
	`V
(
exô£m
);

621 
	}
}

625 
	$wakëhªad
(*
junk1
, 
junk2
)

627 ()
junk1
;

628 ()
junk2
;

630 
i
, 
j
;

632 
	`øndom_yõldî
(4);

634 
j
=0; j<
NLOOPS
; j++) {

635 
	`k¥ötf_t
(".");

636 
i
=0; i<
NCVS
; i++) {

637 
	`øndom_yõldî
(4);

638 
	`P
(
g©e£m
);

639 
	`øndom_yõldî
(4);

640 
	`lock_acquúe
(
ã°locks
[
i
]);

641 
	`øndom_yõldî
(4);

642 
ã°vÆ4
--;

643 
	`Áûif
((
ã°vÆ4
 != 0));

644 
	`cv_sig«l
(
ã°cvs
[
i
], 
ã°locks
[i]);

645 
	`øndom_yõldî
(4);

646 
	`lock_ªÀa£
(
ã°locks
[
i
]);

648 
	`k¥ötf_n
("wakëhªad: %u\n", 
j
);

650 
	`V
(
exô£m
);

651 
	}
}

654 
	$cvã°2
(
«rgs
, **
¨gs
)

656 ()
«rgs
;

657 ()
¨gs
;

659 
i
;

660 
ªsu…
;

662 
	`k¥ötf_n
("Starting cvt2...\n");

663 
i
=0; i<
CREATELOOPS
; i++) {

664 
	`k¥ötf_t
(".");

665 
g©e£m
 = 
	`£m_¸óã
("gatesem", 0);

666 i‡(
g©e£m
 =
NULL
) {

667 
	`∑nic
("cvt2: sem_create failed\n");

669 
exô£m
 = 
	`£m_¸óã
("exitsem", 0);

670 i‡(
exô£m
 =
NULL
) {

671 
	`∑nic
("cvt2: sem_create failed\n");

673 i‡(
i
 !
CREATELOOPS
 - 1) {

674 
	`£m_de°roy
(
g©e£m
);

675 
	`£m_de°roy
(
exô£m
);

678 
i
=0; i<
NCVS
; i++) {

679 
	`k¥ötf_t
(".");

680 
ã°locks
[
i
] = 
	`lock_¸óã
("cvtest2Üock");

681 
ã°cvs
[
i
] = 
	`cv_¸óã
("cvtest2 cv");

683 
	`•ölock_öô
(&
°©us_lock
);

684 
ã°_°©us
 = 
TEST161_SUCCESS
;

686 
ªsu…
 = 
	`thªad_f‹k
("cvt2", 
NULL
, 
¶ì±hªad
, NULL, 0);

687 i‡(
ªsu…
) {

688 
	`∑nic
("cvt2:Åhread_fork failed\n");

690 
ªsu…
 = 
	`thªad_f‹k
("cvt2", 
NULL
, 
wakëhªad
, NULL, 0);

691 i‡(
ªsu…
) {

692 
	`∑nic
("cvt2:Åhread_fork failed\n");

694 
	`P
(
exô£m
);

695 
	`P
(
exô£m
);

697 
	`£m_de°roy
(
exô£m
);

698 
	`£m_de°roy
(
g©e£m
);

699 
exô£m
 = 
g©e£m
 = 
NULL
;

700 
i
=0; i<
NCVS
; i++) {

701 
	`k¥ötf_t
(".");

702 
	`lock_de°roy
(
ã°locks
[
i
]);

703 
	`cv_de°roy
(
ã°cvs
[
i
]);

704 
ã°locks
[
i
] = 
NULL
;

705 
ã°cvs
[
i
] = 
NULL
;

708 
	`k¥ötf_t
("\n");

709 
	`suc˚ss
(
ã°_°©us
, 
SECRET
, "cvt2");

712 
	}
}

715 
	$cvã°3
(
«rgs
, **
¨gs
) {

716 ()
«rgs
;

717 ()
¨gs
;

719 
	`k¥ötf_n
("Starting cvt3...\n");

720 
	`k¥ötf_n
("(ThisÅestÖanics on success!)\n");

722 
ã°lock
 = 
	`lock_¸óã
("testlock");

723 i‡(
ã°lock
 =
NULL
) {

724 
	`∑nic
("cvt3:Üock_create failed\n");

726 
ã°cv
 = 
	`cv_¸óã
("testcv");

727 i‡(
ã°cv
 =
NULL
) {

728 
	`∑nic
("cvt3: cv_create failed\n");

731 
	`£˝rötf
(
SECRET
, "ShouldÖanic...", "cvt3");

732 
	`cv_waô
(
ã°cv
, 
ã°lock
);

736 
	`suc˚ss
(
TEST161_FAIL
, 
SECRET
, "cvt3");

738 
	`lock_de°roy
(
ã°lock
);

739 
	`cv_de°roy
(
ã°cv
);

740 
ã°cv
 = 
NULL
;

741 
ã°lock
 = 
NULL
;

744 
	}
}

747 
	$cvã°4
(
«rgs
, **
¨gs
) {

748 ()
«rgs
;

749 ()
¨gs
;

751 
	`k¥ötf_n
("Starting cvt4...\n");

752 
	`k¥ötf_n
("(ThisÅestÖanics on success!)\n");

754 
ã°lock
 = 
	`lock_¸óã
("testlock");

755 i‡(
ã°lock
 =
NULL
) {

756 
	`∑nic
("cvt4:Üock_create failed\n");

758 
ã°cv
 = 
	`cv_¸óã
("testcv");

759 i‡(
ã°cv
 =
NULL
) {

760 
	`∑nic
("cvt4: cv_create failed\n");

763 
	`£˝rötf
(
SECRET
, "ShouldÖanic...", "cvt4");

764 
	`cv_brﬂdˇ°
(
ã°cv
, 
ã°lock
);

768 
	`suc˚ss
(
TEST161_FAIL
, 
SECRET
, "cvt4");

770 
	`lock_de°roy
(
ã°lock
);

771 
	`cv_de°roy
(
ã°cv
);

772 
ã°cv
 = 
NULL
;

773 
ã°lock
 = 
NULL
;

776 
	}
}

780 
	$¶ì≥πhªad
(*
junk1
, 
junk2
) {

781 ()
junk1
;

782 ()
junk2
;

784 
	`øndom_yõldî
(4);

785 
	`lock_acquúe
(
ã°lock
);

786 
	`øndom_yõldî
(4);

787 
	`Áûif
((
ã°vÆ1
 != 0));

788 
ã°vÆ1
 = 1;

789 
	`cv_sig«l
(
ã°cv
, 
ã°lock
);

791 
	`øndom_yõldî
(4);

792 
	`cv_waô
(
ã°cv
, 
ã°lock
);

793 
	`Áûif
((
ã°vÆ1
 != 3));

794 
ã°vÆ1
 = 4;

795 
	`øndom_yõldî
(4);

796 
	`lock_ªÀa£
(
ã°lock
);

797 
	`øndom_yõldî
(4);

799 
	`V
(
exô£m
);

800 
	}
}

804 
	$wakîthªad
(*
junk1
, 
junk2
) {

805 ()
junk1
;

806 ()
junk2
;

808 
	`øndom_yõldî
(4);

809 
	`lock_acquúe
(
ã°lock2
);

810 
	`Áûif
((
ã°vÆ1
 != 2));

811 
ã°vÆ1
 = 3;

813 
	`øndom_yõldî
(4);

814 
	`cv_sig«l
(
ã°cv
, 
ã°lock2
);

815 
	`øndom_yõldî
(4);

816 
	`lock_ªÀa£
(
ã°lock2
);

817 
	`øndom_yõldî
(4);

819 
	`V
(
exô£m
);

820 
	}
}

823 
	$cvã°5
(
«rgs
, **
¨gs
) {

824 ()
«rgs
;

825 ()
¨gs
;

827 
ªsu…
;

829 
	`k¥ötf_n
("Starting cvt5...\n");

831 
ã°lock
 = 
	`lock_¸óã
("testlock");

832 i‡(
ã°lock
 =
NULL
) {

833 
	`∑nic
("cvt5:Üock_create failed\n");

835 
ã°lock2
 = 
	`lock_¸óã
("testlock2");

836 i‡(
ã°lock
 =
NULL
) {

837 
	`∑nic
("cvt5:Üock_create failed\n");

839 
ã°cv
 = 
	`cv_¸óã
("testcv");

840 i‡(
ã°cv
 =
NULL
) {

841 
	`∑nic
("cvt5: cv_create failed\n");

843 
exô£m
 = 
	`£m_¸óã
("exitsem", 0);

844 i‡(
exô£m
 =
NULL
) {

845 
	`∑nic
("cvt5: sem_create failed\n");

847 
	`•ölock_öô
(&
°©us_lock
);

848 
ã°_°©us
 = 
TEST161_SUCCESS
;

849 
ã°vÆ1
 = 0;

851 
	`lock_acquúe
(
ã°lock
);

852 
	`lock_acquúe
(
ã°lock2
);

854 
ªsu…
 = 
	`thªad_f‹k
("cvt5", 
NULL
, 
¶ì≥πhªad
, NULL, 0);

855 i‡(
ªsu…
) {

856 
	`∑nic
("cvt5:Åhread_fork failed\n");

858 
ªsu…
 = 
	`thªad_f‹k
("cvt5", 
NULL
, 
wakîthªad
, NULL, 0);

859 i‡(
ªsu…
) {

860 
	`∑nic
("cvt5:Åhread_fork failed\n");

863 
	`øndom_yõldî
(4);

864 
	`cv_waô
(
ã°cv
, 
ã°lock
);

865 
	`Áûif
((
ã°vÆ1
 != 1));

866 
ã°vÆ1
 = 2;

867 
	`øndom_yõldî
(4);

868 
	`lock_ªÀa£
(
ã°lock
);

869 
	`øndom_yõldî
(4);

870 
	`lock_ªÀa£
(
ã°lock2
);

872 
	`P
(
exô£m
);

873 
	`P
(
exô£m
);

874 
	`Áûif
((
ã°vÆ1
 != 4));

876 
	`£m_de°roy
(
exô£m
);

877 
	`cv_de°roy
(
ã°cv
);

878 
	`lock_de°roy
(
ã°lock2
);

879 
	`lock_de°roy
(
ã°lock
);

881 
	`suc˚ss
(
ã°_°©us
, 
SECRET
, "cvt5");

883 
exô£m
 = 
NULL
;

884 
ã°cv
 = 
NULL
;

885 
ã°lock2
 = 
NULL
;

886 
ã°lock
 = 
NULL
;

887 
ã°£m2
 = 
NULL
;

888 
ã°£m
 = 
NULL
;

891 
	}
}

	@/home/trinity/src/kern/test/threadlisttest.c

30 
	~<ty≥s.h
>

31 
	~<lib.h
>

32 
	~<thªad.h
>

33 
	~<thªadli°.h
>

34 
	~<ã°.h
>

36 
	#NUMNAMES
 7

	)

37 c⁄° *c⁄° 
	g«mes
[
NUMNAMES
] = {

47 
thªad
 *
	gÁkëhªads
[
NUMNAMES
];

52 
	#FAKE_MAGIC
 ((*)0xbØbØ)

	)

58 
thªad
 *

59 
	$Ákëhªad_¸óã
(c⁄° *
«me
)

61 
thªad
 *
t
;

63 
t
 = 
	`kmÆloc
((*t));

64 i‡(
t
 =
NULL
) {

65 
	`∑nic
("threadlisttest: Out of memory\n");

68 
	`bzîo
(
t
, (*t));

69 
	`°r˝y
(
t
->
t_«me
, 
«me
);

70 
t
->
t_°ack
 = 
FAKE_MAGIC
;

71 
	`thªadli°node_öô
(&
t
->
t_li°node
,Å);

72  
t
;

73 
	}
}

80 
	$Ákëhªad_de°roy
(
thªad
 *
t
)

82 
	`KASSERT
(
t
->
t_°ack
 =
FAKE_MAGIC
);

83 
	`thªadli°node_˛ónup
(&
t
->
t_li°node
);

84 
	`k‰ì
(
t
);

85 
	}
}

92 
	$check_‹dî
(
thªadli°
 *
é
, 
boﬁ
 
ªv
)

94 c⁄° 
°rög0
[] = "...";

95 c⁄° 
°rögN
[] = "~~~";

97 
thªad
 *
t
;

98 c⁄° *
fú°
 = 
ªv
 ? 
°rögN
 : 
°rög0
;

99 c⁄° *
œ°
 = 
ªv
 ? 
°rög0
 : 
°rögN
;

100 c⁄° *
¥ev
;

101 
cmp
;

103 
¥ev
 = 
fú°
;

104 
	`THREADLIST_FORALL
(
t
, *
é
) {

105 
cmp
 = 
	`°rcmp
(
¥ev
, 
t
->
t_«me
);

106 
	`KASSERT
(
ªv
 ? (
cmp
 > 0) : (cmp < 0));

107 
¥ev
 = 
t
->
t_«me
;

109 
cmp
 = 
	`°rcmp
(
¥ev
, 
œ°
);

110 
	`KASSERT
(
ªv
 ? (
cmp
 > 0) : (cmp < 0));

111 
	}
}

118 
	$thªadli°ã°_a
()

120 
thªadli°
 
é
;

122 
	`thªadli°_öô
(&
é
);

123 
	`KASSERT
(
	`thªadli°_i£m±y
(&
é
));

124 
	`thªadli°_˛ónup
(&
é
);

125 
	}
}

129 
	$thªadli°ã°_b
()

131 
thªadli°
 
é
;

132 
thªad
 *
t
;

134 
	`thªadli°_öô
(&
é
);

136 
	`thªadli°_addhód
(&
é
, 
Ákëhªads
[0]);

137 
	`check_‹dî
(&
é
, 
Ál£
);

138 
	`check_‹dî
(&
é
, 
åue
);

139 
	`KASSERT
(
é
.
é_cou¡
 == 1);

140 
t
 = 
	`thªadli°_ªmhód
(&
é
);

141 
	`KASSERT
(
é
.
é_cou¡
 == 0);

142 
	`KASSERT
(
t
 =
Ákëhªads
[0]);

144 
	`thªadli°_addèû
(&
é
, 
Ákëhªads
[0]);

145 
	`check_‹dî
(&
é
, 
Ál£
);

146 
	`check_‹dî
(&
é
, 
åue
);

147 
	`KASSERT
(
é
.
é_cou¡
 == 1);

148 
t
 = 
	`thªadli°_ªmèû
(&
é
);

149 
	`KASSERT
(
é
.
é_cou¡
 == 0);

150 
	`KASSERT
(
t
 =
Ákëhªads
[0]);

152 
	`thªadli°_˛ónup
(&
é
);

153 
	}
}

157 
	$thªadli°ã°_c
()

159 
thªadli°
 
é
;

160 
thªad
 *
t
;

162 
	`thªadli°_öô
(&
é
);

164 
	`thªadli°_addhód
(&
é
, 
Ákëhªads
[0]);

165 
	`thªadli°_addhód
(&
é
, 
Ákëhªads
[1]);

166 
	`KASSERT
(
é
.
é_cou¡
 == 2);

168 
	`check_‹dî
(&
é
, 
åue
);

170 
t
 = 
	`thªadli°_ªmhód
(&
é
);

171 
	`KASSERT
(
t
 =
Ákëhªads
[1]);

172 
t
 = 
	`thªadli°_ªmhód
(&
é
);

173 
	`KASSERT
(
t
 =
Ákëhªads
[0]);

174 
	`KASSERT
(
é
.
é_cou¡
 == 0);

176 
	`thªadli°_addèû
(&
é
, 
Ákëhªads
[0]);

177 
	`thªadli°_addèû
(&
é
, 
Ákëhªads
[1]);

178 
	`KASSERT
(
é
.
é_cou¡
 == 2);

180 
	`check_‹dî
(&
é
, 
Ál£
);

182 
t
 = 
	`thªadli°_ªmèû
(&
é
);

183 
	`KASSERT
(
t
 =
Ákëhªads
[1]);

184 
t
 = 
	`thªadli°_ªmèû
(&
é
);

185 
	`KASSERT
(
t
 =
Ákëhªads
[0]);

186 
	`KASSERT
(
é
.
é_cou¡
 == 0);

188 
	`thªadli°_˛ónup
(&
é
);

189 
	}
}

193 
	$thªadli°ã°_d
()

195 
thªadli°
 
é
;

196 
thªad
 *
t
;

198 
	`thªadli°_öô
(&
é
);

200 
	`thªadli°_addhód
(&
é
, 
Ákëhªads
[0]);

201 
	`thªadli°_addèû
(&
é
, 
Ákëhªads
[1]);

202 
	`KASSERT
(
é
.
é_cou¡
 == 2);

204 
	`check_‹dî
(&
é
, 
Ál£
);

206 
t
 = 
	`thªadli°_ªmhód
(&
é
);

207 
	`KASSERT
(
t
 =
Ákëhªads
[0]);

208 
t
 = 
	`thªadli°_ªmèû
(&
é
);

209 
	`KASSERT
(
t
 =
Ákëhªads
[1]);

210 
	`KASSERT
(
é
.
é_cou¡
 == 0);

212 
	`thªadli°_addhód
(&
é
, 
Ákëhªads
[0]);

213 
	`thªadli°_addèû
(&
é
, 
Ákëhªads
[1]);

214 
	`KASSERT
(
é
.
é_cou¡
 == 2);

216 
	`check_‹dî
(&
é
, 
Ál£
);

218 
t
 = 
	`thªadli°_ªmèû
(&
é
);

219 
	`KASSERT
(
t
 =
Ákëhªads
[1]);

220 
t
 = 
	`thªadli°_ªmèû
(&
é
);

221 
	`KASSERT
(
t
 =
Ákëhªads
[0]);

222 
	`KASSERT
(
é
.
é_cou¡
 == 0);

224 
	`thªadli°_˛ónup
(&
é
);

225 
	}
}

229 
	$thªadli°ã°_e
()

231 
thªadli°
 
é
;

232 
thªad
 *
t
;

233 
i
;

235 
	`thªadli°_öô
(&
é
);

237 
	`thªadli°_addhód
(&
é
, 
Ákëhªads
[1]);

238 
	`thªadli°_addèû
(&
é
, 
Ákëhªads
[3]);

239 
	`KASSERT
(
é
.
é_cou¡
 == 2);

240 
	`check_‹dî
(&
é
, 
Ál£
);

242 
	`thªadli°_ö£πa·î
(&
é
, 
Ákëhªads
[3], fakethreads[4]);

243 
	`KASSERT
(
é
.
é_cou¡
 == 3);

244 
	`check_‹dî
(&
é
, 
Ál£
);

246 
	`thªadli°_ö£πbef‹e
(&
é
, 
Ákëhªads
[0], fakethreads[1]);

247 
	`KASSERT
(
é
.
é_cou¡
 == 4);

248 
	`check_‹dî
(&
é
, 
Ál£
);

250 
	`thªadli°_ö£πa·î
(&
é
, 
Ákëhªads
[1], fakethreads[2]);

251 
	`KASSERT
(
é
.
é_cou¡
 == 5);

252 
	`check_‹dî
(&
é
, 
Ál£
);

254 
	`KASSERT
(
Ákëhªads
[4]->
t_li°node
.
én_¥ev
->
én_£lf
 ==

255 
Ákëhªads
[3]);

256 
	`KASSERT
(
Ákëhªads
[3]->
t_li°node
.
én_¥ev
->
én_£lf
 ==

257 
Ákëhªads
[2]);

258 
	`KASSERT
(
Ákëhªads
[2]->
t_li°node
.
én_¥ev
->
én_£lf
 ==

259 
Ákëhªads
[1]);

260 
	`KASSERT
(
Ákëhªads
[1]->
t_li°node
.
én_¥ev
->
én_£lf
 ==

261 
Ákëhªads
[0]);

263 
i
=0; i<5; i++) {

264 
t
 = 
	`thªadli°_ªmhód
(&
é
);

265 
	`KASSERT
(
t
 =
Ákëhªads
[
i
]);

267 
	`KASSERT
(
é
.
é_cou¡
 == 0);

269 
	`thªadli°_˛ónup
(&
é
);

270 
	}
}

274 
	$thªadli°ã°_f
()

276 
thªadli°
 
é
;

277 
thªad
 *
t
;

278 
i
;

280 
	`thªadli°_öô
(&
é
);

282 
i
=0; i<
NUMNAMES
; i++) {

283 
	`thªadli°_addèû
(&
é
, 
Ákëhªads
[
i
]);

285 
	`KASSERT
(
é
.
é_cou¡
 =
NUMNAMES
);

287 
i
=0;

288 
	`THREADLIST_FORALL
(
t
, 
é
) {

289 
	`KASSERT
(
t
 =
Ákëhªads
[
i
]);

290 
i
++;

292 
	`KASSERT
(
i
 =
NUMNAMES
);

294 
i
=0;

295 
	`THREADLIST_FORALL_REV
(
t
, 
é
) {

296 
	`KASSERT
(
t
 =
Ákëhªads
[
NUMNAMES
 - 
i
 - 1]);

297 
i
++;

299 
	`KASSERT
(
i
 =
NUMNAMES
);

301 
i
=0; i<
NUMNAMES
; i++) {

302 
t
 = 
	`thªadli°_ªmhód
(&
é
);

303 
	`KASSERT
(
t
 =
Ákëhªads
[
i
]);

305 
	`KASSERT
(
é
.
é_cou¡
 == 0);

306 
	}
}

312 
	$thªadli°ã°
(
«rgs
, **
¨gs
)

314 
i
;

316 ()
«rgs
;

317 ()
¨gs
;

319 
	`k¥ötf
("TestingÅhreadlists...\n");

321 
i
=0; i<
NUMNAMES
; i++) {

322 
Ákëhªads
[
i
] = 
	`Ákëhªad_¸óã
(
«mes
[i]);

325 
	`thªadli°ã°_a
();

326 
	`thªadli°ã°_b
();

327 
	`thªadli°ã°_c
();

328 
	`thªadli°ã°_d
();

329 
	`thªadli°ã°_e
();

330 
	`thªadli°ã°_f
();

332 
i
=0; i<
NUMNAMES
; i++) {

333 
	`Ákëhªad_de°roy
(
Ákëhªads
[
i
]);

334 
Ákëhªads
[
i
] = 
NULL
;

337 
	`k¥ötf
("Done.\n");

339 
	}
}

	@/home/trinity/src/kern/test/threadtest.c

33 
	~<ty≥s.h
>

34 
	~<lib.h
>

35 
	~<thªad.h
>

36 
	~<synch.h
>

37 
	~<ã°.h
>

39 
	#NTHREADS
 8

	)

41 
£m≠h‹e
 *
	gt£m
 = 
NULL
;

45 
	$öô_£m
()

47 i‡(
t£m
==
NULL
) {

48 
t£m
 = 
	`£m_¸óã
("tsem", 0);

49 i‡(
t£m
 =
NULL
) {

50 
	`∑nic
("threadtest: sem_create failed\n");

53 
	}
}

57 
	$loudthªad
(*
junk
, 
num
)

59 
ch
 = '0' + 
num
;

60 
i
;

62 ()
junk
;

64 
i
=0; i<120; i++) {

65 
	`putch
(
ch
);

67 
	`V
(
t£m
);

68 
	}
}

82 
	$quõâhªad
(*
junk
, 
num
)

84 
ch
 = '0' + 
num
;

85 vﬁ©ûê
i
;

87 ()
junk
;

89 
	`putch
(
ch
);

90 
i
=0; i<200000; i++);

91 
	`putch
(
ch
);

93 
	`V
(
t£m
);

94 
	}
}

98 
	$ru¡hªads
(
dﬁoud
)

100 
«me
[16];

101 
i
, 
ªsu…
;

103 
i
=0; i<
NTHREADS
; i++) {

104 
	`¢¥ötf
(
«me
, “ame), "thªadã°%d", 
i
);

105 
ªsu…
 = 
	`thªad_f‹k
(
«me
, 
NULL
,

106 
dﬁoud
 ? 
loudthªad
 : 
quõâhªad
,

107 
NULL
, 
i
);

108 i‡(
ªsu…
) {

109 
	`∑nic
("threadtest:Åhread_fork failed %s)\n",

110 
	`°ªº‹
(
ªsu…
));

114 
i
=0; i<
NTHREADS
; i++) {

115 
	`P
(
t£m
);

117 
	}
}

121 
	$thªadã°
(
«rgs
, **
¨gs
)

123 ()
«rgs
;

124 ()
¨gs
;

126 
	`öô_£m
();

127 
	`k¥ötf
("StartingÅhreadÅest...\n");

128 
	`ru¡hªads
(1);

129 
	`k¥ötf
("\nThreadÅest done.\n");

132 
	}
}

135 
	$thªadã°2
(
«rgs
, **
¨gs
)

137 ()
«rgs
;

138 ()
¨gs
;

140 
	`öô_£m
();

141 
	`k¥ötf
("StartingÅhreadÅest 2...\n");

142 
	`ru¡hªads
(0);

143 
	`k¥ötf
("\nThreadÅest 2 done.\n");

146 
	}
}

	@/home/trinity/src/kern/test/tt3.c

33 
	~<ty≥s.h
>

34 
	~<lib.h
>

35 
	~<wch™.h
>

36 
	~<thªad.h
>

37 
	~<synch.h
>

38 
	~<ã°.h
>

42 
	#DIM
 70

	)

45 
	#SLEEPALOT_PRINTS
 20

	)

46 
	#SLEEPALOT_ITERS
 4

	)

48 
	#WAKER_WAKES
 100

	)

50 
	#COMPUTE_ITERS
 10

	)

53 
	#NWAITCHANS
 12

	)

54 
•ölock
 
	g•ölocks
[
NWAITCHANS
];

55 
wch™
 *
	gwaôch™s
[
NWAITCHANS
];

57 vﬁ©ûê
	gwakîd⁄e
;

58 
£m≠h‹e
 *
	gwakî£m
;

59 
£m≠h‹e
 *
	gd⁄e£m
;

63 
	$£tup
()

65 
tmp
[16];

66 
i
;

68 i‡(
wakî£m
 =
NULL
) {

69 
wakî£m
 = 
	`£m_¸óã
("wakersem", 1);

70 
d⁄e£m
 = 
	`£m_¸óã
("donesem", 0);

71 
i
=0; i<
NWAITCHANS
; i++) {

72 
	`•ölock_öô
(&
•ölocks
[
i
]);

73 
	`¢¥ötf
(
tmp
, —mp), "wc%d", 
i
);

74 
waôch™s
[
i
] = 
	`wch™_¸óã
(
	`k°rdup
(
tmp
));

77 
wakîd⁄e
 = 0;

78 
	}
}

82 
	$¶ì∑lŸ_thªad
(*
junk
, 
num
)

84 
i
, 
j
;

86 ()
junk
;

88 
i
=0; i<
SLEEPALOT_PRINTS
; i++) {

89 
j
=0; j<
SLEEPALOT_ITERS
; j++) {

90 
n
;

91 
•ölock
 *
lk
;

92 
wch™
 *
wc
;

94 
n
 = 
	`øndom
(Ë% 
NWAITCHANS
;

95 
lk
 = &
•ölocks
[
n
];

96 
wc
 = 
waôch™s
[
n
];

97 
	`•ölock_acquúe
(
lk
);

98 
	`wch™_¶ìp
(
wc
, 
lk
);

99 
	`•ölock_ªÀa£
(
lk
);

101 
	`k¥ötf
("[%lu]", 
num
);

103 
	`V
(
d⁄e£m
);

104 
	}
}

108 
	$wakî_thªad
(*
junk1
, 
junk2
)

110 
i
, 
d⁄e
;

112 ()
junk1
;

113 ()
junk2
;

116 
	`P
(
wakî£m
);

117 
d⁄e
 = 
wakîd⁄e
;

118 
	`V
(
wakî£m
);

119 i‡(
d⁄e
) {

123 
i
=0; i<
WAKER_WAKES
; i++) {

124 
n
;

125 
•ölock
 *
lk
;

126 
wch™
 *
wc
;

128 
n
 = 
	`øndom
(Ë% 
NWAITCHANS
;

129 
lk
 = &
•ölocks
[
n
];

130 
wc
 = 
waôch™s
[
n
];

131 
	`•ölock_acquúe
(
lk
);

132 
	`wch™_wakóŒ
(
wc
, 
lk
);

133 
	`•ölock_ªÀa£
(
lk
);

135 
	`thªad_yõld
();

138 
	`V
(
d⁄e£m
);

139 
	}
}

143 
	$make_¶ì∑lŸs
(
howm™y
)

145 
«me
[16];

146 
i
, 
ªsu…
;

148 
i
=0; i<
howm™y
; i++) {

149 
	`¢¥ötf
(
«me
, “ame), "¶ì∑lŸ%d", 
i
);

150 
ªsu…
 = 
	`thªad_f‹k
(
«me
, 
NULL
, 
¶ì∑lŸ_thªad
, NULL, 
i
);

151 i‡(
ªsu…
) {

152 
	`∑nic
("thªad_f‹k faûed: %s\n", 
	`°ªº‹
(
ªsu…
));

155 
ªsu…
 = 
	`thªad_f‹k
("wakî", 
NULL
, 
wakî_thªad
, NULL, 0);

156 i‡(
ªsu…
) {

157 
	`∑nic
("thªad_f‹k faûed: %s\n", 
	`°ªº‹
(
ªsu…
));

159 
	}
}

163 
	$compuã_thªad
(*
junk1
, 
num
)

165 
	sm©rix
 {

166 
m
[
DIM
][DIM];

168 
m©rix
 *
m1
, *
m2
, *
m3
;

169 
tŸ
;

170 
i
, 
j
, 
k
, 
m
;

171 
uöt32_t
 
ønd
;

173 ()
junk1
;

175 
m1
 = 
	`kmÆloc
((
m©rix
));

176 
	`KASSERT
(
m1
 !
NULL
);

177 
m2
 = 
	`kmÆloc
((
m©rix
));

178 
	`KASSERT
(
m2
 !
NULL
);

179 
m3
 = 
	`kmÆloc
((
m©rix
));

180 
	`KASSERT
(
m3
 !
NULL
);

182 
m
=0; m<
COMPUTE_ITERS
; m++) {

184 
i
=0; i<
DIM
; i++) {

185 
j
=0; j<
DIM
; j++) {

186 
ønd
 = 
	`øndom
();

187 
m1
->
m
[
i
][
j
] = 
ønd
 >> 16;

188 
m2
->
m
[
i
][
j
] = 
ønd
 & 0xffff;

192 
i
=0; i<
DIM
; i++) {

193 
j
=0; j<
DIM
; j++) {

194 
tŸ
 = 0;

195 
k
=0; k<
DIM
; k++) {

196 
tŸ
 +
m1
->
m
[
i
][
k
] * 
m2
->m[k][
j
];

198 
m3
->
m
[
i
][
j
] = 
tŸ
;

202 
tŸ
 = 0;

203 
i
=0; i<
DIM
; i++) {

204 
tŸ
 +
m3
->
m
[
i
][i];

207 
	`k¥ötf
("{%lu: %u}", 
num
, (Ë
tŸ
);

208 
	`thªad_yõld
();

211 
	`k‰ì
(
m1
);

212 
	`k‰ì
(
m2
);

213 
	`k‰ì
(
m3
);

215 
	`V
(
d⁄e£m
);

216 
	}
}

220 
	$make_compuãs
(
howm™y
)

222 
«me
[16];

223 
i
, 
ªsu…
;

225 
i
=0; i<
howm™y
; i++) {

226 
	`¢¥ötf
(
«me
, “ame), "compuã%d", 
i
);

227 
ªsu…
 = 
	`thªad_f‹k
(
«me
, 
NULL
, 
compuã_thªad
, NULL, 
i
);

228 i‡(
ªsu…
) {

229 
	`∑nic
("thªad_f‹k faûed: %s\n", 
	`°ªº‹
(
ªsu…
));

232 
	}
}

236 
	$föish
(
howm™ytŸÆ
)

238 
i
;

239 
i
=0; i<
howm™ytŸÆ
; i++) {

240 
	`P
(
d⁄e£m
);

242 
	`P
(
wakî£m
);

243 
wakîd⁄e
 = 1;

244 
	`V
(
wakî£m
);

245 
	`P
(
d⁄e£m
);

246 
	}
}

250 
	$ru¡e°3
(
n¶ìps
, 
ncompuãs
)

252 
	`£tup
();

253 
	`k¥ötf
("StartingÅhreadÅest 3 (%d [sleepalots], %d {computes}, "

255 
n¶ìps
, 
ncompuãs
);

256 
	`make_¶ì∑lŸs
(
n¶ìps
);

257 
	`make_compuãs
(
ncompuãs
);

258 
	`föish
(
n¶ìps
+
ncompuãs
);

259 
	`k¥ötf
("\nThreadÅest 3 done\n");

260 
	}
}

263 
	$thªadã°3
(
«rgs
, **
¨gs
)

265 i‡(
«rgs
==1) {

266 
	`ru¡e°3
(5, 2);

268 i‡(
«rgs
==3) {

269 
	`ru¡e°3
(
	`©oi
(
¨gs
[1]),átoi(args[2]));

272 
	`k¥ötf
("Usage:Åt3 [sleepthreads computethreads]\n");

276 
	}
}

	@/home/trinity/src/kern/thread/clock.c

30 
	~<ty≥s.h
>

31 
	~<lib.h
>

32 
	~<˝u.h
>

33 
	~<wch™.h
>

34 
	~<˛ock.h
>

35 
	~<thªad.h
>

36 
	~<cuºít.h
>

53 
	#SCHEDULE_HARDCLOCKS
 4

	)

54 
	#MIGRATE_HARDCLOCKS
 16

	)

59 
wch™
 *
	glbﬁt
;

60 
•ölock
 
	glbﬁt_lock
;

66 
	$h¨d˛ock_boŸ°øp
()

68 
	`•ölock_öô
(&
lbﬁt_lock
);

69 
lbﬁt
 = 
	`wch™_¸óã
("lbolt");

70 i‡(
lbﬁt
 =
NULL
) {

71 
	`∑nic
("Couldn't createÜbolt\n");

73 
	}
}

80 
	$timî˛ock
()

83 
	`•ölock_acquúe
(&
lbﬁt_lock
);

84 
	`wch™_wakóŒ
(
lbﬁt
, &
lbﬁt_lock
);

85 
	`•ölock_ªÀa£
(&
lbﬁt_lock
);

86 
	}
}

93 
	$h¨d˛ock
()

99 
cur˝u
->
c_h¨d˛ocks
++;

100 i‡((
cur˝u
->
c_h¨d˛ocks
 % 
MIGRATE_HARDCLOCKS
) == 0) {

101 
	`thªad_c⁄sidî_migøti⁄
();

103 i‡((
cur˝u
->
c_h¨d˛ocks
 % 
SCHEDULE_HARDCLOCKS
) == 0) {

104 
	`scheduÀ
();

106 
	`thªad_yõld
();

107 
	}
}

113 
	$˛ock¶ìp
(
num_£cs
)

115 
	`•ölock_acquúe
(&
lbﬁt_lock
);

116 
num_£cs
 > 0) {

117 
	`wch™_¶ìp
(
lbﬁt
, &
lbﬁt_lock
);

118 
num_£cs
--;

120 
	`•ölock_ªÀa£
(&
lbﬁt_lock
);

121 
	}
}

	@/home/trinity/src/kern/thread/hangman.c

34 
	~<ty≥s.h
>

35 
	~<lib.h
>

36 
	~<•l.h
>

37 
	~<•ölock.h
>

38 
	~<h™gm™.h
>

40 
•ölock
 
	gh™gm™_lock
 = 
SPINLOCK_INITIALIZER
;

52 
	$h™gm™_check
(c⁄° 
h™gm™_lockabÀ
 *
°¨t
,

53 c⁄° 
h™gm™_a˘‹
 *
èrgë
)

55 c⁄° 
h™gm™_a˘‹
 *
cur
;

57 
cur
 = 
°¨t
->
l_hﬁdög
;

58 
cur
 !
NULL
) {

59 i‡(
cur
 =
èrgë
) {

60 
found
;

62 i‡(
cur
->
a_waôög
 =
NULL
) {

65 
cur
 = cur->
a_waôög
->
l_hﬁdög
;

69 
found
:

78 
	`•lhigh
();

79 
	`•ölock_ªÀa£
(&
h™gm™_lock
);

81 
	`k¥ötf
("hangman: DetectedÜock cycle!\n");

82 
	`k¥ötf
("h™gm™: i¿%†(%p);\n", 
èrgë
->
a_«me
,Åarget);

83 
	`k¥ötf
("h™gm™: waôög f‹ %†(%p), but:\n", 
°¨t
->
l_«me
, start);

84 
	`k¥ötf
("ÜockabÀ %†(%p)\n", 
°¨t
->
l_«me
, start);

85 
cur
 = 
°¨t
->
l_hﬁdög
;

86 
cur
 !
èrgë
) {

87 
	`k¥ötf
(" hñd byá˘‹ %†(%p)\n", 
cur
->
a_«me
, cur);

88 
	`k¥ötf
(" waiting forÜockable %s (%p)\n",

89 
cur
->
a_waôög
->
l_«me
, cur->a_waiting);

90 
cur
 = cur->
a_waôög
->
l_hﬁdög
;

92 
	`k¥ötf
(" hñd byá˘‹ %†(%p)\n", 
cur
->
a_«me
, cur);

93 
	`∑nic
("Deadlock.\n");

94 
	}
}

110 
	$h™gm™_waô
(
h™gm™_a˘‹
 *
a
,

111 
h™gm™_lockabÀ
 *
l
)

113 i‡(
l
 =&
h™gm™_lock
.
•lk_h™gm™
) {

118 
	`•ölock_acquúe
(&
h™gm™_lock
);

120 i‡(
a
->
a_waôög
 !
NULL
) {

121 
	`•ölock_ªÀa£
(&
h™gm™_lock
);

122 
	`∑nic
("hangman_wait:álready waiting for something?\n");

125 
	`h™gm™_check
(
l
, 
a
);

126 
a
->
a_waôög
 = 
l
;

128 
	`•ölock_ªÀa£
(&
h™gm™_lock
);

129 
	}
}

132 
	$h™gm™_acquúe
(
h™gm™_a˘‹
 *
a
,

133 
h™gm™_lockabÀ
 *
l
)

135 i‡(
l
 =&
h™gm™_lock
.
•lk_h™gm™
) {

140 
	`•ölock_acquúe
(&
h™gm™_lock
);

142 i‡(
a
->
a_waôög
 !
l
) {

143 
	`•ölock_ªÀa£
(&
h™gm™_lock
);

144 
	`∑nic
("hangman_acquire:Çot waiting forÜock %s (%p)\n",

145 
l
->
l_«me
,Ü);

147 i‡(
l
->
l_hﬁdög
 !
NULL
) {

148 
	`•ölock_ªÀa£
(&
h™gm™_lock
);

149 
	`∑nic
("hangman_acquire:Üock %s (%p) still held by %s (%p)\n",

150 
l
->
l_«me
,Ü, 
a
->
a_«me
,á);

153 
l
->
l_hﬁdög
 = 
a
;

154 
a
->
a_waôög
 = 
NULL
;

156 
	`•ölock_ªÀa£
(&
h™gm™_lock
);

157 
	}
}

160 
	$h™gm™_ªÀa£
(
h™gm™_a˘‹
 *
a
,

161 
h™gm™_lockabÀ
 *
l
)

163 i‡(
l
 =&
h™gm™_lock
.
•lk_h™gm™
) {

168 
	`•ölock_acquúe
(&
h™gm™_lock
);

170 i‡(
a
->
a_waôög
 !
NULL
) {

171 
	`•ölock_ªÀa£
(&
h™gm™_lock
);

172 
	`∑nic
("hangman_release: waiting for something?\n");

174 i‡(
l
->
l_hﬁdög
 !
a
) {

175 
	`•ölock_ªÀa£
(&
h™gm™_lock
);

176 
	`∑nic
("hangman_release:ÇotÅhe holder\n");

179 
l
->
l_hﬁdög
 = 
NULL
;

181 
	`•ölock_ªÀa£
(&
h™gm™_lock
);

182 
	}
}

	@/home/trinity/src/kern/thread/spinlock.c

31 
	#SPINLOCK_INLINE


	)

32 
	#MEMBAR_INLINE


	)

34 
	~<ty≥s.h
>

35 
	~<lib.h
>

36 
	~<˝u.h
>

37 
	~<•l.h
>

38 
	~<•ölock.h
>

39 
	~<memb¨.h
>

40 
	~<cuºít.h
>

51 
	$•ölock_öô
(
•ölock
 *
•lk
)

53 
	`•ölock_d©a_£t
(&
•lk
->
•lk_lock
, 0);

54 
•lk
->
•lk_hﬁdî
 = 
NULL
;

55 
	`HANGMAN_LOCKABLEINIT
(&
•lk
->
•lk_h™gm™
, "spinlock");

56 
	}
}

62 
	$•ölock_˛ónup
(
•ölock
 *
•lk
)

64 
	`KASSERT
(
•lk
->
•lk_hﬁdî
 =
NULL
);

65 
	`KASSERT
(
	`•ölock_d©a_gë
(&
•lk
->
•lk_lock
) == 0);

66 
	}
}

76 
	$•ölock_acquúe
(
•ölock
 *
•lk
)

78 
˝u
 *
my˝u
;

80 
	`•Ãai£
(
IPL_NONE
, 
IPL_HIGH
);

83 i‡(
	`CURCPU_EXISTS
()) {

84 
my˝u
 = 
cur˝u
->
c_£lf
;

85 i‡(
•lk
->
•lk_hﬁdî
 =
my˝u
) {

86 
	`∑nic
("Dódlock o¿•ölock %p\n", 
•lk
);

88 
my˝u
->
c_•ölocks
++;

90 
	`HANGMAN_WAIT
(&
cur˝u
->
c_h™gm™
, &
•lk
->
•lk_h™gm™
);

93 
my˝u
 = 
NULL
;

107 i‡(
	`•ölock_d©a_gë
(&
•lk
->
•lk_lock
) != 0) {

110 i‡(
	`•ölock_d©a_ã°™d£t
(&
•lk
->
•lk_lock
) != 0) {

116 
	`memb¨_°‹e_™y
();

117 
•lk
->
•lk_hﬁdî
 = 
my˝u
;

119 i‡(
	`CURCPU_EXISTS
()) {

120 
	`HANGMAN_ACQUIRE
(&
cur˝u
->
c_h™gm™
, &
•lk
->
•lk_h™gm™
);

122 
	}
}

128 
	$•ölock_ªÀa£
(
•ölock
 *
•lk
)

131 i‡(
	`CURCPU_EXISTS
()) {

132 
	`KASSERT
(
•lk
->
•lk_hﬁdî
 =
cur˝u
->
c_£lf
);

133 
	`KASSERT
(
cur˝u
->
c_•ölocks
 > 0);

134 
cur˝u
->
c_•ölocks
--;

135 
	`HANGMAN_RELEASE
(&
cur˝u
->
c_h™gm™
, &
•lk
->
•lk_h™gm™
);

138 
•lk
->
•lk_hﬁdî
 = 
NULL
;

139 
	`memb¨_™y_°‹e
();

140 
	`•ölock_d©a_£t
(&
•lk
->
•lk_lock
, 0);

141 
	`•Œowî
(
IPL_HIGH
, 
IPL_NONE
);

142 
	}
}

147 
boﬁ


148 
	$•ölock_do_i_hﬁd
(
•ölock
 *
•lk
)

150 i‡(!
	`CURCPU_EXISTS
()) {

151  
åue
;

155  (
•lk
->
•lk_hﬁdî
 =
cur˝u
->
c_£lf
);

156 
	}
}

	@/home/trinity/src/kern/thread/spl.c

31 
	#SPL_INLINE


	)

33 
	~<ty≥s.h
>

34 
	~<lib.h
>

35 
	~<˝u.h
>

36 
	~<•l.h
>

37 
	~<thªad.h
>

38 
	~<cuºít.h
>

87 
	$•Ãai£
(
ﬁd•l
, 
√w•l
)

89 
thªad
 *
cur
 = 
cuπhªad
;

92 
	`KASSERT
(
ﬁd•l
 =
IPL_NONE
);

93 
	`KASSERT
(
√w•l
 =
IPL_HIGH
);

95 i‡(!
	`CURCPU_EXISTS
()) {

100 i‡(
cur
->
t_ùlhigh_cou¡
 == 0) {

101 
	`˝u_úqoff
();

103 
cur
->
t_ùlhigh_cou¡
++;

104 
	}
}

107 
	$•Œowî
(
ﬁd•l
, 
√w•l
)

109 
thªad
 *
cur
 = 
cuπhªad
;

112 
	`KASSERT
(
ﬁd•l
 =
IPL_HIGH
);

113 
	`KASSERT
(
√w•l
 =
IPL_NONE
);

115 i‡(!
	`CURCPU_EXISTS
()) {

120 
cur
->
t_ùlhigh_cou¡
--;

121 i‡(
cur
->
t_ùlhigh_cou¡
 == 0) {

122 
	`˝u_úq⁄
();

124 
	}
}

132 
	$•lx
(
•l
)

134 
thªad
 *
cur
 = 
cuπhªad
;

135 
ªt
;

137 i‡(!
	`CURCPU_EXISTS
()) {

139  
•l
;

142 i‡(
cur
->
t_cur•l
 < 
•l
) {

144 
	`•Ãai£
(
cur
->
t_cur•l
, 
•l
);

145 
ªt
 = 
cur
->
t_cur•l
;

146 
cur
->
t_cur•l
 = 
•l
;

148 i‡(
cur
->
t_cur•l
 > 
•l
) {

150 
ªt
 = 
cur
->
t_cur•l
;

151 
cur
->
t_cur•l
 = 
•l
;

152 
	`•Œowî
(
ªt
, 
•l
);

156 
ªt
 = 
•l
;

159  
ªt
;

160 
	}
}

	@/home/trinity/src/kern/thread/synch.c

36 
	~<ty≥s.h
>

37 
	~<lib.h
>

38 
	~<•ölock.h
>

39 
	~<wch™.h
>

40 
	~<thªad.h
>

41 
	~<cuºít.h
>

42 
	~<synch.h
>

48 
£m≠h‹e
 *

49 
	$£m_¸óã
(c⁄° *
«me
, 
öôül_cou¡
)

51 
£m≠h‹e
 *
£m
;

53 
£m
 = 
	`kmÆloc
((*sem));

54 i‡(
£m
 =
NULL
) {

55  
NULL
;

58 
£m
->
£m_«me
 = 
	`k°rdup
(
«me
);

59 i‡(
£m
->
£m_«me
 =
NULL
) {

60 
	`k‰ì
(
£m
);

61  
NULL
;

64 
£m
->
£m_wch™
 = 
	`wch™_¸óã
(£m->
£m_«me
);

65 i‡(
£m
->
£m_wch™
 =
NULL
) {

66 
	`k‰ì
(
£m
->
£m_«me
);

67 
	`k‰ì
(
£m
);

68  
NULL
;

71 
	`•ölock_öô
(&
£m
->
£m_lock
);

72 
£m
->
£m_cou¡
 = 
öôül_cou¡
;

74  
£m
;

75 
	}
}

78 
	$£m_de°roy
(
£m≠h‹e
 *
£m
)

80 
	`KASSERT
(
£m
 !
NULL
);

83 
	`•ölock_˛ónup
(&
£m
->
£m_lock
);

84 
	`wch™_de°roy
(
£m
->
£m_wch™
);

85 
	`k‰ì
(
£m
->
£m_«me
);

86 
	`k‰ì
(
£m
);

87 
	}
}

90 
	$P
(
£m≠h‹e
 *
£m
)

92 
	`KASSERT
(
£m
 !
NULL
);

100 
	`KASSERT
(
cuπhªad
->
t_ö_öãºu±
 =
Ál£
);

103 
	`•ölock_acquúe
(&
£m
->
£m_lock
);

104 
£m
->
£m_cou¡
 == 0) {

117 
	`wch™_¶ìp
(
£m
->
£m_wch™
, &£m->
£m_lock
);

119 
	`KASSERT
(
£m
->
£m_cou¡
 > 0);

120 
£m
->
£m_cou¡
--;

121 
	`•ölock_ªÀa£
(&
£m
->
£m_lock
);

122 
	}
}

125 
	$V
(
£m≠h‹e
 *
£m
)

127 
	`KASSERT
(
£m
 !
NULL
);

129 
	`•ölock_acquúe
(&
£m
->
£m_lock
);

131 
£m
->
£m_cou¡
++;

132 
	`KASSERT
(
£m
->
£m_cou¡
 > 0);

133 
	`wch™_wake⁄e
(
£m
->
£m_wch™
, &£m->
£m_lock
);

135 
	`•ölock_ªÀa£
(&
£m
->
£m_lock
);

136 
	}
}

142 
lock
 *

143 
	$lock_¸óã
(c⁄° *
«me
)

145 
lock
 *lock;

147 
lock
 = 
	`kmÆloc
((*lock));

148 i‡(
lock
 =
NULL
) {

149  
NULL
;

152 
lock
->
lk_«me
 = 
	`k°rdup
(
«me
);

153 i‡(
lock
->
lk_«me
 =
NULL
) {

154 
	`k‰ì
(
lock
);

155  
NULL
;

158 
	`HANGMAN_LOCKABLEINIT
(&
lock
->
lk_h™gm™
,Üock->
lk_«me
);

161 
lock
->
lock_cou¡
 = 0;

163  
lock
;

164 
	}
}

167 
	$lock_de°roy
(
lock
 *lock)

169 
	`KASSERT
(
lock
 !
NULL
);

173 
	`k‰ì
(
lock
->
lk_«me
);

174 
	`k‰ì
(
lock
);

175 
	}
}

178 
	$lock_acquúe
(
lock
 *lock)

181 
	`HANGMAN_WAIT
(&
cuπhªad
->
t_h™gm™
, &
lock
->
lk_h™gm™
);

186 
lock
->
lock_cou¡
)

188 
lock
->
lock_cou¡
++;

189 
	`°r˝y
(
lock
->
thªad_«me
, (c⁄° *Ë&
cuπhªad
->
t_«me
);

192 
	`HANGMAN_ACQUIRE
(&
cuπhªad
->
t_h™gm™
, &
lock
->
lk_h™gm™
);

193 
	}
}

196 
	$lock_ªÀa£
(
lock
 *lock)

199 
	`HANGMAN_RELEASE
(&
cuπhªad
->
t_h™gm™
, &
lock
->
lk_h™gm™
);

204 i‡(!
	`°rcmp
(
lock
->
thªad_«me
, (c⁄° *Ë&
cuπhªad
->
t_«me
))

206 
lock
->
lock_cou¡
--;

207 
	`°r˝y
(
lock
->
thªad_«me
, 
NULL
);

210 
	}
}

212 
boﬁ


213 
	$lock_do_i_hﬁd
(
lock
 *lock)

219 i‡(!
	`°rcmp
(
lock
->
thªad_«me
, (c⁄° *Ë&
cuπhªad
->
t_«me
))

222  
åue
;

227  
Ál£
;

230 
	}
}

237 
cv
 *

238 
	$cv_¸óã
(c⁄° *
«me
)

240 
cv
 *cv;

242 
cv
 = 
	`kmÆloc
((*cv));

243 i‡(
cv
 =
NULL
) {

244  
NULL
;

247 
cv
->
cv_«me
 = 
	`k°rdup
(
«me
);

248 i‡(
cv
->
cv_«me
==
NULL
) {

249 
	`k‰ì
(
cv
);

250  
NULL
;

255  
cv
;

256 
	}
}

259 
	$cv_de°roy
(
cv
 *cv)

261 
	`KASSERT
(
cv
 !
NULL
);

265 
	`k‰ì
(
cv
->
cv_«me
);

266 
	`k‰ì
(
cv
);

267 
	}
}

270 
	$cv_waô
(
cv
 *cv, 
lock
 *lock)

273 ()
cv
;

274 ()
lock
;

275 
	}
}

278 
	$cv_sig«l
(
cv
 *cv, 
lock
 *lock)

281 ()
cv
;

282 ()
lock
;

283 
	}
}

286 
	$cv_brﬂdˇ°
(
cv
 *cv, 
lock
 *lock)

289 ()
cv
;

290 ()
lock
;

291 
	}
}

	@/home/trinity/src/kern/thread/thread.c

34 
	#THREADINLINE


	)

36 
	~<ty≥s.h
>

37 
	~<kîn/î∫o.h
>

38 
	~<lib.h
>

39 
	~<¨øy.h
>

40 
	~<˝u.h
>

41 
	~<•l.h
>

42 
	~<•ölock.h
>

43 
	~<wch™.h
>

44 
	~<thªad.h
>

45 
	~<thªadli°.h
>

46 
	~<thªad¥iv©e.h
>

47 
	~<¥oc.h
>

48 
	~<cuºít.h
>

49 
	~<synch.h
>

50 
	~<addr•a˚.h
>

51 
	~<maöbus.h
>

52 
	~<vnode.h
>

56 
	#THREAD_STACK_MAGIC
 0xbØdf00d

	)

59 
	swch™
 {

60 c⁄° *
	mwc_«me
;

61 
thªadli°
 
	mwc_thªads
;

65 
DECLARRAY
(
˝u
, 
__UNUSED
 
ölöe
);

66 
DEFARRAY
(
˝u
, 
__UNUSED
 
ölöe
);

67 
˝u¨øy
 
	gÆl˝us
;

68 
	gnum_˝us
;

71 
£m≠h‹e
 *
	g˝u_°¨tup_£m
;

74 
	gthªad_cou¡
 = 0;

75 
•ölock
 
	gthªad_cou¡_lock
 = 
SPINLOCK_INITIALIZER
;

76 
wch™
 *
	gthªad_cou¡_wch™
;

87 
	$thªad_check°ack_öô
(
thªad
 *thread)

89 ((
uöt32_t
 *)
thªad
->
t_°ack
)[0] = 
THREAD_STACK_MAGIC
;

90 ((
uöt32_t
 *)
thªad
->
t_°ack
)[1] = 
THREAD_STACK_MAGIC
;

91 ((
uöt32_t
 *)
thªad
->
t_°ack
)[2] = 
THREAD_STACK_MAGIC
;

92 ((
uöt32_t
 *)
thªad
->
t_°ack
)[3] = 
THREAD_STACK_MAGIC
;

93 
	}
}

107 
	$thªad_check°ack
(
thªad
 *thread)

109 i‡(
thªad
->
t_°ack
 !
NULL
) {

110 
	`KASSERT
(((
uöt32_t
*)
thªad
->
t_°ack
)[0] =
THREAD_STACK_MAGIC
);

111 
	`KASSERT
(((
uöt32_t
*)
thªad
->
t_°ack
)[1] =
THREAD_STACK_MAGIC
);

112 
	`KASSERT
(((
uöt32_t
*)
thªad
->
t_°ack
)[2] =
THREAD_STACK_MAGIC
);

113 
	`KASSERT
(((
uöt32_t
*)
thªad
->
t_°ack
)[3] =
THREAD_STACK_MAGIC
);

115 
	}
}

122 
thªad
 *

123 
	$thªad_¸óã
(c⁄° *
«me
)

125 
thªad
 *thread;

127 
	`DEBUGASSERT
(
«me
 !
NULL
);

128 i‡(
	`°æí
(
«me
Ë> 
MAX_NAME_LENGTH
) {

129  
NULL
;

132 
thªad
 = 
	`kmÆloc
((*thread));

133 i‡(
thªad
 =
NULL
) {

134  
NULL
;

137 
	`°r˝y
(
thªad
->
t_«me
, 
«me
);

138 
thªad
->
t_wch™_«me
 = "NEW";

139 
thªad
->
t_°©e
 = 
S_READY
;

142 
	`thªad_machdï_öô
(&
thªad
->
t_machdï
);

143 
	`thªadli°node_öô
(&
thªad
->
t_li°node
,Åhread);

144 
thªad
->
t_°ack
 = 
NULL
;

145 
thªad
->
t_c⁄ãxt
 = 
NULL
;

146 
thªad
->
t_˝u
 = 
NULL
;

147 
thªad
->
t_¥oc
 = 
NULL
;

148 
	`HANGMAN_ACTORINIT
(&
thªad
->
t_h™gm™
,Åhªad->
t_«me
);

151 
thªad
->
t_ö_öãºu±
 = 
Ál£
;

152 
thªad
->
t_cur•l
 = 
IPL_HIGH
;

153 
thªad
->
t_ùlhigh_cou¡
 = 1;

157  
thªad
;

158 
	}
}

168 
˝u
 *

169 
	$˝u_¸óã
(
h¨dw¨e_numbî
)

171 
˝u
 *
c
;

172 
ªsu…
;

173 
«mebuf
[16];

175 
c
 = 
	`kmÆloc
((*c));

176 i‡(
c
 =
NULL
) {

177 
	`∑nic
("cpu_create: Out of memory\n");

180 
c
->
c_£lf
 = c;

181 
c
->
c_h¨dw¨e_numbî
 = 
h¨dw¨e_numbî
;

183 
c
->
c_cuπhªad
 = 
NULL
;

184 
	`thªadli°_öô
(&
c
->
c_zombõs
);

185 
c
->
c_h¨d˛ocks
 = 0;

186 
c
->
c_•ölocks
 = 0;

188 
c
->
c_isidÀ
 = 
Ál£
;

189 
	`thªadli°_öô
(&
c
->
c_runqueue
);

190 
	`•ölock_öô
(&
c
->
c_runqueue_lock
);

192 
c
->
c_ùi_≥ndög
 = 0;

193 
c
->
c_numshoŸdown
 = 0;

194 
	`•ölock_öô
(&
c
->
c_ùi_lock
);

196 
ªsu…
 = 
	`˝u¨øy_add
(&
Æl˝us
, 
c
, &c->
c_numbî
);

197 i‡(
ªsu…
 != 0) {

198 
	`∑nic
("˝u_¸óã:áºay_add: %s\n", 
	`°ªº‹
(
ªsu…
));

201 
	`¢¥ötf
(
«mebuf
, “amebuf), "<boŸ #%d>", 
c
->
c_numbî
);

202 
c
->
c_cuπhªad
 = 
	`thªad_¸óã
(
«mebuf
);

203 i‡(
c
->
c_cuπhªad
 =
NULL
) {

204 
	`∑nic
("cpu_create:Åhread_create failed\n");

206 
c
->
c_cuπhªad
->
t_˝u
 = c;

208 i‡(
c
->
c_numbî
 == 0) {

218 
c
->
c_cuπhªad
->
t_°ack
 = 
	`kmÆloc
(
STACK_SIZE
);

219 i‡(
c
->
c_cuπhªad
->
t_°ack
 =
NULL
) {

220 
	`∑nic
("cpu_create: couldn'tállocate stack");

222 
	`thªad_check°ack_öô
(
c
->
c_cuπhªad
);

231 i‡(!
	`CURCPU_EXISTS
()) {

237 
	`INIT_CURCPU
(
c
, c->
c_cuπhªad
);

244 
cuπhªad
->
t_˝u
 = 
cur˝u
;

245 
cur˝u
->
c_cuπhªad
 = 
cuπhªad
;

248 
	`HANGMAN_ACTORINIT
(&
c
->
c_h™gm™
, "cpu");

250 
ªsu…
 = 
	`¥oc_addthªad
(
k¥oc
, 
c
->
c_cuπhªad
);

251 i‡(
ªsu…
) {

252 
	`∑nic
("˝u_¸óã:Öroc_addthªad:: %s\n", 
	`°ªº‹
(
ªsu…
));

255 
	`˝u_machdï_öô
(
c
);

257  
c
;

258 
	}
}

273 
	$thªad_de°roy
(
thªad
 *thread)

275 
	`KASSERT
(
thªad
 !
cuπhªad
);

276 
	`KASSERT
(
thªad
->
t_°©e
 !
S_RUN
);

279 
	`KASSERT
(
thªad
->
t_¥oc
 =
NULL
);

280 i‡(
thªad
->
t_°ack
 !
NULL
) {

281 
	`k‰ì
(
thªad
->
t_°ack
);

283 
	`thªadli°node_˛ónup
(&
thªad
->
t_li°node
);

284 
	`thªad_machdï_˛ónup
(&
thªad
->
t_machdï
);

287 
thªad
->
t_wch™_«me
 = "DESTROYED";

289 
	`k‰ì
(
thªad
);

290 
	}
}

300 
	$ex‹ci£
()

302 
thªad
 *
z
;

304 (
z
 = 
	`thªadli°_ªmhód
(&
cur˝u
->
c_zombõs
)Ë!
NULL
) {

305 
	`KASSERT
(
z
 !
cuπhªad
);

306 
	`KASSERT
(
z
->
t_°©e
 =
S_ZOMBIE
);

307 
	`thªad_de°roy
(
z
);

309 
	}
}

317 
	$thªad_∑nic
()

324 
	`ùi_brﬂdˇ°
(
IPI_PANIC
);

333 
cur˝u
->
c_runqueue
.
é_cou¡
 = 0;

334 
cur˝u
->
c_runqueue
.
é_hód
.
én_√xt
 = &cur˝u->c_runqueue.
é_èû
;

335 
cur˝u
->
c_runqueue
.
é_èû
.
én_¥ev
 = &cur˝u->c_runqueue.
é_hód
;

353 
	}
}

359 
	$thªad_shutdown
()

367 
	`ùi_brﬂdˇ°
(
IPI_OFFLINE
);

368 
	}
}

374 
	$thªad_boŸ°øp
()

376 
	`˝u¨øy_öô
(&
Æl˝us
);

386 
	`KASSERT
(
	`CURCPU_EXISTS
(Ë=
Ál£
);

387 ()
	`˝u_¸óã
(0);

388 
	`KASSERT
(
	`CURCPU_EXISTS
(Ë=
åue
);

391 
	`KASSERT
(
cur˝u
 !
NULL
);

392 
	`KASSERT
(
cuπhªad
 !
NULL
);

393 
	`KASSERT
(
cuπhªad
->
t_¥oc
 !
NULL
);

394 
	`KASSERT
(
cuπhªad
->
t_¥oc
 =
k¥oc
);

397 
	}
}

408 
	$˝u_h©ch
(
so·w¨e_numbî
)

410 
buf
[64];

412 
	`KASSERT
(
cur˝u
 !
NULL
);

413 
	`KASSERT
(
cuπhªad
 !
NULL
);

414 
	`KASSERT
(
cur˝u
->
c_numbî
 =
so·w¨e_numbî
);

416 
	`•l0
();

417 
	`˝u_idítify
(
buf
, (buf));

419 
	`V
(
˝u_°¨tup_£m
);

420 
	`thªad_exô
();

421 
	}
}

427 
	$thªad_°¨t_˝us
()

429 
buf
[64];

430 
i
;

432 
	`˝u_idítify
(
buf
, (buf));

433 
	`k¥ötf
("˝u0: %s\n", 
buf
);

435 
˝u_°¨tup_£m
 = 
	`£m_¸óã
("cpu_hatch", 0);

436 
thªad_cou¡_wch™
 = 
	`wch™_¸óã
("thread_count");

437 
	`maöbus_°¨t_˝us
();

439 
num_˝us
 = 
	`˝u¨øy_num
(&
Æl˝us
);

440 
i
=0; i<
num_˝us
 - 1; i++) {

441 
	`P
(
˝u_°¨tup_£m
);

443 
	`£m_de°roy
(
˝u_°¨tup_£m
);

444 i‡(
i
 == 0) {

445 
	`k¥ötf
("1 CPU online\n");

447 
	`k¥ötf
("%d CPU†⁄löe\n", 
i
 + 1);

449 
˝u_°¨tup_£m
 = 
NULL
;

455 
thªad_cou¡
 = 1;

456 
	}
}

465 
	$thªad_make_ru¬abÀ
(
thªad
 *
èrgë
, 
boﬁ
 
Æªady_have_lock
)

467 
˝u
 *
èrgë˝u
;

470 
èrgë˝u
 = 
èrgë
->
t_˝u
;

472 i‡(
Æªady_have_lock
) {

474 
	`KASSERT
(
	`•ölock_do_i_hﬁd
(&
èrgë˝u
->
c_runqueue_lock
));

477 
	`•ölock_acquúe
(&
èrgë˝u
->
c_runqueue_lock
);

481 
èrgë
->
t_°©e
 = 
S_READY
;

482 
	`thªadli°_addèû
(&
èrgë˝u
->
c_runqueue
, 
èrgë
);

484 i‡(
èrgë˝u
->
c_isidÀ
 &&Å¨gë˝u !
cur˝u
->
c_£lf
) {

489 
	`ùi_£nd
(
èrgë˝u
, 
IPI_UNIDLE
);

492 i‡(!
Æªady_have_lock
) {

493 
	`•ölock_ªÀa£
(&
èrgë˝u
->
c_runqueue_lock
);

495 
	}
}

508 
	$thªad_f‹k
(c⁄° *
«me
,

509 
¥oc
 *proc,

510 (*
íåypoöt
)(*
d©a1
, 
d©a2
),

511 *
d©a1
, 
d©a2
)

513 
thªad
 *
√wthªad
;

514 
ªsu…
;

516 
√wthªad
 = 
	`thªad_¸óã
(
«me
);

517 i‡(
√wthªad
 =
NULL
) {

518  
ENOMEM
;

522 
√wthªad
->
t_°ack
 = 
	`kmÆloc
(
STACK_SIZE
);

523 i‡(
√wthªad
->
t_°ack
 =
NULL
) {

524 
	`thªad_de°roy
(
√wthªad
);

525  
ENOMEM
;

527 
	`thªad_check°ack_öô
(
√wthªad
);

534 
√wthªad
->
t_˝u
 = 
cuπhªad
->t_cpu;

537 i‡(
¥oc
 =
NULL
) {

538 
¥oc
 = 
cuπhªad
->
t_¥oc
;

540 
ªsu…
 = 
	`¥oc_addthªad
(
¥oc
, 
√wthªad
);

541 i‡(
ªsu…
) {

543 
	`thªad_de°roy
(
√wthªad
);

544  
ªsu…
;

552 
√wthªad
->
t_ùlhigh_cou¡
++;

554 
	`•ölock_acquúe
(&
thªad_cou¡_lock
);

555 ++
thªad_cou¡
;

556 
	`wch™_wakóŒ
(
thªad_cou¡_wch™
, &
thªad_cou¡_lock
);

557 
	`•ölock_ªÀa£
(&
thªad_cou¡_lock
);

560 
	`swôch‰ame_öô
(
√wthªad
, 
íåypoöt
, 
d©a1
, 
d©a2
);

563 
	`thªad_make_ru¬abÀ
(
√wthªad
, 
Ál£
);

566 
	}
}

580 
	$thªad_swôch
(
thªad°©e_t
 
√w°©e
, 
wch™
 *
wc
, 
•ölock
 *
lk
)

582 
thªad
 *
cur
, *
√xt
;

583 
•l
;

585 
	`DEBUGASSERT
(
cur˝u
->
c_cuπhªad
 =
cuπhªad
);

586 
	`DEBUGASSERT
(
cuπhªad
->
t_˝u
 =
cur˝u
->
c_£lf
);

589 
•l
 = 
	`•lhigh
();

591 
cur
 = 
cuπhªad
;

597 i‡(
cur˝u
->
c_isidÀ
) {

598 
	`•lx
(
•l
);

603 
	`thªad_check°ack
(
cur
);

606 
	`•ölock_acquúe
(&
cur˝u
->
c_runqueue_lock
);

609 i‡(
√w°©e
 =
S_READY
 && 
	`thªadli°_i£m±y
(&
cur˝u
->
c_runqueue
)) {

610 
	`•ölock_ªÀa£
(&
cur˝u
->
c_runqueue_lock
);

611 
	`•lx
(
•l
);

616 
√w°©e
) {

617 
S_RUN
:

618 
	`∑nic
("Illegal S_RUN inÅhread_switch\n");

619 
S_READY
:

620 
	`thªad_make_ru¬abÀ
(
cur
, 
åue
 );

622 
S_SLEEP
:

623 
cur
->
t_wch™_«me
 = 
wc
->
wc_«me
;

632 
	`thªadli°_addèû
(&
wc
->
wc_thªads
, 
cur
);

633 
	`•ölock_ªÀa£
(
lk
);

635 
S_ZOMBIE
:

636 
cur
->
t_wch™_«me
 = "ZOMBIE";

637 
	`thªadli°_addèû
(&
cur˝u
->
c_zombõs
, 
cur
);

640 
cur
->
t_°©e
 = 
√w°©e
;

660 
cur˝u
->
c_isidÀ
 = 
åue
;

662 
√xt
 = 
	`thªadli°_ªmhód
(&
cur˝u
->
c_runqueue
);

663 i‡(
√xt
 =
NULL
) {

664 
	`•ölock_ªÀa£
(&
cur˝u
->
c_runqueue_lock
);

665 
	`˝u_idÀ
();

666 
	`•ölock_acquúe
(&
cur˝u
->
c_runqueue_lock
);

668 } 
√xt
 =
NULL
);

669 
cur˝u
->
c_isidÀ
 = 
Ál£
;

678 
cur˝u
->
c_cuπhªad
 = 
√xt
;

679 
cuπhªad
 = 
√xt
;

682 
	`swôch‰ame_swôch
(&
cur
->
t_c⁄ãxt
, &
√xt
->t_context);

732 
cur
->
t_wch™_«me
 = 
NULL
;

733 
cur
->
t_°©e
 = 
S_RUN
;

736 
	`•ölock_ªÀa£
(&
cur˝u
->
c_runqueue_lock
);

739 
	`as_a˘iv©e
();

742 
	`ex‹ci£
();

745 
	`•lx
(
•l
);

746 
	}
}

757 
	$thªad_°¨tup
((*
íåypoöt
)(*
d©a1
, 
d©a2
),

758 *
d©a1
, 
d©a2
)

760 
thªad
 *
cur
;

762 
cur
 = 
cuπhªad
;

765 
cur
->
t_wch™_«me
 = 
NULL
;

766 
cur
->
t_°©e
 = 
S_RUN
;

769 
	`•ölock_ªÀa£
(&
cur˝u
->
c_runqueue_lock
);

772 
	`as_a˘iv©e
();

775 
	`ex‹ci£
();

778 
	`•l0
();

781 
	`íåypoöt
(
d©a1
, 
d©a2
);

784 
	`thªad_exô
();

785 
	}
}

804 
	$thªad_exô
()

806 
thªad
 *
cur
;

808 
cur
 = 
cuπhªad
;

814 
	`¥oc_ªmthªad
(
cur
);

817 
	`KASSERT
(
cur
->
t_¥oc
 =
NULL
);

820 
	`thªad_check°ack
(
cur
);

823 i‡(
thªad_cou¡
) {

824 
	`•ölock_acquúe
(&
thªad_cou¡_lock
);

825 --
thªad_cou¡
;

826 
	`wch™_wakóŒ
(
thªad_cou¡_wch™
, &
thªad_cou¡_lock
);

827 
	`•ölock_ªÀa£
(&
thªad_cou¡_lock
);

831 
	`•lhigh
();

832 
	`thªad_swôch
(
S_ZOMBIE
, 
NULL
, NULL);

833 
	`∑nic
("braaaaaaaiiiiiiiiiiinssssss\n");

834 
	}
}

840 
	$thªad_yõld
()

842 
	`thªad_swôch
(
S_READY
, 
NULL
, NULL);

843 
	}
}

855 
	$scheduÀ
()

861 
	}
}

881 
	$thªad_c⁄sidî_migøti⁄
()

883 
my_cou¡
, 
tŸÆ_cou¡
, 
⁄e_sh¨e
, 
to_£nd
;

884 
i
, 
num˝us
;

885 
˝u
 *
c
;

886 
thªadli°
 
vi˘ims
;

887 
thªad
 *
t
;

889 
my_cou¡
 = 
tŸÆ_cou¡
 = 0;

890 
num˝us
 = 
	`˝u¨øy_num
(&
Æl˝us
);

891 
i
=0; i<
num˝us
; i++) {

892 
c
 = 
	`˝u¨øy_gë
(&
Æl˝us
, 
i
);

893 
	`•ölock_acquúe
(&
c
->
c_runqueue_lock
);

894 
tŸÆ_cou¡
 +
c
->
c_runqueue
.
é_cou¡
;

895 i‡(
c
 =
cur˝u
->
c_£lf
) {

896 
my_cou¡
 = 
c
->
c_runqueue
.
é_cou¡
;

898 
	`•ölock_ªÀa£
(&
c
->
c_runqueue_lock
);

901 
⁄e_sh¨e
 = 
	`DIVROUNDUP
(
tŸÆ_cou¡
, 
num˝us
);

902 i‡(
my_cou¡
 < 
⁄e_sh¨e
) {

906 
to_£nd
 = 
my_cou¡
 - 
⁄e_sh¨e
;

907 
	`thªadli°_öô
(&
vi˘ims
);

908 
	`•ölock_acquúe
(&
cur˝u
->
c_runqueue_lock
);

909 
i
=0; i<
to_£nd
; i++) {

910 
t
 = 
	`thªadli°_ªmèû
(&
cur˝u
->
c_runqueue
);

911 
	`thªadli°_addhód
(&
vi˘ims
, 
t
);

913 
	`•ölock_ªÀa£
(&
cur˝u
->
c_runqueue_lock
);

915 
i
=0; i < 
num˝us
 && 
to_£nd
 > 0; i++) {

916 
c
 = 
	`˝u¨øy_gë
(&
Æl˝us
, 
i
);

917 i‡(
c
 =
cur˝u
->
c_£lf
) {

920 
	`•ölock_acquúe
(&
c
->
c_runqueue_lock
);

921 
c
->
c_runqueue
.
é_cou¡
 < 
⁄e_sh¨e
 && 
to_£nd
 > 0) {

922 
t
 = 
	`thªadli°_ªmhód
(&
vi˘ims
);

945 i‡(
t
 =
cuπhªad
) {

946 
	`thªadli°_addèû
(&
vi˘ims
, 
t
);

947 
to_£nd
--;

951 
t
->
t_˝u
 = 
c
;

952 
	`thªadli°_addèû
(&
c
->
c_runqueue
, 
t
);

953 
	`DEBUG
(
DB_THREADS
,

955 
t
->
t_«me
, 
cur˝u
->
c_numbî
, 
c
->c_number);

956 
to_£nd
--;

957 i‡(
c
->
c_isidÀ
) {

962 
	`ùi_£nd
(
c
, 
IPI_UNIDLE
);

965 
	`•ölock_ªÀa£
(&
c
->
c_runqueue_lock
);

973 i‡(!
	`thªadli°_i£m±y
(&
vi˘ims
)) {

974 
	`•ölock_acquúe
(&
cur˝u
->
c_runqueue_lock
);

975 (
t
 = 
	`thªadli°_ªmhód
(&
vi˘ims
)Ë!
NULL
) {

976 
	`thªadli°_addèû
(&
cur˝u
->
c_runqueue
, 
t
);

978 
	`•ölock_ªÀa£
(&
cur˝u
->
c_runqueue_lock
);

981 
	`KASSERT
(
	`thªadli°_i£m±y
(&
vi˘ims
));

982 
	`thªadli°_˛ónup
(&
vi˘ims
);

983 
	}
}

999 
wch™
 *

1000 
	$wch™_¸óã
(c⁄° *
«me
)

1002 
wch™
 *
wc
;

1004 
wc
 = 
	`kmÆloc
((*wc));

1005 i‡(
wc
 =
NULL
) {

1006  
NULL
;

1008 
	`thªadli°_öô
(&
wc
->
wc_thªads
);

1009 
wc
->
wc_«me
 = 
«me
;

1011  
wc
;

1012 
	}
}

1019 
	$wch™_de°roy
(
wch™
 *
wc
)

1021 
	`thªadli°_˛ónup
(&
wc
->
wc_thªads
);

1022 
	`k‰ì
(
wc
);

1023 
	}
}

1033 
	$wch™_¶ìp
(
wch™
 *
wc
, 
•ölock
 *
lk
)

1036 
	`KASSERT
(!
cuπhªad
->
t_ö_öãºu±
);

1039 
	`KASSERT
(
	`•ölock_do_i_hﬁd
(
lk
));

1042 
	`KASSERT
(
cur˝u
->
c_•ölocks
 == 1);

1044 
	`thªad_swôch
(
S_SLEEP
, 
wc
, 
lk
);

1045 
	`•ölock_acquúe
(
lk
);

1046 
	}
}

1052 
	$wch™_wake⁄e
(
wch™
 *
wc
, 
•ölock
 *
lk
)

1054 
thªad
 *
èrgë
;

1056 
	`KASSERT
(
	`•ölock_do_i_hﬁd
(
lk
));

1059 
èrgë
 = 
	`thªadli°_ªmhód
(&
wc
->
wc_thªads
);

1061 i‡(
èrgë
 =
NULL
) {

1074 
	`thªad_make_ru¬abÀ
(
èrgë
, 
Ál£
);

1075 
	}
}

1081 
	$wch™_wakóŒ
(
wch™
 *
wc
, 
•ölock
 *
lk
)

1083 
thªad
 *
èrgë
;

1084 
thªadli°
 
li°
;

1086 
	`KASSERT
(
	`•ölock_do_i_hﬁd
(
lk
));

1088 
	`thªadli°_öô
(&
li°
);

1094 (
èrgë
 = 
	`thªadli°_ªmhód
(&
wc
->
wc_thªads
)Ë!
NULL
) {

1095 
	`thªadli°_addèû
(&
li°
, 
èrgë
);

1103 (
èrgë
 = 
	`thªadli°_ªmhód
(&
li°
)Ë!
NULL
) {

1104 
	`thªad_make_ru¬abÀ
(
èrgë
, 
Ál£
);

1107 
	`thªadli°_˛ónup
(&
li°
);

1108 
	}
}

1114 
boﬁ


1115 
	$wch™_i£m±y
(
wch™
 *
wc
, 
•ölock
 *
lk
)

1117 
boﬁ
 
ªt
;

1119 
	`KASSERT
(
	`•ölock_do_i_hﬁd
(
lk
));

1120 
ªt
 = 
	`thªadli°_i£m±y
(&
wc
->
wc_thªads
);

1122  
ªt
;

1123 
	}
}

1135 
	$ùi_£nd
(
˝u
 *
èrgë
, 
code
)

1137 
	`KASSERT
(
code
 >= 0 && code < 32);

1139 
	`•ölock_acquúe
(&
èrgë
->
c_ùi_lock
);

1140 
èrgë
->
c_ùi_≥ndög
 |(
uöt32_t
)1 << 
code
;

1141 
	`maöbus_£nd_ùi
(
èrgë
);

1142 
	`•ölock_ªÀa£
(&
èrgë
->
c_ùi_lock
);

1143 
	}
}

1149 
	$ùi_brﬂdˇ°
(
code
)

1151 
i
;

1152 
˝u
 *
c
;

1154 
i
=0; i < 
	`˝u¨øy_num
(&
Æl˝us
); i++) {

1155 
c
 = 
	`˝u¨øy_gë
(&
Æl˝us
, 
i
);

1156 i‡(
c
 !
cur˝u
->
c_£lf
) {

1157 
	`ùi_£nd
(
c
, 
code
);

1160 
	}
}

1166 
	$ùi_ébshoŸdown
(
˝u
 *
èrgë
, c⁄° 
ébshoŸdown
 *
m≠pög
)

1168 
n
;

1170 
	`•ölock_acquúe
(&
èrgë
->
c_ùi_lock
);

1172 
n
 = 
èrgë
->
c_numshoŸdown
;

1173 i‡(
n
 =
TLBSHOOTDOWN_MAX
) {

1183 
	`∑nic
("ipi_tlbshootdown: Too many shootdowns queued\n");

1186 
èrgë
->
c_shoŸdown
[
n
] = *
m≠pög
;

1187 
èrgë
->
c_numshoŸdown
 = 
n
+1;

1190 
èrgë
->
c_ùi_≥ndög
 |(
uöt32_t
)1 << 
IPI_TLBSHOOTDOWN
;

1191 
	`maöbus_£nd_ùi
(
èrgë
);

1193 
	`•ölock_ªÀa£
(&
èrgë
->
c_ùi_lock
);

1194 
	}
}

1200 
	$öãΩro˚ss‹_öãºu±
()

1202 
uöt32_t
 
bôs
;

1203 
i
;

1205 
	`•ölock_acquúe
(&
cur˝u
->
c_ùi_lock
);

1206 
bôs
 = 
cur˝u
->
c_ùi_≥ndög
;

1208 i‡(
bôs
 & (1U << 
IPI_PANIC
)) {

1210 
	`•ölock_ªÀa£
(&
cur˝u
->
c_ùi_lock
);

1211 
	`˝u_hÆt
();

1213 i‡(
bôs
 & (1U << 
IPI_OFFLINE
)) {

1215 
	`•ölock_ªÀa£
(&
cur˝u
->
c_ùi_lock
);

1216 
	`•ölock_acquúe
(&
cur˝u
->
c_runqueue_lock
);

1217 i‡(!
cur˝u
->
c_isidÀ
) {

1218 
	`k¥ötf
("cpu%d: offline: warning:Çot idle\n",

1219 
cur˝u
->
c_numbî
);

1221 
	`•ölock_ªÀa£
(&
cur˝u
->
c_runqueue_lock
);

1222 
	`˝u_hÆt
();

1224 i‡(
bôs
 & (1U << 
IPI_UNIDLE
)) {

1230 i‡(
bôs
 & (1U << 
IPI_TLBSHOOTDOWN
)) {

1236 
i
=0; i<
cur˝u
->
c_numshoŸdown
; i++) {

1237 
	`vm_ébshoŸdown
(&
cur˝u
->
c_shoŸdown
[
i
]);

1239 
cur˝u
->
c_numshoŸdown
 = 0;

1242 
cur˝u
->
c_ùi_≥ndög
 = 0;

1243 
	`•ölock_ªÀa£
(&
cur˝u
->
c_ùi_lock
);

1244 
	}
}

1249 
	$thªad_waô_f‹_cou¡
(
tc
)

1251 
	`•ölock_acquúe
(&
thªad_cou¡_lock
);

1252 
thªad_cou¡
 !
tc
) {

1253 
	`wch™_¶ìp
(
thªad_cou¡_wch™
, &
thªad_cou¡_lock
);

1255 
	`•ölock_ªÀa£
(&
thªad_cou¡_lock
);

1256 
	}
}

	@/home/trinity/src/kern/thread/threadlist.c

34 
	~<ty≥s.h
>

35 
	~<lib.h
>

36 
	~<thªad.h
>

37 
	~<thªadli°.h
>

40 
	$thªadli°node_öô
(
thªadli°node
 *
én
, 
thªad
 *
t
)

42 
	`DEBUGASSERT
(
én
 !
NULL
);

43 
	`KASSERT
(
t
 !
NULL
);

45 
én
->
én_√xt
 = 
NULL
;

46 
én
->
én_¥ev
 = 
NULL
;

47 
én
->
én_£lf
 = 
t
;

48 
	}
}

51 
	$thªadli°node_˛ónup
(
thªadli°node
 *
én
)

53 
	`DEBUGASSERT
(
én
 !
NULL
);

55 
	`KASSERT
(
én
->
én_√xt
 =
NULL
);

56 
	`KASSERT
(
én
->
én_¥ev
 =
NULL
);

57 
	`KASSERT
(
én
->
én_£lf
 !
NULL
);

58 
	}
}

61 
	$thªadli°_öô
(
thªadli°
 *
é
)

63 
	`DEBUGASSERT
(
é
 !
NULL
);

65 
é
->
é_hód
.
én_√xt
 = &é->
é_èû
;

66 
é
->
é_hód
.
én_¥ev
 = 
NULL
;

67 
é
->
é_èû
.
én_√xt
 = 
NULL
;

68 
é
->
é_èû
.
én_¥ev
 = &é->
é_hód
;

69 
é
->
é_hód
.
én_£lf
 = 
NULL
;

70 
é
->
é_èû
.
én_£lf
 = 
NULL
;

71 
é
->
é_cou¡
 = 0;

72 
	}
}

75 
	$thªadli°_˛ónup
(
thªadli°
 *
é
)

77 
	`DEBUGASSERT
(
é
 !
NULL
);

78 
	`DEBUGASSERT
(
é
->
é_hód
.
én_√xt
 =&é->
é_èû
);

79 
	`DEBUGASSERT
(
é
->
é_hód
.
én_¥ev
 =
NULL
);

80 
	`DEBUGASSERT
(
é
->
é_èû
.
én_√xt
 =
NULL
);

81 
	`DEBUGASSERT
(
é
->
é_èû
.
én_¥ev
 =&é->
é_hód
);

82 
	`DEBUGASSERT
(
é
->
é_hód
.
én_£lf
 =
NULL
);

83 
	`DEBUGASSERT
(
é
->
é_èû
.
én_£lf
 =
NULL
);

85 
	`KASSERT
(
	`thªadli°_i£m±y
(
é
));

86 
	`KASSERT
(
é
->
é_cou¡
 == 0);

89 
	}
}

91 
boﬁ


92 
	$thªadli°_i£m±y
(
thªadli°
 *
é
)

94 
	`DEBUGASSERT
(
é
 !
NULL
);

96  (
é
->
é_cou¡
 == 0);

97 
	}
}

107 
	$thªadli°_ö£πa·înode
(
thªadli°node
 *
⁄li°
, 
thªad
 *
t
)

109 
thªadli°node
 *
addì
;

111 
addì
 = &
t
->
t_li°node
;

113 
	`DEBUGASSERT
(
addì
->
én_¥ev
 =
NULL
);

114 
	`DEBUGASSERT
(
addì
->
én_√xt
 =
NULL
);

116 
addì
->
én_¥ev
 = 
⁄li°
;

117 
addì
->
én_√xt
 = 
⁄li°
->tln_next;

118 
addì
->
én_¥ev
->
én_√xt
 =áddee;

119 
addì
->
én_√xt
->
én_¥ev
 =áddee;

120 
	}
}

127 
	$thªadli°_ö£πbef‹íode
(
thªad
 *
t
, 
thªadli°node
 *
⁄li°
)

129 
thªadli°node
 *
addì
;

131 
addì
 = &
t
->
t_li°node
;

133 
	`DEBUGASSERT
(
addì
->
én_¥ev
 =
NULL
);

134 
	`DEBUGASSERT
(
addì
->
én_√xt
 =
NULL
);

136 
addì
->
én_¥ev
 = 
⁄li°
->tln_prev;

137 
addì
->
én_√xt
 = 
⁄li°
;

138 
addì
->
én_¥ev
->
én_√xt
 =áddee;

139 
addì
->
én_√xt
->
én_¥ev
 =áddee;

140 
	}
}

147 
	$thªadli°_ªmovíode
(
thªadli°node
 *
én
)

149 
	`DEBUGASSERT
(
én
 !
NULL
);

150 
	`DEBUGASSERT
(
én
->
én_¥ev
 !
NULL
);

151 
	`DEBUGASSERT
(
én
->
én_√xt
 !
NULL
);

153 
én
->
én_¥ev
->
én_√xt
 =Åln->tln_next;

154 
én
->
én_√xt
->
én_¥ev
 =Åln->tln_prev;

155 
én
->
én_¥ev
 = 
NULL
;

156 
én
->
én_√xt
 = 
NULL
;

157 
	}
}

163 
	$thªadli°_addhód
(
thªadli°
 *
é
, 
thªad
 *
t
)

165 
	`DEBUGASSERT
(
é
 !
NULL
);

166 
	`DEBUGASSERT
(
t
 !
NULL
);

168 
	`thªadli°_ö£πa·înode
(&
é
->
é_hód
, 
t
);

169 
é
->
é_cou¡
++;

170 
	}
}

173 
	$thªadli°_addèû
(
thªadli°
 *
é
, 
thªad
 *
t
)

175 
	`DEBUGASSERT
(
é
 !
NULL
);

176 
	`DEBUGASSERT
(
t
 !
NULL
);

178 
	`thªadli°_ö£πbef‹íode
(
t
, &
é
->
é_èû
);

179 
é
->
é_cou¡
++;

180 
	}
}

182 
thªad
 *

183 
	$thªadli°_ªmhód
(
thªadli°
 *
é
)

185 
thªadli°node
 *
én
;

187 
	`DEBUGASSERT
(
é
 !
NULL
);

189 
én
 = 
é
->
é_hód
.
én_√xt
;

190 i‡(
én
->
én_√xt
 =
NULL
) {

192  
NULL
;

194 
	`thªadli°_ªmovíode
(
én
);

195 
	`DEBUGASSERT
(
é
->
é_cou¡
 > 0);

196 
é
->
é_cou¡
--;

197  
én
->
én_£lf
;

198 
	}
}

200 
thªad
 *

201 
	$thªadli°_ªmèû
(
thªadli°
 *
é
)

203 
thªadli°node
 *
én
;

205 
	`DEBUGASSERT
(
é
 !
NULL
);

207 
én
 = 
é
->
é_èû
.
én_¥ev
;

208 i‡(
én
->
én_¥ev
 =
NULL
) {

210  
NULL
;

212 
	`thªadli°_ªmovíode
(
én
);

213 
	`DEBUGASSERT
(
é
->
é_cou¡
 > 0);

214 
é
->
é_cou¡
--;

215  
én
->
én_£lf
;

216 
	}
}

219 
	$thªadli°_ö£πa·î
(
thªadli°
 *
é
,

220 
thªad
 *
⁄li°
, thªad *
addì
)

222 
	`thªadli°_ö£πa·înode
(&
⁄li°
->
t_li°node
, 
addì
);

223 
é
->
é_cou¡
++;

224 
	}
}

227 
	$thªadli°_ö£πbef‹e
(
thªadli°
 *
é
,

228 
thªad
 *
addì
, thªad *
⁄li°
)

230 
	`thªadli°_ö£πbef‹íode
(
addì
, &
⁄li°
->
t_li°node
);

231 
é
->
é_cou¡
++;

232 
	}
}

235 
	$thªadli°_ªmove
(
thªadli°
 *
é
, 
thªad
 *
t
)

237 
	`thªadli°_ªmovíode
(&
t
->
t_li°node
);

238 
	`DEBUGASSERT
(
é
->
é_cou¡
 > 0);

239 
é
->
é_cou¡
--;

240 
	}
}

	@/home/trinity/src/kern/vfs/device.c

36 
	~<ty≥s.h
>

37 
	~<kîn/î∫o.h
>

38 
	~<kîn/f˙é.h
>

39 
	~<°©.h
>

40 
	~<lib.h
>

41 
	~<uio.h
>

42 
	~<synch.h
>

43 
	~<vnode.h
>

44 
	~<devi˚.h
>

53 
	$dev_óch›í
(
vnode
 *
v
, 
Êags
)

55 
devi˚
 *
d
 = 
v
->
vn_d©a
;

57 i‡(
Êags
 & (
O_CREAT
 | 
O_TRUNC
 | 
O_EXCL
 | 
O_APPEND
)) {

58  
EINVAL
;

61  
	`DEVOP_EACHOPEN
(
d
, 
Êags
);

62 
	}
}

70 
	$dev_ª˛aim
(
vnode
 *
v
)

72 ()
v
;

75 
	}
}

86 
	$dev_åy£ek
(
devi˚
 *
d
, 
off_t
 
pos
)

88 i‡(
d
->
d_blocks
 > 0) {

89 i‡((
pos
 % 
d
->
d_blocksize
)!=0) {

91  
EINVAL
;

93 i‡(
pos
 / 
d
->
d_blocksize
 >d->
d_blocks
) {

95  
EINVAL
;

102 
	}
}

109 
	$dev_ªad
(
vnode
 *
v
, 
uio
 *uio)

111 
devi˚
 *
d
 = 
v
->
vn_d©a
;

112 
ªsu…
;

114 
ªsu…
 = 
	`dev_åy£ek
(
d
, 
uio
->
uio_off£t
);

115 i‡(
ªsu…
) {

116  
ªsu…
;

119 
	`KASSERT
(
uio
->
uio_rw
 =
UIO_READ
);

120  
	`DEVOP_IO
(
d
, 
uio
);

121 
	}
}

128 
	$dev_wrôe
(
vnode
 *
v
, 
uio
 *uio)

130 
devi˚
 *
d
 = 
v
->
vn_d©a
;

131 
ªsu…
;

133 
ªsu…
 = 
	`dev_åy£ek
(
d
, 
uio
->
uio_off£t
);

134 i‡(
ªsu…
) {

135  
ªsu…
;

138 
	`KASSERT
(
uio
->
uio_rw
 =
UIO_WRITE
);

139  
	`DEVOP_IO
(
d
, 
uio
);

140 
	}
}

147 
	$dev_io˘l
(
vnode
 *
v
, 
›
, 
u£Ωå_t
 
d©a
)

149 
devi˚
 *
d
 = 
v
->
vn_d©a
;

150  
	`DEVOP_IOCTL
(
d
, 
›
, 
d©a
);

151 
	}
}

160 
	$dev_°©
(
vnode
 *
v
, 
°©
 *
°©buf
)

162 
devi˚
 *
d
 = 
v
->
vn_d©a
;

163 
ªsu…
;

165 
	`bzîo
(
°©buf
, (
°©
));

167 i‡(
d
->
d_blocks
 > 0) {

168 
°©buf
->
°_size
 = 
d
->
d_blocks
 * d->
d_blocksize
;

169 
°©buf
->
°_blksize
 = 
d
->
d_blocksize
;

172 
°©buf
->
°_size
 = 0;

175 
ªsu…
 = 
	`VOP_GETTYPE
(
v
, &
°©buf
->
°_mode
);

176 i‡(
ªsu…
) {

177  
ªsu…
;

180 
°©buf
->
°_mode
 |= 0600;

182 
°©buf
->
°_∆ök
 = 1;

183 
°©buf
->
°_blocks
 = 
d
->
d_blocks
;

186 
°©buf
->
°_dev
 = 0;

189 
°©buf
->
°_rdev
 = 
d
->
d_devnumbî
;

192 
	}
}

201 
	$dev_gëty≥
(
vnode
 *
v
, 
mode_t
 *
ªt
)

203 
devi˚
 *
d
 = 
v
->
vn_d©a
;

204 i‡(
d
->
d_blocks
 > 0) {

205 *
ªt
 = 
S_IFBLK
;

208 *
ªt
 = 
S_IFCHR
;

211 
	}
}

217 
boﬁ


218 
	$dev_is£ekabÀ
(
vnode
 *
v
)

220 
devi˚
 *
d
 = 
v
->
vn_d©a
;

222 i‡(
d
->
d_blocks
 == 0) {

223  
Ál£
;

225  
åue
;

226 
	}
}

233 
	$nuŒ_fsync
(
vnode
 *
v
)

235 ()
v
;

237 
	}
}

245 
	$dev_mm≠
(
vnode
 *
v
 )

247 ()
v
;

248  
ENOSYS
;

249 
	}
}

256 
	$dev_åunˇã
(
vnode
 *
v
, 
off_t
 
Àn
)

258 
devi˚
 *
d
 = 
v
->
vn_d©a
;

263 i‡(
d
->
d_blocks
 > 0 && (
off_t
)(d->d_blocks*d->
d_blocksize
Ë=
Àn
) {

267  
EINVAL
;

268 
	}
}

278 
	$dev_«mefûe
(
vnode
 *
v
, 
uio
 *uio)

286 ()
v
;

287 ()
uio
;

290 
	}
}

306 
	$dev_lookup
(
vnode
 *
dú
,

307 *
∑th«me
, 
vnode
 **
ªsu…
)

314 i‡(
	`°æí
(
∑th«me
)>0) {

315  
ENOENT
;

317 
	`VOP_INCREF
(
dú
);

318 *
ªsu…
 = 
dú
;

320 
	}
}

325 c⁄° 
vnode_›s
 
	gdev_vnode_›s
 = {

326 .
v›_magic
 = 
VOP_MAGIC
,

328 .
	gv›_óch›í
 = 
dev_óch›í
,

329 .
	gv›_ª˛aim
 = 
dev_ª˛aim
,

330 .
	gv›_ªad
 = 
dev_ªad
,

331 .
	gv›_ªadlök
 = 
v›Áû_uio_övÆ
,

332 .
	gv›_gëdúíåy
 = 
v›Áû_uio_nŸdú
,

333 .
	gv›_wrôe
 = 
dev_wrôe
,

334 .
	gv›_io˘l
 = 
dev_io˘l
,

335 .
	gv›_°©
 = 
dev_°©
,

336 .
	gv›_gëty≥
 = 
dev_gëty≥
,

337 .
	gv›_is£ekabÀ
 = 
dev_is£ekabÀ
,

338 .
	gv›_fsync
 = 
nuŒ_fsync
,

339 .
	gv›_mm≠
 = 
dev_mm≠
,

340 .
	gv›_åunˇã
 = 
dev_åunˇã
,

341 .
	gv›_«mefûe
 = 
dev_«mefûe
,

342 .
	gv›_¸ót
 = 
v›Áû_¸ót_nŸdú
,

343 .
	gv›_symlök
 = 
v›Áû_symlök_nŸdú
,

344 .
	gv›_mkdú
 = 
v›Áû_mkdú_nŸdú
,

345 .
	gv›_lök
 = 
v›Áû_lök_nŸdú
,

346 .
	gv›_ªmove
 = 
v›Áû_°rög_nŸdú
,

347 .
	gv›_rmdú
 = 
v›Áû_°rög_nŸdú
,

348 .
	gv›_ª«me
 = 
v›Áû_ª«me_nŸdú
,

349 .
	gv›_lookup
 = 
dev_lookup
,

350 .
	gv›_look∑ª¡
 = 
v›Áû_look∑ª¡_nŸdú
,

356 
vnode
 *

357 
	$dev_¸óã_vnode
(
devi˚
 *
dev
)

359 
ªsu…
;

360 
vnode
 *
v
;

362 
v
 = 
	`kmÆloc
((
vnode
));

363 i‡(
v
==
NULL
) {

364  
NULL
;

367 
ªsu…
 = 
	`vnode_öô
(
v
, &
dev_vnode_›s
, 
NULL
, 
dev
);

368 i‡(
ªsu…
 != 0) {

369 
	`∑nic
("While creating vnode for device: vnode_init: %s\n",

370 
	`°ªº‹
(
ªsu…
));

373  
v
;

374 
	}
}

383 
	$dev_un¸óã_vnode
(
vnode
 *
vn
)

385 
	`KASSERT
(
vn
->
vn_›s
 =&
dev_vnode_›s
);

386 
	`vnode_˛ónup
(
vn
);

387 
	`k‰ì
(
vn
);

388 
	}
}

	@/home/trinity/src/kern/vfs/devnull.c

34 
	~<ty≥s.h
>

35 
	~<kîn/î∫o.h
>

36 
	~<lib.h
>

37 
	~<uio.h
>

38 
	~<vfs.h
>

39 
	~<devi˚.h
>

44 
	$nuŒ›í
(
devi˚
 *
dev
, 
›íÊags
)

46 ()
dev
;

47 ()
›íÊags
;

50 
	}
}

55 
	$nuŒio
(
devi˚
 *
dev
, 
uio
 *uio)

66 ()
dev
;

68 i‡(
uio
->
uio_rw
 =
UIO_WRITE
) {

69 
uio
->
uio_ªsid
 = 0;

73 
	}
}

78 
	$nuŒio˘l
(
devi˚
 *
dev
, 
›
, 
u£Ωå_t
 
d©a
)

84 ()
dev
;

85 ()
›
;

86 ()
d©a
;

88  
EINVAL
;

89 
	}
}

91 c⁄° 
devi˚_›s
 
	gnuŒ_dev›s
 = {

92 .
dev›_óch›í
 = 
nuŒ›í
,

93 .
	gdev›_io
 = 
nuŒio
,

94 .
	gdev›_io˘l
 = 
nuŒio˘l
,

101 
	$devnuŒ_¸óã
()

103 
ªsu…
;

104 
devi˚
 *
dev
;

106 
dev
 = 
	`kmÆloc
((*dev));

107 i‡(
dev
==
NULL
) {

108 
	`∑nic
("CouldÇotáddÇull device: out of memory\n");

111 
dev
->
d_›s
 = &
nuŒ_dev›s
;

113 
dev
->
d_blocks
 = 0;

114 
dev
->
d_blocksize
 = 1;

116 
dev
->
d_devnumbî
 = 0;

118 
dev
->
d_d©a
 = 
NULL
;

120 
ªsu…
 = 
	`vfs_adddev
("nuŒ", 
dev
, 0);

121 i‡(
ªsu…
) {

122 
	`∑nic
("CouldÇŸáddÇuŒ devi˚: %s\n", 
	`°ªº‹
(
ªsu…
));

124 
	}
}

	@/home/trinity/src/kern/vfs/vfscwd.c

34 
	~<ty≥s.h
>

35 
	~<kîn/î∫o.h
>

36 
	~<°©.h
>

37 
	~<lib.h
>

38 
	~<uio.h
>

39 
	~<¥oc.h
>

40 
	~<cuºít.h
>

41 
	~<vfs.h
>

42 
	~<fs.h
>

43 
	~<vnode.h
>

49 
	$vfs_gëcurdú
(
vnode
 **
ªt
)

51 
rv
 = 0;

53 
	`•ölock_acquúe
(&
cuΩroc
->
p_lock
);

54 i‡(
cuΩroc
->
p_cwd
!=
NULL
) {

55 
	`VOP_INCREF
(
cuΩroc
->
p_cwd
);

56 *
ªt
 = 
cuΩroc
->
p_cwd
;

59 
rv
 = 
ENOENT
;

61 
	`•ölock_ªÀa£
(&
cuΩroc
->
p_lock
);

63  
rv
;

64 
	}
}

71 
	$vfs_£tcurdú
(
vnode
 *
dú
)

73 
vnode
 *
ﬁd
;

74 
mode_t
 
vty≥
;

75 
ªsu…
;

77 
ªsu…
 = 
	`VOP_GETTYPE
(
dú
, &
vty≥
);

78 i‡(
ªsu…
) {

79  
ªsu…
;

81 i‡(
vty≥
 !
S_IFDIR
) {

82  
ENOTDIR
;

85 
	`VOP_INCREF
(
dú
);

87 
	`•ölock_acquúe
(&
cuΩroc
->
p_lock
);

88 
ﬁd
 = 
cuΩroc
->
p_cwd
;

89 
cuΩroc
->
p_cwd
 = 
dú
;

90 
	`•ölock_ªÀa£
(&
cuΩroc
->
p_lock
);

92 i‡(
ﬁd
!=
NULL
) {

93 
	`VOP_DECREF
(
ﬁd
);

97 
	}
}

103 
	$vfs_˛órcurdú
()

105 
vnode
 *
ﬁd
;

107 
	`•ölock_acquúe
(&
cuΩroc
->
p_lock
);

108 
ﬁd
 = 
cuΩroc
->
p_cwd
;

109 
cuΩroc
->
p_cwd
 = 
NULL
;

110 
	`•ölock_ªÀa£
(&
cuΩroc
->
p_lock
);

112 i‡(
ﬁd
!=
NULL
) {

113 
	`VOP_DECREF
(
ﬁd
);

117 
	}
}

124 
	$vfs_chdú
(*
∑th
)

126 
vnode
 *
vn
;

127 
ªsu…
;

129 
ªsu…
 = 
	`vfs_lookup
(
∑th
, &
vn
);

130 i‡(
ªsu…
) {

131  
ªsu…
;

133 
ªsu…
 = 
	`vfs_£tcurdú
(
vn
);

134 
	`VOP_DECREF
(
vn
);

135  
ªsu…
;

136 
	}
}

144 
	$vfs_gëcwd
(
uio
 *uio)

146 
vnode
 *
cwd
;

147 
ªsu…
;

148 c⁄° *
«me
;

149 
cﬁ⁄
=':';

151 
	`KASSERT
(
uio
->
uio_rw
==
UIO_READ
);

153 
ªsu…
 = 
	`vfs_gëcurdú
(&
cwd
);

154 i‡(
ªsu…
) {

155  
ªsu…
;

159 
	`KASSERT
(
cwd
->
vn_fs
 !
NULL
);

161 
«me
 = 
	`FSOP_GETVOLNAME
(
cwd
->
vn_fs
);

162 i‡(
«me
==
NULL
) {

163 
	`vfs_biglock_acquúe
();

164 
«me
 = 
	`vfs_gëdev«me
(
cwd
->
vn_fs
);

165 
	`vfs_biglock_ªÀa£
();

167 
	`KASSERT
(
«me
 !
NULL
);

169 
ªsu…
 = 
	`uiomove
((*)
«me
, 
	`°æí
“ame), 
uio
);

170 i‡(
ªsu…
) {

171 
out
;

173 
ªsu…
 = 
	`uiomove
(&
cﬁ⁄
, 1, 
uio
);

174 i‡(
ªsu…
) {

175 
out
;

178 
ªsu…
 = 
	`VOP_NAMEFILE
(
cwd
, 
uio
);

180 
out
:

182 
	`VOP_DECREF
(
cwd
);

183  
ªsu…
;

184 
	}
}

	@/home/trinity/src/kern/vfs/vfsfail.c

30 
	~<ty≥s.h
>

31 
	~<kîn/î∫o.h
>

32 
	~<vnode.h
>

51 
	$v›Áû_uio_nŸdú
(
vnode
 *
vn
, 
uio
 *uio)

53 ()
vn
;

54 ()
uio
;

55  
ENOTDIR
;

56 
	}
}

59 
	$v›Áû_uio_isdú
(
vnode
 *
vn
, 
uio
 *uio)

61 ()
vn
;

62 ()
uio
;

63  
EISDIR
;

64 
	}
}

67 
	$v›Áû_uio_övÆ
(
vnode
 *
vn
, 
uio
 *uio)

69 ()
vn
;

70 ()
uio
;

71  
EINVAL
;

72 
	}
}

75 
	$v›Áû_uio_nosys
(
vnode
 *
vn
, 
uio
 *uio)

77 ()
vn
;

78 ()
uio
;

79  
ENOSYS
;

80 
	}
}

86 
	$v›Áû_mm≠_isdú
(
vnode
 *
vn
 )

88 ()
vn
;

89  
EISDIR
;

90 
	}
}

93 
	$v›Áû_mm≠_≥rm
(
vnode
 *
vn
 )

95 ()
vn
;

96  
EPERM
;

97 
	}
}

100 
	$v›Áû_mm≠_nosys
(
vnode
 *
vn
 )

102 ()
vn
;

103  
ENOSYS
;

104 
	}
}

110 
	$v›Áû_åunˇã_isdú
(
vnode
 *
vn
, 
off_t
 
pos
)

112 ()
vn
;

113 ()
pos
;

114  
EISDIR
;

115 
	}
}

121 
	$v›Áû_¸ót_nŸdú
(
vnode
 *
vn
, c⁄° *
«me
, 
boﬁ
 
ex˛
,

122 
mode_t
 
mode
, 
vnode
 **
ªsu…
)

124 ()
vn
;

125 ()
«me
;

126 ()
ex˛
;

127 ()
mode
;

128 ()
ªsu…
;

129  
ENOTDIR
;

130 
	}
}

136 
	$v›Áû_symlök_nŸdú
(
vnode
 *
vn
, c⁄° *
c⁄ã¡s
,

137 c⁄° *
«me
)

139 ()
vn
;

140 ()
c⁄ã¡s
;

141 ()
«me
;

142  
ENOTDIR
;

143 
	}
}

146 
	$v›Áû_symlök_nosys
(
vnode
 *
vn
, c⁄° *
c⁄ã¡s
,

147 c⁄° *
«me
)

149 ()
vn
;

150 ()
c⁄ã¡s
;

151 ()
«me
;

152  
ENOSYS
;

153 
	}
}

159 
	$v›Áû_mkdú_nŸdú
(
vnode
 *
vn
, c⁄° *
«me
, 
mode_t
 
mode
)

161 ()
vn
;

162 ()
«me
;

163 ()
mode
;

164  
ENOTDIR
;

165 
	}
}

168 
	$v›Áû_mkdú_nosys
(
vnode
 *
vn
, c⁄° *
«me
, 
mode_t
 
mode
)

170 ()
vn
;

171 ()
«me
;

172 ()
mode
;

173  
ENOSYS
;

174 
	}
}

180 
	$v›Áû_lök_nŸdú
(
vnode
 *
dú
, c⁄° *
«me
, vnodê*
fûe
)

182 ()
dú
;

183 ()
«me
;

184 ()
fûe
;

185  
ENOTDIR
;

186 
	}
}

189 
	$v›Áû_lök_nosys
(
vnode
 *
dú
, c⁄° *
«me
, vnodê*
fûe
)

191 ()
dú
;

192 ()
«me
;

193 ()
fûe
;

194  
ENOSYS
;

195 
	}
}

201 
	$v›Áû_°rög_nŸdú
(
vnode
 *
vn
, c⁄° *
«me
)

203 ()
vn
;

204 ()
«me
;

205  
ENOTDIR
;

206 
	}
}

209 
	$v›Áû_°rög_nosys
(
vnode
 *
vn
, c⁄° *
«me
)

211 ()
vn
;

212 ()
«me
;

213  
ENOSYS
;

214 
	}
}

220 
	$v›Áû_ª«me_nŸdú
(
vnode
 *
‰omdú
, c⁄° *
‰om«me
,

221 
vnode
 *
todú
, c⁄° *
t⁄ame
)

223 ()
‰omdú
;

224 ()
‰om«me
;

225 ()
todú
;

226 ()
t⁄ame
;

227  
ENOTDIR
;

228 
	}
}

231 
	$v›Áû_ª«me_nosys
(
vnode
 *
‰omdú
, c⁄° *
‰om«me
,

232 
vnode
 *
todú
, c⁄° *
t⁄ame
)

234 ()
‰omdú
;

235 ()
‰om«me
;

236 ()
todú
;

237 ()
t⁄ame
;

238  
ENOSYS
;

239 
	}
}

245 
	$v›Áû_lookup_nŸdú
(
vnode
 *
vn
, *
∑th
, vnodê**
ªsu…
)

247 ()
vn
;

248 ()
∑th
;

249 ()
ªsu…
;

250  
ENOTDIR
;

251 
	}
}

254 
	$v›Áû_look∑ª¡_nŸdú
(
vnode
 *
vn
, *
∑th
, vnodê**
ªsu…
,

255 *
buf
, 
size_t
 
Àn
)

257 ()
vn
;

258 ()
∑th
;

259 ()
ªsu…
;

260 ()
buf
;

261 ()
Àn
;

262  
ENOTDIR
;

263 
	}
}

	@/home/trinity/src/kern/vfs/vfslist.c

35 
	#VFSINLINE


	)

37 
	~<ty≥s.h
>

38 
	~<kîn/î∫o.h
>

39 
	~<lib.h
>

40 
	~<¨øy.h
>

41 
	~<synch.h
>

42 
	~<vfs.h
>

43 
	~<fs.h
>

44 
	~<vnode.h
>

45 
	~<devi˚.h
>

77 
	sknowndev
 {

78 *
	mkd_«me
;

79 *
	mkd_øw«me
;

80 
devi˚
 *
	mkd_devi˚
;

81 
vnode
 *
	mkd_vnode
;

82 
fs
 *
	mkd_fs
;

86 
	#SWAP_FS
 ((
fs
 *)-1)

	)

88 
DECLARRAY
(
knowndev
, 
__UNUSED
 
ölöe
);

89 
DEFARRAY
(
knowndev
, 
__UNUSED
 
ölöe
);

91 
knowndev¨øy
 *
	gknowndevs
;

94 
lock
 *
	gvfs_biglock
;

95 
	gvfs_biglock_dïth
;

102 
	$vfs_boŸ°øp
()

104 
knowndevs
 = 
	`knowndev¨øy_¸óã
();

105 i‡(
knowndevs
==
NULL
) {

106 
	`∑nic
("vfs: CouldÇot create knowndevsárray\n");

109 
vfs_biglock
 = 
	`lock_¸óã
("vfs_biglock");

110 i‡(
vfs_biglock
==
NULL
) {

111 
	`∑nic
("vfs: CouldÇot create vfs bigÜock\n");

113 
vfs_biglock_dïth
 = 0;

115 
	`devnuŒ_¸óã
();

116 
	`£mfs_boŸ°øp
();

117 
	}
}

127 
	$vfs_biglock_acquúe
()

129 i‡(!
	`lock_do_i_hﬁd
(
vfs_biglock
)) {

130 
	`lock_acquúe
(
vfs_biglock
);

132 i‡(
vfs_biglock_dïth
 == 0) {

147 
	`lock_acquúe
(
vfs_biglock
);

149 
vfs_biglock_dïth
++;

150 
	}
}

153 
	$vfs_biglock_ªÀa£
()

155 
	`KASSERT
(
	`lock_do_i_hﬁd
(
vfs_biglock
));

156 
	`KASSERT
(
vfs_biglock_dïth
 > 0);

157 
vfs_biglock_dïth
--;

158 i‡(
vfs_biglock_dïth
 == 0) {

159 
	`lock_ªÀa£
(
vfs_biglock
);

161 
	}
}

163 
boﬁ


164 
	$vfs_biglock_do_i_hﬁd
()

166  
	`lock_do_i_hﬁd
(
vfs_biglock
);

167 
	}
}

173 
	$vfs_sync
()

175 
knowndev
 *
dev
;

176 
i
, 
num
;

178 
	`vfs_biglock_acquúe
();

180 
num
 = 
	`knowndev¨øy_num
(
knowndevs
);

181 
i
=0; i<
num
; i++) {

182 
dev
 = 
	`knowndev¨øy_gë
(
knowndevs
, 
i
);

183 i‡(
dev
->
kd_fs
 !
NULL
 && dev->kd_f†!
SWAP_FS
) {

184  
	`FSOP_SYNC
(
dev
->
kd_fs
);

188 
	`vfs_biglock_ªÀa£
();

191 
	}
}

198 
	$vfs_gëroŸ
(c⁄° *
dev«me
, 
vnode
 **
ªt
)

200 
knowndev
 *
kd
;

201 
i
, 
num
;

203 
	`KASSERT
(
	`vfs_biglock_do_i_hﬁd
());

205 
num
 = 
	`knowndev¨øy_num
(
knowndevs
);

206 
i
=0; i<
num
; i++) {

207 
kd
 = 
	`knowndev¨øy_gë
(
knowndevs
, 
i
);

218 i‡(
kd
->
kd_fs
 !
NULL
 && kd->kd_f†!
SWAP_FS
) {

219 c⁄° *
vﬁ«me
;

220 
vﬁ«me
 = 
	`FSOP_GETVOLNAME
(
kd
->
kd_fs
);

222 i‡(!
	`°rcmp
(
kd
->
kd_«me
, 
dev«me
) ||

223 (
vﬁ«me
!=
NULL
 && !
	`°rcmp
(vﬁ«me, 
dev«me
))) {

224  
	`FSOP_GETROOT
(
kd
->
kd_fs
, 
ªt
);

228 i‡(
kd
->
kd_øw«me
!=
NULL
 &&

229 !
	`°rcmp
(
kd
->
kd_«me
, 
dev«me
)) {

230  
ENXIO
;

239 i‡(!
	`°rcmp
(
kd
->
kd_«me
, 
dev«me
)) {

240 
	`KASSERT
(
kd
->
kd_fs
==
NULL
);

241 
	`KASSERT
(
kd
->
kd_øw«me
==
NULL
);

242 
	`KASSERT
(
kd
->
kd_devi˚
 !
NULL
);

243 
	`VOP_INCREF
(
kd
->
kd_vnode
);

244 *
ªt
 = 
kd
->
kd_vnode
;

252 i‡(
kd
->
kd_øw«me
!=
NULL
 && !
	`°rcmp
(kd->kd_øw«me, 
dev«me
)) {

253 
	`KASSERT
(
kd
->
kd_devi˚
 !
NULL
);

254 
	`VOP_INCREF
(
kd
->
kd_vnode
);

255 *
ªt
 = 
kd
->
kd_vnode
;

270  
ENODEV
;

271 
	}
}

277 
	$vfs_gëdev«me
(
fs
 *fs)

279 
knowndev
 *
kd
;

280 
i
, 
num
;

282 
	`KASSERT
(
fs
 !
NULL
);

284 
	`KASSERT
(
	`vfs_biglock_do_i_hﬁd
());

286 
num
 = 
	`knowndev¨øy_num
(
knowndevs
);

287 
i
=0; i<
num
; i++) {

288 
kd
 = 
	`knowndev¨øy_gë
(
knowndevs
, 
i
);

290 i‡(
kd
->
kd_fs
 =
fs
) {

297  
kd
->
kd_«me
;

301  
NULL
;

302 
	}
}

309 
	$mkøw«me
(c⁄° *
«me
)

311 *
s
 = 
	`kmÆloc
(
	`°æí
(
«me
)+3+1);

312 i‡(!
s
) {

313  
NULL
;

315 
	`°r˝y
(
s
, 
«me
);

316 
	`°rˇt
(
s
, "raw");

317  
s
;

318 
	}
}

326 
ölöe


328 
	$ßme°rög
(c⁄° *
a
, c⁄° *
b
)

330 i‡(
a
==
NULL
 || 
b
==NULL) {

333  !
	`°rcmp
(
a
, 
b
);

334 
	}
}

341 
ölöe


343 
	$ßme°rög3
(c⁄° *
a
, c⁄° *
b
, c⁄° *
c
, c⁄° *
d
)

345  
	`ßme°rög
(
a
,
b
Ë|| same°rög◊,
c
Ë|| same°rög◊,
d
);

346 
	}
}

355 
	$bad«mes
(c⁄° *
n1
, c⁄° *
n2
, c⁄° *
n3
)

357 c⁄° *
vﬁ«me
;

358 
i
, 
num
;

359 
knowndev
 *
kd
;

361 
	`KASSERT
(
	`vfs_biglock_do_i_hﬁd
());

363 
num
 = 
	`knowndev¨øy_num
(
knowndevs
);

364 
i
=0; i<
num
; i++) {

365 
kd
 = 
	`knowndev¨øy_gë
(
knowndevs
, 
i
);

367 i‡(
kd
->
kd_fs
 !
NULL
 && kd->kd_f†!
SWAP_FS
) {

368 
vﬁ«me
 = 
	`FSOP_GETVOLNAME
(
kd
->
kd_fs
);

369 i‡(
	`ßme°rög3
(
vﬁ«me
, 
n1
, 
n2
, 
n3
)) {

374 i‡(
	`ßme°rög3
(
kd
->
kd_øw«me
, 
n1
, 
n2
, 
n3
) ||

375 
	`ßme°rög3
(
kd
->
kd_«me
, 
n1
, 
n2
, 
n3
)) {

381 
	}
}

392 
	$vfs_dﬂdd
(c⁄° *
d«me
, 
mou¡abÀ
, 
devi˚
 *
dev
, 
fs
 *fs)

394 *
«me
=
NULL
, *
øw«me
=NULL;

395 
knowndev
 *
kd
=
NULL
;

396 
vnode
 *vnode=
NULL
;

397 c⁄° *
vﬁ«me
=
NULL
;

398 
ödex
;

399 
ªsu…
;

402 
ödex
 = 0;

404 
	`vfs_biglock_acquúe
();

406 
«me
 = 
	`k°rdup
(
d«me
);

407 i‡(
«me
==
NULL
) {

408 
ªsu…
 = 
ENOMEM
;

409 
Áû
;

411 i‡(
mou¡abÀ
) {

412 
øw«me
 = 
	`mkøw«me
(
«me
);

413 i‡(
øw«me
==
NULL
) {

414 
ªsu…
 = 
ENOMEM
;

415 
Áû
;

419 
vnode
 = 
	`dev_¸óã_vnode
(
dev
);

420 i‡(
vnode
==
NULL
) {

421 
ªsu…
 = 
ENOMEM
;

422 
Áû
;

425 
kd
 = 
	`kmÆloc
((
knowndev
));

426 i‡(
kd
==
NULL
) {

427 
ªsu…
 = 
ENOMEM
;

428 
Áû
;

431 
kd
->
kd_«me
 = 
«me
;

432 
kd
->
kd_øw«me
 = 
øw«me
;

433 
kd
->
kd_devi˚
 = 
dev
;

434 
kd
->
kd_vnode
 = 
vnode
;

435 
kd
->
kd_fs
 = 
fs
;

437 i‡(
fs
!=
NULL
) {

438 
vﬁ«me
 = 
	`FSOP_GETVOLNAME
(
fs
);

441 i‡(
	`bad«mes
(
«me
, 
øw«me
, 
vﬁ«me
)) {

442 
ªsu…
 = 
EEXIST
;

443 
Áû
;

446 
ªsu…
 = 
	`knowndev¨øy_add
(
knowndevs
, 
kd
, &
ödex
);

447 i‡(
ªsu…
) {

448 
Áû
;

451 i‡(
dev
 !
NULL
) {

453 
dev
->
d_devnumbî
 = 
ödex
+1;

456 
	`vfs_biglock_ªÀa£
();

459 
Áû
:

460 i‡(
«me
) {

461 
	`k‰ì
(
«me
);

463 i‡(
øw«me
) {

464 
	`k‰ì
(
øw«me
);

466 i‡(
vnode
) {

467 
	`dev_un¸óã_vnode
(
vnode
);

469 i‡(
kd
) {

470 
	`k‰ì
(
kd
);

473 
	`vfs_biglock_ªÀa£
();

474  
ªsu…
;

475 
	}
}

482 
	$vfs_adddev
(c⁄° *
dev«me
, 
devi˚
 *
dev
, 
mou¡abÀ
)

484  
	`vfs_dﬂdd
(
dev«me
, 
mou¡abÀ
, 
dev
, 
NULL
);

485 
	}
}

493 
	$vfs_addfs
(c⁄° *
dev«me
, 
fs
 *fs)

495  
	`vfs_dﬂdd
(
dev«me
, 0, 
NULL
, 
fs
);

496 
	}
}

506 
	$födmou¡
(c⁄° *
dev«me
, 
knowndev
 **
ªsu…
)

508 
knowndev
 *
dev
;

509 
i
, 
num
;

510 
boﬁ
 
found
 = 
Ál£
;

512 
	`KASSERT
(
	`vfs_biglock_do_i_hﬁd
());

514 
num
 = 
	`knowndev¨øy_num
(
knowndevs
);

515 
i
=0; !
found
 && i<
num
; i++) {

516 
dev
 = 
	`knowndev¨øy_gë
(
knowndevs
, 
i
);

517 i‡(
dev
->
kd_øw«me
==
NULL
) {

522 i‡(!
	`°rcmp
(
dev«me
, 
dev
->
kd_«me
)) {

523 *
ªsu…
 = 
dev
;

524 
found
 = 
åue
;

528  
found
 ? 0 : 
ENODEV
;

529 
	}
}

538 
	$vfs_mou¡
(c⁄° *
dev«me
, *
d©a
,

539 (*
mou¡func
)(*
d©a
, 
devi˚
 *, 
fs
 **
ªt
))

541 c⁄° *
vﬁ«me
;

542 
knowndev
 *
kd
;

543 
fs
 *fs;

544 
ªsu…
;

546 
	`vfs_biglock_acquúe
();

548 
ªsu…
 = 
	`födmou¡
(
dev«me
, &
kd
);

549 i‡(
ªsu…
) {

550 
	`vfs_biglock_ªÀa£
();

551  
ªsu…
;

554 i‡(
kd
->
kd_fs
 !
NULL
) {

555 
	`vfs_biglock_ªÀa£
();

556  
EBUSY
;

558 
	`KASSERT
(
kd
->
kd_øw«me
 !
NULL
);

559 
	`KASSERT
(
kd
->
kd_devi˚
 !
NULL
);

561 
ªsu…
 = 
	`mou¡func
(
d©a
, 
kd
->
kd_devi˚
, &
fs
);

562 i‡(
ªsu…
) {

563 
	`vfs_biglock_ªÀa£
();

564  
ªsu…
;

567 
	`KASSERT
(
fs
 !
NULL
);

568 
	`KASSERT
(
fs
 !
SWAP_FS
);

570 
kd
->
kd_fs
 = 
fs
;

572 
vﬁ«me
 = 
	`FSOP_GETVOLNAME
(
fs
);

573 
	`k¥ötf
("vfs: Mounted %s: on %s\n",

574 
vﬁ«me
 ? vﬁ«mê: 
kd
->
kd_«me
, kd->kd_name);

576 
	`vfs_biglock_ªÀa£
();

578 
	}
}

586 
	$vfs_sw≠⁄
(c⁄° *
dev«me
, 
vnode
 **
ªt
)

588 *
my«me
 = 
NULL
;

589 
size_t
 
Àn
;

590 
knowndev
 *
kd
;

591 
ªsu…
;

593 
Àn
 = 
	`°æí
(
dev«me
);

594 i‡(
Àn
 > 0 && 
dev«me
[len - 1] == ':') {

596 
my«me
 = 
	`k°rdup
(
dev«me
);

597 i‡(
my«me
 =
NULL
) {

598  
ENOMEM
;

600 
my«me
[
Àn
 - 1] = 0;

601 
dev«me
 = 
my«me
;

604 
	`vfs_biglock_acquúe
();

606 
ªsu…
 = 
	`födmou¡
(
dev«me
, &
kd
);

607 i‡(
ªsu…
) {

608 
out
;

611 i‡(
kd
->
kd_fs
 !
NULL
) {

612 
ªsu…
 = 
EBUSY
;

613 
out
;

615 
	`KASSERT
(
kd
->
kd_øw«me
 !
NULL
);

616 
	`KASSERT
(
kd
->
kd_devi˚
 !
NULL
);

618 
	`k¥ötf
("vfs: Sw≠áâachedÅÿ%s\n", 
kd
->
kd_«me
);

620 
kd
->
kd_fs
 = 
SWAP_FS
;

621 
	`VOP_INCREF
(
kd
->
kd_vnode
);

622 *
ªt
 = 
kd
->
kd_vnode
;

624 
out
:

625 
	`vfs_biglock_ªÀa£
();

626 i‡(
my«me
 !
NULL
) {

627 
	`k‰ì
(
my«me
);

630  
ªsu…
;

631 
	}
}

638 
	$vfs_unmou¡
(c⁄° *
dev«me
)

640 
knowndev
 *
kd
;

641 
ªsu…
;

643 
	`vfs_biglock_acquúe
();

645 
ªsu…
 = 
	`födmou¡
(
dev«me
, &
kd
);

646 i‡(
ªsu…
) {

647 
Áû
;

650 i‡(
kd
->
kd_fs
 =
NULL
 || kd->kd_f†=
SWAP_FS
) {

651 
ªsu…
 = 
EINVAL
;

652 
Áû
;

654 
	`KASSERT
(
kd
->
kd_øw«me
 !
NULL
);

655 
	`KASSERT
(
kd
->
kd_devi˚
 !
NULL
);

658 
ªsu…
 = 
	`FSOP_SYNC
(
kd
->
kd_fs
);

659 i‡(
ªsu…
) {

660 
Áû
;

663 
ªsu…
 = 
	`FSOP_UNMOUNT
(
kd
->
kd_fs
);

664 i‡(
ªsu…
) {

665 
Áû
;

668 
	`k¥ötf
("vfs: Unmou¡ed %s:\n", 
kd
->
kd_«me
);

671 
kd
->
kd_fs
 = 
NULL
;

673 
	`KASSERT
(
ªsu…
==0);

675 
Áû
:

676 
	`vfs_biglock_ªÀa£
();

677  
ªsu…
;

678 
	}
}

688 
	$vfs_sw≠off
(c⁄° *
dev«me
)

690 
knowndev
 *
kd
;

691 
ªsu…
;

693 
	`vfs_biglock_acquúe
();

695 
ªsu…
 = 
	`födmou¡
(
dev«me
, &
kd
);

696 i‡(
ªsu…
) {

697 
Áû
;

700 i‡(
kd
->
kd_fs
 !
SWAP_FS
) {

701 
ªsu…
 = 
EINVAL
;

702 
Áû
;

705 
	`k¥ötf
("vfs: Sw≠ dëached from %s:\n", 
kd
->
kd_«me
);

708 
kd
->
kd_fs
 = 
NULL
;

710 
	`KASSERT
(
ªsu…
==0);

712 
Áû
:

713 
	`vfs_biglock_ªÀa£
();

714  
ªsu…
;

715 
	}
}

721 
	$vfs_unmou¡Æl
()

723 
knowndev
 *
dev
;

724 
i
, 
num
;

725 
ªsu…
;

727 
	`vfs_biglock_acquúe
();

729 
num
 = 
	`knowndev¨øy_num
(
knowndevs
);

730 
i
=0; i<
num
; i++) {

731 
dev
 = 
	`knowndev¨øy_gë
(
knowndevs
, 
i
);

732 i‡(
dev
->
kd_øw«me
 =
NULL
) {

736 i‡(
dev
->
kd_fs
 =
NULL
) {

740 i‡(
dev
->
kd_fs
 =
SWAP_FS
) {

742 
dev
->
kd_fs
 = 
NULL
;

746 
	`k¥ötf
("vfs: Unmou¡ög %s:\n", 
dev
->
kd_«me
);

748 
ªsu…
 = 
	`FSOP_SYNC
(
dev
->
kd_fs
);

749 i‡(
ªsu…
) {

750 
	`k¥ötf
("vfs: Warning: sync failed for %s: %s,Årying "

751 "agaö\n", 
dev
->
kd_«me
, 
	`°ªº‹
(
ªsu…
));

753 
ªsu…
 = 
	`FSOP_SYNC
(
dev
->
kd_fs
);

754 i‡(
ªsu…
) {

755 
	`k¥ötf
("vfs: Warning: sync failed secondÅime"

757 
dev
->
kd_«me
, 
	`°ªº‹
(
ªsu…
));

766 
ªsu…
 = 
	`FSOP_UNMOUNT
(
dev
->
kd_fs
);

767 i‡(
ªsu…
 =
EBUSY
) {

768 
	`k¥ötf
("vfs: Cannot unmount %s: (busy)\n",

769 
dev
->
kd_«me
);

772 i‡(
ªsu…
) {

773 
	`k¥ötf
("vfs: Warning: unmount failed for %s:"

775 
dev
->
kd_«me
, 
	`°ªº‹
(
ªsu…
));

780 
dev
->
kd_fs
 = 
NULL
;

783 
	`vfs_biglock_ªÀa£
();

786 
	}
}

	@/home/trinity/src/kern/vfs/vfslookup.c

34 
	~<ty≥s.h
>

35 
	~<kîn/î∫o.h
>

36 
	~<limôs.h
>

37 
	~<lib.h
>

38 
	~<synch.h
>

39 
	~<vfs.h
>

40 
	~<fs.h
>

41 
	~<vnode.h
>

43 
vnode
 *
	gboŸfs_vnode
 = 
NULL
;

50 
	$ch™ge_boŸfs
(
vnode
 *
√wvn
)

52 
vnode
 *
ﬁdvn
;

54 
ﬁdvn
 = 
boŸfs_vnode
;

55 
boŸfs_vnode
 = 
√wvn
;

57 i‡(
ﬁdvn
 !
NULL
) {

58 
	`VOP_DECREF
(
ﬁdvn
);

60 
	}
}

71 
	$vfs_£tboŸfs
(c⁄° *
f¢ame
)

73 
tmp
[
NAME_MAX
+1];

74 *
s
;

75 
ªsu…
;

76 
vnode
 *
√wguy
;

78 
	`vfs_biglock_acquúe
();

80 
	`¢¥ötf
(
tmp
, —mp)-1, "%s", 
f¢ame
);

81 
s
 = 
	`°rchr
(
tmp
, ':');

82 i‡(
s
) {

84 i‡(
	`°æí
(
s
)>0) {

85 
	`vfs_biglock_ªÀa£
();

86  
EINVAL
;

90 
	`°rˇt
(
tmp
, ":");

93 
ªsu…
 = 
	`vfs_chdú
(
tmp
);

94 i‡(
ªsu…
) {

95 
	`vfs_biglock_ªÀa£
();

96  
ªsu…
;

99 
ªsu…
 = 
	`vfs_gëcurdú
(&
√wguy
);

100 i‡(
ªsu…
) {

101 
	`vfs_biglock_ªÀa£
();

102  
ªsu…
;

105 
	`ch™ge_boŸfs
(
√wguy
);

107 
	`vfs_biglock_ªÀa£
();

109 
	}
}

115 
	$vfs_˛órboŸfs
()

117 
	`vfs_biglock_acquúe
();

118 
	`ch™ge_boŸfs
(
NULL
);

119 
	`vfs_biglock_ªÀa£
();

120 
	}
}

130 
	$gëdevi˚
(*
∑th
, **
sub∑th
, 
vnode
 **
°¨tvn
)

132 
¶ash
=-1, 
cﬁ⁄
=-1, 
i
;

133 
vnode
 *
vn
;

134 
ªsu…
;

136 
	`KASSERT
(
	`vfs_biglock_do_i_hﬁd
());

141 i‡(
∑th
[0] == 0) {

142  
EINVAL
;

149 
i
=0; 
∑th
[i]; i++) {

150 i‡(
∑th
[
i
]==':') {

151 
cﬁ⁄
 = 
i
;

154 i‡(
∑th
[
i
]=='/') {

155 
¶ash
 = 
i
;

160 i‡(
cﬁ⁄
 < 0 && 
¶ash
 != 0) {

168 *
sub∑th
 = 
∑th
;

169  
	`vfs_gëcurdú
(
°¨tvn
);

172 i‡(
cﬁ⁄
>0) {

174 
∑th
[
cﬁ⁄
]=0;

175 
∑th
[
cﬁ⁄
+1]=='/') {

177 
cﬁ⁄
++;

179 *
sub∑th
 = &
∑th
[
cﬁ⁄
+1];

181 
ªsu…
 = 
	`vfs_gëroŸ
(
∑th
, 
°¨tvn
);

182 i‡(
ªsu…
) {

183  
ªsu…
;

195 
	`KASSERT
(
cﬁ⁄
==0 || 
¶ash
==0);

197 i‡(
∑th
[0]=='/') {

198 i‡(
boŸfs_vnode
==
NULL
) {

199  
ENOENT
;

201 
	`VOP_INCREF
(
boŸfs_vnode
);

202 *
°¨tvn
 = 
boŸfs_vnode
;

205 
	`KASSERT
(
∑th
[0]==':');

207 
ªsu…
 = 
	`vfs_gëcurdú
(&
vn
);

208 i‡(
ªsu…
) {

209  
ªsu…
;

216 
	`KASSERT
(
vn
->
vn_fs
!=
NULL
);

218 
ªsu…
 = 
	`FSOP_GETROOT
(
vn
->
vn_fs
, 
°¨tvn
);

220 
	`VOP_DECREF
(
vn
);

222 i‡(
ªsu…
) {

223  
ªsu…
;

227 
∑th
[1]=='/') {

229 
∑th
++;

232 *
sub∑th
 = 
∑th
+1;

235 
	}
}

243 
	$vfs_look∑ª¡
(*
∑th
, 
vnode
 **
ªtvÆ
,

244 *
buf
, 
size_t
 
buÊí
)

246 
vnode
 *
°¨tvn
;

247 
ªsu…
;

249 
	`vfs_biglock_acquúe
();

251 
ªsu…
 = 
	`gëdevi˚
(
∑th
, &∑th, &
°¨tvn
);

252 i‡(
ªsu…
) {

253 
	`vfs_biglock_ªÀa£
();

254  
ªsu…
;

257 i‡(
	`°æí
(
∑th
)==0) {

263 
ªsu…
 = 
EINVAL
;

266 
ªsu…
 = 
	`VOP_LOOKPARENT
(
°¨tvn
, 
∑th
, 
ªtvÆ
, 
buf
, 
buÊí
);

269 
	`VOP_DECREF
(
°¨tvn
);

271 
	`vfs_biglock_ªÀa£
();

272  
ªsu…
;

273 
	}
}

276 
	$vfs_lookup
(*
∑th
, 
vnode
 **
ªtvÆ
)

278 
vnode
 *
°¨tvn
;

279 
ªsu…
;

281 
	`vfs_biglock_acquúe
();

283 
ªsu…
 = 
	`gëdevi˚
(
∑th
, &∑th, &
°¨tvn
);

284 i‡(
ªsu…
) {

285 
	`vfs_biglock_ªÀa£
();

286  
ªsu…
;

289 i‡(
	`°æí
(
∑th
)==0) {

290 *
ªtvÆ
 = 
°¨tvn
;

291 
	`vfs_biglock_ªÀa£
();

295 
ªsu…
 = 
	`VOP_LOOKUP
(
°¨tvn
, 
∑th
, 
ªtvÆ
);

297 
	`VOP_DECREF
(
°¨tvn
);

298 
	`vfs_biglock_ªÀa£
();

299  
ªsu…
;

300 
	}
}

	@/home/trinity/src/kern/vfs/vfspath.c

34 
	~<ty≥s.h
>

35 
	~<kîn/î∫o.h
>

36 
	~<kîn/f˙é.h
>

37 
	~<limôs.h
>

38 
	~<lib.h
>

39 
	~<vfs.h
>

40 
	~<vnode.h
>

45 
	$vfs_›í
(*
∑th
, 
›íÊags
, 
mode_t
 
mode
, 
vnode
 **
ªt
)

47 
how
;

48 
ªsu…
;

49 
ˇnwrôe
;

50 
vnode
 *
vn
 = 
NULL
;

52 
how
 = 
›íÊags
 & 
O_ACCMODE
;

54 
how
) {

55 
O_RDONLY
:

56 
ˇnwrôe
=0;

58 
O_WRONLY
:

59 
O_RDWR
:

60 
ˇnwrôe
=1;

63  
EINVAL
;

66 i‡(
›íÊags
 & 
O_CREAT
) {

67 
«me
[
NAME_MAX
+1];

68 
vnode
 *
dú
;

69 
ex˛
 = (
›íÊags
 & 
O_EXCL
)!=0;

71 
ªsu…
 = 
	`vfs_look∑ª¡
(
∑th
, &
dú
, 
«me
, (name));

72 i‡(
ªsu…
) {

73  
ªsu…
;

76 
ªsu…
 = 
	`VOP_CREAT
(
dú
, 
«me
, 
ex˛
, 
mode
, &
vn
);

78 
	`VOP_DECREF
(
dú
);

81 
ªsu…
 = 
	`vfs_lookup
(
∑th
, &
vn
);

84 i‡(
ªsu…
) {

85  
ªsu…
;

88 
	`KASSERT
(
vn
 !
NULL
);

90 
ªsu…
 = 
	`VOP_EACHOPEN
(
vn
, 
›íÊags
);

91 i‡(
ªsu…
) {

92 
	`VOP_DECREF
(
vn
);

93  
ªsu…
;

96 i‡(
›íÊags
 & 
O_TRUNC
) {

97 i‡(
ˇnwrôe
==0) {

98 
ªsu…
 = 
EINVAL
;

101 
ªsu…
 = 
	`VOP_TRUNCATE
(
vn
, 0);

103 i‡(
ªsu…
) {

104 
	`VOP_DECREF
(
vn
);

105  
ªsu…
;

109 *
ªt
 = 
vn
;

112 
	}
}

116 
	$vfs_˛o£
(
vnode
 *
vn
)

132 
	`VOP_DECREF
(
vn
);

133 
	}
}

137 
	$vfs_ªmove
(*
∑th
)

139 
vnode
 *
dú
;

140 
«me
[
NAME_MAX
+1];

141 
ªsu…
;

143 
ªsu…
 = 
	`vfs_look∑ª¡
(
∑th
, &
dú
, 
«me
, (name));

144 i‡(
ªsu…
) {

145  
ªsu…
;

148 
ªsu…
 = 
	`VOP_REMOVE
(
dú
, 
«me
);

149 
	`VOP_DECREF
(
dú
);

151  
ªsu…
;

152 
	}
}

156 
	$vfs_ª«me
(*
ﬁd∑th
, *
√w∑th
)

158 
vnode
 *
ﬁddú
;

159 
ﬁd«me
[
NAME_MAX
+1];

160 
vnode
 *
√wdú
;

161 
√w«me
[
NAME_MAX
+1];

162 
ªsu…
;

164 
ªsu…
 = 
	`vfs_look∑ª¡
(
ﬁd∑th
, &
ﬁddú
, 
ﬁd«me
, (oldname));

165 i‡(
ªsu…
) {

166  
ªsu…
;

168 
ªsu…
 = 
	`vfs_look∑ª¡
(
√w∑th
, &
√wdú
, 
√w«me
, (newname));

169 i‡(
ªsu…
) {

170 
	`VOP_DECREF
(
ﬁddú
);

171  
ªsu…
;

174 i‡(
ﬁddú
->
vn_fs
==
NULL
 || 
√wdú
->vn_fs==NULL ||

175 
ﬁddú
->
vn_fs
 !
√wdú
->vn_fs) {

176 
	`VOP_DECREF
(
√wdú
);

177 
	`VOP_DECREF
(
ﬁddú
);

178  
EXDEV
;

181 
ªsu…
 = 
	`VOP_RENAME
(
ﬁddú
, 
ﬁd«me
, 
√wdú
, 
√w«me
);

183 
	`VOP_DECREF
(
√wdú
);

184 
	`VOP_DECREF
(
ﬁddú
);

186  
ªsu…
;

187 
	}
}

191 
	$vfs_lök
(*
ﬁd∑th
, *
√w∑th
)

193 
vnode
 *
ﬁdfûe
;

194 
vnode
 *
√wdú
;

195 
√w«me
[
NAME_MAX
+1];

196 
ªsu…
;

198 
ªsu…
 = 
	`vfs_lookup
(
ﬁd∑th
, &
ﬁdfûe
);

199 i‡(
ªsu…
) {

200  
ªsu…
;

202 
ªsu…
 = 
	`vfs_look∑ª¡
(
√w∑th
, &
√wdú
, 
√w«me
, (newname));

203 i‡(
ªsu…
) {

204 
	`VOP_DECREF
(
ﬁdfûe
);

205  
ªsu…
;

208 i‡(
ﬁdfûe
->
vn_fs
==
NULL
 || 
√wdú
->vn_fs==NULL ||

209 
ﬁdfûe
->
vn_fs
 !
√wdú
->vn_fs) {

210 
	`VOP_DECREF
(
√wdú
);

211 
	`VOP_DECREF
(
ﬁdfûe
);

212  
EXDEV
;

215 
ªsu…
 = 
	`VOP_LINK
(
√wdú
, 
√w«me
, 
ﬁdfûe
);

217 
	`VOP_DECREF
(
√wdú
);

218 
	`VOP_DECREF
(
ﬁdfûe
);

220  
ªsu…
;

221 
	}
}

231 
	$vfs_symlök
(c⁄° *
c⁄ã¡s
, *
∑th
)

233 
vnode
 *
√wdú
;

234 
√w«me
[
NAME_MAX
+1];

235 
ªsu…
;

237 
ªsu…
 = 
	`vfs_look∑ª¡
(
∑th
, &
√wdú
, 
√w«me
, (newname));

238 i‡(
ªsu…
) {

239  
ªsu…
;

242 
ªsu…
 = 
	`VOP_SYMLINK
(
√wdú
, 
√w«me
, 
c⁄ã¡s
);

243 
	`VOP_DECREF
(
√wdú
);

245  
ªsu…
;

246 
	}
}

256 
	$vfs_ªadlök
(*
∑th
, 
uio
 *uio)

258 
vnode
 *
vn
;

259 
ªsu…
;

261 
ªsu…
 = 
	`vfs_lookup
(
∑th
, &
vn
);

262 i‡(
ªsu…
) {

263  
ªsu…
;

266 
ªsu…
 = 
	`VOP_READLINK
(
vn
, 
uio
);

268 
	`VOP_DECREF
(
vn
);

270  
ªsu…
;

271 
	}
}

277 
	$vfs_mkdú
(*
∑th
, 
mode_t
 
mode
)

279 
vnode
 *
∑ª¡
;

280 
«me
[
NAME_MAX
+1];

281 
ªsu…
;

283 
ªsu…
 = 
	`vfs_look∑ª¡
(
∑th
, &
∑ª¡
, 
«me
, (name));

284 i‡(
ªsu…
) {

285  
ªsu…
;

288 
ªsu…
 = 
	`VOP_MKDIR
(
∑ª¡
, 
«me
, 
mode
);

290 
	`VOP_DECREF
(
∑ª¡
);

292  
ªsu…
;

293 
	}
}

299 
	$vfs_rmdú
(*
∑th
)

301 
vnode
 *
∑ª¡
;

302 
«me
[
NAME_MAX
+1];

303 
ªsu…
;

305 
ªsu…
 = 
	`vfs_look∑ª¡
(
∑th
, &
∑ª¡
, 
«me
, (name));

306 i‡(
ªsu…
) {

307  
ªsu…
;

310 
ªsu…
 = 
	`VOP_RMDIR
(
∑ª¡
, 
«me
);

312 
	`VOP_DECREF
(
∑ª¡
);

314  
ªsu…
;

315 
	}
}

	@/home/trinity/src/kern/vfs/vnode.c

33 
	~<ty≥s.h
>

34 
	~<kîn/î∫o.h
>

35 
	~<lib.h
>

36 
	~<synch.h
>

37 
	~<vfs.h
>

38 
	~<vnode.h
>

44 
	$vnode_öô
(
vnode
 *
vn
, c⁄° 
vnode_›s
 *
›s
,

45 
fs
 *fs, *
fsd©a
)

47 
	`KASSERT
(
vn
 !
NULL
);

48 
	`KASSERT
(
›s
 !
NULL
);

50 
vn
->
vn_›s
 = 
›s
;

51 
vn
->
vn_ªfcou¡
 = 1;

52 
	`•ölock_öô
(&
vn
->
vn_cou¡lock
);

53 
vn
->
vn_fs
 = 
fs
;

54 
vn
->
vn_d©a
 = 
fsd©a
;

56 
	}
}

62 
	$vnode_˛ónup
(
vnode
 *
vn
)

64 
	`KASSERT
(
vn
->
vn_ªfcou¡
 == 1);

66 
	`•ölock_˛ónup
(&
vn
->
vn_cou¡lock
);

68 
vn
->
vn_›s
 = 
NULL
;

69 
vn
->
vn_ªfcou¡
 = 0;

70 
vn
->
vn_fs
 = 
NULL
;

71 
vn
->
vn_d©a
 = 
NULL
;

72 
	}
}

80 
	$vnode_ö¸ef
(
vnode
 *
vn
)

82 
	`KASSERT
(
vn
 !
NULL
);

84 
	`•ölock_acquúe
(&
vn
->
vn_cou¡lock
);

85 
vn
->
vn_ªfcou¡
++;

86 
	`•ölock_ªÀa£
(&
vn
->
vn_cou¡lock
);

87 
	}
}

95 
	$vnode_de¸ef
(
vnode
 *
vn
)

97 
boﬁ
 
de°roy
;

98 
ªsu…
;

100 
	`KASSERT
(
vn
 !
NULL
);

102 
	`•ölock_acquúe
(&
vn
->
vn_cou¡lock
);

104 
	`KASSERT
(
vn
->
vn_ªfcou¡
 > 0);

105 i‡(
vn
->
vn_ªfcou¡
 > 1) {

106 
vn
->
vn_ªfcou¡
--;

107 
de°roy
 = 
Ál£
;

111 
de°roy
 = 
åue
;

113 
	`•ölock_ªÀa£
(&
vn
->
vn_cou¡lock
);

115 i‡(
de°roy
) {

116 
ªsu…
 = 
	`VOP_RECLAIM
(
vn
);

117 i‡(
ªsu…
 !0 &&Ñesu… !
EBUSY
) {

119 
	`k¥ötf
("vfs: Warning: VOP_RECLAIM: %s\n",

120 
	`°ªº‹
(
ªsu…
));

123 
	}
}

130 
	$vnode_check
(
vnode
 *
v
, c⁄° *
›°r
)

135 i‡(
v
 =
NULL
) {

136 
	`∑nic
("vnode_check: v›_%s:ÇuŒ vnode\n", 
›°r
);

138 i‡(
v
 == (*)0xdeadbeef) {

139 
	`∑nic
("vnode_check: v›_%s: dódbì‡vnode\n", 
›°r
);

142 i‡(
v
->
vn_›s
 =
NULL
) {

143 
	`∑nic
("vnode_check: v›_%s:ÇuŒ op†poöãr\n", 
›°r
);

145 i‡(
v
->
vn_›s
 == (*)0xdeadbeef) {

146 
	`∑nic
("vnode_check: v›_%s: dódbì‡›†poöãr\n", 
›°r
);

149 i‡(
v
->
vn_›s
->
v›_magic
 !
VOP_MAGIC
) {

150 
	`∑nic
("vnode_check: vop_%s: ops with bad magicÇumber %lx\n",

151 
›°r
, 
v
->
vn_›s
->
v›_magic
);

158 i‡(
v
->
vn_fs
 == (*)0xdeadbeef) {

159 
	`∑nic
("vnode_check: v›_%s: dódbì‡f†poöãr\n", 
›°r
);

162 
	`•ölock_acquúe
(&
v
->
vn_cou¡lock
);

164 i‡(
v
->
vn_ªfcou¡
 < 0) {

165 
	`∑nic
("vnode_check: v›_%s:Çeg©ivêªfcou¡ %d\n", 
›°r
,

166 
v
->
vn_ªfcou¡
);

168 i‡(
v
->
vn_ªfcou¡
 == 0) {

169 
	`∑nic
("vnode_check: v›_%s: zîÿªfcou¡\n", 
›°r
);

171 i‡(
v
->
vn_ªfcou¡
 > 0x100000) {

172 
	`k¥ötf
("vnode_check: vop_%s: warning:ÜargeÑefcount %d\n",

173 
›°r
, 
v
->
vn_ªfcou¡
);

176 
	`•ölock_ªÀa£
(&
v
->
vn_cou¡lock
);

178 
	}
}

	@/home/trinity/src/kern/vm/addrspace.c

30 
	~<ty≥s.h
>

31 
	~<kîn/î∫o.h
>

32 
	~<lib.h
>

33 
	~<addr•a˚.h
>

34 
	~<vm.h
>

35 
	~<¥oc.h
>

43 
addr•a˚
 *

44 
	$as_¸óã
()

46 
addr•a˚
 *
as
;

48 
as
 = 
	`kmÆloc
((
addr•a˚
));

49 i‡(
as
 =
NULL
) {

50  
NULL
;

57  
as
;

58 
	}
}

61 
	$as_c›y
(
addr•a˚
 *
ﬁd
, addr•a˚ **
ªt
)

63 
addr•a˚
 *
√was
;

65 
√was
 = 
	`as_¸óã
();

66 i‡(
√was
==
NULL
) {

67  
ENOMEM
;

74 ()
ﬁd
;

76 *
ªt
 = 
√was
;

78 
	}
}

81 
	$as_de°roy
(
addr•a˚
 *
as
)

87 
	`k‰ì
(
as
);

88 
	}
}

91 
	$as_a˘iv©e
()

93 
addr•a˚
 *
as
;

95 
as
 = 
	`¥oc_gëas
();

96 i‡(
as
 =
NULL
) {

107 
	}
}

110 
	$as_dó˘iv©e
()

117 
	}
}

130 
	$as_deföe_ªgi⁄
(
addr•a˚
 *
as
, 
vaddr_t
 
vaddr
, 
size_t
 
memsize
,

131 
ªadabÀ
, 
wrôóbÀ
, 
execuèbÀ
)

137 ()
as
;

138 ()
vaddr
;

139 ()
memsize
;

140 ()
ªadabÀ
;

141 ()
wrôóbÀ
;

142 ()
execuèbÀ
;

143  
ENOSYS
;

144 
	}
}

147 
	$as_¥ï¨e_lﬂd
(
addr•a˚
 *
as
)

153 ()
as
;

155 
	}
}

158 
	$as_com∂ëe_lﬂd
(
addr•a˚
 *
as
)

164 ()
as
;

166 
	}
}

169 
	$as_deföe_°ack
(
addr•a˚
 *
as
, 
vaddr_t
 *
°ack±r
)

175 ()
as
;

178 *
°ack±r
 = 
USERSTACK
;

181 
	}
}

	@/home/trinity/src/kern/vm/copyinout.c

30 
	~<ty≥s.h
>

31 
	~<kîn/î∫o.h
>

32 
	~<lib.h
>

33 
	~<£tjmp.h
>

34 
	~<thªad.h
>

35 
	~<cuºít.h
>

36 
	~<vm.h
>

37 
	~<c›yöout.h
>

100 
	$c›yÁû
()

102 
	`l⁄gjmp
(
cuπhªad
->
t_machdï
.
tm_c›yjmp
, 1);

103 
	}
}

118 
	$c›ycheck
(
c⁄°_u£Ωå_t
 
u£Ωå
, 
size_t
 
Àn
, size_à*
°›Àn
)

120 
vaddr_t
 
bŸ
, 
t›
;

122 *
°›Àn
 = 
Àn
;

124 
bŸ
 = (
vaddr_t
Ë
u£Ωå
;

125 
t›
 = 
bŸ
+
Àn
-1;

127 i‡(
t›
 < 
bŸ
) {

129  
EFAULT
;

132 i‡(
bŸ
 >
USERSPACETOP
) {

134  
EFAULT
;

137 i‡(
t›
 >
USERSPACETOP
) {

139 *
°›Àn
 = 
USERSPACETOP
 - 
bŸ
;

143 
	}
}

153 
	$c›yö
(
c⁄°_u£Ωå_t
 
u£r§c
, *
de°
, 
size_t
 
Àn
)

155 
ªsu…
;

156 
size_t
 
°›Àn
;

158 
ªsu…
 = 
	`c›ycheck
(
u£r§c
, 
Àn
, &
°›Àn
);

159 i‡(
ªsu…
) {

160  
ªsu…
;

162 i‡(
°›Àn
 !
Àn
) {

164  
EFAULT
;

167 
cuπhªad
->
t_machdï
.
tm_badÁu…func
 = 
c›yÁû
;

169 
ªsu…
 = 
	`£tjmp
(
cuπhªad
->
t_machdï
.
tm_c›yjmp
);

170 i‡(
ªsu…
) {

171 
cuπhªad
->
t_machdï
.
tm_badÁu…func
 = 
NULL
;

172  
EFAULT
;

175 
	`mem˝y
(
de°
, (c⁄° *)
u£r§c
, 
Àn
);

177 
cuπhªad
->
t_machdï
.
tm_badÁu…func
 = 
NULL
;

179 
	}
}

189 
	$c›yout
(c⁄° *
§c
, 
u£Ωå_t
 
u£rde°
, 
size_t
 
Àn
)

191 
ªsu…
;

192 
size_t
 
°›Àn
;

194 
ªsu…
 = 
	`c›ycheck
(
u£rde°
, 
Àn
, &
°›Àn
);

195 i‡(
ªsu…
) {

196  
ªsu…
;

198 i‡(
°›Àn
 !
Àn
) {

200  
EFAULT
;

203 
cuπhªad
->
t_machdï
.
tm_badÁu…func
 = 
c›yÁû
;

205 
ªsu…
 = 
	`£tjmp
(
cuπhªad
->
t_machdï
.
tm_c›yjmp
);

206 i‡(
ªsu…
) {

207 
cuπhªad
->
t_machdï
.
tm_badÁu…func
 = 
NULL
;

208  
EFAULT
;

211 
	`mem˝y
((*)
u£rde°
, 
§c
, 
Àn
);

213 
cuπhªad
->
t_machdï
.
tm_badÁu…func
 = 
NULL
;

215 
	}
}

235 
	$c›y°r
(*
de°
, c⁄° *
§c
, 
size_t
 
maxÀn
, size_à
°›Àn
,

236 
size_t
 *
gŸÀn
)

238 
size_t
 
i
;

240 
i
=0; i<
maxÀn
 && i<
°›Àn
; i++) {

241 
de°
[
i
] = 
§c
[i];

242 i‡(
§c
[
i
] == 0) {

243 i‡(
gŸÀn
 !
NULL
) {

244 *
gŸÀn
 = 
i
+1;

249 i‡(
°›Àn
 < 
maxÀn
) {

251  
EFAULT
;

254  
ENAMETOOLONG
;

255 
	}
}

266 
	$c›yö°r
(
c⁄°_u£Ωå_t
 
u£r§c
, *
de°
, 
size_t
 
Àn
, size_à*
a˘uÆ
)

268 
ªsu…
;

269 
size_t
 
°›Àn
;

271 
ªsu…
 = 
	`c›ycheck
(
u£r§c
, 
Àn
, &
°›Àn
);

272 i‡(
ªsu…
) {

273  
ªsu…
;

276 
cuπhªad
->
t_machdï
.
tm_badÁu…func
 = 
c›yÁû
;

278 
ªsu…
 = 
	`£tjmp
(
cuπhªad
->
t_machdï
.
tm_c›yjmp
);

279 i‡(
ªsu…
) {

280 
cuπhªad
->
t_machdï
.
tm_badÁu…func
 = 
NULL
;

281  
EFAULT
;

284 
ªsu…
 = 
	`c›y°r
(
de°
, (c⁄° *)
u£r§c
, 
Àn
, 
°›Àn
, 
a˘uÆ
);

286 
cuπhªad
->
t_machdï
.
tm_badÁu…func
 = 
NULL
;

287  
ªsu…
;

288 
	}
}

299 
	$c›yout°r
(c⁄° *
§c
, 
u£Ωå_t
 
u£rde°
, 
size_t
 
Àn
, size_à*
a˘uÆ
)

301 
ªsu…
;

302 
size_t
 
°›Àn
;

304 
ªsu…
 = 
	`c›ycheck
(
u£rde°
, 
Àn
, &
°›Àn
);

305 i‡(
ªsu…
) {

306  
ªsu…
;

309 
cuπhªad
->
t_machdï
.
tm_badÁu…func
 = 
c›yÁû
;

311 
ªsu…
 = 
	`£tjmp
(
cuπhªad
->
t_machdï
.
tm_c›yjmp
);

312 i‡(
ªsu…
) {

313 
cuπhªad
->
t_machdï
.
tm_badÁu…func
 = 
NULL
;

314  
EFAULT
;

317 
ªsu…
 = 
	`c›y°r
((*)
u£rde°
, 
§c
, 
Àn
, 
°›Àn
, 
a˘uÆ
);

319 
cuπhªad
->
t_machdï
.
tm_badÁu…func
 = 
NULL
;

320  
ªsu…
;

321 
	}
}

	@/home/trinity/src/kern/vm/kmalloc.c

30 
	~<ty≥s.h
>

31 
	~<lib.h
>

32 
	~<•ölock.h
>

33 
	~<vm.h
>

34 
	~<kîn/ã°161.h
>

35 
	~<ã°.h
>

47 
	$fûl_dódbìf
(*
v±r
, 
size_t
 
Àn
)

49 
uöt32_t
 *
±r
 = 
v±r
;

50 
size_t
 
i
;

52 
i
=0; i<
Àn
/(
uöt32_t
); i++) {

53 
±r
[
i
] = 0xdeadbeef;

55 
	}
}

118 #unde‡
SLOW


119 #unde‡
SLOWER


120 #unde‡
GUARDS


121 #unde‡
LABELS


123 #unde‡
CHECKBEEF


124 #unde‡
CHECKGUARDS


128 #i‡
PAGE_SIZE
 == 4096

130 
	#NSIZES
 8

	)

131 c⁄° 
size_t
 
	gsizes
[
NSIZES
] = { 16, 32, 64, 128, 256, 512, 1024, 2048 };

133 
	#SMALLEST_SUBPAGE_SIZE
 16

	)

134 
	#LARGEST_SUBPAGE_SIZE
 2048

	)

136 #ñi‡
PAGE_SIZE
 == 8192

144 
	s‰ìli°
 {

145 
‰ìli°
 *
	m√xt
;

148 
	s∑gîef
 {

149 
∑gîef
 *
	m√xt_ßmesize
;

150 
∑gîef
 *
	m√xt_Æl
;

151 
vaddr_t
 
	m∑góddr_™d_blockty≥
;

152 
uöt16_t
 
	m‰ìli°_off£t
;

153 
uöt16_t
 
	mn‰ì
;

156 
	#INVALID_OFFSET
 (0xffff)

	)

158 
	#PR_PAGEADDR
(
¥
Ë(’r)->
∑góddr_™d_blockty≥
 & 
PAGE_FRAME
)

	)

159 
	#PR_BLOCKTYPE
(
¥
Ë(’r)->
∑góddr_™d_blockty≥
 & ~
PAGE_FRAME
)

	)

160 
	#MKPAB
(
∑
, 
blk
Ë((’a)&
PAGE_FRAME
Ë| ((blkË& ~PAGE_FRAME))

	)

171 
•ölock
 
	gkmÆloc_•ölock
 = 
SPINLOCK_INITIALIZER
;

183 
	#NPAGEREFS_PER_PAGE
 (
PAGE_SIZE
 / (
∑gîef
))

	)

185 
	s∑gîeÂage
 {

186 
∑gîef
 
	mªfs
[
NPAGEREFS_PER_PAGE
];

194 
	#INUSE_WORDS
 (
NPAGEREFS_PER_PAGE
 / 32)

	)

196 
	skhóp_roŸ
 {

197 
∑gîeÂage
 *
	m∑ge
;

198 
uöt32_t
 
	m∑gîefs_öu£
[
INUSE_WORDS
];

199 
	mnumöu£
;

212 
	#NUM_PAGEREFPAGES
 16

	)

213 
	#TOTAL_PAGEREFS
 (
NUM_PAGEREFPAGES
 * 
NPAGEREFS_PER_PAGE
)

	)

215 
khóp_roŸ
 
	gkhó¥oŸs
[
NUM_PAGEREFPAGES
];

222 
	$Ælo˝agîeÂage
(
khóp_roŸ
 *
roŸ
)

224 
vaddr_t
 
va
;

226 
	`KASSERT
(
roŸ
->
∑ge
 =
NULL
);

233 
	`•ölock_ªÀa£
(&
kmÆloc_•ölock
);

234 
va
 = 
	`Æloc_k∑ges
(1);

235 
	`•ölock_acquúe
(&
kmÆloc_•ölock
);

236 i‡(
va
 == 0) {

237 
	`k¥ötf
("kmalloc: Couldn't getáÖagerefÖage\n");

240 
	`KASSERT
(
va
 % 
PAGE_SIZE
 == 0);

242 i‡(
roŸ
->
∑ge
 !
NULL
) {

244 
	`•ölock_ªÀa£
(&
kmÆloc_•ölock
);

245 
	`‰ì_k∑ges
(
va
);

246 
	`•ölock_acquúe
(&
kmÆloc_•ölock
);

248 
	`KASSERT
(
roŸ
->
∑ge
 !
NULL
);

252 
roŸ
->
∑ge
 = (
∑gîeÂage
 *)
va
;

253 
	}
}

259 
∑gîef
 *

260 
	$Ælo˝agîef
()

262 
i
,
j
;

263 
uöt32_t
 
k
;

264 
whichroŸ
;

265 
khóp_roŸ
 *
roŸ
;

267 
whichroŸ
=0; whichroŸ < 
NUM_PAGEREFPAGES
; whichroot++) {

268 
roŸ
 = &
khó¥oŸs
[
whichroŸ
];

269 i‡(
roŸ
->
numöu£
 >
NPAGEREFS_PER_PAGE
) {

276 
i
=0; i<
INUSE_WORDS
; i++) {

277 i‡(
roŸ
->
∑gîefs_öu£
[
i
]==0xffffffff) {

281 
k
=1,
j
=0; k!=0; k<<=1,j++) {

282 i‡((
roŸ
->
∑gîefs_öu£
[
i
] & 
k
)==0) {

283 
roŸ
->
∑gîefs_öu£
[
i
] |
k
;

284 
roŸ
->
numöu£
++;

285 i‡(
roŸ
->
∑ge
 =
NULL
) {

286 
	`Ælo˝agîeÂage
(
roŸ
);

288 i‡(
roŸ
->
∑ge
 =
NULL
) {

289  
NULL
;

291  &
roŸ
->
∑ge
->
ªfs
[
i
*32 + 
j
];

294 
	`KASSERT
(0);

299  
NULL
;

300 
	}
}

307 
	$‰ì∑gîef
(
∑gîef
 *
p
)

309 
size_t
 
i
, 
j
;

310 
uöt32_t
 
k
;

311 
whichroŸ
;

312 
khóp_roŸ
 *
roŸ
;

313 
∑gîeÂage
 *
∑ge
;

315 
whichroŸ
=0; whichroŸ < 
NUM_PAGEREFPAGES
; whichroot++) {

316 
roŸ
 = &
khó¥oŸs
[
whichroŸ
];

318 
∑ge
 = 
roŸ
->page;

319 i‡(
∑ge
 =
NULL
) {

320 
	`KASSERT
(
roŸ
->
numöu£
 == 0);

324 
j
 = 
p
-
∑ge
->
ªfs
;

326 i‡(
j
 < 
NPAGEREFS_PER_PAGE
) {

328 
i
 = 
j
/32;

329 
k
 = ((
uöt32_t
)1Ë<< (
j
%32);

330 
	`KASSERT
((
roŸ
->
∑gîefs_öu£
[
i
] & 
k
) != 0);

331 
roŸ
->
∑gîefs_öu£
[
i
] &~
k
;

332 
	`KASSERT
(
roŸ
->
numöu£
 > 0);

333 
roŸ
->
numöu£
--;

338 
	`KASSERT
(0);

339 
	}
}

347 
∑gîef
 *
	gsizeba£s
[
NSIZES
];

348 
∑gîef
 *
	gÆlba£
;

352 #ifde‡
GUARDS


355 
	#GUARD_RETBYTE
 0xa9

	)

357 
	#GUARD_FILLBYTE
 0xba

	)

359 
	#GUARD_HALFWORD
 0xb0b0

	)

362 
	#GUARD_OVERHEAD
 8

	)

365 
	#GUARD_PTROFFSET
 4

	)

372 
	$e°ablishgu¨db™d
(*
block
, 
size_t
 
˛õ¡size
, size_à
blocksize
)

374 
vaddr_t
 
lowgu¨d
, 
lowsize
, 
d©a
, 
ídd©a
, 
highgu¨d
, 
highsize
, 
i
;

376 
	`KASSERT
(
˛õ¡size
 + 
GUARD_OVERHEAD
 <
blocksize
);

377 
	`KASSERT
(
˛õ¡size
 < 65536U);

379 
lowgu¨d
 = (
vaddr_t
)
block
;

380 
lowsize
 = 
lowgu¨d
 + 2;

381 
d©a
 = 
lowsize
 + 2;

382 
ídd©a
 = 
d©a
 + 
˛õ¡size
;

383 
highgu¨d
 = 
lowgu¨d
 + 
blocksize
 - 4;

384 
highsize
 = 
highgu¨d
 + 2;

386 *(
uöt16_t
 *)
lowgu¨d
 = 
GUARD_HALFWORD
;

387 *(
uöt16_t
 *)
lowsize
 = 
˛õ¡size
;

388 
i
=
d©a
; i<
ídd©a
; i++) {

389 *(
uöt8_t
 *)
i
 = 
GUARD_RETBYTE
;

391 
i
=
ídd©a
; i<
highgu¨d
; i++) {

392 *(
uöt8_t
 *)
i
 = 
GUARD_FILLBYTE
;

394 *(
uöt16_t
 *)
highgu¨d
 = 
GUARD_HALFWORD
;

395 *(
uöt16_t
 *)
highsize
 = 
˛õ¡size
;

397  (*)
d©a
;

398 
	}
}

405 
	$checkgu¨db™d
(
vaddr_t
 
blockaddr
, 
size_t
 
smÆÀrblocksize
, size_à
blocksize
)

419 
vaddr_t
 
lowgu¨d
, 
lowsize
, 
d©a
, 
ídd©a
, 
highgu¨d
, 
highsize
, 
i
;

420 
˛õ¡size
;

422 
lowgu¨d
 = 
blockaddr
;

423 
lowsize
 = 
lowgu¨d
 + 2;

424 
d©a
 = 
lowsize
 + 2;

425 
highgu¨d
 = 
blockaddr
 + 
blocksize
 - 4;

426 
highsize
 = 
highgu¨d
 + 2;

428 
	`KASSERT
(*(
uöt16_t
 *)
lowgu¨d
 =
GUARD_HALFWORD
);

429 
	`KASSERT
(*(
uöt16_t
 *)
highgu¨d
 =
GUARD_HALFWORD
);

430 
˛õ¡size
 = *(
uöt16_t
 *)
lowsize
;

431 
	`KASSERT
(
˛õ¡size
 =*(
uöt16_t
 *)
highsize
);

432 
	`KASSERT
(
˛õ¡size
 + 
GUARD_OVERHEAD
 > 
smÆÀrblocksize
);

433 
	`KASSERT
(
˛õ¡size
 + 
GUARD_OVERHEAD
 <
blocksize
);

434 
ídd©a
 = 
d©a
 + 
˛õ¡size
;

435 
i
=
ídd©a
; i<
highgu¨d
; i++) {

436 
	`KASSERT
(*(
uöt8_t
 *)
i
 =
GUARD_FILLBYTE
);

438 
	}
}

442 
	#GUARD_OVERHEAD
 0

	)

449 #ifde‡
SLOWER


450 #i‚de‡
SLOW


451 
	#SLOW


	)

455 #ifde‡
CHECKBEEF


464 
	$checkdódbìf
(*
block
, 
size_t
 
blocksize
)

466 
uöt32_t
 *
±r
 = 
block
;

467 
size_t
 
i
;

469 
i
=1; i < 
blocksize
/(
uöt32_t
); i++) {

470 
	`KASSERT
(
±r
[
i
] == 0xdeadbeef);

472 
	}
}

475 #ifde‡
SLOW


497 
	$checksub∑ge
(
∑gîef
 *
¥
)

499 
vaddr_t
 
¥∑ge
, 
Êa
;

500 
‰ìli°
 *
Ê
;

501 
blkty≥
;

502 
n‰ì
=0;

503 
size_t
 
blocksize
;

504 #ifde‡
CHECKGUARDS


505 c⁄° 
maxblocks
 = 
PAGE_SIZE
 / 
SMALLEST_SUBPAGE_SIZE
;

506 c⁄° 
num‰ìw‹ds
 = 
	`DIVROUNDUP
(
maxblocks
, 32);

507 
uöt32_t
 
is‰ì
[
num‰ìw‹ds
], 
mask
;

508 
numblocks
, 
blocknum
, 
i
;

509 
size_t
 
smÆÀrblocksize
;

512 
	`KASSERT
(
	`•ölock_do_i_hﬁd
(&
kmÆloc_•ölock
));

514 i‡(
¥
->
‰ìli°_off£t
 =
INVALID_OFFSET
) {

515 
	`KASSERT
(
¥
->
n‰ì
==0);

519 
¥∑ge
 = 
	`PR_PAGEADDR
(
¥
);

520 
blkty≥
 = 
	`PR_BLOCKTYPE
(
¥
);

521 
	`KASSERT
(
blkty≥
 >0 && blkty≥ < 
NSIZES
);

522 
blocksize
 = 
sizes
[
blkty≥
];

524 #ifde‡
CHECKGUARDS


525 
smÆÀrblocksize
 = 
blkty≥
 > 0 ? 
sizes
[blktype - 1] : 0;

526 
i
=0; i<
num‰ìw‹ds
; i++) {

527 
is‰ì
[
i
] = 0;

531 #ifde‡
__mùs__


532 
	`KASSERT
(
¥∑ge
 >
MIPS_KSEG0
);

533 
	`KASSERT
(
¥∑ge
 < 
MIPS_KSEG1
);

536 
	`KASSERT
(
¥
->
‰ìli°_off£t
 < 
PAGE_SIZE
);

537 
	`KASSERT
(
¥
->
‰ìli°_off£t
 % 
blocksize
 == 0);

539 
Êa
 = 
¥∑ge
 + 
¥
->
‰ìli°_off£t
;

540 
Ê
 = (
‰ìli°
 *)
Êa
;

542 ; 
Ê
 !
NULL
; f»Ê->
√xt
) {

543 
Êa
 = (
vaddr_t
)
Ê
;

544 
	`KASSERT
(
Êa
 >
¥∑ge
 && fœ <ÖΩagê+ 
PAGE_SIZE
);

545 
	`KASSERT
((
Êa
-
¥∑ge
Ë% 
blocksize
 == 0);

546 #ifde‡
CHECKBEEF


547 
	`checkdódbìf
(
Ê
, 
blocksize
);

549 #ifde‡
CHECKGUARDS


550 
blocknum
 = (
Êa
-
¥∑ge
Ë/ 
blocksize
;

551 
mask
 = 1U << (
blocknum
 % 32);

552 
	`KASSERT
((
is‰ì
[
blocknum
 / 32] & 
mask
) == 0);

553 
is‰ì
[
blocknum
 / 32] |
mask
;

555 
	`KASSERT
(
Ê
->
√xt
 != fl);

556 
n‰ì
++;

558 
	`KASSERT
(
n‰ì
==
¥
->nfree);

560 #ifde‡
CHECKGUARDS


561 
numblocks
 = 
PAGE_SIZE
 / 
blocksize
;

562 
i
=0; i<
numblocks
; i++) {

563 
mask
 = 1U << (
i
 % 32);

564 i‡((
is‰ì
[
i
 / 32] & 
mask
) == 0) {

565 
	`checkgu¨db™d
(
¥∑ge
 + 
i
 * 
blocksize
,

566 
smÆÀrblocksize
, 
blocksize
);

570 
	}
}

572 
	#checksub∑ge
(
¥
Ë(()’r))

	)

575 #ifde‡
SLOWER


582 
	$checksub∑ges
()

584 
∑gîef
 *
¥
;

585 
i
;

586 
sc
=0, 
ac
=0;

588 
	`KASSERT
(
	`•ölock_do_i_hﬁd
(&
kmÆloc_•ölock
));

590 
i
=0; i<
NSIZES
; i++) {

591 
¥
 = 
sizeba£s
[
i
];Ö∏!
NULL
;Ö∏¥->
√xt_ßmesize
) {

592 
	`checksub∑ge
(
¥
);

593 
	`KASSERT
(
sc
 < 
TOTAL_PAGEREFS
);

594 
sc
++;

598 
¥
 = 
Ælba£
;Ö∏!
NULL
;Ö∏¥->
√xt_Æl
) {

599 
	`checksub∑ge
(
¥
);

600 
	`KASSERT
(
ac
 < 
TOTAL_PAGEREFS
);

601 
ac
++;

604 
	`KASSERT
(
sc
==
ac
);

605 
	}
}

607 
	#checksub∑ges
()

	)

612 #ifde‡
LABELS


614 
	#LABEL_PTROFFSET
 (
mÆlo˛abñ
)

	)

615 
	#LABEL_OVERHEAD
 
LABEL_PTROFFSET


	)

617 
	smÆlo˛abñ
 {

618 
vaddr_t
 
	mœbñ
;

619 
	mgíî©i⁄
;

622 
	gmÆlocgíî©i⁄
;

629 
	$e°ablishœbñ
(*
block
, 
vaddr_t
 
œbñ
)

631 
mÆlo˛abñ
 *
ml
;

633 
ml
 = 
block
;

634 
ml
->
œbñ
 =Üabel;

635 
ml
->
gíî©i⁄
 = 
mÆlocgíî©i⁄
;

636 
ml
++;

637  
ml
;

638 
	}
}

642 
	$dump_sub∑ge
(
∑gîef
 *
¥
, 
gíî©i⁄
)

644 
blocksize
 = 
sizes
[
	`PR_BLOCKTYPE
(
¥
)];

645 
numblocks
 = 
PAGE_SIZE
 / 
blocksize
;

646 
num‰ìw‹ds
 = 
	`DIVROUNDUP
(
numblocks
, 32);

647 
uöt32_t
 
is‰ì
[
num‰ìw‹ds
], 
mask
;

648 
vaddr_t
 
¥∑ge
;

649 
‰ìli°
 *
Ê
;

650 
vaddr_t
 
blockaddr
;

651 
mÆlo˛abñ
 *
ml
;

652 
i
;

654 
i
=0; i<
num‰ìw‹ds
; i++) {

655 
is‰ì
[
i
] = 0;

658 
¥∑ge
 = 
	`PR_PAGEADDR
(
¥
);

659 
Ê
 = (
‰ìli°
 *)(
¥∑ge
 + 
¥
->
‰ìli°_off£t
);

660 ; 
Ê
 !
NULL
; f»Ê->
√xt
) {

661 
i
 = ((
vaddr_t
)
Ê
 - 
¥∑ge
Ë/ 
blocksize
;

662 
mask
 = 1U << (
i
 % 32);

663 
is‰ì
[
i
 / 32] |
mask
;

666 
i
=0; i<
numblocks
; i++) {

667 
mask
 = 1U << (
i
 % 32);

668 i‡(
is‰ì
[
i
 / 32] & 
mask
) {

671 
blockaddr
 = 
¥∑ge
 + 
i
 * 
blocksize
;

672 
ml
 = (
mÆlo˛abñ
 *)
blockaddr
;

673 i‡(
ml
->
gíî©i⁄
 != generation) {

676 
	`k¥ötf
("%5zu bytesát %p,állocatedát %p\n",

677 
blocksize
, (*)
blockaddr
, (*)
ml
->
œbñ
);

679 
	}
}

683 
	$dump_sub∑ges
(
gíî©i⁄
)

685 
∑gîef
 *
¥
;

686 
i
;

688 
	`k¥ötf
("RemaöögáŒoˇti⁄†‰om gíî©i⁄ %u:\n", 
gíî©i⁄
);

689 
i
=0; i<
NSIZES
; i++) {

690 
¥
 = 
sizeba£s
[
i
];Ö∏!
NULL
;Ö∏¥->
√xt_ßmesize
) {

691 
	`dump_sub∑ge
(
¥
, 
gíî©i⁄
);

694 
	}
}

698 
	#LABEL_OVERHEAD
 0

	)

703 
	$khóp_√xtgíî©i⁄
()

705 #ifde‡
LABELS


706 
	`•ölock_acquúe
(&
kmÆloc_•ölock
);

707 
mÆlocgíî©i⁄
++;

708 
	`•ölock_ªÀa£
(&
kmÆloc_•ölock
);

710 
	}
}

713 
	$khóp_dump
()

715 #ifde‡
LABELS


717 
	`•ölock_acquúe
(&
kmÆloc_•ölock
);

718 
	`dump_sub∑ges
(
mÆlocgíî©i⁄
);

719 
	`•ölock_ªÀa£
(&
kmÆloc_•ölock
);

721 
	`k¥ötf
("Enable LABELS in kmalloc.cÅo useÅhis functionality.\n");

723 
	}
}

726 
	$khóp_dum∑Œ
()

728 #ifde‡
LABELS


729 
i
;

732 
	`•ölock_acquúe
(&
kmÆloc_•ölock
);

733 
i
=0; i<=
mÆlocgíî©i⁄
; i++) {

734 
	`dump_sub∑ges
(
i
);

736 
	`•ölock_ªÀa£
(&
kmÆloc_•ölock
);

738 
	`k¥ötf
("Enable LABELS in kmalloc.cÅo useÅhis functionality.\n");

740 
	}
}

749 
	$sub∑ge_°©s
(
∑gîef
 *
¥
, 
boﬁ
 
quõt
)

751 
vaddr_t
 
¥∑ge
, 
Êa
;

752 
‰ìli°
 *
Ê
;

753 
blkty≥
;

754 
i
, 
n
, 
ödex
;

755 
uöt32_t
 
‰ìm≠
[
PAGE_SIZE
 / (
SMALLEST_SUBPAGE_SIZE
*32)];

757 
	`checksub∑ge
(
¥
);

758 
	`KASSERT
(
	`•ölock_do_i_hﬁd
(&
kmÆloc_•ölock
));

761 
i
=0; i<
	`ARRAYCOUNT
(
‰ìm≠
); i++) {

762 
‰ìm≠
[
i
] = 0;

765 
¥∑ge
 = 
	`PR_PAGEADDR
(
¥
);

766 
blkty≥
 = 
	`PR_BLOCKTYPE
(
¥
);

767 
	`KASSERT
(
blkty≥
 >0 && blkty≥ < 
NSIZES
);

770 
n
 = 
PAGE_SIZE
 / 
sizes
[
blkty≥
];

771 
	`KASSERT
(
n
 <32 * 
	`ARRAYCOUNT
(
‰ìm≠
));

773 i‡(
¥
->
‰ìli°_off£t
 !
INVALID_OFFSET
) {

774 
Êa
 = 
¥∑ge
 + 
¥
->
‰ìli°_off£t
;

775 
Ê
 = (
‰ìli°
 *)
Êa
;

777 ; 
Ê
 !
NULL
; f»Ê->
√xt
) {

778 
Êa
 = (
vaddr_t
)
Ê
;

779 
ödex
 = (
Êa
-
¥∑ge
Ë/ 
sizes
[
blkty≥
];

780 
	`KASSERT
(
ödex
<
n
);

781 
‰ìm≠
[
ödex
/32] |= (1<<(index%32));

785 i‡(!
quõt
) {

786 
	`k¥ötf
("at 0x%08lx: size %-4lu %u/%u free\n",

787 ()
¥∑ge
, (Ë
sizes
[
blkty≥
],

788 (Ë
¥
->
n‰ì
, 
n
);

789 
	`k¥ötf
(" ");

790 
i
=0; i<
n
; i++) {

791 
vÆ
 = (
‰ìm≠
[
i
/32] & (1<<(i%32)))!=0;

792 
	`k¥ötf
("%c", 
vÆ
 ? '.' : '*');

793 i‡(
i
%64==63 && i<
n
-1) {

794 
	`k¥ötf
("\n ");

797 
	`k¥ötf
("\n");

799  (()
sizes
[
blkty≥
] * (
n
 - (Ë
¥
->
n‰ì
));

800 
	}
}

806 
	$khóp_¥öt°©s
()

808 
∑gîef
 *
¥
;

811 
	`•ölock_acquúe
(&
kmÆloc_•ölock
);

813 
	`k¥ötf
("Subpageállocator status:\n");

815 
¥
 = 
Ælba£
;Ö∏!
NULL
;Ö∏¥->
√xt_Æl
) {

816 
	`sub∑ge_°©s
(
¥
, 
Ál£
);

819 
	`•ölock_ªÀa£
(&
kmÆloc_•ölock
);

820 
	}
}

828 
	$khóp_gëu£d
() {

829 
∑gîef
 *
¥
;

830 
tŸÆ
 = 0;

831 
num_∑ges
 = 0, 
c‹em≠_byãs
 = 0;

834 
	`•ölock_acquúe
(&
kmÆloc_•ölock
);

835 
¥
 = 
Ælba£
;Ö∏!
NULL
;Ö∏¥->
√xt_Æl
) {

836 
tŸÆ
 +
	`sub∑ge_°©s
(
¥
, 
åue
);

837 
num_∑ges
++;

840 
c‹em≠_byãs
 = 
	`c‹em≠_u£d_byãs
();

844 i‡(
c‹em≠_byãs
 > 0) {

845 
tŸÆ
 +
c‹em≠_byãs
 - (
num_∑ges
 * 
PAGE_SIZE
);

848 
	`•ölock_ªÀa£
(&
kmÆloc_•ölock
);

850  
tŸÆ
;

851 
	}
}

858 
	$khóp_¥ötu£d
()

860 
tŸÆ_°rög
[32];

861 
	`¢¥ötf
(
tŸÆ_°rög
, —ŸÆ_°rög), "%lu", 
	`khóp_gëu£d
());

862 
	`£˝rötf
(
SECRET
, 
tŸÆ_°rög
, "khu");

863 
	}
}

872 
	$ªmove_li°s
(
∑gîef
 *
¥
, 
blkty≥
)

874 
∑gîef
 **
guy
;

876 
	`KASSERT
(
blkty≥
>=0 && blkty≥<
NSIZES
);

878 
guy
 = &
sizeba£s
[
blkty≥
]; *guy; guy = &(*guy)->
√xt_ßmesize
) {

879 
	`checksub∑ge
(*
guy
);

880 i‡(*
guy
 =
¥
) {

881 *
guy
 = 
¥
->
√xt_ßmesize
;

886 
guy
 = &
Ælba£
; *guy; guy = &(*guy)->
√xt_Æl
) {

887 
	`checksub∑ge
(*
guy
);

888 i‡(*
guy
 =
¥
) {

889 *
guy
 = 
¥
->
√xt_Æl
;

893 
	}
}

900 
ölöe


901 
	$blockty≥
(
size_t
 
˛õ¡sz
)

903 
i
;

904 
i
=0; i<
NSIZES
; i++) {

905 i‡(
˛õ¡sz
 <
sizes
[
i
]) {

906  
i
;

910 
	`∑nic
("Subpageállocator cannot handleállocation of size %zu\n",

911 
˛õ¡sz
);

915 
	}
}

923 
sub∑ge_kmÆloc
(
size_t
 
sz


924 #ifde‡
LABELS


925 , 
vaddr_t
 
œbñ


929 
	gblkty≥
;

930 
∑gîef
 *
	g¥
;

931 
vaddr_t
 
	g¥∑ge
;

932 
vaddr_t
 
	gÊa
;

933 
‰ìli°
 *vﬁ©ûê
	gÊ
;

934 *
	gªçå
;

936 vﬁ©ûê
	gi
;

938 #ifde‡
GUARDS


939 
size_t
 
	g˛õ¡sz
;

942 #ifde‡
GUARDS


943 
	g˛õ¡sz
 = 
sz
;

944 
	gsz
 +
GUARD_OVERHEAD
;

946 #ifde‡
LABELS


947 #ifde‡
GUARDS


949 
	g˛õ¡sz
 +
LABEL_PTROFFSET
;

951 
	gsz
 +
LABEL_PTROFFSET
;

953 
	gblkty≥
 = 
blockty≥
(
sz
);

954 #ifde‡
GUARDS


955 
	gsz
 = 
sizes
[
blkty≥
];

958 
•ölock_acquúe
(&
kmÆloc_•ölock
);

960 
checksub∑ges
();

962 
	g¥
 = 
sizeba£s
[
blkty≥
];Ö∏!
NULL
;Ö∏
¥
->
√xt_ßmesize
) {

965 
KASSERT
(
PR_BLOCKTYPE
(
¥
Ë=
blkty≥
);

966 
checksub∑ge
(
¥
);

968 i‡(
	g¥
->
	gn‰ì
 > 0) {

970 
	gdﬂŒoc
:

972 
KASSERT
(
¥
->
‰ìli°_off£t
 < 
PAGE_SIZE
);

973 
	g¥∑ge
 = 
PR_PAGEADDR
(
¥
);

974 
	gÊa
 = 
¥∑ge
 + 
¥
->
‰ìli°_off£t
;

975 
	gÊ
 = (
‰ìli°
 *)
Êa
;

977 
	gªçå
 = 
Ê
;

978 
	gÊ
 = 
Ê
->
√xt
;

979 
	g¥
->
	gn‰ì
--;

981 i‡(
	gÊ
 !
NULL
) {

982 
KASSERT
(
¥
->
n‰ì
 > 0);

983 
	gÊa
 = (
vaddr_t
)
Ê
;

984 
KASSERT
(
Êa
 - 
¥∑ge
 < 
PAGE_SIZE
);

985 
	g¥
->
	g‰ìli°_off£t
 = 
Êa
 - 
¥∑ge
;

988 
KASSERT
(
¥
->
n‰ì
 == 0);

989 
	g¥
->
	g‰ìli°_off£t
 = 
INVALID_OFFSET
;

991 #ifde‡
GUARDS


992 
	gªçå
 = 
e°ablishgu¨db™d
(
ªçå
, 
˛õ¡sz
, 
sz
);

994 #ifde‡
LABELS


995 
	gªçå
 = 
e°ablishœbñ
(
ªçå
, 
œbñ
);

998 
checksub∑ges
();

1000 
•ölock_ªÀa£
(&
kmÆloc_•ölock
);

1001  
	gªçå
;

1014 
•ölock_ªÀa£
(&
kmÆloc_•ölock
);

1015 
	g¥∑ge
 = 
Æloc_k∑ges
(1);

1016 i‡(
	g¥∑ge
==0) {

1018 
sûít
("kmalloc: Subpageállocator couldn't getáÖage\n");

1019  
	gNULL
;

1021 
KASSERT
(
¥∑ge
 % 
PAGE_SIZE
 == 0);

1022 #ifde‡
CHECKBEEF


1024 
fûl_dódbìf
((*)
¥∑ge
, 
PAGE_SIZE
);

1026 
•ölock_acquúe
(&
kmÆloc_•ölock
);

1028 
	g¥
 = 
Ælo˝agîef
();

1029 i‡(
	g¥
==
NULL
) {

1031 
•ölock_ªÀa£
(&
kmÆloc_•ölock
);

1032 
‰ì_k∑ges
(
¥∑ge
);

1033 
k¥ötf
("kmalloc: Subpageállocator couldn't getÖageref\n");

1034  
	gNULL
;

1037 
	g¥
->
	g∑góddr_™d_blockty≥
 = 
MKPAB
(
¥∑ge
, 
blkty≥
);

1038 
	g¥
->
	gn‰ì
 = 
PAGE_SIZE
 / 
sizes
[
blkty≥
];

1046 
	gÊa
 = 
¥∑ge
;

1047 
	gÊ
 = (
‰ìli°
 *)
Êa
;

1048 
	gÊ
->
	g√xt
 = 
NULL
;

1049 
	gi
=1; i<
	g¥
->
	gn‰ì
; i++) {

1050 
	gÊ
 = (
‰ìli°
 *)(
Êa
 + 
i
*
sizes
[
blkty≥
]);

1051 
	gÊ
->
	g√xt
 = (
‰ìli°
 *)(
Êa
 + (
i
-1)*
sizes
[
blkty≥
]);

1052 
KASSERT
(
Ê
 !Ê->
√xt
);

1054 
	gÊa
 = (
vaddr_t
Ë
Ê
;

1055 
	g¥
->
	g‰ìli°_off£t
 = 
Êa
 - 
¥∑ge
;

1056 
KASSERT
(
¥
->
‰ìli°_off£t
 =’r->
n‰ì
-1)*
sizes
[
blkty≥
]);

1058 
	g¥
->
	g√xt_ßmesize
 = 
sizeba£s
[
blkty≥
];

1059 
	gsizeba£s
[
blkty≥
] = 
¥
;

1061 
	g¥
->
	g√xt_Æl
 = 
Ælba£
;

1062 
	gÆlba£
 = 
¥
;

1065 
	gdﬂŒoc
;

1074 
	$sub∑ge_k‰ì
(*
±r
)

1076 
blkty≥
;

1077 
vaddr_t
 
±øddr
;

1078 
∑gîef
 *
¥
;

1079 
vaddr_t
 
¥∑ge
;

1080 
vaddr_t
 
Êa
;

1081 
‰ìli°
 *
Ê
;

1082 
vaddr_t
 
off£t
;

1083 #ifde‡
GUARDS


1084 
size_t
 
blocksize
, 
smÆÀrblocksize
;

1087 
±øddr
 = (
vaddr_t
)
±r
;

1088 #ifde‡
GUARDS


1089 i‡(
±øddr
 % 
PAGE_SIZE
 == 0) {

1102 
±øddr
 -
GUARD_PTROFFSET
;

1104 #ifde‡
LABELS


1105 i‡(
±øddr
 % 
PAGE_SIZE
 == 0) {

1109 
±øddr
 -
LABEL_PTROFFSET
;

1112 
	`•ölock_acquúe
(&
kmÆloc_•ölock
);

1114 
	`checksub∑ges
();

1117 
¥∑ge
 = 0;

1118 
blkty≥
 = 0;

1120 
¥
 = 
Ælba£
;Ör;Ö∏¥->
√xt_Æl
) {

1121 
¥∑ge
 = 
	`PR_PAGEADDR
(
¥
);

1122 
blkty≥
 = 
	`PR_BLOCKTYPE
(
¥
);

1123 
	`KASSERT
(
blkty≥
 >0 && blkty≥ < 
NSIZES
);

1126 
	`KASSERT
(
blkty≥
>=0 && blkty≥<
NSIZES
);

1127 
	`checksub∑ge
(
¥
);

1129 i‡(
±øddr
 >
¥∑ge
 &&Öåadd∏<ÖΩagê+ 
PAGE_SIZE
) {

1134 i‡(
¥
==
NULL
) {

1136 
	`•ölock_ªÀa£
(&
kmÆloc_•ölock
);

1140 
off£t
 = 
±øddr
 - 
¥∑ge
;

1143 i‡(
off£t
 >
PAGE_SIZE
 || off£à% 
sizes
[
blkty≥
] != 0) {

1144 
	`∑nic
("k‰ì: sub∑gê‰ì o‡övÆidádd∏%p\n", 
±r
);

1147 #ifde‡
GUARDS


1148 
blocksize
 = 
sizes
[
blkty≥
];

1149 
smÆÀrblocksize
 = 
blkty≥
 > 0 ? 
sizes
[blktype - 1] : 0;

1150 
	`checkgu¨db™d
(
±øddr
, 
smÆÀrblocksize
, 
blocksize
);

1157 
	`fûl_dódbìf
((*)
±øddr
, 
sizes
[
blkty≥
]);

1164 
Êa
 = 
¥∑ge
 + 
off£t
;

1165 
Ê
 = (
‰ìli°
 *)
Êa
;

1166 i‡(
¥
->
‰ìli°_off£t
 =
INVALID_OFFSET
) {

1167 
Ê
->
√xt
 = 
NULL
;

1169 
Ê
->
√xt
 = (
‰ìli°
 *)(
¥∑ge
 + 
¥
->
‰ìli°_off£t
);

1172 #ifde‡
SLOW


1174 
‰ìli°
 *
Ê2
;

1176 
Ê2
 = 
Ê
->
√xt
; fl2 !
NULL
; fl2 = fl2->next) {

1177 
	`KASSERT
(
Ê2
 !
Ê
);

1182 
	`KASSERT
(
Ê
 !Ê->
√xt
);

1185 
¥
->
‰ìli°_off£t
 = 
off£t
;

1186 
¥
->
n‰ì
++;

1188 
	`KASSERT
(
¥
->
n‰ì
 <
PAGE_SIZE
 / 
sizes
[
blkty≥
]);

1189 i‡(
¥
->
n‰ì
 =
PAGE_SIZE
 / 
sizes
[
blkty≥
]) {

1191 
	`ªmove_li°s
(
¥
, 
blkty≥
);

1192 
	`‰ì∑gîef
(
¥
);

1194 
	`•ölock_ªÀa£
(&
kmÆloc_•ölock
);

1195 
	`‰ì_k∑ges
(
¥∑ge
);

1198 
	`•ölock_ªÀa£
(&
kmÆloc_•ölock
);

1201 #ifde‡
SLOWER


1202 
	`•ölock_acquúe
(&
kmÆloc_•ölock
);

1203 
	`checksub∑ges
();

1204 
	`•ölock_ªÀa£
(&
kmÆloc_•ölock
);

1208 
	}
}

1218 
	$kmÆloc
(
size_t
 
sz
)

1220 
size_t
 
checksz
;

1221 #ifde‡
LABELS


1222 
vaddr_t
 
œbñ
;

1225 #ifde‡
LABELS


1226 #ifde‡
__GNUC__


1227 
œbñ
 = (
vaddr_t
)
	`__buûtö_ªtu∫_addªss
(0);

1233 
checksz
 = 
sz
 + 
GUARD_OVERHEAD
 + 
LABEL_OVERHEAD
;

1234 i‡(
checksz
 >
LARGEST_SUBPAGE_SIZE
) {

1235 
≈ages
;

1236 
vaddr_t
 
addªss
;

1239 
≈ages
 = (
sz
 + 
PAGE_SIZE
 - 1)/PAGE_SIZE;

1240 
addªss
 = 
	`Æloc_k∑ges
(
≈ages
);

1241 i‡(
addªss
==0) {

1242  
NULL
;

1244 
	`KASSERT
(
addªss
 % 
PAGE_SIZE
 == 0);

1246  (*)
addªss
;

1249 #ifde‡
LABELS


1250  
	`sub∑ge_kmÆloc
(
sz
, 
œbñ
);

1252  
	`sub∑ge_kmÆloc
(
sz
);

1254 
	}
}

1260 
	$k‰ì
(*
±r
)

1265 i‡(
±r
 =
NULL
) {

1267 } i‡(
	`sub∑ge_k‰ì
(
±r
)) {

1268 
	`KASSERT
((
vaddr_t
)
±r
%
PAGE_SIZE
==0);

1269 
	`‰ì_k∑ges
((
vaddr_t
)
±r
);

1271 
	}
}

	@
1
.
0
337
16293
/home/trinity/src/kern/Makefile
/home/trinity/src/kern/arch/mips/include/current.h
/home/trinity/src/kern/arch/mips/include/elf.h
/home/trinity/src/kern/arch/mips/include/kern/endian.h
/home/trinity/src/kern/arch/mips/include/kern/regdefs.h
/home/trinity/src/kern/arch/mips/include/kern/setjmp.h
/home/trinity/src/kern/arch/mips/include/kern/signal.h
/home/trinity/src/kern/arch/mips/include/kern/types.h
/home/trinity/src/kern/arch/mips/include/membar.h
/home/trinity/src/kern/arch/mips/include/specialreg.h
/home/trinity/src/kern/arch/mips/include/spinlock.h
/home/trinity/src/kern/arch/mips/include/thread.h
/home/trinity/src/kern/arch/mips/include/tlb.h
/home/trinity/src/kern/arch/mips/include/trapframe.h
/home/trinity/src/kern/arch/mips/include/types.h
/home/trinity/src/kern/arch/mips/include/vm.h
/home/trinity/src/kern/arch/mips/locore/cache-mips161.S
/home/trinity/src/kern/arch/mips/locore/exception-mips1.S
/home/trinity/src/kern/arch/mips/locore/trap.c
/home/trinity/src/kern/arch/mips/syscall/syscall.c
/home/trinity/src/kern/arch/mips/thread/cpu.c
/home/trinity/src/kern/arch/mips/thread/switch.S
/home/trinity/src/kern/arch/mips/thread/switchframe.c
/home/trinity/src/kern/arch/mips/thread/switchframe.h
/home/trinity/src/kern/arch/mips/thread/thread_machdep.c
/home/trinity/src/kern/arch/mips/thread/threadstart.S
/home/trinity/src/kern/arch/mips/vm/dumbvm.c
/home/trinity/src/kern/arch/mips/vm/ram.c
/home/trinity/src/kern/arch/mips/vm/tlb-mips161.S
/home/trinity/src/kern/arch/sys161/dev/lamebus_machdep.c
/home/trinity/src/kern/arch/sys161/include/bus.h
/home/trinity/src/kern/arch/sys161/include/maxcpus.h
/home/trinity/src/kern/arch/sys161/main/start.S
/home/trinity/src/kern/compile/DUMBVM/.depend.__printf.c
/home/trinity/src/kern/compile/DUMBVM/.depend.adddi3.c
/home/trinity/src/kern/compile/DUMBVM/.depend.anddi3.c
/home/trinity/src/kern/compile/DUMBVM/.depend.array.c
/home/trinity/src/kern/compile/DUMBVM/.depend.arraytest.c
/home/trinity/src/kern/compile/DUMBVM/.depend.ashldi3.c
/home/trinity/src/kern/compile/DUMBVM/.depend.ashrdi3.c
/home/trinity/src/kern/compile/DUMBVM/.depend.atoi.c
/home/trinity/src/kern/compile/DUMBVM/.depend.autoconf.c
/home/trinity/src/kern/compile/DUMBVM/.depend.beep.c
/home/trinity/src/kern/compile/DUMBVM/.depend.beep_ltimer.c
/home/trinity/src/kern/compile/DUMBVM/.depend.bitmap.c
/home/trinity/src/kern/compile/DUMBVM/.depend.bitmaptest.c
/home/trinity/src/kern/compile/DUMBVM/.depend.bswap.c
/home/trinity/src/kern/compile/DUMBVM/.depend.bzero.c
/home/trinity/src/kern/compile/DUMBVM/.depend.cache-mips161.S
/home/trinity/src/kern/compile/DUMBVM/.depend.clock.c
/home/trinity/src/kern/compile/DUMBVM/.depend.cmpdi2.c
/home/trinity/src/kern/compile/DUMBVM/.depend.con_lser.c
/home/trinity/src/kern/compile/DUMBVM/.depend.console.c
/home/trinity/src/kern/compile/DUMBVM/.depend.copyinout.c
/home/trinity/src/kern/compile/DUMBVM/.depend.cpu.c
/home/trinity/src/kern/compile/DUMBVM/.depend.device.c
/home/trinity/src/kern/compile/DUMBVM/.depend.devnull.c
/home/trinity/src/kern/compile/DUMBVM/.depend.divdi3.c
/home/trinity/src/kern/compile/DUMBVM/.depend.dumbvm.c
/home/trinity/src/kern/compile/DUMBVM/.depend.emu.c
/home/trinity/src/kern/compile/DUMBVM/.depend.emu_att.c
/home/trinity/src/kern/compile/DUMBVM/.depend.exception-mips1.S
/home/trinity/src/kern/compile/DUMBVM/.depend.fstest.c
/home/trinity/src/kern/compile/DUMBVM/.depend.hmacunit.c
/home/trinity/src/kern/compile/DUMBVM/.depend.iordi3.c
/home/trinity/src/kern/compile/DUMBVM/.depend.kgets.c
/home/trinity/src/kern/compile/DUMBVM/.depend.kmalloc.c
/home/trinity/src/kern/compile/DUMBVM/.depend.kmalloctest.c
/home/trinity/src/kern/compile/DUMBVM/.depend.kprintf.c
/home/trinity/src/kern/compile/DUMBVM/.depend.lamebus.c
/home/trinity/src/kern/compile/DUMBVM/.depend.lamebus_machdep.c
/home/trinity/src/kern/compile/DUMBVM/.depend.lhd.c
/home/trinity/src/kern/compile/DUMBVM/.depend.lhd_att.c
/home/trinity/src/kern/compile/DUMBVM/.depend.lib.c
/home/trinity/src/kern/compile/DUMBVM/.depend.loadelf.c
/home/trinity/src/kern/compile/DUMBVM/.depend.lrandom.c
/home/trinity/src/kern/compile/DUMBVM/.depend.lrandom_att.c
/home/trinity/src/kern/compile/DUMBVM/.depend.lser.c
/home/trinity/src/kern/compile/DUMBVM/.depend.lser_att.c
/home/trinity/src/kern/compile/DUMBVM/.depend.lshldi3.c
/home/trinity/src/kern/compile/DUMBVM/.depend.lshrdi3.c
/home/trinity/src/kern/compile/DUMBVM/.depend.ltimer.c
/home/trinity/src/kern/compile/DUMBVM/.depend.ltimer_att.c
/home/trinity/src/kern/compile/DUMBVM/.depend.ltrace.c
/home/trinity/src/kern/compile/DUMBVM/.depend.ltrace_att.c
/home/trinity/src/kern/compile/DUMBVM/.depend.main.c
/home/trinity/src/kern/compile/DUMBVM/.depend.memcpy.c
/home/trinity/src/kern/compile/DUMBVM/.depend.memmove.c
/home/trinity/src/kern/compile/DUMBVM/.depend.memset.c
/home/trinity/src/kern/compile/DUMBVM/.depend.menu.c
/home/trinity/src/kern/compile/DUMBVM/.depend.misc.c
/home/trinity/src/kern/compile/DUMBVM/.depend.moddi3.c
/home/trinity/src/kern/compile/DUMBVM/.depend.muldi3.c
/home/trinity/src/kern/compile/DUMBVM/.depend.negdi2.c
/home/trinity/src/kern/compile/DUMBVM/.depend.notdi2.c
/home/trinity/src/kern/compile/DUMBVM/.depend.proc.c
/home/trinity/src/kern/compile/DUMBVM/.depend.qdivrem.c
/home/trinity/src/kern/compile/DUMBVM/.depend.ram.c
/home/trinity/src/kern/compile/DUMBVM/.depend.random.c
/home/trinity/src/kern/compile/DUMBVM/.depend.random_lrandom.c
/home/trinity/src/kern/compile/DUMBVM/.depend.rtclock.c
/home/trinity/src/kern/compile/DUMBVM/.depend.rtclock_ltimer.c
/home/trinity/src/kern/compile/DUMBVM/.depend.runprogram.c
/home/trinity/src/kern/compile/DUMBVM/.depend.rwtest.c
/home/trinity/src/kern/compile/DUMBVM/.depend.secure.c
/home/trinity/src/kern/compile/DUMBVM/.depend.semfs_fsops.c
/home/trinity/src/kern/compile/DUMBVM/.depend.semfs_obj.c
/home/trinity/src/kern/compile/DUMBVM/.depend.semfs_vnops.c
/home/trinity/src/kern/compile/DUMBVM/.depend.semunit.c
/home/trinity/src/kern/compile/DUMBVM/.depend.setjmp.S
/home/trinity/src/kern/compile/DUMBVM/.depend.sfs_balloc.c
/home/trinity/src/kern/compile/DUMBVM/.depend.sfs_bmap.c
/home/trinity/src/kern/compile/DUMBVM/.depend.sfs_dir.c
/home/trinity/src/kern/compile/DUMBVM/.depend.sfs_fsops.c
/home/trinity/src/kern/compile/DUMBVM/.depend.sfs_inode.c
/home/trinity/src/kern/compile/DUMBVM/.depend.sfs_io.c
/home/trinity/src/kern/compile/DUMBVM/.depend.sfs_vnops.c
/home/trinity/src/kern/compile/DUMBVM/.depend.sha256.c
/home/trinity/src/kern/compile/DUMBVM/.depend.snprintf.c
/home/trinity/src/kern/compile/DUMBVM/.depend.spinlock.c
/home/trinity/src/kern/compile/DUMBVM/.depend.spl.c
/home/trinity/src/kern/compile/DUMBVM/.depend.start.S
/home/trinity/src/kern/compile/DUMBVM/.depend.stoplight.c
/home/trinity/src/kern/compile/DUMBVM/.depend.strcat.c
/home/trinity/src/kern/compile/DUMBVM/.depend.strchr.c
/home/trinity/src/kern/compile/DUMBVM/.depend.strcmp.c
/home/trinity/src/kern/compile/DUMBVM/.depend.strcpy.c
/home/trinity/src/kern/compile/DUMBVM/.depend.strlen.c
/home/trinity/src/kern/compile/DUMBVM/.depend.strrchr.c
/home/trinity/src/kern/compile/DUMBVM/.depend.strtok_r.c
/home/trinity/src/kern/compile/DUMBVM/.depend.subdi3.c
/home/trinity/src/kern/compile/DUMBVM/.depend.switch.S
/home/trinity/src/kern/compile/DUMBVM/.depend.switchframe.c
/home/trinity/src/kern/compile/DUMBVM/.depend.synch.c
/home/trinity/src/kern/compile/DUMBVM/.depend.synchprobs.c
/home/trinity/src/kern/compile/DUMBVM/.depend.synchtest.c
/home/trinity/src/kern/compile/DUMBVM/.depend.syscall.c
/home/trinity/src/kern/compile/DUMBVM/.depend.test161.c
/home/trinity/src/kern/compile/DUMBVM/.depend.thread.c
/home/trinity/src/kern/compile/DUMBVM/.depend.thread_machdep.c
/home/trinity/src/kern/compile/DUMBVM/.depend.threadlist.c
/home/trinity/src/kern/compile/DUMBVM/.depend.threadlisttest.c
/home/trinity/src/kern/compile/DUMBVM/.depend.threadstart.S
/home/trinity/src/kern/compile/DUMBVM/.depend.threadtest.c
/home/trinity/src/kern/compile/DUMBVM/.depend.time.c
/home/trinity/src/kern/compile/DUMBVM/.depend.time_syscalls.c
/home/trinity/src/kern/compile/DUMBVM/.depend.tlb-mips161.S
/home/trinity/src/kern/compile/DUMBVM/.depend.trap.c
/home/trinity/src/kern/compile/DUMBVM/.depend.tt3.c
/home/trinity/src/kern/compile/DUMBVM/.depend.ucmpdi2.c
/home/trinity/src/kern/compile/DUMBVM/.depend.udivdi3.c
/home/trinity/src/kern/compile/DUMBVM/.depend.uio.c
/home/trinity/src/kern/compile/DUMBVM/.depend.umoddi3.c
/home/trinity/src/kern/compile/DUMBVM/.depend.vfscwd.c
/home/trinity/src/kern/compile/DUMBVM/.depend.vfsfail.c
/home/trinity/src/kern/compile/DUMBVM/.depend.vfslist.c
/home/trinity/src/kern/compile/DUMBVM/.depend.vfslookup.c
/home/trinity/src/kern/compile/DUMBVM/.depend.vfspath.c
/home/trinity/src/kern/compile/DUMBVM/.depend.vnode.c
/home/trinity/src/kern/compile/DUMBVM/.depend.whalemating.c
/home/trinity/src/kern/compile/DUMBVM/.depend.xordi3.c
/home/trinity/src/kern/compile/DUMBVM/Makefile
/home/trinity/src/kern/compile/DUMBVM/autoconf.c
/home/trinity/src/kern/compile/DUMBVM/autoconf.h
/home/trinity/src/kern/compile/DUMBVM/files.mk
/home/trinity/src/kern/compile/DUMBVM/opt-automationtest.h
/home/trinity/src/kern/compile/DUMBVM/opt-dumbvm.h
/home/trinity/src/kern/compile/DUMBVM/opt-hangman.h
/home/trinity/src/kern/compile/DUMBVM/opt-net.h
/home/trinity/src/kern/compile/DUMBVM/opt-netfs.h
/home/trinity/src/kern/compile/DUMBVM/opt-noasserts.h
/home/trinity/src/kern/compile/DUMBVM/opt-semfs.h
/home/trinity/src/kern/compile/DUMBVM/opt-sfs.h
/home/trinity/src/kern/compile/DUMBVM/opt-synchprobs.h
/home/trinity/src/kern/compile/DUMBVM/vers.c
/home/trinity/src/kern/dev/generic/beep.c
/home/trinity/src/kern/dev/generic/beep.h
/home/trinity/src/kern/dev/generic/console.c
/home/trinity/src/kern/dev/generic/console.h
/home/trinity/src/kern/dev/generic/random.c
/home/trinity/src/kern/dev/generic/random.h
/home/trinity/src/kern/dev/generic/rtclock.c
/home/trinity/src/kern/dev/generic/rtclock.h
/home/trinity/src/kern/dev/lamebus/beep_ltimer.c
/home/trinity/src/kern/dev/lamebus/con_lscreen.c
/home/trinity/src/kern/dev/lamebus/con_lser.c
/home/trinity/src/kern/dev/lamebus/emu.c
/home/trinity/src/kern/dev/lamebus/emu.h
/home/trinity/src/kern/dev/lamebus/emu_att.c
/home/trinity/src/kern/dev/lamebus/lamebus.c
/home/trinity/src/kern/dev/lamebus/lamebus.h
/home/trinity/src/kern/dev/lamebus/lhd.c
/home/trinity/src/kern/dev/lamebus/lhd.h
/home/trinity/src/kern/dev/lamebus/lhd_att.c
/home/trinity/src/kern/dev/lamebus/lnet.c
/home/trinity/src/kern/dev/lamebus/lnet_att.c
/home/trinity/src/kern/dev/lamebus/lrandom.c
/home/trinity/src/kern/dev/lamebus/lrandom.h
/home/trinity/src/kern/dev/lamebus/lrandom_att.c
/home/trinity/src/kern/dev/lamebus/lscreen.c
/home/trinity/src/kern/dev/lamebus/lscreen.h
/home/trinity/src/kern/dev/lamebus/lscreen_att.c
/home/trinity/src/kern/dev/lamebus/lser.c
/home/trinity/src/kern/dev/lamebus/lser.h
/home/trinity/src/kern/dev/lamebus/lser_att.c
/home/trinity/src/kern/dev/lamebus/ltimer.c
/home/trinity/src/kern/dev/lamebus/ltimer.h
/home/trinity/src/kern/dev/lamebus/ltimer_att.c
/home/trinity/src/kern/dev/lamebus/ltrace.c
/home/trinity/src/kern/dev/lamebus/ltrace.h
/home/trinity/src/kern/dev/lamebus/ltrace_att.c
/home/trinity/src/kern/dev/lamebus/random_lrandom.c
/home/trinity/src/kern/dev/lamebus/rtclock_ltimer.c
/home/trinity/src/kern/fs/semfs/semfs.h
/home/trinity/src/kern/fs/semfs/semfs_fsops.c
/home/trinity/src/kern/fs/semfs/semfs_obj.c
/home/trinity/src/kern/fs/semfs/semfs_vnops.c
/home/trinity/src/kern/fs/sfs/sfs_balloc.c
/home/trinity/src/kern/fs/sfs/sfs_bmap.c
/home/trinity/src/kern/fs/sfs/sfs_dir.c
/home/trinity/src/kern/fs/sfs/sfs_fsops.c
/home/trinity/src/kern/fs/sfs/sfs_inode.c
/home/trinity/src/kern/fs/sfs/sfs_io.c
/home/trinity/src/kern/fs/sfs/sfs_vnops.c
/home/trinity/src/kern/fs/sfs/sfsprivate.h
/home/trinity/src/kern/include/addrspace.h
/home/trinity/src/kern/include/array.h
/home/trinity/src/kern/include/bitmap.h
/home/trinity/src/kern/include/cdefs.h
/home/trinity/src/kern/include/clock.h
/home/trinity/src/kern/include/copyinout.h
/home/trinity/src/kern/include/cpu.h
/home/trinity/src/kern/include/current.h
/home/trinity/src/kern/include/device.h
/home/trinity/src/kern/include/elf.h
/home/trinity/src/kern/include/emufs.h
/home/trinity/src/kern/include/endian.h
/home/trinity/src/kern/include/fs.h
/home/trinity/src/kern/include/hangman.h
/home/trinity/src/kern/include/kern/endian.h
/home/trinity/src/kern/include/kern/errmsg.h
/home/trinity/src/kern/include/kern/errno.h
/home/trinity/src/kern/include/kern/fcntl.h
/home/trinity/src/kern/include/kern/ioctl.h
/home/trinity/src/kern/include/kern/iovec.h
/home/trinity/src/kern/include/kern/limits.h
/home/trinity/src/kern/include/kern/reboot.h
/home/trinity/src/kern/include/kern/resource.h
/home/trinity/src/kern/include/kern/secret.h
/home/trinity/src/kern/include/kern/secure.h
/home/trinity/src/kern/include/kern/seek.h
/home/trinity/src/kern/include/kern/sfs.h
/home/trinity/src/kern/include/kern/signal.h
/home/trinity/src/kern/include/kern/socket.h
/home/trinity/src/kern/include/kern/stat.h
/home/trinity/src/kern/include/kern/stattypes.h
/home/trinity/src/kern/include/kern/syscall.h
/home/trinity/src/kern/include/kern/test161.h
/home/trinity/src/kern/include/kern/time.h
/home/trinity/src/kern/include/kern/types.h
/home/trinity/src/kern/include/kern/unistd.h
/home/trinity/src/kern/include/kern/wait.h
/home/trinity/src/kern/include/lib.h
/home/trinity/src/kern/include/limits.h
/home/trinity/src/kern/include/mainbus.h
/home/trinity/src/kern/include/membar.h
/home/trinity/src/kern/include/proc.h
/home/trinity/src/kern/include/prompt.h
/home/trinity/src/kern/include/setjmp.h
/home/trinity/src/kern/include/sfs.h
/home/trinity/src/kern/include/signal.h
/home/trinity/src/kern/include/spinlock.h
/home/trinity/src/kern/include/spl.h
/home/trinity/src/kern/include/stat.h
/home/trinity/src/kern/include/stdarg.h
/home/trinity/src/kern/include/synch.h
/home/trinity/src/kern/include/syscall.h
/home/trinity/src/kern/include/test.h
/home/trinity/src/kern/include/thread.h
/home/trinity/src/kern/include/threadlist.h
/home/trinity/src/kern/include/threadprivate.h
/home/trinity/src/kern/include/types.h
/home/trinity/src/kern/include/uio.h
/home/trinity/src/kern/include/version.h
/home/trinity/src/kern/include/vfs.h
/home/trinity/src/kern/include/vm.h
/home/trinity/src/kern/include/vnode.h
/home/trinity/src/kern/include/wchan.h
/home/trinity/src/kern/lib/array.c
/home/trinity/src/kern/lib/bitmap.c
/home/trinity/src/kern/lib/bswap.c
/home/trinity/src/kern/lib/kgets.c
/home/trinity/src/kern/lib/kprintf.c
/home/trinity/src/kern/lib/misc.c
/home/trinity/src/kern/lib/time.c
/home/trinity/src/kern/lib/uio.c
/home/trinity/src/kern/main/main.c
/home/trinity/src/kern/main/menu.c
/home/trinity/src/kern/proc/proc.c
/home/trinity/src/kern/synchprobs/stoplight.c
/home/trinity/src/kern/synchprobs/whalemating.c
/home/trinity/src/kern/syscall/loadelf.c
/home/trinity/src/kern/syscall/runprogram.c
/home/trinity/src/kern/syscall/time_syscalls.c
/home/trinity/src/kern/test/arraytest.c
/home/trinity/src/kern/test/automationtest.c
/home/trinity/src/kern/test/bitmaptest.c
/home/trinity/src/kern/test/fstest.c
/home/trinity/src/kern/test/hmacunit.c
/home/trinity/src/kern/test/kmalloctest.c
/home/trinity/src/kern/test/lib.c
/home/trinity/src/kern/test/nettest.c
/home/trinity/src/kern/test/rwtest.c
/home/trinity/src/kern/test/semunit.c
/home/trinity/src/kern/test/synchprobs.c
/home/trinity/src/kern/test/synchtest.c
/home/trinity/src/kern/test/threadlisttest.c
/home/trinity/src/kern/test/threadtest.c
/home/trinity/src/kern/test/tt3.c
/home/trinity/src/kern/thread/clock.c
/home/trinity/src/kern/thread/hangman.c
/home/trinity/src/kern/thread/spinlock.c
/home/trinity/src/kern/thread/spl.c
/home/trinity/src/kern/thread/synch.c
/home/trinity/src/kern/thread/thread.c
/home/trinity/src/kern/thread/threadlist.c
/home/trinity/src/kern/vfs/device.c
/home/trinity/src/kern/vfs/devnull.c
/home/trinity/src/kern/vfs/vfscwd.c
/home/trinity/src/kern/vfs/vfsfail.c
/home/trinity/src/kern/vfs/vfslist.c
/home/trinity/src/kern/vfs/vfslookup.c
/home/trinity/src/kern/vfs/vfspath.c
/home/trinity/src/kern/vfs/vnode.c
/home/trinity/src/kern/vm/addrspace.c
/home/trinity/src/kern/vm/copyinout.c
/home/trinity/src/kern/vm/kmalloc.c
